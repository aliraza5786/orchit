import{D as A}from"./vuedraggable.umd-DbAKQh2u.js";import{d as R,W as O,u as J,r as C,n as K,c as Q,j as D,o as h,z as U,f as y,i as P,L as _,k as $,e as F,D as G,ah as L,h as V,t as z,P as H,p as c,w,al as X,J as q,af as Y}from"./index-D8TZ_VUv.js";import{_ as Z}from"./DropMenu.vue_vue_type_script_setup_true_lang-B4L6ax1K.js";import{u as ee}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-BYh4oA3G.js";import"./lodash-B3d4OLnQ.js";const oe={class:"flex items-center justify-between w-full p-4 border-b border-border cursor-grab"},ne={class:"flex items-center gap-2 flex-auto max-w-4/5"},te=["onKeydown"],le=["onKeydown"],se={class:"text-xs bg-muted bg-bg-card aspect-square flex justify-center items-center text-muted-foreground p-1 min-w-6 rounded-full"},ae=R({__name:"KanbanColumn",props:{column:{},variable_id:{},sheet_id:{},canDragList:{type:Boolean},plusIcon:{type:Boolean},index:{},totalColumns:{}},emits:["update:column","delete:column","onPlus","reorder","select:ticket","move:column"],setup(M,{emit:S}){const{canDeleteVariable:I,canEditVariable:v}=O(),o=M,r=S,B=J(),b=()=>{var e,a;B.setTransition({...(e=o==null?void 0:o.column)==null?void 0:e.transitions,currentColumn:(a=o.column)==null?void 0:a.title})},p=()=>{B.setTransition({})},u=C(!1),m=C(o.column.title),x=C(null);K(()=>o.column.title,e=>{m.value=e});function k(){!v.value||!g()||(u.value=!0,X(()=>{x.value&&(x.value.focus(),x.value.select())}))}function E(){const e=(m.value??"").trim()||"Untitled";e!==o.column.title?r("update:column",{...o.column,title:e,oldTitle:o.column.title}):m.value=o.column.title,u.value=!1}function T(){m.value=o.column.title,u.value=!1}const n=C([...o.column.cards??[]]);K(()=>o.column.cards,e=>{n.value=[...e??[]]});const t={backlog:"bg-column-backlog",todo:"bg-column-todo",progress:"bg-column-progress",done:"bg-column-done"},i=Q(()=>{const e=String(o.column._id);return t[e]??"bg-muted/30"});function l(e){var f,N,W,j;const a=e.moved??e.added;a&&r("reorder",{moved:a.element,fromColumnId:((W=(N=(f=e.from)==null?void 0:f.__draggable_component__)==null?void 0:N.$props)==null?void 0:W.listOwnerId)??((j=o.column)==null?void 0:j.title),toColumnId:o.column._id,oldIndex:a.oldIndex??null,newIndex:a.newIndex??null})}function s(){if(!v.value&&!I.value)return[];const e=[];return v.value&&(o.index!==void 0&&o.index>0&&e.push({label:"Move column left side",action:()=>{r("move:column",{direction:"left",column:o.column})}}),o.index!==void 0&&o.totalColumns!==void 0&&o.index<o.totalColumns-1&&e.push({label:"Move column right side",action:()=>{r("move:column",{direction:"right",column:o.column})}})),I.value&&e.push({label:"Delete",danger:!0,action:()=>d()}),e}function g(){var a;const e=(a=o==null?void 0:o.column)==null?void 0:a.title.trim().toLowerCase();if(e)switch(e){case"admin":return!1;default:return!0}}const d=()=>{var e;r("delete:column",{title:o.column.title,columnId:(e=o.column)==null?void 0:e._id})};return window.addEventListener("close-all-showADDNEW",()=>{o.column.showADDNEW=!1}),(e,a)=>(h(),D("div",{class:U(["flex bg-bg-body flex-col min-h-[565px] h-full w-full rounded-lg transition-all duration-200",i.value])},[y("div",oe,[y("div",ne,[u.value?G((h(),D("input",{key:1,autofocus:"",ref_key:"titleInputRef",ref:x,"onUpdate:modelValue":a[0]||(a[0]=f=>m.value=f),class:"font-semibold inline text-foreground px-1 py-0.5 rounded bg-transparent border border-border focus:outline-none focus:ring-1 focus:ring-border",onKeydown:[L(V(E,["prevent"]),["enter"]),L(V(T,["prevent"]),["esc"])],onBlur:E,onMousedown:a[1]||(a[1]=V(()=>{},["stop"]))},null,40,le)),[[H,m.value]]):(h(),D("button",{key:0,class:"font-semibold overflow-ellipsis line-clamp-1 text-nowrap text-foreground px-1 py-0.5 rounded hover:bg-bg-card focus:outline-none focus:ring-1 focus:ring-border cursor-text",onClick:k,onKeydown:L(V(k,["prevent"]),["enter"]),title:"Click to rename"},z(m.value),41,te)),y("span",se,z(n.value.length),1)]),e.plusIcon?(h(),D("i",{key:0,class:"cursor-pointer fa-solid fa-plus",onClick:a[2]||(a[2]=f=>r("onPlus",e.column))})):$("",!0),g()&&(c(v)||c(I))?(h(),F(Z,{key:1,items:s()},{trigger:w(()=>a[4]||(a[4]=[y("i",{class:"fa-solid fa-ellipsis cursor-pointer"},null,-1)])),_:1},8,["items"])):$("",!0)]),P(c(A),{disabled:!e.canDragList,modelValue:n.value,"onUpdate:modelValue":a[3]||(a[3]=f=>n.value=f),"item-key":"_id",class:"flex-1 p-4 space-y-3 overflow-y-auto",group:{name:"tickets",pull:!0,put:!0},animation:180,"ghost-class":"kanban-ghost","chosen-class":"kanban-chosen",onStart:b,onEnd:p,"drag-class":"kanban-dragging",onChange:l},{item:w(({element:f})=>[y("div",null,[_(e.$slots,"ticket",{ticket:f},void 0,!0)])]),footer:w(()=>[n.value.length?$("",!0):_(e.$slots,"emptyState",{key:0,column:e.column},void 0,!0)]),_:3},8,["disabled","modelValue"]),_(e.$slots,"footer",{column:e.column},void 0,!0)],2))}}),ie=q(ae,[["__scopeId","data-v-d986dc1a"]]),ue={class:"h-full flex gap-3"},re=R({__name:"KanbanBoard",props:{board:{},onBoardUpdate:{},variable_id:{},sheet_id:{},plusIcon:{type:Boolean,default:!0}},emits:["update:board","select:ticket","update:column","delete:column","onPlus","reorder"],setup(M,{emit:S}){const{canCreateCard:I,canEditCard:v}=O(),o=ee("(max-width: 650px)"),r=C(v.value);Y(()=>{r.value=v.value});const B=()=>{console.log(">>> strating"),r.value=!1},b=M,p=S,u=C(T(b.board));K(()=>b.board,n=>{u.value=T(n)});function m(n){const t=n.oldIndex,i=n.newIndex,l=u.value.columns[i],s=l!=null&&l.title?l==null?void 0:l.title:"",g=l==null?void 0:l._id;s!=null&&k("column",{id:s,oldIndex:t,newIndex:i,_id:g}),r.value=!0}function x(n){console.log(n),k("ticket",n)}function k(n,t){var l;const i=u.value;p("update:board",i),p("reorder",{type:n,board:i,meta:t}),(l=b.onBoardUpdate)==null||l.call(b,i)}function E({direction:n,column:t}){const i=[...u.value.columns],l=i.findIndex(g=>g.title.toLowerCase()===t.title.toLowerCase());if(l===-1)return;let s=l;if(n==="left"&&l>0?s=l-1:n==="right"&&l<i.length-1&&(s=l+1),s!==l){const[g]=i.splice(l,1);i.splice(s,0,g),u.value.columns=i;const d=i[s],e=d!=null&&d.title?d==null?void 0:d.title:"",a=d==null?void 0:d._id;e!=null&&k("column",{id:e,oldIndex:l,newIndex:s,_id:a})}}function T(n){return{columns:((n==null?void 0:n.length)>0?n:[]).map(t=>({_id:t==null?void 0:t._id,title:t==null?void 0:t.title,transitions:t.transitions,cards:((t==null?void 0:t.cards)??[]).map(i=>({...i}))}))}}return(n,t)=>(h(),D("div",ue,[P(c(A),{modelValue:u.value.columns,"onUpdate:modelValue":t[4]||(t[4]=i=>u.value.columns=i),"item-key":"_id",group:"columns",animation:180,"ghost-class":"kanban-ghost","chosen-class":"kanban-chosen","drag-class":"kanban-dragging","force-fallback":!0,disabled:c(o),class:U(["flex gap-3",{"overflow-x-auto snap-x snap-mandatory w-full pb-4 mobile-scroll-visible":c(o),"min-w-max":!c(o)}]),direction:"horizontal",onEnd:m,onStart:B},{item:w(({element:i,index:l})=>[y("div",{class:U(["rounded-lg bg-bg-surface h-full",{"snap-center min-w-[270px] max-w-[270px]":c(o),"min-w-[320px] max-w-[320px]":!c(o)}])},[P(ie,{plusIcon:n.plusIcon&&c(I),canDragList:!c(o)&&r.value,onOnPlus:t[0]||(t[0]=s=>p("onPlus",s)),sheet_id:n.sheet_id,variable_id:n.variable_id,"onUpdate:column":t[1]||(t[1]=s=>p("update:column",s)),index:l,totalColumns:u.value.columns.length,"onSelect:ticket":t[2]||(t[2]=s=>p("select:ticket",s)),"onDelete:column":t[3]||(t[3]=s=>p("delete:column",s)),column:i,onReorder:x,"onMove:column":E},{emptyState:w(({column:s})=>[_(n.$slots,"emptyState",{column:s},void 0,!0)]),ticket:w(({ticket:s})=>[_(n.$slots,"ticket",{ticket:s},void 0,!0)]),footer:w(({column:s})=>[_(n.$slots,"column-footer",{column:s},void 0,!0)]),_:2},1032,["plusIcon","canDragList","sheet_id","variable_id","index","totalColumns","column"])],2)]),_:3},8,["modelValue","disabled","class"])]))}}),ge=q(re,[["__scopeId","data-v-2a9d41b1"]]);export{ge as default};
