const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CreateTaskModal-CNtPViHO.js","assets/CreateTaskModal.vue_vue_type_script_setup_true_lang-9K3ykgmj.js","assets/index-BwDegMQR.js","assets/index-CtUylECF.css","assets/ConfirmDeleteModal-B4AwgacM.js","assets/ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-BtEcibsL.js","assets/SidePanel-B3bD0s9k.js","assets/SidePanel-D0jmQaof.css","assets/KanbanBoard-A6fi2rIM.js","assets/DropMenu.vue_vue_type_script_setup_true_lang-FP483xO8.js","assets/index-Cj6ciq7q.js","assets/workspace-CqnIlRFj.js","assets/KanbanBoard-D-U-s5tF.css"])))=>i.map(i=>d[i]);
import{J as ne,K as fe,L as q,n as c,r as C,m as Q,M as Be,c as R,N as ae,d as ve,O as Re,i as B,e as l,g as re,y as Y,b as I,h as N,w as V,f as J,B as ge,T as qe,t as E,P as Ie,o as x,Q as Qe,R as We,j as se,S as Oe,A as Pe,U as Xe,V as Ye,W as et,X as tt,a as je,Y as st,Z as at,$ as rt,a0 as nt,C as Ae,a1 as De,a2 as Te,p as ot,F as He}from"./index-BwDegMQR.js";import{K as lt,D as it}from"./KanbanSkeleton-CaozuWBb.js";import{_ as dt}from"./SearchBar.vue_vue_type_script_setup_true_lang-D1E2iujg.js";import{_ as ut}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-BtEcibsL.js";import{u as ct}from"./workspace-CqnIlRFj.js";import"./index-Cj6ciq7q.js";const pt="data:image/svg+xml,%3csvg%20width='60'%20height='46'%20viewBox='0%200%2060%2046'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20opacity='0.4'%3e%3cpath%20d='M59.7443%2034.8967L50.5682%2025.7206C50.4457%2025.5984%2050.2897%2025.5152%2050.1199%2025.4816C49.9501%2025.4479%2049.7742%2025.4653%2049.6143%2025.5315C49.4544%2025.5976%2049.3176%2025.7097%2049.2213%2025.8535C49.125%2025.9973%2049.0734%2026.1664%2049.073%2026.3394V30.517H25.9775V40.5114H49.0755V44.689C49.0759%2044.8621%2049.1275%2045.0312%2049.2238%2045.175C49.3201%2045.3187%2049.4569%2045.4308%2049.6168%2045.497C49.7767%2045.5632%2049.9527%2045.5805%2050.1224%2045.5468C50.2922%2045.5132%2050.4482%2045.43%2050.5708%2045.3078L59.7468%2036.1318C59.9095%2035.9672%2060.0005%2035.7451%2060.0001%2035.5137C59.9996%2035.2823%2059.9076%2035.0605%2059.7443%2034.8967Z'%20fill='%23C6DBA9'/%3e%3cpath%20d='M32.3149%2030.5293C30.664%2031.5967%2028.7394%2032.1633%2026.7734%2032.1609V40.5237H34.7295C39.2829%2038.5638%2042.9649%2035.0102%2045.0851%2030.5293H32.3149Z'%20fill='url(%23paint0_linear_250_16424)'/%3e%3cpath%20d='M46.2209%2020.2832C46.2317%2015.0884%2044.2448%2010.0884%2040.6714%206.3179C37.0981%202.54738%2032.2119%200.295026%2027.024%200.0269855C21.8362%20-0.241055%2016.7439%201.49574%2012.801%204.87791C8.85809%208.26009%206.36647%2013.0287%205.84178%2018.1969L2.46233%2017.8913C2.31055%2017.8782%202.15829%2017.9103%202.02467%2017.9835C1.89106%2018.0566%201.78205%2018.1677%201.71134%2018.3026C1.64063%2018.4376%201.61138%2018.5904%201.62726%2018.7419C1.64313%2018.8934%201.70343%2019.0368%201.80058%2019.1542L9.51927%2028.406C9.79205%2028.7344%2010.277%2028.7773%2010.378%2028.5045L19.6298%2020.7833C20.3876%2020.3413%2020.1173%2019.4825%2019.4328%2019.4194L15.8008%2019.091C16.0297%2017.1283%2016.8213%2015.2735%2018.0802%2013.7503C19.3391%2012.2271%2021.0115%2011.1004%2022.8961%2010.5059C24.7806%209.9114%2026.7969%209.8745%2028.7019%2010.3996C30.6069%2010.9248%2032.3195%2011.9896%2033.6332%2013.4657C34.947%2014.9419%2035.8059%2016.7664%2036.1065%2018.7195C36.4071%2020.6726%2036.1365%2022.6709%2035.3274%2024.4738C34.5183%2026.2766%2033.2051%2027.8071%2031.5462%2028.8807C29.8872%2029.9544%2027.9531%2030.5254%2025.977%2030.5251H25.9283V40.5094C31.2249%2040.4031%2036.7093%2038.2263%2040.4202%2034.4455C44.1311%2030.6648%2046.2134%2025.5808%2046.2209%2020.2832Z'%20fill='%23D7A39E'/%3e%3cpath%20d='M25.9773%2030.5293H0V40.5237H25.9773V30.5293Z'%20fill='url(%23paint1_linear_250_16424)'/%3e%3c/g%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_250_16424'%20x1='6.53714'%20y1='35.5252'%20x2='47.0198'%20y2='35.5252'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%236C798F'/%3e%3cstop%20offset='1'%20stop-color='%236C798F'%20stop-opacity='0.1'/%3e%3c/linearGradient%3e%3clinearGradient%20id='paint1_linear_250_16424'%20x1='0'%20y1='36'%20x2='26'%20y2='36'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23E8D4D3'%20stop-opacity='0'/%3e%3cstop%20offset='1'%20stop-color='%23E2A39F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",Ke="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='20'%20height='20'%20rx='3.33333'%20fill='%2329BF7F'/%3e%3cpath%20d='M6.43164%2014.3018L9.29004%2012.167L9.29102%2012.166C9.47176%2012.0328%209.69053%2011.9609%209.91504%2011.9609C10.0834%2011.9609%2010.2482%2012.0017%2010.3965%2012.0781L10.5391%2012.166L10.54%2012.167L13.373%2014.291V5.91699H6.43164V14.3018ZM14.4316%2014.3789C14.4277%2014.5672%2014.3725%2014.7506%2014.2725%2014.9102C14.1723%2015.0699%2014.0303%2015.1996%2013.8623%2015.2852C13.6944%2015.3706%2013.5064%2015.4094%2013.3184%2015.3965C13.1304%2015.3835%2012.9495%2015.3196%2012.7949%2015.2119L12.79%2015.208L9.91504%2013.0518L7.01465%2015.209C6.83427%2015.3432%206.61546%2015.4161%206.39062%2015.417H6.38965C6.2298%2015.4164%206.07171%2015.38%205.92773%2015.3105V15.3096C5.75087%2015.2261%205.60123%2015.0946%205.49609%2014.9297C5.3907%2014.7642%205.33364%2014.5721%205.33301%2014.376V5.87402C5.3338%205.7361%205.36234%205.59971%205.41602%205.47266C5.46971%205.3456%205.54812%205.23049%205.64648%205.13379C5.74485%205.0371%205.86131%204.96069%205.98926%204.90918C6.1165%204.85797%206.2525%204.83272%206.38965%204.83398V4.83301H13.3906C13.6661%204.83457%2013.9302%204.94494%2014.125%205.13965C14.3198%205.33446%2014.4301%205.59852%2014.4316%205.87402V14.3789Z'%20fill='white'%20stroke='white'%20stroke-width='0.333333'/%3e%3c/svg%3e",mt=(o,n={})=>fe({queryKey:["sprint-list"],queryFn:({signal:v})=>q({url:`sprints/${o}`,method:"GET",signal:v}),...n}),gt=(o,n={})=>fe({queryKey:["sprint-cards",o],queryFn:({signal:v})=>q({url:`sprints/${c(o)}/backlog`,method:"GET",signal:v}),...n}),ft=(o,n={})=>fe({queryKey:["sprint-kanban",o],queryFn:({signal:v})=>q({url:`workspace/cards/sprintgrouped?sprint_id=${c(o)}&variable_id=68b6c96e0a95eef7d14e6981`,method:"GET",signal:v}),...n}),vt=(o,n={})=>ne({key:["sprint-complete"]},{mutationFn:v=>q({url:`sprints/${c(o)}/complete`,method:"POST",data:v.payload}),...n}),bt=(o,n={})=>fe({queryKey:["sprint-detail",o],queryFn:({signal:v})=>q({url:`sprints/detail/${c(o)}?include_cards=true`,method:"GET",signal:v}),...n}),Ee=(o,n={})=>fe({queryKey:["backlog-list",o],queryFn:({signal:v})=>q({url:`sprints/workspace/${c(o)}/cards?include_sprint_cards=false`,method:"GET",signal:v}),...n}),ze=(o={})=>ne({key:["move-card-to-sprint"]},{mutationFn:n=>q({url:`/sprints/${n.id}/cards`,method:"POST",data:n.payload}),...o}),yt=(o={})=>ne({key:["add-sprint"]},{mutationFn:n=>q({url:`/sprints/${n.id}`,method:"PUT",data:n.payload}),...o}),kt=(o={})=>ne({key:["start-sprint"]},{mutationFn:n=>q({url:`/sprints/${n.id}/start`,method:"POST",data:n.payload}),...o}),xt=(o={})=>ne({key:["delete-sprint"]},{mutationFn:n=>q({url:`/sprints/${n}`,method:"DELETE"}),...o}),Ct=(o={})=>ne({key:["remove-card-from-sprint"]},{mutationFn:n=>q({url:`sprints/${c(n.sprintId)}/cards/remove `,method:"POST",data:{card_ids:[n.cardId]}}),...o}),Ze="jira-like:";function Fe(o="id"){return`${o}_${Math.random().toString(36).slice(2,9)}`}function Ue(o,n){try{localStorage.setItem(Ze+o,JSON.stringify(n))}catch{}}function Ne(o,n){try{const v=localStorage.getItem(Ze+o);return v?JSON.parse(v):n}catch{return n}}function Ge(o){switch(o){case"Highest":return"rounded-md bg-red-50 px-2 py-0.5 text-xs text-red-700";case"High":return"rounded-md bg-orange-50 px-2 py-0.5 text-xs text-orange-700";case"Medium":return"rounded-md bg-amber-50 px-2 py-0.5 text-xs text-amber-700";case"Low":return"rounded-md bg-gray-100 px-2 py-0.5 text-xs text-gray-600"}}function Je(){const o=C(Ne("backlog",[])),n=C(Ne("sprints",[]));if(n.value.length===0)n.value.push({id:Fe("sprint"),name:"Sprint 1",goal:"",start:"",end:"",started:!1,tickets:[]});else if(n.value.length>1){for(let t=1;t<n.value.length;t++)o.value.push(...n.value[t].tickets);n.value=[n.value[0]]}const v=C(n.value[0].id);Q([o,n],()=>{Ue("backlog",o.value),Ue("sprints",n.value)},{deep:!0});const D=C([]),h=Be({}),y=R(()=>o.value.length>0&&D.value.length===o.value.length),_=t=>{var a;const s=n.value.find(i=>i.id===t);return!!s&&s.tickets.length>0&&(((a=h[t])==null?void 0:a.length)||0)===s.tickets.length};function L(t,s,a){const i=s.target.checked;if(t==="backlog")D.value=i?o.value.map(g=>g.id):[];else if(a){const g=n.value.find(d=>d.id===a);h[a]=i&&g?g.tickets.map(d=>d.id):[]}}function $(t,s,a,i){const g=a.target.checked,d=t==="backlog"?D.value:h[i]||(h[i]=[]);if(g&&!d.includes(s)&&d.push(s),!g){const A=d.indexOf(s);A>=0&&d.splice(A,1)}}function k(){return n.value.find(t=>t.id===v.value)||n.value[0]}function M(){const s=[...o.value,...n.value.flatMap(i=>i.tickets)].map(i=>Number(String(i.key).replace(/[^0-9]/g,""))).filter(i=>!Number.isNaN(i));return`PRJ-${s.length?Math.max(...s)+1:1}`}const{mutate:S}=ze({onSuccess:()=>{ae.success("Cards moved to sprint successfully")},onError:t=>{ae.error("Failed to move cards: "+(t.message||"Unknown error"))}});function P(){var i,g;const t=k();if(!t||!D.value.length)return;const s=[],a=[];for(const d of o.value)(D.value.includes(d.id)?a:s).push(d);o.value=s,t.tickets.push(...a),D.value=[],a.length>0&&S({id:t.id,payload:{card_ids:a.map(d=>d.id),priority:((g=(i=a[0])==null?void 0:i.priority)==null?void 0:g.toLowerCase())||"medium",story_points:a.reduce((d,A)=>d+(A.storyPoints||0),0)}})}function H(t){const s=n.value.find(d=>d.id===t);if(!s)return;const a=h[t]||[],i=[],g=[];for(const d of s.tickets)(a.includes(d.id)?g:i).push(d);s.tickets=i,o.value.push(...g),h[t]=[]}function O(t,s){if(t==="backlog")o.value=o.value.filter(a=>!D.value.includes(a.id)),D.value=[];else if(s){const a=h[s]||[],i=n.value.find(g=>g.id===s);if(!i)return;i.tickets=i.tickets.filter(g=>!a.includes(g.id)),h[s]=[]}}function b(t,s){const a={id:Fe("T"),key:M(),createdAt:new Date().toISOString(),...s};if(t==="backlog")o.value.push(a);else{const i=k();i==null||i.tickets.push(a)}}function e(t){const s=k();s&&(s.name=t.name??s.name,s.goal=t.goal??s.goal,s.start=t.start??s.start,s.end=t.end??s.end)}function r(){const t=k();t&&(t.started=!t.started)}function m(t){return t.tickets.reduce((s,a)=>s+(a.storyPoints||0),0)}return{backlog:o,sprints:n,activeSprintId:v,selectedBacklogIds:D,selectedSprintIds:h,allBacklogChecked:y,allSprintChecked:_,toggleAll:L,toggleOne:$,getActiveSprint:k,createTicket:b,saveSprintMeta:e,toggleStartSprint:r,sprintPoints:m,moveSelectedToSprint:P,moveSelectedToBacklog:H,deleteSelected:O,priorityClass:Ge}}const St={class:"space-y-3 flex flex-col overflow-y-auto"},_t={key:0,class:"empty-state flex flex-col justify-center items-center h-full"},ht={class:"flex items-center gap-2 text-text-secondary float-start"},wt={class:"inline-block rounded-full px-2 py-0.5 text-xs"},Dt={class:"truncate"},Tt={key:0,class:"float-end flex justify-center text-gray-500 items-center text-xs aspect-square max-w-6 min-h-6 bg-gray-500/10 rounded-full"},Vt={key:1,class:"text-xs aspect-square max-w-6 flex justify-center items-center text-center min-h-6 bg-accent/30 text-accent border-accent border rounded-full"},Lt=["onDragstart"],$t=ve({__name:"BacklogTable",props:{sorters:{}},emits:["ticket-dragged-to-sprint","open-ticket","ticket-moved-to-backlog"],setup(o,{emit:n}){const v=n,{workspaceId:D}=Re(),{data:h,isPending:y}=Ee(D),_=C([]);Q(h,b=>{b!=null&&b.cards&&(_.value=b.cards.map(e=>{var a,i,g,d,A;const r=((a=e.card)==null?void 0:a.variables)??{},m=((i=e.card)==null?void 0:i._id)??e.card_id,t=String(r["card-status"]??"").trim(),s=String(r.priority??"").trim();return{id:m,key:r["card-code"]||(m==null?void 0:m.slice(-6))||"PRJ-?",summary:r["card-title"]||"(untitled)",type:"Story",status:t,assignee:((d=(g=e.card)==null?void 0:g.assigned_to)==null?void 0:d.name)??"Unassigned",storyPoints:Number(e.story_points??0)||0,priority:$(s),createdAt:((A=e.card)==null?void 0:A.created_at)??new Date().toISOString(),description:r["card-description"]||""}}))},{immediate:!0});function L(b){const e=b.toLowerCase();switch(e.trim()){case"todo":return"bg-gray-500/10 text-gray-500";case"to do":return"bg-gray-500/10 text-gray-500";case"in progress":return"bg-gray-amber/10 text-amber-500";case"done":return"bg-green-500/10 text-green-500"}return e.includes("progress")?"In Progress":e.includes("done")||e.includes("complete")?"Done":"Todo"}function $(b){const e=String(b??"").toLowerCase();return e==="highest"||e==="blocker"||e==="critical"?"Highest":e==="high"||e==="major"?"High":e==="medium"||e==="normal"?"Medium":"Low"}const k=C(!1),M=C(null);function S(b,e,r){var t;M.value=e.id;const m=JSON.stringify({id:e.id,from:r,ticket:e});(t=b.dataTransfer)==null||t.setData("text/plain",m),b.dataTransfer&&(b.dataTransfer.effectAllowed="move")}function P(b){var e;k.value=!1,((e=b.dataTransfer)==null?void 0:e.dropEffect)!=="none"&&M.value&&(_.value=_.value.filter(r=>r.id!==M.value)),M.value=null}function H(b){var e;b.preventDefault(),k.value=!1;try{const r=(e=b.dataTransfer)==null?void 0:e.getData("text/plain");if(!r)return;const m=JSON.parse(r);if(m.from!=="sprint"||_.value.some(s=>s.id===m.id))return;_.value.push(m.ticket),v("ticket-moved-to-backlog",m.id,m.sprintId)}catch(r){console.error("Drop error:",r)}}const O=R(()=>[{key:"summary",label:"Summary",sortable:!1},{key:"status",label:"Status",width:120,sortable:!1},{key:"assignee",label:"",width:120,sortable:!1}]);return(b,e)=>(x(),B("section",St,[l("div",{class:Y(["rounded-lg border h-[300px] border-border flex flex-col",k.value?"ring-2 ring-blue-400":""]),onDragover:e[4]||(e[4]=re(()=>{},["prevent"])),onDragenter:e[5]||(e[5]=r=>k.value=!0),onDragleave:e[6]||(e[6]=r=>k.value=!1),onDrop:e[7]||(e[7]=r=>H(r))},[!c(y)&&_.value.length===0?(x(),B("div",_t,[e[9]||(e[9]=l("img",{src:pt,class:"mb-4",alt:"backlog-plan"},null,-1)),e[10]||(e[10]=l("h6",{class:"text-sm text-text-primary font-semibold mb-1"},"Get started in the backlog",-1)),e[11]||(e[11]=l("p",{class:"text-sm text-text-primary/90 mb-3"},"Plan and start a sprint to see issues here.",-1)),N(ge,null,{default:V(()=>e[8]||(e[8]=[J("Add Task Backlog")])),_:1,__:[8]})])):(x(),I(qe,{key:1,showHeader:!1,pagination:!1,class:"flex-grow h-full",rowDraggable:!0,onRowDragstart:e[1]||(e[1]=({row:r,$event:m})=>S(m,r,"backlog")),onRowDragend:e[2]||(e[2]=({$event:r})=>P(r)),columns:O.value,rows:_.value,"page-size":20,hover:!0,itemKey:r=>r.id,sorters:b.sorters,onRowClick:e[3]||(e[3]=({row:r})=>b.$emit("open-ticket",r))},{summary:V(({row:r})=>[l("div",ht,[e[12]||(e[12]=l("img",{src:Ke,alt:""},null,-1)),l("span",wt,E(r.key),1),l("span",Dt,E(r.summary),1)])]),status:V(({row:r})=>[l("span",{class:Y([L(r.status),"px-2 py-1 rounded-md"])},E(r.status),3)]),assignee:V(({row:r})=>[r.assignee=="Unassigned"?(x(),B("span",Tt,"UA")):(x(),B("span",Vt,E(c(Ie)(r.assignee)),1))]),drag:V(({row:r})=>[l("button",{class:"cursor-grab",title:"Drag to Sprint",draggable:"",onClick:e[0]||(e[0]=re(()=>{},["stop"])),onDragstart:m=>S(m,r,"backlog"),onDragend:P},"↕",40,Lt)]),_:1},8,["columns","rows","itemKey","sorters"]))],34)]))}}),Mt="data:image/svg+xml,%3csvg%20width='60'%20height='60'%20viewBox='0%200%2060%2060'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20opacity='0.4'%3e%3cpath%20d='M9.375%2030C11.6402%2030%2013.4766%2028.1637%2013.4766%2025.8984C13.4766%2023.6332%2011.6402%2021.7969%209.375%2021.7969C7.10977%2021.7969%205.27344%2023.6332%205.27344%2025.8984C5.27344%2028.1637%207.10977%2030%209.375%2030Z'%20fill='%23AE2A19'/%3e%3cpath%20d='M26.25%2024.375C28.5152%2024.375%2030.3516%2022.5387%2030.3516%2020.2734C30.3516%2018.0082%2028.5152%2016.1719%2026.25%2016.1719C23.9848%2016.1719%2022.1484%2018.0082%2022.1484%2020.2734C22.1484%2022.5387%2023.9848%2024.375%2026.25%2024.375Z'%20fill='%23BF63F3'/%3e%3cpath%20d='M15.3931%2035.8594H11.0159V33.0938C9.93587%2033.3387%208.81469%2033.3387%207.73465%2033.0938V35.8594H1.87528C1.55115%2035.8601%201.2345%2035.9568%200.965283%2036.1373C0.696064%2036.3178%200.486343%2036.574%200.362583%2036.8736C0.238824%2037.1731%200.206573%2037.5027%200.269899%2037.8205C0.333226%2038.1384%200.489292%2038.4304%200.718404%2038.6597L7.05872%2045L0.718404%2051.3403C0.489292%2051.5696%200.333226%2051.8616%200.269899%2052.1795C0.206573%2052.4973%200.238824%2052.8269%200.362583%2053.1264C0.486343%2053.426%200.696064%2053.6822%200.965283%2053.8627C1.2345%2054.0432%201.55115%2054.1399%201.87528%2054.1406H15.3931L21.7503%2045L15.3931%2035.8594Z'%20fill='%2382B536'/%3e%3cpath%20d='M34.4562%2035.8594H27.8937V27.4688C26.8137%2027.7138%2025.6925%2027.7138%2024.6125%2027.4688V35.8594H19.3896L25.7487%2045L19.3896%2054.1406H34.4562L40.8143%2045L34.4562%2035.8594Z'%20fill='%2382B536'/%3e%3cpath%20d='M43.8281%2019.6875H55.3125C55.7475%2019.6873%2056.1647%2019.5143%2056.4723%2019.2067C56.7799%2018.8991%2056.9529%2018.4819%2056.9531%2018.0469V9.375C56.9529%208.93996%2056.7799%208.5228%2056.4723%208.21518C56.1647%207.90755%2055.7475%207.73462%2055.3125%207.73438H43.8281V7.5C43.8281%207.06488%2043.6553%206.64758%2043.3476%206.3399C43.0399%206.03223%2042.6226%205.85938%2042.1875%205.85938C41.7524%205.85938%2041.3351%206.03223%2041.0274%206.3399C40.7197%206.64758%2040.5469%207.06488%2040.5469%207.5V32.5781H43.8281V19.6875Z'%20fill='%23FCA700'/%3e%3cpath%20d='M59.2843%2043.8403L51.7843%2036.3403C51.6322%2036.1878%2051.4514%2036.0668%2051.2524%2035.9842C51.0534%2035.9017%2050.8401%2035.8593%2050.6246%2035.8594H38.4521L44.8121%2045L38.4531%2054.1406H50.6246C50.8401%2054.1407%2051.0534%2054.0983%2051.2524%2054.0158C51.4514%2053.9332%2051.6322%2053.8122%2051.7843%2053.6597L59.2843%2046.1597C59.4368%2046.0075%2059.5577%2045.8267%2059.6402%2045.6277C59.7228%2045.4287%2059.7652%2045.2154%2059.7652%2045C59.7652%2044.7846%2059.7228%2044.5713%2059.6402%2044.3723C59.5577%2044.1733%2059.4368%2043.9925%2059.2843%2043.8403Z'%20fill='%2382B536'/%3e%3c/g%3e%3c/svg%3e",Bt={class:"rounded-lg flex flex-col"},Pt=["checked"],Et=["checked","onChange"],Ot={class:"flex items-center gap-2 text-text-secondary float-start"},At={class:"inline-block rounded-full px-2 py-0.5 text-xs"},Ht={class:"truncate"},Ft={key:0,class:"float-end flex justify-center text-gray-500 items-center text-xs aspect-square max-w-6 min-h-6 bg-gray-500/10 rounded-full"},Ut={key:1,class:"text-xs aspect-square max-w-6 flex justify-center items-center text-center min-h-6 bg-accent/30 text-accent border-accent border rounded-full"},Nt=["onDragstart"],Rt={key:1,class:"empty-state flex flex-col h-full justify-center items-center border-dashed border border-border"},qt=ve({__name:"SprintCard",props:{sprint:{},sprintId:{}},emits:["edit-sprint","toggle-start","open-ticket","move-selected-to-backlog","delete-selected-sprint","refresh"],setup(o,{emit:n}){const v=o;Q(v,t=>{console.log("props changes",t)});const D=n,h=Je(),{selectedSprintIds:y,allSprintChecked:_,toggleAll:L,toggleOne:$}=h,k=C([]);Q(()=>v.sprint.tickets,t=>{k.value=[...t||[]]},{immediate:!0,deep:!0});const M=C(!1),S=C(null),{mutate:P}=ze({onSuccess:()=>{ae.success("Card moved to sprint successfully"),D("refresh")},onError:t=>{ae.error("Failed to move card: "+(t.message||"Unknown error"))}});function H(t,s,a,i){var d;S.value=s.id;const g=JSON.stringify({id:s.id,from:a,sprintId:i,ticket:s});(d=t.dataTransfer)==null||d.setData("text/plain",g),t.dataTransfer&&(t.dataTransfer.effectAllowed="move")}function O(t){var s;M.value=!1,((s=t.dataTransfer)==null?void 0:s.dropEffect)!=="none"&&S.value&&(k.value=k.value.filter(a=>a.id!==S.value)),S.value=null}function b(){M.value=!0}function e(){M.value=!1}function r(t){var s;t.preventDefault(),M.value=!1;try{const a=(s=t.dataTransfer)==null?void 0:s.getData("text/plain");if(!a)return;const i=JSON.parse(a);if(i.from!=="backlog"||k.value.some(d=>d.id===i.id))return;k.value.push(i.ticket),P({id:v.sprintId,payload:{card_ids:[i.ticket.id],priority:i.ticket.priority.toLowerCase(),story_points:i.ticket.storyPoints||0}})}catch(a){console.error("Drop error:",a)}}const m=[{key:"summary",label:"Summary",sortable:!0},{key:"status",label:"Status",width:120,sortable:!0},{key:"assignee",label:"Assignee",width:120,sortable:!0}];return(t,s)=>(x(),B("div",Bt,[l("div",{class:Y(["h-[300px]",M.value?"ring-2 ring-blue-400 rounded-lg":""]),onDragover:s[5]||(s[5]=re(()=>{},["prevent"])),onDragenter:b,onDragleave:e,onDrop:r},[k.value.length>0?(x(),I(qe,{key:0,showHeader:!1,pagination:!1,"row-draggable":!0,class:"h-full",onRowDragstart:s[2]||(s[2]=({row:a,$event:i})=>H(i,a,"sprint",t.sprint.id)),onRowDragend:s[3]||(s[3]=({$event:a})=>O(a)),columns:m,rows:k.value,"page-size":100,hover:!0,"item-key":a=>a.id,onRowClick:s[4]||(s[4]=({row:a})=>t.$emit("open-ticket",a))},{"select-header":V(()=>[l("input",{type:"checkbox",checked:c(_)(t.sprint.id),onChange:s[0]||(s[0]=a=>c(L)("sprint",a,t.sprint.id))},null,40,Pt)]),select:V(({row:a})=>[l("input",{type:"checkbox",checked:(c(y)[t.sprint.id]||[]).includes(a.id),onChange:i=>c($)("sprint",a.id,i,t.sprint.id)},null,40,Et)]),summary:V(({row:a})=>[l("div",Ot,[s[6]||(s[6]=l("img",{src:Ke,alt:""},null,-1)),l("span",At,E(a.key),1),l("span",Ht,E(a.summary),1)])]),status:V(({row:a})=>[l("span",{class:Y([c(Qe)(a.status),"px-2 py-1 rounded-md"])},E(a.status),3)]),assignee:V(({row:a})=>[a.assignee=="Unassigned"?(x(),B("span",Ft,"UA")):(x(),B("span",Ut,E(c(Ie)(`${a.assignee}`)),1))]),priority:V(({row:a})=>[l("span",{class:Y(c(Ge)(a.priority))},E(a.priority),3)]),drag:V(({row:a})=>[l("button",{class:"cursor-grab",title:"Drag to Backlog",draggable:"",onClick:s[1]||(s[1]=re(()=>{},["stop"])),onDragstart:i=>H(i,a,"sprint",t.sprint.id),onDragend:O},"↕",40,Nt)]),_:1},8,["rows","item-key"])):(x(),B("div",Rt,s[7]||(s[7]=[We('<img src="'+Mt+'" class="mb-4" alt="backlog-plan"><h6 class="text-sm text-text-primary font-semibold mb-1 text-center">Plan your sprint</h6><p class="text-sm text-text-primary/90 mb-3 max-w-120 text-center">Drag work items from the <span class="font-bold"> Backlog </span> section or create new ones to plan the work for this sprint. Select <span class="font-bold">Start sprint</span> when you&#39;re ready.</p>',3)])))],34)]))}}),It={class:"px-6 grid grid-cols-2 gap-4"},jt={class:"flex gap-1 flex-col"},Kt={key:0,class:"text-xs text-red-500"},zt={class:"flex gap-1 flex-col"},Zt={key:0,class:"text-xs text-red-500"},Gt={class:"flex flex-col col-span-2"},Jt={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},Qt=ve({__name:"StartSprintModal",props:{modelValue:{type:Boolean,default:!1},sprint:{},creatingSprint:{type:Boolean}},emits:["update:modelValue","save","close"],setup(o,{emit:n}){const v=n,D=o,h=R({get:()=>D.modelValue,set:e=>v("update:modelValue",e)}),y=Be({goal:"",start:"",end:""});Q(()=>D.sprint,e=>{e&&(y.goal=e.goal??"",y.start=e.start??"",y.end=e.end??"",O())},{immediate:!0});const _=Be({start:!1,end:!1}),L=R(()=>""),$=R(()=>{if(!_.end)return"";if(y.start&&y.end){const e=b(y.start),r=b(y.end);if(Number.isFinite(e)&&Number.isFinite(r)&&r<e)return"End date cannot be before start date"}return""}),k=R(()=>!$.value);function M(e){y.start=e||"",_.start=!0}function S(e){y.end=e||"",_.end=!0}function P(){h.value=!1,v("close")}function H(){_.start=!0,_.end=!0,k.value&&v("save",{goal:y.goal??"",start:y.start||"",end:y.end||""})}function O(){_.start=!1,_.end=!1}function b(e){return e?new Date(`${e}T00:00:00`).getTime():NaN}return(e,r)=>(x(),I(Ye,{modelValue:h.value,"onUpdate:modelValue":r[1]||(r[1]=m=>h.value=m),modalClass:"!py-0",size:"md"},{default:V(()=>[r[6]||(r[6]=l("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[l("h2",{class:"text-xl font-semibold"},"Start Sprint"),l("p",{class:"text-sm text-text-secondary mt-1"},[J(" Update sprint name, goal, and dates, then click "),l("span",{class:"font-medium"},"Start"),J(". ")])],-1)),l("div",It,[l("div",jt,[r[2]||(r[2]=l("label",{class:"text-sm"},"Start date",-1)),l("div",{class:Y(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",L.value?"border-red-500":""])},[N(Oe,{placeholder:"Set start date",class:"w-full","model-value":y.start,"emit-as":"ymd","onUpdate:modelValue":M},null,8,["model-value"])],2),L.value?(x(),B("p",Kt,E(L.value),1)):se("",!0)]),l("div",zt,[r[3]||(r[3]=l("label",{class:"text-sm"},"End date",-1)),l("div",{class:Y(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",$.value?"border-red-500":""])},[N(Oe,{placeholder:"Set end date",class:"w-full","model-value":y.end,"emit-as":"ymd","onUpdate:modelValue":S},null,8,["model-value"])],2),$.value?(x(),B("p",Zt,E($.value),1)):se("",!0)]),l("div",Gt,[r[4]||(r[4]=l("label",{class:"text-sm"},"Goal (optional)",-1)),Pe(l("textarea",{"onUpdate:modelValue":r[0]||(r[0]=m=>y.goal=m),class:"w-full rounded-lg border border-border px-3 py-2 bg-bg-input",rows:"2",placeholder:"Ship onboarding flow"},null,512),[[Xe,y.goal]])])]),l("div",Jt,[N(ge,{variant:"secondary",onClick:P},{default:V(()=>r[5]||(r[5]=[J("Cancel")])),_:1,__:[5]}),N(ge,{variant:"primary",disabled:!k.value,onClick:H},{default:V(()=>[J(E(e.creatingSprint?"Starting...":"Start"),1)]),_:1},8,["disabled"])])]),_:1,__:[6]},8,["modelValue"]))}}),Wt={class:"flex gap-2 flex-auto overflow-y-auto"},Xt={class:"flex-auto bg-gradient-to-b from-bg-card/95 to-bg-card/90 backdrop-blur rounded-2xl shadow-[0_10px_40px_-10px_rgba(0,0,0,.5)] flex-grow h-full bg-bg-card border border-border overflow-x-auto flex"},Yt={class:"flex overflow-x-auto gap-3 p-4"},es={key:0,class:"mx-auto text-text-secondary/80 m-2 w-[90%] h-full justify-center flex items-center border border-dashed border-border"},ts=ve({__name:"ActiveSprint",props:{sptint_id:{}},setup(o){const n=o,v=De(()=>Te(()=>import("./CreateTaskModal-CNtPViHO.js"),__vite__mapDeps([0,1,2,3]))),D=De(()=>Te(()=>import("./ConfirmDeleteModal-B4AwgacM.js"),__vite__mapDeps([4,5,2,3]))),h=De(()=>Te(()=>import("./SidePanel-B3bD0s9k.js"),__vite__mapDeps([6,2,3,7]))),y=De(()=>Te(()=>import("./KanbanBoard-A6fi2rIM.js"),__vite__mapDeps([8,2,3,9,10,5,11,12]))),_=ot(),{workspaceId:L,moduleId:$}=et(),{data:k}=tt(L.value,$.value),M=je(),{mutate:S,isPending:P}=st({onSuccess:()=>{M.invalidateQueries({queryKey:["sheet-list"]}),ie.value="",z.value=!1,le.value=!1,z.value=!1}}),H=f=>{S({workspace_id:L.value,module_id:$.value,variable_id:m.value,value:f})},{data:O}=at({workspace_id:L,workspace_module_id:$}),b=R(()=>{var f;return O.value?(f=O.value[0])==null?void 0:f._id:""}),e=C(b),r=R(()=>{var f;return k.value?(f=k.value[0])==null?void 0:f._id:""}),m=C(r),t=ct(),s=R(()=>n.sptint_id),{data:a,isPending:i}=ft(s),g=C(!1),d=C(),A=f=>{d.value=f},oe=rt(),ee=nt();function Ve(f){f.type=="column"?oe.mutate({payload:{workspace_id:L.value,workspace_module_id:$.value,variable_id:m.value,moved_value:f.meta.id,new_index:f.meta.newIndex}}):ee.mutate({payload:{workspace_id:L.value,card_id:f.meta.moved._id,group_value:f.meta.fromColumnId,group_variable_id:m.value,new_index:f.meta.newIndex,sheet_id:e.value}})}const K=f=>{};Q(O,f=>{var w;(f==null?void 0:f.length)>0&&(e.value=(w=f[0])==null?void 0:w._id)});const le=C(!1),ie=C(""),Le=f=>{S({workspace_id:_.params.id,module_id:_.params.module_id,new_value:f.title,value:f.oldTitle,variable_id:m.value})},z=C(!1),j=C(),be=()=>{S({value:j.value.title,workspace_id:L.value,module_id:$.value,newValue:j.value.title,variable_id:m.value,is_trash:!0})},$e=f=>{z.value=!0,j.value=f},Me=f=>{g.value=!0,j.value=f};return(f,w)=>{var ye,de,te,ke,xe;return x(),B("div",Wt,[l("div",Xt,[Pe(N(lt,null,null,512),[[Ae,c(i)]]),Pe(l("div",Yt,[N(c(y),{onOnPlus:Me,"onDelete:column":w[0]||(w[0]=F=>$e(F)),"onUpdate:column":w[1]||(w[1]=F=>Le(F)),onReorder:Ve,onAddColumn:H,"onSelect:ticket":A,board:c(a),onOnBoardUpdate:K,variable_id:m.value,sheet_id:e.value},{"column-footer":V(F=>{var Ce,Se,_e,he,we;return[(Se=(Ce=c(t))==null?void 0:Ce.transitions)!=null&&Se.all_allowed&&!((we=(he=(_e=c(t))==null?void 0:_e.transitions)==null?void 0:he.all_allowed)!=null&&we.includes(F.column.title))&&c(t).transitions.currentColumn!=F.column.title?(x(),B("div",es," Disbale ( you can't drop here )")):se("",!0)]}),_:1},8,["board","variable_id","sheet_id"])],512),[[Ae,!c(i)]])]),N(c(D),{onClick:w[2]||(w[2]=re(()=>{},["stop"])),modelValue:z.value,"onUpdate:modelValue":w[3]||(w[3]=F=>z.value=F),title:"Delete List",itemLabel:"list",itemName:(ye=j.value)==null?void 0:ye.title,requireMatchText:(de=j.value)==null?void 0:de.title,confirmText:"Delete workspace",cancelText:"Cancel",size:"md",loading:c(P),onConfirm:be,onCancel:w[4]||(w[4]=()=>{z.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),g.value?(x(),I(c(v),{selectedVariable:m.value,listId:(te=j.value)==null?void 0:te.title,sheet_id:e.value,key:"createTaskModalKey",modelValue:g.value,"onUpdate:modelValue":w[5]||(w[5]=F=>g.value=F),onSubmit:w[6]||(w[6]=()=>{})},null,8,["selectedVariable","listId","sheet_id","modelValue"])):se("",!0),(ke=d.value)!=null&&ke._id?(x(),I(c(h),{key:1,details:d.value,onClose:w[7]||(w[7]=()=>{A({variables:{}})}),showPanel:!!((xe=d.value)!=null&&xe._id)},null,8,["details","showPanel"])):se("",!0)])}}}),ss={class:"flex-auto flex-grow h-full bg-bg-card rounded-lg border border-border overflow-x-auto flex-col flex"},as={class:"header px-4 py-3 border-b border-border flex items-center justify-between gap-1"},rs={class:"flex gap-3 items-center"},ns={key:1,class:"space-y-6 p-4 w-full flex-auto overflow-y-auto"},os={class:"flex flex-col gap-6"},ls={class:"space-y-4 bg-bg-surface/30 p-4 rounded-md"},is={class:"flex items-center justify-between"},ds={class:"text-sm font-semibold"},us={key:0,class:"w-full h-full min-h-[250px] flex justify-center items-center"},cs={class:"space-y-4 bg-bg-surface/30 p-4 rounded-md"},ps={class:"flex items-center justify-between"},ms={class:"text-sm font-semibold"},gs={key:0,class:"w-full h-full min-h-[250px] flex justify-center items-center"},Cs=ve({__name:"Plan",setup(o){const{workspaceId:n}=Re(),v=C(!1),{moveSelectedToSprint:D,moveSelectedToBacklog:h,deleteSelected:y,saveSprintMeta:_,toggleStartSprint:L}=Je(),{data:$}=Ee(n),{mutate:k,isPending:M}=xt({onSuccess:()=>{xe.invalidateQueries({queryKey:["sprint-list"]}),P.value=!1}}),S=C(null),P=C(!1),H=()=>{var p;k((p=S.value)==null?void 0:p._id)},{mutate:O,isPending:b}=yt({onSuccess:p=>{_({name:p.title}),e({id:d.value}),ee.value=!1}}),{mutate:e,isPending:r}=kt({onSuccess:()=>{oe()}}),m=p=>{console.log("helo",S.value,p),O({id:d.value,payload:{goal:p.goal,start_date:p.start,end_date:p.end}})},{data:t,refetch:s}=mt(n.value),{refetch:a,isPending:i}=Ee(n),g=R(()=>{var p,u;return(u=(p=t==null?void 0:t.value)==null?void 0:p.sprints[0])==null?void 0:u._id}),d=C(g.value);Q(()=>g.value,p=>{d.value=p});const{data:A,refetch:oe}=bt(g),ee=C(!1),Ve=()=>{ee.value=!0},{data:K,isPending:le}=gt(d);Q(()=>le.value,p=>{console.log(p,le.value,">>>> laoding state changes")});const ie=R(()=>{var W,Z;const p=(W=K==null?void 0:K.value)==null?void 0:W.backlog_items;if(!p)return null;const u=(((Z=K==null?void 0:K.value)==null?void 0:Z.backlog_items)||[]).map(T=>{var ue,ce,pe,me,U;const G=((ue=T==null?void 0:T.card)==null?void 0:ue.variables)||{},X=((ce=T==null?void 0:T.card)==null?void 0:ce._id)||T.card_id;return{id:X,key:G["card-code"]||(X==null?void 0:X.slice(-6))||"PRJ-?",summary:G["card-title"]||"(untitled)",type:"Story",status:Le(String(G["card-status"]||"").trim()),assignee:((me=(pe=T==null?void 0:T.card)==null?void 0:pe.assigned_to)==null?void 0:me.name)||"Unassigned",storyPoints:Number(T.story_points||0),priority:z(String(G.priority||"").trim()),createdAt:((U=T==null?void 0:T.card)==null?void 0:U.created_at)||new Date().toISOString(),description:G["card-description"]||""}});return{id:p._id,name:p.title||"Sprint 1",title:p.title,goal:"",start:"",end:"",started:!1,tickets:u}});function Le(p){const u=p.toLowerCase();return u.includes("progress")?"In Progress":u.includes("done")||u.includes("complete")?"Done":"Todo"}function z(p){const u=p.toLowerCase();return u==="highest"||u==="blocker"||u==="critical"?"Highest":u==="high"||u==="major"?"High":u==="medium"||u==="normal"?"Medium":"Low"}const{mutate:j}=Ct({onSuccess:()=>{ae.success("Card removed from sprint successfully"),be()},onError:p=>{ae.error("Failed to remove card from sprint"),console.error("Failed to remove card from sprint:",p)}});function be(){s(),a(),oe()}function $e(p){console.log(">>> moving back to backlog"),d&&j({sprintId:d,cardId:p})}const Me={createdAt:(p,u,W)=>{const Z=new Date(p.createdAt).getTime(),T=new Date(u.createdAt).getTime();return W==="asc"?Z-T:T-Z}},f=C(!1),w=C(null);function ye(){v.value=!0,w.value=null}function de(p){w.value=p,f.value=!0}const te=C(!1);function ke(){te.value=!0}const xe=je();function F(){S.value=null,te.value=!0}function Ce(p){S.value=p,te.value=!0}function Se(p){S.value=p,P.value=!0}const{mutate:_e,isPending:he}=vt(d,{onSuccess:()=>{oe()}}),we=()=>{_e({})};return(p,u)=>{var W,Z,T,G,X,ue,ce,pe,me;return x(),B(He,null,[l("div",ss,[l("div",as,[N(it,{prefix:"View By",modelValue:d.value,"onUpdate:modelValue":u[1]||(u[1]=U=>d.value=U),options:(W=c(t))==null?void 0:W.sprints,variant:"secondary",onEditOption:Ce,onDeleteOption:Se},{more:V(()=>[l("div",{onClick:u[0]||(u[0]=U=>F()),class:"capitalize border-t border-border px-4 py-2 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-1 overflow-hidden overflow-ellipsis text-nowrap"},u[8]||(u[8]=[l("i",{class:"fa-solid fa-plus"},null,-1),J(" Add new ")]))]),_:1},8,["modelValue","options"]),l("div",rs,[N(dt,{placeholder:"Search in Orchit AI space"}),((Z=c(A))==null?void 0:Z.status)=="active"?(x(),I(ge,{key:0,size:"sm",onClick:we},{default:V(()=>[J(E(c(he)?"Ending...":"End"),1)]),_:1})):(x(),I(ge,{key:1,size:"sm",onClick:Ve},{default:V(()=>u[9]||(u[9]=[J("Start Sprint")])),_:1,__:[9]}))])]),((T=c(A))==null?void 0:T.status)=="active"?(x(),I(ts,{key:0,sptint_id:d.value},null,8,["sptint_id"])):(x(),B("div",ns,[l("div",os,[l("section",ls,[l("div",is,[l("h2",ds,"Sprint ("+E((X=(G=ie.value)==null?void 0:G.tickets)==null?void 0:X.length)+" Taks)",1)]),c(le)?(x(),B("div",us,u[10]||(u[10]=[l("div",{role:"status","aria-label":"Loading",class:"h-10 w-10 rounded-full border-4 border-neutral-700 border-t-transparent animate-spin"},null,-1)]))):(x(),B(He,{key:1},[ie.value?(x(),I(qt,{key:0,sprintId:d.value,sprint:ie.value,onOpenTicket:de,onEditSprint:ke,onToggleStart:c(L),onMoveSelectedToBacklog:c(h),onDeleteSelectedSprint:u[2]||(u[2]=U=>c(y)("sprint",U)),onRefresh:be},null,8,["sprintId","sprint","onToggleStart","onMoveSelectedToBacklog"])):se("",!0)],64))]),l("section",cs,[l("div",ps,[l("h2",ms,"Backlog ("+E((ce=(ue=c($))==null?void 0:ue.cards)==null?void 0:ce.length)+" Tasks)",1),l("div",{class:"flex items-center gap-2"},[l("button",{class:"w-8 h-8 rounded-md border cursor-pointer aspect-square text-sm border-border hover:bg-gray-50",onClick:ye},u[11]||(u[11]=[l("i",{class:"text-text-primary fa-regular fa-plus"},null,-1)]))])]),c(i)?(x(),B("div",gs,u[12]||(u[12]=[l("div",{role:"status","aria-label":"Loading",class:"h-10 w-10 rounded-full border-4 border-neutral-700 border-t-transparent animate-spin"},null,-1)]))):(x(),I($t,{key:1,sorters:Me,onMoveSelectedToSprint:c(D),onDeleteSelectedBacklog:u[3]||(u[3]=U=>c(y)("backlog")),onOpenTicket:de,onTicketMovedToBacklog:$e},null,8,["onMoveSelectedToSprint"]))])])]))]),N(ut,{onClick:u[4]||(u[4]=re(()=>{},["stop"])),modelValue:P.value,"onUpdate:modelValue":u[5]||(u[5]=U=>P.value=U),title:"Delete Sprint",itemLabel:"Sprint",itemName:(pe=S.value)==null?void 0:pe.title,requireMatchText:(me=S.value)==null?void 0:me.title,confirmText:"Delete Ticket",cancelText:"Cancel",size:"md",loading:c(M),onConfirm:H,onCancel:u[6]||(u[6]=()=>{S.value=null,P.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),N(Qt,{sprint:S.value,modelValue:ee.value,"onUpdate:modelValue":u[7]||(u[7]=U=>ee.value=U),onSave:m,creatingSprint:c(r)||c(b)},null,8,["sprint","modelValue","creatingSprint"])],64)}}});export{Cs as default};
