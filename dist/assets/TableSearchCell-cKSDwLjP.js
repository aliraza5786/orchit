import{d as P,c as x,r,x as N,z as U,aw as A,k as s,o as n,D as X,O as S,l as H,ai as E,t as B,g as b,h as q,H as G,f as J,R as Q,aj as $,F as W,C as Z,i as F,az as ee,am as te}from"./index-DhNbIl3H.js";const oe={key:1,class:"truncate text-text-secondary opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-2 text-xs font-medium"},ae={key:1,class:"relative w-full h-full"},le=["placeholder"],ne={class:"max-h-50 overflow-y-auto"},re=["onMousedown"],se={key:1,class:"px-3 py-2 text-center text-text-secondary text-sm"},de=P({__name:"TableSearchCell",props:{modelValue:{},options:{default:()=>[]},placeholder:{default:"Type to search..."},disabled:{type:Boolean,default:!1},displayField:{},emptyText:{},columnName:{default:""}},emits:["update:modelValue","change"],setup(M,{emit:D}){const i=M,m=D,O={High:"#F87171",Medium:"#FBBF24",Low:"#34D399"},I=x(()=>{if(i.columnName.toLowerCase()!=="priority")return"transparent";const e=l.value;return O[e]??"#E5E7EB"}),Y=e=>i.columnName.toLowerCase()!=="priority"?"transparent":O[e]??"#E5E7EB",v=r(!1),w=r(!1),a=r(""),p=r(null),k=r(null),f=r(null),R=r({top:"0px",left:"0px",width:"100%"}),T=r(!1),d=()=>{if(!p.value||!f.value)return;const e=p.value.getBoundingClientRect(),t=f.value.offsetHeight||200,u=window.innerHeight-e.bottom;let _=e.bottom+window.scrollY+6;u<t&&e.top>t&&(_=e.top+window.scrollY-t-5),R.value={top:`${_}px`,left:`${e.left+window.scrollX}px`,width:`${e.width}px`}};N(()=>i.modelValue,e=>{l.value=e});const c=e=>typeof e=="string"?e:String(e.title??e.label??e.value??""),y=x(()=>{if(!l.value)return"";const e=i.options.find(t=>{var o,u;return typeof t=="string"?t===l.value:typeof l.value!="object"?t._id==l.value||t.value==l.value:t._id==((o=l.value)==null?void 0:o._id)||t.value==((u=l.value)==null?void 0:u.value)});return e?c(e):""}),g=x(()=>(i.options??[]).map(e=>typeof e=="string"?{value:e,label:e}:e));N(()=>i.modelValue,e=>{const t=g.value.find(o=>o._id==e||o.value==e);a.value=t?c(t):""},{immediate:!0});const l=r(i.modelValue),h=x(()=>{if(!a.value||a.value===y.value)return g.value;const e=a.value.toLowerCase();return g.value.filter(t=>c(t).toLowerCase().includes(e))}),j=async()=>{var e,t;i.disabled||(v.value=!0,a.value=y.value,w.value=!0,await te(),(e=p.value)==null||e.focus(),(t=p.value)==null||t.select(),d(),window.addEventListener("scroll",d,!0),window.addEventListener("resize",d))},C=()=>{v.value=!1,w.value=!1,a.value="",window.removeEventListener("scroll",d,!0),window.removeEventListener("resize",d)},z=e=>{let t;typeof e=="string"?t=e:t=e._id??e.value??e.title,l.value=t,m("update:modelValue",t),m("change",t),C()},L=()=>{if(h.value.length>0){const e=h.value.find(t=>c(t).toLowerCase()===a.value.toLowerCase());if(e){z(e);return}}m("update:modelValue",a.value),m("change",a.value),C()},K=()=>{setTimeout(()=>{if(T.value){T.value=!1;return}v.value&&L()},150)},V=e=>{k.value&&!k.value.contains(e.target)&&f.value&&!f.value.contains(e.target)&&v.value&&L()};return U(()=>{document.addEventListener("mousedown",V)}),A(()=>{document.removeEventListener("mousedown",V),window.removeEventListener("scroll",d,!0),window.removeEventListener("resize",d)}),(e,t)=>(n(),s("div",{class:"relative w-full h-full",ref_key:"containerRef",ref:k,onClick:t[2]||(t[2]=F(()=>{},["stop"]))},[v.value?(n(),s("div",ae,[G(b("input",{ref_key:"inputRef",ref:p,"onUpdate:modelValue":t[0]||(t[0]=o=>a.value=o),onBlur:K,onKeydown:[$(L,["enter"]),$(C,["esc"])],onInput:t[1]||(t[1]=o=>w.value=!0),class:"absolute left-0 top-1/2 -translate-y-1/2 min-w-[150px] w-full p-1 border border-accent/60 rounded-sm focus:outline-none focus:ring-1 focus:ring-accent bg-bg-body z-50 text-[12px] h-8",placeholder:e.placeholder},null,40,le),[[Q,a.value]]),(n(),J(ee,{to:"body"},[w.value?(n(),s("div",{key:0,ref_key:"dropdownRef",ref:f,class:"fixed z-[9999] bg-bg-dropdown border border-border rounded-md shadow-lg py-2",style:E(R.value)},[b("div",ne,[h.value.length>0?(n(!0),s(W,{key:0},Z(h.value,o=>(n(),s("div",{key:o._id??o.value,onMousedown:F(u=>z(o),["prevent"]),class:"px-3 py-1.5 capitalize font-medium cursor-pointer hover:bg-bg-dropdown-menu-hover text-[12px] text-text-primary flex items-center gap-2"},[S(e.$slots,"option",{option:o},()=>{var u;return[b("span",{style:E(((u=e.columnName)==null?void 0:u.toLowerCase())==="priority"?{backgroundColor:Y(c(o)),color:"white",padding:"2px 8px",borderRadius:"10px"}:{})},B(c(o)),5)]})],40,re))),128)):(n(),s("div",se," No match found "))])],4)):H("",!0)]))])):(n(),s("div",{key:0,onClick:j,class:X(["h-full flex items-center px-3 py-1.5 cursor-pointer hover:bg-bg-surface-hover rounded-md truncate transition-all duration-200 group",{"opacity-50 cursor-not-allowed":e.disabled}])},[S(e.$slots,"display",{},()=>{var o;return[y.value?(n(),s("span",{key:0,class:"truncate font-normal text-[12px] text-text-primary",style:E(((o=e.columnName)==null?void 0:o.toLowerCase())==="priority"?{backgroundColor:I.value,color:"white",padding:"2px 8px",borderRadius:"10px",fontSize:"10px"}:{})},B(y.value),5)):e.emptyText&&!e.disabled?(n(),s("span",oe,[t[3]||(t[3]=b("i",{class:"fa-solid fa-plus text-[10px]"},null,-1)),q(" Add "+B(e.emptyText),1)])):H("",!0)]})],2))],512))}});export{de as default};
