const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CvqJivzk.js","assets/index-BoW5koMG.css","assets/BaseSelectField-BK2Nx_pX.js","assets/AssigmentDropdown-cxCoMqER.js"])))=>i.map(i=>d[i]);
import{d as _t,r as g,W as ht,N as ft,O as bt,by as gt,p as S,x as Ce,av as xt,L as De,c as P,a1 as yt,bz as wt,bA as kt,bB as Ct,bC as Dt,bD as St,ab as Et,aO as It,e as Vt,ap as N,w as E,o as r,E as G,G as Tt,f as s,j as d,q as n,A as q,i as y,F as D,z as K,k as I,t as _,ae as O,ai as Se,h as Ee,P as ue,g as J,al as Ie,U as Ve,C as z,K as At}from"./index-CvqJivzk.js";import{u as Qt}from"./sidePanelStore-oB2i4n84.js";const Ut={key:0,class:"flex flex-col gap-5 p-6 animate-pulse"},Lt={key:1},Pt={class:"sticky top-0 z-10 border-b border-border px-4 sm:px-6 py-[9px] flex items-center justify-between bg-bg-card"},qt={class:"flex items-center gap-2"},Kt=["aria-label"],Ot={class:"py-5 px-4 sm:px-6 flex flex-col gap-5 flex-grow"},zt={key:0,class:"space-y-2 sm:col-span-1"},Mt={class:"text-xs uppercase tracking-wider text-text-secondary"},jt={class:"capitalize"},Bt=["disabled","title","onKeydown"],Ft=["title"],Rt=["disabled"],$t=["innerHTML"],Nt={key:1,class:"opacity-60"},Ht={key:"tab-details",class:"space-y-6"},Wt={class:"grid grid-cols-2 gap-4 text-sm"},Yt={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-4"},Gt={class:"mt-1 font-medium"},Jt={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-4"},Xt={class:"mt-1 font-medium"},Zt={class:"rounded-2xl border border-orchit-white/10 bg-orchit-white/5 p-4 grid grid-cols-1 gap-4"},es={class:"space-y-2"},ts={class:"space-y-2"},ss={class:"space-y-2"},as={class:"h-8 px-3 flex items-center gap-2 rounded-lg bg-bg-input border border-orchit-white/10"},is={class:"space-y-2"},os={key:0,class:"text-xs text-red-400 mt-1"},ls={key:0,class:"space-y-2 sm:col-span-1"},ns={class:"text-xs uppercase tracking-wider text-text-secondary"},rs={key:1},ds={class:"relative border-l border-orchit-white/10 pl-5 space-y-4 ml-1"},us={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-3 hover:bg-orchit-white/7 transition"},cs={class:"font-semibold"},ps={class:"font-semibold"},ms={key:"tab-comments",class:"space-y-4"},vs={class:"flex items-center gap-3 mb-2"},_s={class:"h-8 w-8 rounded-full bg-accent/15 text-accent flex items-center justify-center text-xs font-semibold"},hs={class:"flex-1"},fs={class:"text-sm font-medium"},bs={class:"text-xs text-text-secondary"},gs={key:0,class:"flex items-center gap-2"},xs=["disabled","onClick"],ys=["disabled","onClick"],ws={class:"flex items-center gap-2 justify-end"},ks={key:0,class:"mt-3 grid grid-cols-2 gap-2"},Cs=["href"],Ds={class:"text-xs truncate"},Ss={class:"rounded-xl border border-orchit-white/10 bg-orchit-white/5 overflow-hidden"},Es=["disabled"],Is={class:"flex items-center w-full justify-between p-2 border-t border-orchit-white/10"},Vs={key:"tab-attachments",class:"space-y-3"},Ts={class:"text-xs text-text-secondary"},As={class:"grid sm:grid-cols-2 gap-4"},Qs={class:"p-3"},Us={key:0,class:"rounded-lg overflow-hidden"},Ls=["src"],Ps={key:1,class:"rounded-lg overflow-hidden"},qs=["src"],Ks={key:2,class:"h-40 rounded-lg bg-black/5 grid place-items-center"},Os={class:"mt-3"},zs={class:"font-medium truncate"},Ms={class:"text-xs text-text-secondary capitalize"},js={class:"p-3 pt-0"},Bs=["href"],Fs=_t({__name:"SidePanel",props:{pin:{type:Boolean,default:!1},showPanel:{type:Boolean,default:!0},details:{type:Object,default:()=>({})}},emits:["close","closeSidePanel","update:details","comment:post","priority:change","ticketUpdated"],setup(M,{emit:Te}){var ye,we,ke;const x=Qt(),Ae=O({loader:()=>z(()=>import("./index-CvqJivzk.js").then(t=>t.dr),__vite__mapDeps([0,1])),loadingComponent:{template:'<div class="h-20 w-full animate-pulse bg-neutral-700/30 rounded-lg"></div>'},delay:200}),X=O(()=>z(()=>import("./BaseSelectField-BK2Nx_pX.js"),__vite__mapDeps([2,0,1]))),ce=O(()=>z(()=>import("./index-CvqJivzk.js").then(t=>t.ds),__vite__mapDeps([0,1]))),Qe=O(()=>z(()=>import("./AssigmentDropdown-cxCoMqER.js"),__vite__mapDeps([3,0,1]))),Z=O(()=>z(()=>import("./index-CvqJivzk.js").then(t=>t.dq),__vite__mapDeps([0,1]))),Ue=O(()=>z(()=>import("./index-CvqJivzk.js").then(t=>t.du),__vite__mapDeps([0,1]))),j=g(!1),{canCreateComment:ee,canEditComment:H,canViewComment:pe,canDeleteComment:Le,canEditCard:w,canViewAttachment:Pe,canAssignCard:qe}=ht(),{workspaceId:Ke}=ft(),c=bt(),h=M,te=Te,se=g(h.details._id),{data:l,isPending:me,isFetching:Oe,refetch:ze}=gt(se,{initialData:()=>c.getQueryData(["product-card",se.value]),staleTime:5*60*1e3,gcTime:10*60*1e3,refetchOnWindowFocus:!1});S(h,()=>{se.value=h.details._id}),S(()=>l.value,t=>{t&&(x.selectedCard=t,x.selectedCardTitle=t["card-title"],x.selectedCardId=t._id)},{immediate:!0});const B=g("details"),Me=[{label:"Details",value:"details"},{label:"Comments",value:"comments",disabled:pe},{label:"History",value:"history"},{label:"Attachment",value:"attachment"}],Q=g(!1),V=g(l.value?l.value["card-title"]:""),ve=g(null);function je(){var t;w.value&&(x.saveTitle(V.value),x.saveLocalId((t=l.value)==null?void 0:t._id),x.saveCardDetails(l.value),Q.value=!0,Ie(()=>{var e;return(e=ve.value)==null?void 0:e.focus()}))}S(()=>x.selectedCardTitle,t=>{!Q.value&&t!==void 0&&(V.value=t)},{immediate:!0});function Be(){const t=V.value.trim();if(!t||t===x.selectedCardTitle){Q.value=!1;return}A.mutate({card_id:x.selectedCardId,variables:{"card-title":t}}),Q.value=!1}const U=g(l!=null&&l.value?l==null?void 0:l.value["card-description"]:"");S(()=>{var t;return(t=x.selectedCard)==null?void 0:t["card-description"]},t=>{var e;t&&((e=x.selectedCard)==null?void 0:e._id)===x.selectedCardId&&(x.selectedCard["card-description"]=t,x.selectedCard={...x.selectedCard})});const F=g(!1),ae=g(null);function Fe(t){var p,u;const e=(p=t==null?void 0:t.querySelector)==null?void 0:p.call(t,".ProseMirror");if(!e)return;e.focus();const a=(u=window.getSelection)==null?void 0:u.call(window),o=document.createRange();o.selectNodeContents(e),o.collapse(!1),a==null||a.removeAllRanges(),a==null||a.addRange(o)}async function Re(){w.value&&(F.value=!0,await Ie(),Fe(ae.value||void 0))}function _e(){var a,o;const t=(a=U.value)==null?void 0:a.trim(),e=((o=l.value)==null?void 0:o["card-description"])??"";if(!t||t===e){F.value=!1;return}A.mutate({card_id:h.details._id,variables:{"card-description":t}},{onSuccess:()=>{te("ticketUpdated",{cardId:h.details._id,updates:{"card-description":t}})}}),F.value=!1}function he(t){var a;if(!F.value)return;const e=t.target;(a=ae.value)!=null&&a.contains(e)||_e()}Ce(()=>document.addEventListener("mousedown",he)),xt(()=>document.removeEventListener("mousedown",he));const ie=De({posted_on:((ye=h.details)==null?void 0:ye.posted_on)??((we=h.details)==null?void 0:we.created_at)??""}),$e=P({get:()=>ie.posted_on?new Date(ie.posted_on).toISOString().slice(0,10):"",set:t=>{ie.posted_on=t?new Date(t+"T00:00:00").toISOString():""}}),{data:oe}=yt(Ke.value),le=g(l!=null&&l.value?l.value.workspace_lane_id:"");S([()=>l.value,()=>Oe.value],()=>{l!=null&&l.value&&(V.value=l==null?void 0:l.value["card-title"],U.value=l.value["card-description"],le.value=l.value.workspace_lane_id)});const Ne=P(()=>((oe==null?void 0:oe.value)??[]).map(t=>{var e;return{_id:t._id,title:((e=t==null?void 0:t.variables)==null?void 0:e["lane-title"])??String(t._id)}}));function He(t){le.value=t,A.mutate({card_id:h.details._id,workspace_lane_id:t})}const k=g({startDate:null,endDate:null});S(()=>l.value,t=>{k.value.startDate=(t==null?void 0:t["start-date"])??null,k.value.endDate=(t==null?void 0:t["end-date"])??null},{immediate:!0,deep:!0});const ne=P(()=>k!=null&&k.value.startDate&&k.value.endDate&&k.value.endDate<k.value.startDate?"End date cannot be before start date":""),We=t=>{k.value.startDate=t??null,A.mutate({card_id:h.details._id,variables:{"start-date":t}})},Ye=t=>{k.value.endDate=t??null,A.mutate({card_id:h.details._id,variables:{"end-date":t}})},Ge=P(()=>l==null?void 0:l.value.assigned_to),Je=t=>{A.mutate({card_id:h.details._id,seat_id:t==null?void 0:t._id,optimisticUser:t})},Xe=P(()=>{var t;return(t=h.details)==null?void 0:t._id}),{data:re}=wt(Xe),f=g((ke=re.value)==null?void 0:ke.comments);S(()=>re.value,()=>{var t;f.value=(t=re.value)==null?void 0:t.comments});const{mutate:Ze,isPending:et}=kt({onMutate:async t=>{const e=h.details._id;await c.cancelQueries({queryKey:["product-comments",e]}),await c.cancelQueries({queryKey:["sheet-list"]});const a=c.getQueryData(["product-comments",e]),o=c.getQueryData(["sheet-list"]),p={_id:Date.now().toString(),comment_text:t.payload.comment_text,commented_by:{u_full_name:"You",_id:fe.value},attachments:t.payload.attachments||[],created_at:new Date().toISOString()};return c.setQueryData(["product-comments",e],u=>({...u,comments:[...(u==null?void 0:u.comments)||[],p]})),c.setQueriesData({queryKey:["sheet-list"]},u=>Array.isArray(u)?u.map(m=>{var i;return{...m,cards:(i=m.cards)==null?void 0:i.map(v=>v._id===e?{...v,comment_count:(v.comment_count||0)+1}:v)}}):u),{previousComments:a,previousLists:o}},onError:(t,e,a)=>{a!=null&&a.previousComments&&c.setQueryData(["product-comments",h.details._id],a.previousComments),a!=null&&a.previousLists&&c.setQueriesData({queryKey:["sheet-list"]},a.previousLists),console.log(t,e)},onSettled:()=>{c.invalidateQueries({queryKey:["product-comments",h.details._id]}),c.invalidateQueries({queryKey:["sheet-list"]}),c.invalidateQueries({queryKey:["product-card"]})}}),W=g(""),tt=t=>(t??"").split(" ").map(e=>e[0]).filter(Boolean).slice(0,2).join("").toUpperCase(),st=t=>t?new Date(t).toLocaleString():"",{data:fe}=Ct(),at=t=>{var e;return((e=t==null?void 0:t.created_by)==null?void 0:e._id)===fe.value},R=g(null),T=g(""),{mutate:it,isPending:be}=Dt({onSuccess:t=>{const e=f.value.findIndex(a=>a._id===t._id);e>-1&&(f.value[e]={...f.value[e],comment_text:t.comment_text}),R.value=null,T.value="",c.invalidateQueries({queryKey:["product-card"]})}}),{mutate:ot}=St();function lt(t){R.value=t._id,T.value=t.comment_text??""}function de(){R.value=null,T.value="",Q.value=!1}function nt(t){const e=T.value.trim();if(!e)return;const a=f.value.findIndex(p=>p._id===t._id),o=a>-1?{...f.value[a]}:null;a>-1&&(f.value[a]={...f.value[a],comment_text:e}),it({id:t._id,payload:{comment_text:e}},{onError:()=>{a>-1&&o&&(f.value[a]=o)},onSuccess:p=>{a>-1&&(f.value[a]=p??f.value[a]),de(),c.invalidateQueries({queryKey:["product-card"]})}})}function rt(t){const e=f.value.findIndex(o=>o._id===t._id),a=e>-1?f.value[e]:null;e>-1&&f.value.splice(e,1),ot({id:t._id},{onError:()=>{a&&f.value.splice(e,0,a)}})}const dt=P(()=>{var t;return(t=l.value)==null?void 0:t.attachments.map(e=>{var a;return{_id:e._id??e.id??((a=crypto.randomUUID)==null?void 0:a.call(crypto))??Math.random(),name:e.name??e.filename??"file",url:e.url,kind:(e.type??e.kind??"").toLowerCase().includes("image")?"image":(e.type??e.kind??"").toLowerCase().includes("video")?"video":"file"}})}),A=Et({onMutate:async t=>{const{card_id:e,variables:a}=t;await c.cancelQueries({queryKey:["product-card",e]}),await c.cancelQueries({queryKey:["sheet-list"]});const o=c.getQueryData(["product-card",e]),p=c.getQueryData(["sheet-list"]),u=m=>{if(!m||m._id!==e)return m;const i={...m,variables:Array.isArray(m.variables)?[...m.variables]:[]};return a&&(Object.assign(i,a),Object.entries(a).forEach(([v,b])=>{const L=i.variables.findIndex(C=>C.slug===v);L!==-1?i.variables[L]={...i.variables[L],value:b}:i.variables.push({slug:v,value:b,type:"Text"}),v==="card-description"&&(i["card-description"]=b,i.description=b)})),t.workspace_lane_id&&(i.workspace_lane_id=t.workspace_lane_id),t.optimisticUser&&(i.seat=t.optimisticUser,i.assigned_to=t.optimisticUser),i};return c.setQueryData(["product-card",e],u),c.setQueriesData({queryKey:["sheet-list"]},m=>Array.isArray(m)?m.map(i=>{var v;return{...i,cards:(v=i.cards)==null?void 0:v.map(b=>b._id===e?u(b):b)}}):m),{previousCard:o,previousLists:p}},onSuccess:(t,e)=>{const a=e.card_id;ze(),t&&(c.setQueryData(["product-card",a],t),c.setQueriesData({queryKey:["sheet-list"]},o=>Array.isArray(o)?o.map(p=>{var u;return{...p,cards:(u=p.cards)==null?void 0:u.map(m=>m._id===a?{...m,...t}:m)}}):o),c.invalidateQueries({queryKey:["product-card",a]}))},onError:(t,e,a)=>{if(!a)return;const o=e.card_id;c.setQueryData(["product-card",o],a.previousCard),c.setQueriesData({queryKey:["sheet-list"]},a.previousLists)},onSettled:(t,e,a)=>{const o=a.card_id;c.invalidateQueries({queryKey:["product-card",o]}),c.invalidateQueries({queryKey:["sheet-list"]})}}),Y=g([]),{mutate:ut}=It({onSuccess:t=>{Y.value=[t],c.invalidateQueries({queryKey:["product-card"]})}});function ct(t){const e=t.target.files;Array.from(e).forEach(a=>{const o=new FormData;o.append("file",a),ut(o)})}function pt(){const t=W.value.trim();!t&&!Y.value.length||Ze({id:h.details._id,payload:{comment_text:t,attachments:Y.value.map(e=>({name:e.data.name,url:e.data.url}))}})}const $=De({}),ge=()=>{var t;(t=l==null?void 0:l.value)!=null&&t.variables&&(l.value.variables??[]).forEach(a=>{var p,u;if(!a||a.type!=="Select")return;const o=Array.isArray(a.data)&&a.data.length?((p=a.data[0])==null?void 0:p.value)??((u=a.data[0])==null?void 0:u._id)??a.data[0]:void 0;$[a.slug]=a.value??$[a.slug]??o??null})};Ce(ge),S(()=>l.value,ge,{deep:!0});function xe(t,e){var o,p;$[e]=t,((p=(((o=l.value)==null?void 0:o.variables)??[]).find(u=>u.slug===e))==null?void 0:p.value)!==t&&A.mutate({card_id:h.details._id,variables:{[e]:t}})}function mt(t){return t==="comments"&&!pe.value?(Ve.error("You do not have permission to view comments"),!1):t==="attachment"&&!Pe.value?(Ve.error("You do not have permission to view attachments"),!1):!0}return(t,e)=>(r(),Vt(N,{name:"panel",appear:""},{default:E(()=>{var a;return[G(s("div",{class:q(["flex flex-col h-full overflow-y-auto bg-gradient-to-b from-bg-card/95 to-bg-card/90 backdrop-blur rounded-[6px] shadow-[0_10px_40px_-10px_rgba(0,0,0,.5)] border border-orchit-white/5 overflow-hidden transition-all duration-300 ease-in-out",j.value?"min-w-full max-w-full":"min-w-full max-w-[380px] sm:min-w-[380px]"]),role:"complementary","aria-label":"Details panel"},[n(me)&&!n(l)?(r(),d("div",Ut,e[9]||(e[9]=[s("div",{class:"h-8 bg-orchit-white/10 rounded-xl w-3/4"},null,-1),s("div",{class:"space-y-2"},[s("div",{class:"h-4 bg-orchit-white/10 rounded w-full"}),s("div",{class:"h-4 bg-orchit-white/10 rounded w-5/6"})],-1),s("div",{class:"grid grid-cols-2 gap-4"},[s("div",{class:"h-20 bg-orchit-white/10 rounded-xl"}),s("div",{class:"h-20 bg-orchit-white/10 rounded-xl"})],-1)]))):(r(),d("div",Lt,[s("div",Pt,[e[11]||(e[11]=s("h5",{class:"text-[18px] font-semibold tracking-tight"},"Details",-1)),s("div",qt,[s("button",{class:"p-2 rounded-xl hover:bg-orchit-white/5 active:scale-[.98] cursor-pointer transition",onClick:e[0]||(e[0]=o=>j.value=!j.value),"aria-label":j.value?"Collapse details":"Expand details"},[s("i",{class:q(["fa-solid",j.value?"fa-compress":"fa-expand","text-lg"])},null,2)],8,Kt),s("button",{class:"p-2 rounded-xl hover:bg-orchit-white/5 active:scale-[.98] cursor-pointer transition",onClick:e[1]||(e[1]=()=>{te("close"),te("closeSidePanel")}),"aria-label":"Close details"},e[10]||(e[10]=[s("i",{class:"fa-solid fa-xmark text-lg"},null,-1)]))])]),s("div",Ot,[(r(!0),d(D,null,K((a=n(l))==null?void 0:a.variables,(o,p)=>(r(),d(D,{key:o.slug||`var-${p}`},[(o==null?void 0:o.type)==="Select"&&o.slug=="card-type"?(r(),d("div",zt,[s("div",Mt,_(o.title),1),y(n(X),{disabled:!n(w),size:"sm",options:o==null?void 0:o.data.map(u=>({_id:u,title:u})),placeholder:"Select option",allowCustom:!1,"model-value":$[o.slug],"onUpdate:modelValue":u=>xe(u,o.slug)},null,8,["disabled","options","model-value","onUpdate:modelValue"])])):I("",!0)],64))),128)),s("div",jt,[y(N,{name:"fade-scale",mode:"out-in"},{default:E(()=>[Q.value?G((r(),d("input",{disabled:!n(w),title:n(w)?"":"You do not have permission to edit this card",key:"title-edit",ref_key:"titleInput",ref:ve,"onUpdate:modelValue":e[2]||(e[2]=o=>V.value=o),onKeydown:[Se(Ee(Be,["prevent"]),["enter"]),Se(Ee(de,["prevent"]),["esc"])],class:"w-full text-2xl font-semibold rounded-xl px-3 py-2 bg-orchit-white/5 border border-orchit-white/10 focus:outline-none focus:ring-2 focus:ring-accent/40 transition",type:"text","aria-label":"Edit title"},null,40,Bt)),[[ue,V.value]]):(r(),d("h1",{key:"title-view",class:q([n(w)?"cursor-text":"cursor-not-allowed","text-[20px] leading-[28px] font-semibold tracking-tight rounded-lg px-2 py-1 hover:bg-orchit-white/5 transition"]),onClick:e[3]||(e[3]=o=>je()),"aria-label":"Card title",title:n(w)?"":"You do not have permission to edit this card"},_(V.value||"Untitled"),11,Ft))]),_:1})]),s("div",null,[e[12]||(e[12]=s("h3",{class:"mb-2 text-base font-semibold tracking-wide px-1"}," Description ",-1)),y(N,{name:"fade-scale",mode:"out-in"},{default:E(()=>[F.value?(r(),d("div",{key:"desc-edit",ref_key:"descEditorWrap",ref:ae,class:"rounded-xl overflow-hidden border border-orchit-white/10 shadow-sm"},[y(n(Ae),{modelValue:U.value,"onUpdate:modelValue":e[4]||(e[4]=o=>U.value=o),onFocusOut:_e},null,8,["modelValue"])],512)):(r(),d("div",{key:"desc-view",class:q(["text-[15px] leading-6 text-text-secondary whitespace-pre-wrap rounded-xl px-4 py-3 border border-orchit-white/10 bg-orchit-white/5 hover:border-orchit-white/20 transition",n(w)?"cursor-text":"cursor-not-allowed"]),disabled:!n(w),onClick:Re},[U.value?(r(),d("div",{key:0,innerHTML:U.value},null,8,$t)):(r(),d("span",Nt,"Click to add a description…"))],10,Rt))]),_:1})]),y(n(Ue),{modelValue:B.value,"onUpdate:modelValue":e[5]||(e[5]=o=>B.value=o),options:Me,size:"md",beforeChange:mt},null,8,["modelValue"]),y(N,{name:"section",mode:"out-in"},{default:E(()=>{var o,p,u,m;return[B.value==="details"?(r(),d("section",Ht,[s("div",Wt,[s("div",Yt,[e[13]||(e[13]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," Posted On ",-1)),s("div",Gt,_($e.value),1)]),s("div",Jt,[e[14]||(e[14]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," ID ",-1)),s("div",Xt,_(M.details["card-code"]),1)])]),s("div",Zt,[s("div",es,[e[15]||(e[15]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," Lane ",-1)),y(n(X),{disabled:!n(w),size:"sm",options:Ne.value,placeholder:"Select lane",allowCustom:!1,"model-value":le.value,"onUpdate:modelValue":He},null,8,["disabled","options","model-value"])]),s("div",ts,[e[16]||(e[16]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," Assign ",-1)),y(n(Qe),{disabled:!n(qe),onAssign:e[6]||(e[6]=i=>Je(i)),assigneeId:Ge.value,seat:n(l).seat},null,8,["disabled","assigneeId","seat"])]),M.pin?I("",!0):(r(),d(D,{key:0},[s("div",ss,[e[18]||(e[18]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," Start Date ",-1)),s("div",as,[e[17]||(e[17]=s("i",{class:"fa-regular fa-calendar"},null,-1)),y(n(ce),{disabled:!n(w),placeholder:"Set start date",class:"w-full","model-value":k.value.startDate,"emit-as":"ymd","onUpdate:modelValue":We},null,8,["disabled","model-value"])])]),s("div",is,[e[20]||(e[20]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," Target End ",-1)),s("div",{class:q(["h-8 px-3 flex items-center gap-2 rounded-lg bg-bg-input border transition-colors",ne.value?"border-red-500":"border-orchit-white/10"])},[e[19]||(e[19]=s("i",{class:"fa-regular fa-calendar"},null,-1)),y(n(ce),{disabled:!n(w),placeholder:"Set end date",class:"w-full","model-value":k.value.endDate,"emit-as":"ymd","onUpdate:modelValue":Ye},null,8,["disabled","model-value"])],2),ne.value?(r(),d("p",os,_(ne.value),1)):I("",!0)])],64)),n(me)?(r(),d(D,{key:1},[e[21]||(e[21]=s("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),e[22]||(e[22]=s("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),e[23]||(e[23]=s("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),e[24]||(e[24]=s("div",{class:"bg-bg-surface/40 w-full animate-pulse h-6 p-1"},null,-1))],64)):(o=n(l))!=null&&o.variables?(r(!0),d(D,{key:2},K((p=n(l))==null?void 0:p.variables,(i,v)=>(r(),d(D,{key:i.slug||`var-${v}`},[i.type==="Select"&&i.slug!=="card-type"?(r(),d("div",ls,[s("div",ns,_(i.title),1),y(n(X),{disabled:!n(w),size:"sm",options:i==null?void 0:i.data.map(b=>({_id:b,title:b})),placeholder:"Select option",allowCustom:!1,"model-value":$[i.slug],"onUpdate:modelValue":b=>xe(b,i.slug)},null,8,["disabled","options","model-value","onUpdate:modelValue"])])):I("",!0)],64))),128)):I("",!0)])])):B.value==="history"?(r(),d("section",rs,[s("div",null,[e[27]||(e[27]=s("h3",{class:"text-sm font-semibold tracking-wide mb-3"}," History ",-1)),s("ol",ds,[(r(!0),d(D,null,K((u=n(l))==null?void 0:u.history,(i,v)=>(r(),d("li",{key:v,class:"group"},[e[26]||(e[26]=s("span",{class:"absolute -left-[5px] top-0 w-2 h-2 rounded-full bg-accent/70 ring-4 ring-accent/10"},null,-1)),s("div",us,[s("span",cs,_(i.user.u_full_name),1),e[25]||(e[25]=s("span",{class:"text-text-secondary"}," changed ",-1)),s("span",ps,_(i.field_name),1)])]))),128))])])])):B.value==="comments"?(r(),d("section",ms,[(r(!0),d(D,null,K(f.value??[],i=>{var v,b,L;return r(),d("div",{key:i._id,class:"rounded-xl border border-orchit-white/10 bg-orchit-white/5 p-4 hover:bg-orchit-white/7 transition"},[s("div",vs,[s("div",_s,_(tt((v=i.commented_by)==null?void 0:v.u_full_name)),1),s("div",hs,[s("div",fs,_((b=i.commented_by)==null?void 0:b.u_full_name),1),s("div",bs,_(st(i.created_at)),1)]),at(i)?(r(),d("div",gs,[R.value!==i._id?(r(),d("button",{key:0,disabled:!n(H),class:"text-xs text-accent hover:underline",onClick:C=>lt(i)}," Edit ",8,xs)):I("",!0),s("button",{disabled:!n(Le),class:"text-xs text-red-400 hover:underline",onClick:C=>rt(i)}," Delete ",8,ys)])):I("",!0)]),y(N,{name:"fade",mode:"out-in"},{default:E(()=>[R.value!==i._id?(r(),d("p",{key:`c-view-${i._id}`,class:"text-[15px] leading-6"},_(i.comment_text),1)):(r(),d("div",{key:`c-edit-${i._id}`,class:"space-y-2"},[G(s("textarea",{"onUpdate:modelValue":e[7]||(e[7]=C=>T.value=C),rows:"3",class:"w-full p-3 rounded-lg bg-bg-input/80 border border-orchit-white/10 focus:ring-2 focus:ring-accent/40 outline-none"},null,512),[[ue,T.value]]),s("div",ws,[y(n(Z),{variant:"secondary",size:"sm",onClick:de},{default:E(()=>e[28]||(e[28]=[J("Cancel")])),_:1,__:[28]}),y(n(Z),{class:"btn",size:"sm",onClick:C=>nt(i),disabled:!T.value.trim()||n(be)||!n(H)},{default:E(()=>[J(_(n(be)?"Saving…":"Save"),1)]),_:2},1032,["onClick","disabled"])])]))]),_:2},1024),(L=i==null?void 0:i.attachments)!=null&&L.length?(r(),d("div",ks,[(r(!0),d(D,null,K(i.attachments,(C,vt)=>(r(),d("a",{key:vt,href:C.url,target:"_blank",class:"group flex items-center gap-2 rounded-lg border border-orchit-white/10 bg-orchit-white/5 px-2 py-1 hover:bg-orchit-white/10 transition"},[e[29]||(e[29]=s("i",{class:"fa-regular fa-file text-text-secondary group-hover:text-text-primary transition"},null,-1)),s("span",Ds,_(C==null?void 0:C.name),1)],8,Cs))),128))])):I("",!0)])}),128)),s("div",Ss,[G(s("textarea",{disabled:!n(ee)||!n(H),"onUpdate:modelValue":e[8]||(e[8]=i=>W.value=i),rows:"3",class:q([n(ee)||n(H)?"cursor-text":"cursor-not-allowed","w-full p-3 bg-transparent outline-none text-sm"]),placeholder:"Write a comment"},null,10,Es),[[ue,W.value]]),s("div",Is,[s("input",{type:"file",multiple:"",onChange:ct,class:"max-w-full text-ellipsis text-xs text-text-secondary file:mr-3 col-span-2 file:px-3 file:py-1.5 file:rounded-md file:border file:border-orchit-white/10 file:bg-orchit-white/10 hover:file:bg-orchit-white/15 file:text-text-primary transition inline w-fit"},null,32),y(n(Z),{variant:"primary",class:"min-w-[70px]",size:"sm",onClick:pt,disabled:!W.value.trim()&&!Y.value.length||!n(ee)},{default:E(()=>[J(_(n(et)?"Posting…":"Post"),1)]),_:1},8,["disabled"])])])])):(r(),d("section",Vs,[s("div",Ts," Files attached to this "+_(((m=M.details)==null?void 0:m.type)??"item")+". ",1),s("div",As,[(r(!0),d(D,null,K(dt.value,i=>(r(),d("div",{key:i._id,class:"rounded-2xl overflow-hidden border border-orchit-white/10 bg-orchit-white/5 hover:bg-orchit-white/8 transition group"},[s("div",Qs,[i.kind==="image"?(r(),d("div",Us,[s("img",{src:i.url,class:"w-full h-40 object-cover group-hover:scale-[1.02] transition"},null,8,Ls)])):i.kind==="video"?(r(),d("div",Ps,[s("video",{src:i.url,controls:"",class:"w-full h-40 object-cover"},null,8,qs)])):(r(),d("div",Ks,e[30]||(e[30]=[s("i",{class:"fa-regular fa-file text-3xl text-text-secondary"},null,-1)]))),s("div",Os,[s("div",zs,_(i.name),1),s("div",Ms,_(i.kind),1)])]),s("div",js,[s("a",{href:i.url,target:"_blank",rel:"noopener",class:"w-full inline-flex items-center justify-center gap-2 h-9 rounded-lg bg-accent text-orchit-white text-sm hover:opacity-90 transition"},e[31]||(e[31]=[s("i",{class:"fa-regular fa-arrow-up-right-from-square"},null,-1),J(" View ")]),8,Bs)])]))),128))])]))]}),_:1})])]))],2),[[Tt,M.showPanel]])]}),_:1}))}}),Ns=At(Fs,[["__scopeId","data-v-1870e7cf"]]);export{Ns as default};
