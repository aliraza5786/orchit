const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BUo6hkzk.js","assets/index-CloD0T9Z.css","assets/BaseSelectField-B6dCcgeN.js","assets/AssigmentDropdown-BqlwgOx8.js"])))=>i.map(i=>d[i]);
import{d as _t,r as b,W as ht,Q as ft,S as bt,by as gt,x as S,C as Ce,aw as xt,O as De,c as P,a1 as yt,bz as wt,bA as kt,bB as Ct,bC as Dt,bD as St,ab as Et,aO as It,f as Vt,ap as W,w as E,o as n,y as G,J as Tt,g as a,m as d,i as r,F as q,h as x,G as D,E as K,n as I,t as m,ae as O,ai as Se,l as Ee,T as ue,k as J,al as Ie,V as Ve,H as M,N as Qt}from"./index-BUo6hkzk.js";import{u as At}from"./sidePanelStore-BB897cie.js";const Ut={key:0,class:"flex flex-col gap-5 p-6 animate-pulse"},Lt={key:1},Pt={class:"sticky top-0 z-10 border-b border-border px-4 sm:px-6 py-[9px] flex items-center justify-between bg-bg-card"},qt={class:"flex items-center gap-2"},Kt=["aria-label"],Ot={class:"py-5 px-4 sm:px-6 flex flex-col gap-5 flex-grow"},Mt={key:0,class:"space-y-2 sm:col-span-1"},zt={class:"text-xs uppercase tracking-wider text-text-secondary"},Bt={class:"capitalize"},jt=["disabled","title","onKeydown"],Ft=["title"],Rt=["disabled"],$t=["innerHTML"],Ht={key:1,class:"opacity-60"},Nt={key:"tab-details",class:"space-y-6"},Wt={class:"grid grid-cols-2 gap-4 text-sm"},Yt={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-4"},Gt={class:"mt-1 font-medium"},Jt={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-4"},Xt={class:"mt-1 font-medium"},Zt={class:"rounded-2xl border border-orchit-white/10 bg-orchit-white/5 p-4 grid grid-cols-1 gap-4"},es={class:"space-y-2"},ts={class:"space-y-2"},ss={class:"space-y-2"},as={class:"h-8 px-3 flex items-center gap-2 rounded-lg bg-bg-input border border-orchit-white/10"},is={class:"space-y-2"},os={key:0,class:"text-xs text-red-400 mt-1"},ls={key:0,class:"space-y-2 sm:col-span-1"},rs={class:"text-xs uppercase tracking-wider text-text-secondary"},ns={key:1},ds={class:"relative border-l border-orchit-white/10 pl-5 space-y-4 ml-1"},us={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-3 hover:bg-orchit-white/7 transition"},cs={class:"font-semibold"},ps={class:"font-semibold"},vs={key:"tab-comments",class:"space-y-4"},ms={class:"flex items-center gap-3 mb-2"},_s={class:"h-8 w-8 rounded-full bg-accent/15 text-accent flex items-center justify-center text-xs font-semibold"},hs={class:"flex-1"},fs={class:"text-sm font-medium"},bs={class:"text-xs text-text-secondary"},gs={key:0,class:"flex items-center gap-2"},xs=["disabled","onClick"],ys=["disabled","onClick"],ws={class:"flex items-center gap-2 justify-end"},ks={key:0,class:"mt-3 grid grid-cols-2 gap-2"},Cs=["href"],Ds={class:"text-xs truncate"},Ss={class:"rounded-xl border border-orchit-white/10 bg-orchit-white/5 overflow-hidden"},Es=["disabled"],Is={class:"flex items-center w-full justify-between p-2 border-t border-orchit-white/10"},Vs={key:"tab-attachments",class:"space-y-3"},Ts={class:"text-xs text-text-secondary"},Qs={class:"grid sm:grid-cols-2 gap-4"},As={class:"p-3"},Us={key:0,class:"rounded-lg overflow-hidden"},Ls=["src"],Ps={key:1,class:"rounded-lg overflow-hidden"},qs=["src"],Ks={key:2,class:"h-40 rounded-lg bg-black/5 grid place-items-center"},Os={class:"mt-3"},Ms={class:"font-medium truncate"},zs={class:"text-xs text-text-secondary capitalize"},Bs={class:"p-3 pt-0"},js=["href"],Fs=_t({__name:"SidePanel",props:{pin:{type:Boolean,default:!1},showPanel:{type:Boolean,default:!0},details:{type:Object,default:()=>({})}},emits:["close","closeSidePanel","update:details","comment:post","priority:change","ticketUpdated"],setup(z,{emit:Te}){var ye,we,ke;const g=At(),Qe=O({loader:()=>M(()=>import("./index-BUo6hkzk.js").then(e=>e.dr),__vite__mapDeps([0,1])),loadingComponent:{template:'<div class="h-20 w-full animate-pulse bg-neutral-700/30 rounded-lg"></div>'},delay:200}),X=O(()=>M(()=>import("./BaseSelectField-B6dCcgeN.js"),__vite__mapDeps([2,0,1]))),ce=O(()=>M(()=>import("./index-BUo6hkzk.js").then(e=>e.ds),__vite__mapDeps([0,1]))),Ae=O(()=>M(()=>import("./AssigmentDropdown-BqlwgOx8.js"),__vite__mapDeps([3,0,1]))),Z=O(()=>M(()=>import("./index-BUo6hkzk.js").then(e=>e.dq),__vite__mapDeps([0,1]))),Ue=O(()=>M(()=>import("./index-BUo6hkzk.js").then(e=>e.du),__vite__mapDeps([0,1]))),B=b(!1),{canCreateComment:ee,canEditComment:Y,canViewComment:pe,canDeleteComment:Le,canEditCard:y,canViewAttachment:Pe,canAssignCard:qe}=ht(),{workspaceId:Ke}=ft(),c=bt(),_=z,te=Te,se=b(_.details._id),{data:l,isPending:ve,isFetching:Oe,refetch:Me}=gt(se,{initialData:()=>c.getQueryData(["product-card",se.value]),staleTime:5*60*1e3,gcTime:10*60*1e3,refetchOnWindowFocus:!1});console.log("card variables",l.value),S(_,()=>{se.value=_.details._id}),S(()=>l.value,e=>{console.log("card variables",l.value),e&&(g.selectedCard=e,g.selectedCardTitle=e["card-title"],g.selectedCardId=e._id)},{immediate:!0});const j=b("details"),ze=[{label:"Details",value:"details"},{label:"Comments",value:"comments",disabled:pe},{label:"History",value:"history"},{label:"Attachment",value:"attachment"}],A=b(!1),V=b(l.value?l.value["card-title"]:""),me=b(null);function Be(){var e;y.value&&(g.saveTitle(V.value),g.saveLocalId((e=l.value)==null?void 0:e._id),g.saveCardDetails(l.value),A.value=!0,Ie(()=>{var t;return(t=me.value)==null?void 0:t.focus()}))}S(()=>g.selectedCardTitle,e=>{!A.value&&e!==void 0&&(V.value=e)},{immediate:!0});function je(){const e=V.value.trim();if(!e||e===g.selectedCardTitle){A.value=!1;return}Q.mutate({card_id:g.selectedCardId,variables:{"card-title":e}}),A.value=!1}const U=b(l!=null&&l.value?l==null?void 0:l.value["card-description"]:"");S(()=>{var e;return(e=g.selectedCard)==null?void 0:e["card-description"]},e=>{var t;e&&((t=g.selectedCard)==null?void 0:t._id)===g.selectedCardId&&(g.selectedCard["card-description"]=e,g.selectedCard={...g.selectedCard})});const F=b(!1),ae=b(null);function Fe(e){var u,p;const t=(u=e==null?void 0:e.querySelector)==null?void 0:u.call(e,".ProseMirror");if(!t)return;t.focus();const s=(p=window.getSelection)==null?void 0:p.call(window),o=document.createRange();o.selectNodeContents(t),o.collapse(!1),s==null||s.removeAllRanges(),s==null||s.addRange(o)}async function Re(){y.value&&(F.value=!0,await Ie(),Fe(ae.value||void 0))}function _e(){var s,o;const e=(s=U.value)==null?void 0:s.trim(),t=((o=l.value)==null?void 0:o["card-description"])??"";if(!e||e===t){F.value=!1;return}Q.mutate({card_id:_.details._id,variables:{"card-description":e}},{onSuccess:()=>{te("ticketUpdated",{cardId:_.details._id,updates:{"card-description":e}})}}),F.value=!1}function he(e){var s;if(!F.value)return;const t=e.target;(s=ae.value)!=null&&s.contains(t)||_e()}Ce(()=>document.addEventListener("mousedown",he)),xt(()=>document.removeEventListener("mousedown",he));const ie=De({posted_on:((ye=_.details)==null?void 0:ye.posted_on)??((we=_.details)==null?void 0:we.created_at)??""}),$e=P({get:()=>ie.posted_on?new Date(ie.posted_on).toISOString().slice(0,10):"",set:e=>{ie.posted_on=e?new Date(e+"T00:00:00").toISOString():""}}),{data:oe}=yt(Ke.value),le=b(l!=null&&l.value?l.value.workspace_lane_id:"");S([()=>l.value,()=>Oe.value],()=>{l!=null&&l.value&&(V.value=l==null?void 0:l.value["card-title"],U.value=l.value["card-description"],le.value=l.value.workspace_lane_id)});const He=P(()=>((oe==null?void 0:oe.value)??[]).map(e=>{var t;return{_id:e._id,title:((t=e==null?void 0:e.variables)==null?void 0:t["lane-title"])??String(e._id)}}));function Ne(e){le.value=e,Q.mutate({card_id:_.details._id,workspace_lane_id:e})}const k=b({startDate:null,endDate:null});S(()=>l.value,e=>{k.value.startDate=(e==null?void 0:e["start-date"])??null,k.value.endDate=(e==null?void 0:e["end-date"])??null},{immediate:!0,deep:!0});const re=P(()=>k!=null&&k.value.startDate&&k.value.endDate&&k.value.endDate<k.value.startDate?"End date cannot be before start date":""),We=e=>{k.value.startDate=e??null,Q.mutate({card_id:_.details._id,variables:{"start-date":e}})},Ye=e=>{k.value.endDate=e??null,Q.mutate({card_id:_.details._id,variables:{"end-date":e}})},Ge=P(()=>l==null?void 0:l.value.assigned_to),Je=e=>{Q.mutate({card_id:_.details._id,seat_id:e==null?void 0:e._id,optimisticUser:e})},Xe=P(()=>{var e;return(e=_.details)==null?void 0:e._id}),{data:ne}=wt(Xe),f=b((ke=ne.value)==null?void 0:ke.comments);S(()=>ne.value,()=>{var e;f.value=(e=ne.value)==null?void 0:e.comments});const{mutate:Ze,isPending:et}=kt({onMutate:async e=>{const t=_.details._id;await c.cancelQueries({queryKey:["product-comments",t]}),await c.cancelQueries({queryKey:["sheet-list"]});const s=c.getQueryData(["product-comments",t]),o=c.getQueryData(["sheet-list"]),u={_id:Date.now().toString(),comment_text:e.payload.comment_text,commented_by:{u_full_name:"You",_id:fe.value},attachments:e.payload.attachments||[],created_at:new Date().toISOString()};return c.setQueryData(["product-comments",t],p=>({...p,comments:[...(p==null?void 0:p.comments)||[],u]})),{previousComments:s,previousLists:o}},onError:(e,t,s)=>{s!=null&&s.previousComments&&c.setQueryData(["product-comments",_.details._id],s.previousComments),s!=null&&s.previousLists&&c.setQueriesData({queryKey:["sheet-list"]},s.previousLists),console.log(e,t)},onSettled:()=>{c.invalidateQueries({queryKey:["product-comments",_.details._id]}),c.invalidateQueries({queryKey:["sheet-list"]}),c.invalidateQueries({queryKey:["product-card"]})}}),R=b(""),tt=e=>(e??"").split(" ").map(t=>t[0]).filter(Boolean).slice(0,2).join("").toUpperCase(),st=e=>e?new Date(e).toLocaleString():"",{data:fe}=Ct(),at=e=>{var t;return((t=e==null?void 0:e.created_by)==null?void 0:t._id)===fe.value},$=b(null),T=b(""),{mutate:it,isPending:be}=Dt({onSuccess:e=>{const t=f.value.findIndex(s=>s._id===e._id);t>-1&&(f.value[t]={...f.value[t],comment_text:e.comment_text}),$.value=null,T.value="",c.invalidateQueries({queryKey:["product-card"]})}}),{mutate:ot}=St();function lt(e){$.value=e._id,T.value=e.comment_text??""}function de(){$.value=null,T.value="",A.value=!1}function rt(e){const t=T.value.trim();if(!t)return;const s=f.value.findIndex(u=>u._id===e._id),o=s>-1?{...f.value[s]}:null;s>-1&&(f.value[s]={...f.value[s],comment_text:t}),it({id:e._id,payload:{comment_text:t}},{onError:()=>{s>-1&&o&&(f.value[s]=o)},onSuccess:u=>{s>-1&&(f.value[s]=u??f.value[s]),de(),c.invalidateQueries({queryKey:["product-card"]})}})}function nt(e){const t=f.value.findIndex(o=>o._id===e._id),s=t>-1?f.value[t]:null;t>-1&&f.value.splice(t,1),ot({id:e._id},{onError:()=>{s&&f.value.splice(t,0,s)}})}const dt=P(()=>{var e;return(e=l.value)==null?void 0:e.attachments.map(t=>{var s;return{_id:t._id??t.id??((s=crypto.randomUUID)==null?void 0:s.call(crypto))??Math.random(),name:t.name??t.filename??"file",url:t.url,kind:(t.type??t.kind??"").toLowerCase().includes("image")?"image":(t.type??t.kind??"").toLowerCase().includes("video")?"video":"file"}})}),Q=Et({onMutate:async e=>{const{card_id:t,variables:s}=e;await c.cancelQueries({queryKey:["product-card",t]}),await c.cancelQueries({queryKey:["sheet-list"]});const o=c.getQueryData(["product-card",t]),u=c.getQueryData(["sheet-list"]),p=h=>{if(!h||h._id!==t)return h;const i={...h,variables:Array.isArray(h.variables)?[...h.variables]:[]};return s&&(Object.assign(i,s),Object.entries(s).forEach(([w,v])=>{const L=i.variables.findIndex(C=>C.slug===w);L!==-1?i.variables[L]={...i.variables[L],value:v}:i.variables.push({slug:w,value:v,type:"Text"}),w==="card-description"&&(i["card-description"]=v,i.description=v)})),e.workspace_lane_id&&(i.workspace_lane_id=e.workspace_lane_id),e.optimisticUser&&(i.seat=e.optimisticUser,i.assigned_to=e.optimisticUser),i};return c.setQueryData(["product-card",t],p),c.setQueriesData({queryKey:["sheet-list"]},h=>Array.isArray(h)?h.map(i=>{var w;return{...i,cards:(w=i.cards)==null?void 0:w.map(v=>v._id===t?p(v):v)}}):h),{previousCard:o,previousLists:u}},onSuccess:(e,t)=>{const s=t.card_id;Me(),e&&(c.setQueryData(["product-card",s],e),c.setQueriesData({queryKey:["sheet-list"]},o=>Array.isArray(o)?o.map(u=>{var p;return{...u,cards:(p=u.cards)==null?void 0:p.map(h=>h._id===s?{...h,...e}:h)}}):o),c.invalidateQueries({queryKey:["product-card",s]}))},onError:(e,t,s)=>{if(!s)return;const o=t.card_id;c.setQueryData(["product-card",o],s.previousCard),c.setQueriesData({queryKey:["sheet-list"]},s.previousLists)},onSettled:(e,t,s)=>{const o=s.card_id;c.invalidateQueries({queryKey:["product-card",o]}),c.invalidateQueries({queryKey:["sheet-list"]})}}),H=b([]),{mutate:ut}=It({onSuccess:e=>{H.value=[e],c.invalidateQueries({queryKey:["product-card"]})}});function ct(e){const t=e.target.files;Array.from(t).forEach(s=>{const o=new FormData;o.append("file",s),ut(o)})}function pt(){const e=R.value.trim();if(!e&&!H.value.length)return;const t=_.details._id;c.setQueriesData({queryKey:["sheet-list"]},s=>Array.isArray(s)?s.map(o=>({...o,cards:o.cards.map(u=>u._id===t?{...u,comment_count:(u.comment_count||0)+1}:u)})):s),Ze({id:t,payload:{comment_text:e,attachments:H.value.map(s=>({name:s.data.name,url:s.data.url}))}}),R.value="",H.value=[]}const N=De({}),ge=()=>{var e;(e=l==null?void 0:l.value)!=null&&e.variables&&(l.value.variables??[]).forEach(s=>{var u,p;if(!s||s.type!=="Select")return;const o=Array.isArray(s.data)&&s.data.length?((u=s.data[0])==null?void 0:u.value)??((p=s.data[0])==null?void 0:p._id)??s.data[0]:void 0;N[s.slug]=s.value??N[s.slug]??o??null})};Ce(ge),S(()=>l.value,ge,{deep:!0});function xe(e,t){var o,u;N[t]=e,((u=(((o=l.value)==null?void 0:o.variables)??[]).find(p=>p.slug===t))==null?void 0:u.value)!==e&&Q.mutate({card_id:_.details._id,variables:{[t]:e}})}function vt(e){return e==="comments"&&!pe.value?(Ve.error("You do not have permission to view comments"),!1):e==="attachment"&&!Pe.value?(Ve.error("You do not have permission to view attachments"),!1):!0}return(e,t)=>(n(),Vt(W,{name:"panel",appear:""},{default:E(()=>{var s;return[G(a("div",{class:q(["flex flex-col h-full overflow-y-auto bg-gradient-to-b from-bg-card/95 to-bg-card/90 backdrop-blur rounded-[6px] shadow-[0_10px_40px_-10px_rgba(0,0,0,.5)] border border-orchit-white/5 overflow-hidden transition-all duration-300 ease-in-out",B.value?"min-w-full max-w-full":"min-w-full max-w-[380px] sm:min-w-[380px]"]),role:"complementary","aria-label":"Details panel"},[r(ve)&&!r(l)?(n(),d("div",Ut,t[9]||(t[9]=[a("div",{class:"h-8 bg-orchit-white/10 rounded-xl w-3/4"},null,-1),a("div",{class:"space-y-2"},[a("div",{class:"h-4 bg-orchit-white/10 rounded w-full"}),a("div",{class:"h-4 bg-orchit-white/10 rounded w-5/6"})],-1),a("div",{class:"grid grid-cols-2 gap-4"},[a("div",{class:"h-20 bg-orchit-white/10 rounded-xl"}),a("div",{class:"h-20 bg-orchit-white/10 rounded-xl"})],-1)]))):(n(),d("div",Lt,[a("div",Pt,[t[11]||(t[11]=a("h5",{class:"text-[18px] font-semibold tracking-tight"},"Details",-1)),a("div",qt,[a("button",{class:"p-2 rounded-xl hover:bg-orchit-white/5 active:scale-[.98] cursor-pointer transition",onClick:t[0]||(t[0]=o=>B.value=!B.value),"aria-label":B.value?"Collapse details":"Expand details"},[a("i",{class:q(["fa-solid",B.value?"fa-compress":"fa-expand","text-lg"])},null,2)],8,Kt),a("button",{class:"p-2 rounded-xl hover:bg-orchit-white/5 active:scale-[.98] cursor-pointer transition",onClick:t[1]||(t[1]=()=>{te("close"),te("closeSidePanel")}),"aria-label":"Close details"},t[10]||(t[10]=[a("i",{class:"fa-solid fa-xmark text-lg"},null,-1)]))])]),a("div",Ot,[(n(!0),d(D,null,K((s=r(l))==null?void 0:s.variables,(o,u)=>(n(),d(D,{key:o.slug||`var-${u}`},[(o==null?void 0:o.type)==="Select"&&o.slug=="card-type"?(n(),d("div",Mt,[a("div",zt,m(o.title),1),x(r(X),{disabled:!r(y),size:"sm",options:o==null?void 0:o.data.map(p=>({_id:p,title:p})),placeholder:"Select option",allowCustom:!1,"model-value":N[o.slug],"onUpdate:modelValue":p=>xe(p,o.slug)},null,8,["disabled","options","model-value","onUpdate:modelValue"])])):I("",!0)],64))),128)),a("div",Bt,[x(W,{name:"fade-scale",mode:"out-in"},{default:E(()=>[A.value?G((n(),d("input",{disabled:!r(y),title:r(y)?"":"You do not have permission to edit this card",key:"title-edit",ref_key:"titleInput",ref:me,"onUpdate:modelValue":t[2]||(t[2]=o=>V.value=o),onKeydown:[Se(Ee(je,["prevent"]),["enter"]),Se(Ee(de,["prevent"]),["esc"])],class:"w-full text-2xl font-semibold rounded-xl px-3 py-2 bg-orchit-white/5 border border-orchit-white/10 focus:outline-none focus:ring-2 focus:ring-accent/40 transition",type:"text","aria-label":"Edit title"},null,40,jt)),[[ue,V.value]]):(n(),d("h1",{key:"title-view",class:q([r(y)?"cursor-text":"cursor-not-allowed","text-[20px] leading-[28px] font-semibold tracking-tight rounded-lg px-2 py-1 hover:bg-orchit-white/5 transition"]),onClick:t[3]||(t[3]=o=>Be()),"aria-label":"Card title",title:r(y)?"":"You do not have permission to edit this card"},m(V.value||"Untitled"),11,Ft))]),_:1})]),a("div",null,[t[12]||(t[12]=a("h3",{class:"mb-2 text-base font-semibold tracking-wide px-1"}," Description ",-1)),x(W,{name:"fade-scale",mode:"out-in"},{default:E(()=>[F.value?(n(),d("div",{key:"desc-edit",ref_key:"descEditorWrap",ref:ae,class:"rounded-xl overflow-hidden border border-orchit-white/10 shadow-sm"},[x(r(Qe),{modelValue:U.value,"onUpdate:modelValue":t[4]||(t[4]=o=>U.value=o),onFocusOut:_e},null,8,["modelValue"])],512)):(n(),d("div",{key:"desc-view",class:q(["text-[15px] leading-6 text-text-secondary whitespace-pre-wrap rounded-xl px-4 py-3 border border-orchit-white/10 bg-orchit-white/5 hover:border-orchit-white/20 transition",r(y)?"cursor-text":"cursor-not-allowed"]),disabled:!r(y),onClick:Re},[U.value?(n(),d("div",{key:0,innerHTML:U.value},null,8,$t)):(n(),d("span",Ht,"Click to add a description…"))],10,Rt))]),_:1})]),x(r(Ue),{modelValue:j.value,"onUpdate:modelValue":t[5]||(t[5]=o=>j.value=o),options:ze,size:"md",beforeChange:vt},null,8,["modelValue"]),x(W,{name:"section",mode:"out-in"},{default:E(()=>{var o,u,p,h;return[j.value==="details"?(n(),d("section",Nt,[a("div",Wt,[a("div",Yt,[t[13]||(t[13]=a("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," Posted On ",-1)),a("div",Gt,m($e.value),1)]),a("div",Jt,[t[14]||(t[14]=a("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," ID ",-1)),a("div",Xt,m(z.details["card-code"]),1)])]),a("div",Zt,[a("div",es,[t[15]||(t[15]=a("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," Tab ",-1)),x(r(X),{disabled:!r(y),size:"sm",options:He.value,placeholder:"Select lane",allowCustom:!1,"model-value":le.value,"onUpdate:modelValue":Ne},null,8,["disabled","options","model-value"])]),a("div",ts,[t[16]||(t[16]=a("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," Assign ",-1)),x(r(Ae),{disabled:!r(qe),onAssign:t[6]||(t[6]=i=>Je(i)),assigneeId:Ge.value,seat:r(l).seat},null,8,["disabled","assigneeId","seat"])]),z.pin?I("",!0):(n(),d(D,{key:0},[a("div",ss,[t[18]||(t[18]=a("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," Start Date ",-1)),a("div",as,[t[17]||(t[17]=a("i",{class:"fa-regular fa-calendar"},null,-1)),x(r(ce),{disabled:!r(y),placeholder:"Set start date",class:"w-full","model-value":k.value.startDate,"emit-as":"ymd","onUpdate:modelValue":We},null,8,["disabled","model-value"])])]),a("div",is,[t[20]||(t[20]=a("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," Target End ",-1)),a("div",{class:q(["h-8 px-3 flex items-center gap-2 rounded-lg bg-bg-input border transition-colors",re.value?"border-red-500":"border-orchit-white/10"])},[t[19]||(t[19]=a("i",{class:"fa-regular fa-calendar"},null,-1)),x(r(ce),{disabled:!r(y),placeholder:"Set end date",class:"w-full","model-value":k.value.endDate,"emit-as":"ymd","onUpdate:modelValue":Ye},null,8,["disabled","model-value"])],2),re.value?(n(),d("p",os,m(re.value),1)):I("",!0)])],64)),r(ve)?(n(),d(D,{key:1},[t[21]||(t[21]=a("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),t[22]||(t[22]=a("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),t[23]||(t[23]=a("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),t[24]||(t[24]=a("div",{class:"bg-bg-surface/40 w-full animate-pulse h-6 p-1"},null,-1))],64)):(o=r(l))!=null&&o.variables?(n(!0),d(D,{key:2},K((u=r(l))==null?void 0:u.variables,(i,w)=>(n(),d(D,{key:i.slug||`var-${w}`},[i.type==="Select"&&i.slug!=="card-type"&&i.slug!=="ok"&&i.slug!=="process"?(n(),d("div",ls,[a("div",rs,m(i.title),1),x(r(X),{disabled:!r(y),size:"sm",options:i==null?void 0:i.data.filter(v=>v!=="ok"&&v!=="process").map(v=>({_id:v,title:v})),placeholder:"Select option",allowCustom:!1,"model-value":N[i.slug],"onUpdate:modelValue":v=>xe(v,i.slug)},null,8,["disabled","options","model-value","onUpdate:modelValue"])])):I("",!0)],64))),128)):I("",!0)])])):j.value==="history"?(n(),d("section",ns,[a("div",null,[t[27]||(t[27]=a("h3",{class:"text-sm font-semibold tracking-wide mb-3"}," History ",-1)),a("ol",ds,[(n(!0),d(D,null,K((p=r(l))==null?void 0:p.history,(i,w)=>(n(),d("li",{key:w,class:"group"},[t[26]||(t[26]=a("span",{class:"absolute -left-[5px] top-0 w-2 h-2 rounded-full bg-accent/70 ring-4 ring-accent/10"},null,-1)),a("div",us,[a("span",cs,m(i.user.u_full_name),1),t[25]||(t[25]=a("span",{class:"text-text-secondary"}," changed ",-1)),a("span",ps,m(i.field_name),1)])]))),128))])])])):j.value==="comments"?(n(),d("section",vs,[(n(!0),d(D,null,K(f.value??[],i=>{var w,v,L;return n(),d("div",{key:i._id,class:"rounded-xl border border-orchit-white/10 bg-orchit-white/5 p-4 hover:bg-orchit-white/7 transition"},[a("div",ms,[a("div",_s,m(tt((w=i.commented_by)==null?void 0:w.u_full_name)),1),a("div",hs,[a("div",fs,m((v=i.commented_by)==null?void 0:v.u_full_name),1),a("div",bs,m(st(i.created_at)),1)]),at(i)?(n(),d("div",gs,[$.value!==i._id?(n(),d("button",{key:0,disabled:!r(Y),class:"text-xs text-accent hover:underline",onClick:C=>lt(i)}," Edit ",8,xs)):I("",!0),a("button",{disabled:!r(Le),class:"text-xs text-red-400 hover:underline",onClick:C=>nt(i)}," Delete ",8,ys)])):I("",!0)]),x(W,{name:"fade",mode:"out-in"},{default:E(()=>[$.value!==i._id?(n(),d("p",{key:`c-view-${i._id}`,class:"text-[15px] leading-6"},m(i.comment_text),1)):(n(),d("div",{key:`c-edit-${i._id}`,class:"space-y-2"},[G(a("textarea",{"onUpdate:modelValue":t[7]||(t[7]=C=>T.value=C),rows:"3",class:"w-full p-3 rounded-lg bg-bg-input/80 border border-orchit-white/10 focus:ring-2 focus:ring-accent/40 outline-none"},null,512),[[ue,T.value]]),a("div",ws,[x(r(Z),{variant:"secondary",size:"sm",onClick:de},{default:E(()=>t[28]||(t[28]=[J("Cancel")])),_:1,__:[28]}),x(r(Z),{class:"btn",size:"sm",onClick:C=>rt(i),disabled:!T.value.trim()||r(be)||!r(Y)},{default:E(()=>[J(m(r(be)?"Saving…":"Save"),1)]),_:2},1032,["onClick","disabled"])])]))]),_:2},1024),(L=i==null?void 0:i.attachments)!=null&&L.length?(n(),d("div",ks,[(n(!0),d(D,null,K(i.attachments,(C,mt)=>(n(),d("a",{key:mt,href:C.url,target:"_blank",class:"group flex items-center gap-2 rounded-lg border border-orchit-white/10 bg-orchit-white/5 px-2 py-1 hover:bg-orchit-white/10 transition"},[t[29]||(t[29]=a("i",{class:"fa-regular fa-file text-text-secondary group-hover:text-text-primary transition"},null,-1)),a("span",Ds,m(C==null?void 0:C.name),1)],8,Cs))),128))])):I("",!0)])}),128)),a("div",Ss,[G(a("textarea",{disabled:!r(ee)||!r(Y),"onUpdate:modelValue":t[8]||(t[8]=i=>R.value=i),rows:"3",class:q([r(ee)||r(Y)?"cursor-text":"cursor-not-allowed","w-full p-3 bg-transparent outline-none text-sm"]),placeholder:"Write a comment"},null,10,Es),[[ue,R.value]]),a("div",Is,[a("input",{type:"file",multiple:"",onChange:ct,class:"max-w-full text-ellipsis text-xs text-text-secondary file:mr-3 col-span-2 file:px-3 file:py-1.5 file:rounded-md file:border file:border-orchit-white/10 file:bg-orchit-white/10 hover:file:bg-orchit-white/15 file:text-text-primary transition inline w-fit"},null,32),x(r(Z),{variant:"primary",class:"min-w-[70px]",size:"sm",onClick:pt,disabled:!R.value.trim()&&!H.value.length||!r(ee)},{default:E(()=>[J(m(r(et)?"Posting…":"Post"),1)]),_:1},8,["disabled"])])])])):(n(),d("section",Vs,[a("div",Ts," Files attached to this "+m(((h=z.details)==null?void 0:h.type)??"item")+". ",1),a("div",Qs,[(n(!0),d(D,null,K(dt.value,i=>(n(),d("div",{key:i._id,class:"rounded-2xl overflow-hidden border border-orchit-white/10 bg-orchit-white/5 hover:bg-orchit-white/8 transition group"},[a("div",As,[i.kind==="image"?(n(),d("div",Us,[a("img",{src:i.url,class:"w-full h-40 object-cover group-hover:scale-[1.02] transition"},null,8,Ls)])):i.kind==="video"?(n(),d("div",Ps,[a("video",{src:i.url,controls:"",class:"w-full h-40 object-cover"},null,8,qs)])):(n(),d("div",Ks,t[30]||(t[30]=[a("i",{class:"fa-regular fa-file text-3xl text-text-secondary"},null,-1)]))),a("div",Os,[a("div",Ms,m(i.name),1),a("div",zs,m(i.kind),1)])]),a("div",Bs,[a("a",{href:i.url,target:"_blank",rel:"noopener",class:"w-full inline-flex items-center justify-center gap-2 h-9 rounded-lg bg-accent text-orchit-white text-sm hover:opacity-90 transition"},t[31]||(t[31]=[a("i",{class:"fa-regular fa-arrow-up-right-from-square"},null,-1),J(" View ")]),8,js)])]))),128))])]))]}),_:1})])]))],2),[[Tt,z.showPanel]])]}),_:1}))}}),Hs=Qt(Fs,[["__scopeId","data-v-1809bb8c"]]);export{Hs as default};
