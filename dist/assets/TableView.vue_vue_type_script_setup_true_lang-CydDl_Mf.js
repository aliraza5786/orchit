import{d as ge,Q as we,r as i,a0 as ye,c as V,a2 as he,O as I,x as J,D as xe,m as d,g as o,f as R,n as f,G as w,E as x,l as D,k as L,i as K,A as ke,o as l,ah as S,t as Y,y as _e,P as Ce,T as Ve,b4 as Me,al as Ee,ac as ze}from"./index-DkDAC3Va.js";import{_ as Z}from"./CreateTaskModal.vue_vue_type_script_setup_true_lang-DYWAXxAd.js";const $e={class:"kanban-table space-y-4 mt-4 overflow-y-auto overflow-x-auto ps-4 mb-5"},Be={class:"w-full table-fixed border-collapse rounded-[6px] shadow-sm bg-bg-body/20 text-sm border border-border/60"},Ie={class:"bg-bg-surface border-b border-border sticky top-[-1px] z-10"},Re={class:"text-text-secondary"},De=["onMousedown"],Le={class:"w-10 p-2 text-center relative"},Se={class:"relative inline-block"},Te={key:0,class:"column-menu absolute w-[200px] -right-1 bg-bg-dropdown border border-border rounded shadow z-50"},Ae=["checked","onChange"],Ue={class:"bg-bg-surface/20"},Ne=["colspan"],Pe=["onClick"],We=["colspan"],Xe=["onMouseenter"],je={class:"w-8 group text-center align-middle border-r border-border/40 relative"},Fe={class:"flex justify-center items-center h-full w-full relative"},Oe=["onClick"],Ge={key:0,class:"absolute left-6 top-6 bg-bg-dropdown border border-border rounded shadow-md z-50 min-w-[120px] text-left overflow-hidden row-action-menu"},Qe=["onClick"],qe=["colspan"],He=["onUpdate:modelValue","onBlur"],Je=["colspan"],Ze=ge({__name:"TableView",props:{columns:{},rows:{},isPending:{type:Boolean},canCreate:{type:Boolean,default:!0},canCreateVariable:{type:Boolean,default:!0},canDelete:{type:Boolean,default:!1}},emits:["update:rows","create","toggleVisibility","addVar","delete","scroll"],setup(ee,{emit:se}){const{workspaceId:T}=we(),$=ke(),g=i(!1),A=i();function te(){$.path.includes("/workspace/plan")?g.value=!0:F(u==null?void 0:u.length)}const U=i(""),v=ee,{data:N}=ye({workspace_id:T.value,workspace_module_id:U}),oe=V(()=>{var e;return N.value?(e=N.value[0])==null?void 0:e._id:""}),B=i(oe),{data:P}=he(T,U,B),ne=V(()=>{var e;return P.value?(e=P.value[0])==null?void 0:e._id:""}),W=i(ne),p=se,u=I(v.rows||[]),re=e=>{p("scroll",e)};J(()=>v.rows,e=>{e&&u.splice(0,u.length,...e)});const a=I({id:null,field:""}),y=i(null),X=i(null),j=V(()=>u.some(e=>a.id===e.id&&!e[a.field])),le=(e,s)=>{a.id=e.id,a.field=s,Ee(()=>{var r;return(r=X.value)==null?void 0:r.focus()})},ae=()=>{a.id=null,a.field=""},de=e=>{var s;if(!((s=e[a.field])!=null&&s.trim())){const r=u.findIndex(m=>m.id===e.id);r!==-1&&u.splice(r,1)}ae(),p("update:rows",u.slice()),p("create",e)},F=e=>{var r;const s={id:Date.now()};v.columns.forEach(m=>s[m.key]=""),u.splice(e,0,s),le(s,((r=v.columns[0])==null?void 0:r.key)||""),y.value=null,p("update:rows",u.slice())};function ue(e,s){if(!(!e||!s))return s.includes(".")?s.split(".").reduce((r,m)=>r==null?r:r[m],e):e[s]}function ie(e,s){return s!=null&&s.accessor?s.accessor(e):ue(e,s.key)}const ce=e=>{var r;const s=ie(e.row,e.column);return(r=e.column)!=null&&r.render?e.column.render({row:e==null?void 0:e.row,column:e==null?void 0:e.column,value:s,index:e==null?void 0:e.index}):ze("span",String(s??""))},c=I({});J(()=>v.columns,e=>{e.forEach((s,r)=>{r==0?c[s.key]=250:c[s.key]||(c[s.key]=150)})},{immediate:!0});let M=null,O=0,G=0;const be=(e,s)=>{M=s,O=e.clientX,G=c[s],document.addEventListener("mousemove",Q),document.addEventListener("mouseup",q)},Q=e=>{if(!M)return;const s=e.clientX-O,r=Math.max(80,G+s);c[M]=r},q=()=>{M=null,document.removeEventListener("mousemove",Q),document.removeEventListener("mouseup",q)},k=i(v.columns.filter(e=>e.visible??!0).map(e=>e.key)),_=V(()=>v.columns.filter(e=>k.value.includes(e.key)&&e.label.toLowerCase()!=="process")),E=i(!1),h=i(null),ve=e=>{h.value===e?h.value=null:h.value=e},H=e=>{e.target.closest(".column-menu")||(E.value=!1),!e.target.closest(".row-action-btn")&&!e.target.closest(".row-action-menu")&&(h.value=null)};document.addEventListener("click",H),xe(()=>{document.removeEventListener("click",H)});const pe=e=>{const s=k.value.indexOf(e);s===-1?(p("toggleVisibility",e,!0),k.value.push(e)):(p("toggleVisibility",e,!1),k.value.splice(s,1))},me=V(()=>1+_.value.length+1);return(e,s)=>{var r,m;return l(),d("div",{class:"",onScroll:re},[o("div",$e,[o("table",Be,[o("thead",Ie,[o("tr",Re,[s[9]||(s[9]=o("th",{class:"w-8 p-0 sticky left-0 z-20 bg-bg-surface"},null,-1)),(l(!0),d(w,null,x(_.value,t=>(l(),d("th",{key:t==null?void 0:t.key,class:"relative font-bold p-2 uppercase text-left text-[11px] tracking-wide border-r border-border/40 select-none whitespace-nowrap min-w-[200px]",style:S({width:c[t.key]?c[t.key]+"px":"100%"})},[o("span",null,Y(t==null?void 0:t.label),1),o("div",{class:"absolute right-0 top-0 h-full w-2 cursor-col-resize z-30 hover:bg-accent/20 active:bg-accent/40 transition",onMousedown:b=>be(b,t.key)},null,40,De)],4))),128)),o("th",Le,[o("div",Se,[o("button",{onClick:s[0]||(s[0]=D(t=>E.value=!E.value,["stop"])),class:"p-1 rounded hover:bg-bg-surface/50 cursor-pointer"},s[7]||(s[7]=[o("i",{class:"fa-regular fa-columns-3"},null,-1)])),E.value?(l(),d("div",Te,[(l(!0),d(w,null,x(v.columns.filter(t=>t.label.toLowerCase()!=="process"),t=>(l(),d("div",{key:"toggle-"+t.key,class:"flex items-center space-x-2 px-3 py-1.5 capitalize font-medium cursor-pointer hover:bg-bg-dropdown-menu-hover text-[12px] text-text-primary gap-2"},[o("input",{type:"checkbox",checked:k.value.includes(t.key),onChange:b=>pe(t.key),class:"h-4 w-4 mt-0.5 rounded border-border accent-accent cursor-pointer flex-shrink-0"},null,40,Ae),o("span",null,Y(t.label),1)]))),128)),e.canCreateVariable?(l(),d("div",{key:0,onClick:s[1]||(s[1]=t=>p("addVar")),class:"sticky bottom-0 bg-bg-dropdown shadow-md mt-2 shadow-border capitalize border-t border-border px-4 py-2 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-1 overflow-hidden overflow-ellipsis text-nowrap"},s[8]||(s[8]=[o("i",{class:"fa-solid fa-plus"},null,-1),L(" Add new ")]))):f("",!0)])):f("",!0)])])])]),o("tbody",Ue,[e.isPending?(l(),d(w,{key:0},x(5,t=>o("tr",{key:"sk-"+t,class:"border-b border-border animate-pulse"},[s[11]||(s[11]=o("td",null,[o("div",{class:"w-4 h-4 bg-bg-surface rounded"})],-1)),(l(!0),d(w,null,x(e.columns,(b,z)=>(l(),d("td",{key:b.key,class:"border-r border-border h-8",style:S({width:c[b.key]+"px"}),colspan:z===_.value.length-1?2:1},s[10]||(s[10]=[o("div",{class:"w-full h-4 bg-bg-surface rounded"},null,-1)]),12,Ne))),128))])),64)):(l(!0),d(w,{key:1},x(u,(t,b)=>{var z;return l(),d(w,{key:t==null?void 0:t.id},[y.value===b&&!j.value?(l(),d("tr",{key:0,class:"relative bg-bg-surface/20 transition-all cursor-pointer border border-accent",onMouseleave:s[2]||(s[2]=n=>y.value=null)},[o("td",{class:"!p-0 w-8",onClick:n=>F(b)},s[12]||(s[12]=[o("span",{class:"absolute left-[-20px] top-[-14px] bg-bg-surface border border-border w-6 h-6 text-sm rounded-md flex justify-center items-center shadow-sm hover:bg-bg-surface pb-[0.5px]"},"+",-1)]),8,Pe),o("td",{class:"!p-0",colspan:(z=e.columns)==null?void 0:z.length},null,8,We)],32)):f("",!0),o("tr",{onMouseenter:n=>y.value=b,class:"border-b border-border hover:bg-bg-surface/40 transition-colors"},[o("td",je,[o("div",Fe,[o("div",{class:"h-6 w-5 flex items-center justify-center rounded hover:bg-bg-dropdown-menu-hover cursor-pointer text-text-secondary row-action-btn",onClick:D(n=>ve(t._id||t.id),["stop"])},s[13]||(s[13]=[o("i",{class:"fa-solid fa-ellipsis-vertical text-xs"},null,-1)]),8,Oe),h.value===(t._id||t.id)?(l(),d("div",Ge,[e.canDelete?(l(),d("div",{key:0,onClick:D(()=>{p("delete",t),h.value=null},["stop"]),class:"px-3 py-2 text-xs text-red-500 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-2"},s[14]||(s[14]=[o("i",{class:"fa-solid fa-trash"},null,-1),L(" Delete ")]),8,Qe)):f("",!0)])):f("",!0)])]),(l(!0),d(w,null,x(_.value,(n,fe)=>(l(),d("td",{key:n==null?void 0:n.key,class:"border-r border-border overflow-visible relative h-8",style:S({width:c[n.key]+"px"}),colspan:fe===_.value.length-1?2:1},[(a==null?void 0:a.id)===(t==null?void 0:t.id)&&(a==null?void 0:a.field)===(n==null?void 0:n.key)?_e((l(),d("input",{key:0,"onUpdate:modelValue":C=>t[n==null?void 0:n.key]=C,onBlur:C=>de(t),class:"min-w-[200px] w-full p-1 border border-accent/60 rounded-sm focus:outline-none focus:ring-1 focus:ring-accent bg-bg-body text-[12px] h-8",ref_for:!0,ref:C=>C&&(a==null?void 0:a.id)===(t==null?void 0:t.id)&&(a==null?void 0:a.field)===(n==null?void 0:n.key)&&(X.value=C)},null,40,He)),[[Ve,t[n==null?void 0:n.key]]]):Ce(e.$slots,n.key,{key:2,row:t,column:n,index:`r-${t._id}`},()=>[(l(),R(Me(ce),{row:t,column:n,index:t._id},null,8,["row","column","index"]))])],12,qe))),128))],40,Xe)],64)}),128)),!j.value&&e.canCreate?(l(),d("tr",{key:2,onClick:te,class:"bg-bg-surface border-t border-border cursor-pointer transition hover:bg-bg-body",onMouseenter:s[3]||(s[3]=t=>y.value=u==null?void 0:u.length),onMouseleave:s[4]||(s[4]=t=>y.value=null)},[o("td",{colspan:me.value,class:"text-text-secondary h-8 px-3"},s[15]||(s[15]=[o("span",{class:"inline-flex w-5 h-5 border border-border-input rounded-full justify-center items-center text-secondary hover:bg-bg-surface/50 transition pb-0.5"}," + ",-1),L(" Add New Row ")]),8,Je)],32)):f("",!0)])]),g.value&&K($).path.includes("/plan")?(l(),R(Z,{key:0,modelValue:g.value,"onUpdate:modelValue":s[5]||(s[5]=t=>g.value=t),selectedVariable:W.value,listId:(r=A.value)==null?void 0:r.title,sheet_id:B.value},null,8,["modelValue","selectedVariable","listId","sheet_id"])):f("",!0)]),g.value&&K($).path.includes("/plan")?(l(),R(Z,{key:0,modelValue:g.value,"onUpdate:modelValue":s[6]||(s[6]=t=>g.value=t),selectedVariable:W.value,listId:(m=A.value)==null?void 0:m.title,sheet_id:B.value},null,8,["modelValue","selectedVariable","listId","sheet_id"])):f("",!0)],32)}}});export{Ze as _};
