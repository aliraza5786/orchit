import{d as Y,a as Z,r as d,q as ee,c as I,b as V,v as te,x as oe,e as se,w as P,f as ae,o as v,h as r,s as b,i as p,t as y,j as B,k as ne,l as h,m as A,F as le,y as re,z as F,p as m,B as ue}from"./index-BHjrnfZn.js";import{_ as ie}from"./AuthLayout.vue_vue_type_script_setup_true_lang-CQgfmjMk.js";import{v as ce,a as de}from"./auth-BG0jk9WJ.js";import"./favicon-BAFXWHLW.js";import"./Header-D-RoSY1I.js";import"./useTheme-BteZOFqA.js";import"./dark-logo-Mcb_sJlF.js";const me={class:"max-w-[496px] md:mx-auto w-full"},fe={class:"mb-12 space-y-2"},ve={class:"font-bold"},pe={class:"flex justify-center gap-4 pb-4"},ye=["value","onKeydown","onPaste","onInput"],ge={key:0,class:"text-red-500 text-sm text-center mt-2"},we={class:"text-sm font-medium text-text-secondary text-center"},xe=["aria-disabled"],be={key:1,class:"text-green-600 text-sm text-center mt-2"},he={key:2,class:"text-red-500 text-sm text-center mt-2"},i=5,M=45,Re=Y({name:"OtpVerify",__name:"OtpVerification",setup(ke){const O=Z(),S=d(Array.from({length:i},()=>null)),L=ae(),N=ee(),g=d(N.params.email||""),u=d(Array.from({length:i},()=>"")),a=d(""),w=d("");let f;function $(t,e){S.value[e]=t instanceof HTMLInputElement?t:null}function c(t){var e;(e=S.value[t])==null||e.focus()}const E=I(()=>u.value.every(t=>t.length===1)),{mutateAsync:z,isPending:k}=V({mutationFn:ce});async function j(){var t,e,o;if(a.value="",!E.value){a.value="Please enter the complete 5-digit code.";return}try{const s=u.value.join(""),n=await z({u_email:g.value,otp:s});localStorage.setItem("token",(t=n==null?void 0:n.data)==null?void 0:t.token),await O.bootstrap(),L.push("/create-profile")}catch(s){a.value=((o=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:o.message)||"Invalid code, please try again."}}function K(t,e){const{key:o}=e;/^[0-9]$/.test(o)?(u.value[t]=o,a.value&&(a.value=""),e.preventDefault(),t<i-1&&c(t+1)):o==="Backspace"?u.value[t]?(u.value[t]="",a.value&&(a.value="")):t>0&&c(t-1):o==="ArrowLeft"&&t>0?c(t-1):o==="ArrowRight"&&t<i-1&&c(t+1)}function D(t,e=0){const o=t.replace(/\D/g,"").slice(0,i-e);if(!o)return;for(let n=0;n<o.length;n++)u.value[e+n]=o[n];const s=Math.min(e+o.length,i-1);c(s),a.value&&(a.value="")}function q(t,e){var o;D(((o=e.clipboardData)==null?void 0:o.getData("text"))??"",t)}function W(t,e){const o=e.target,s=(o.value||"").replace(/\D/g,"");s.length<=1?(u.value[t]=s,s&&t<i-1&&c(t+1)):D(s,t),o.value=u.value[t]??"",a.value&&(a.value="")}function G(t){const e=t.target;setTimeout(()=>e.select(),0)}const l=d(M);let x;function _(){x&&(clearInterval(x),x=void 0)}function R(){_(),l.value=M,x=window.setInterval(()=>{l.value>0&&(l.value-=1),l.value===0&&_()},1e3)}const H=I(()=>{const t=Math.floor(l.value/60).toString().padStart(2,"0"),e=(l.value%60).toString().padStart(2,"0");return`${t}:${e}`}),{mutateAsync:U,isPending:C,error:T,reset:J}=V({mutationFn:de}),Q=I(()=>T!=null&&T.value?"1":"");async function X(){var t,e;if(a.value="",J(),!g.value){a.value="Email not found. Please login again.";return}try{await U({u_email:g.value}),w.value="A new code has been sent to your email.",f&&clearTimeout(f),f=window.setTimeout(()=>w.value="",4e3),R()}catch(o){a.value=((e=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to resend code."}}return te(()=>{setTimeout(()=>c(0),0),R()}),oe(()=>{_(),f&&clearTimeout(f)}),(t,e)=>(v(),se(ie,null,{form:P(()=>[r("div",me,[r("div",fe,[e[0]||(b(-1,!0),(e[0]=r("h2",{class:"text-[32px] font-medium text-center text-text-primary"},[e[4]||(e[4]=p("Enter Verification Code"))])).cacheIndex=0,b(1),e[0]),e[1]||(b(-1,!0),(e[1]=r("p",{class:"text-base sm:text-nowrap font-medium text-text-secondary text-center"},[e[5]||(e[5]=p(" We sent a five-digit code to your email ")),r("span",ve,"("+y(g.value)+")",1),e[6]||(e[6]=p(". "))])).cacheIndex=1,b(1),e[1])]),r("form",{onSubmit:e[3]||(e[3]=B(()=>{},["prevent"])),class:"space-y-4 w-full"},[r("div",pe,[(v(),h(le,null,re(i,(o,s)=>r("input",{key:s,ref_for:!0,ref:n=>$(n,s),type:"text",inputmode:"numeric",pattern:"[0-9]*",maxlength:"1",autocomplete:"one-time-code",enterkeyhint:"done",class:F(["w-full aspect-square text-5xl p-1 md:p-2 font-bold text-center border rounded-lg focus:outline-none",["border-border",a.value?"border-red-500":"",m(k)?"opacity-60 pointer-events-none":""]]),value:u.value[s],onKeydown:n=>K(s,n),onPaste:B(n=>q(s,n),["prevent"]),onInput:n=>W(s,n),onFocus:G},null,42,ye)),64))]),ne(ue,{disabled:m(k),size:"lg",block:!0,onClick:j},{default:P(()=>[p(y(m(k)?"Verifying...":"Verify"),1)]),_:1},8,["disabled"]),a.value?(v(),h("p",ge,y(a.value),1)):A("",!0),r("p",we,[e[7]||(e[7]=p(" Didn't receive an email? Try checking your junk folder. ")),r("span",{class:F(["text-text-primary font-bold underline",l.value>0?"opacity-50 cursor-not-allowed":"cursor-pointer"]),role:"button","aria-disabled":l.value>0||m(C),onClick:e[2]||(e[2]=o=>l.value===0&&!m(C)&&X())},y(l.value>0?`Resend in ${H.value}`:m(C)?"Resending...":"Resend code"),11,xe)]),w.value?(v(),h("p",be,y(w.value),1)):A("",!0),Q.value?(v(),h("p",he,"Failed to resend OTP. Please try again.")):A("",!0)],32)])]),_:1}))}});export{Re as default};
