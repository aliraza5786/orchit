import{r as S,q as M,z as et,d as V,c as f,j as r,o as a,f as e,t as n,k as $,C as E,i as L,g as z,L as st,W as ct,u as pt,bc as X,x as gt,a0 as ft,y as xt,bd as bt,R as B,P as vt,v as i,e as _t,F as w,A as y,w as ht,be as mt,ai as U,ae as Z,ad as C}from"./index-BcU3GTvQ.js";import{_ as kt}from"./ProgressBar.vue_vue_type_script_setup_true_lang-Ddoe3IO2.js";import{c as wt,d as yt}from"./usePeople-BIZyLxAx.js";import{a as Ct}from"./FormatDate-DIyppjZM.js";function St(j,{start:g=0,maxWhileLoading:T=90,step:d=.8,intervalMs:c=120}={}){const u=S(g);let p=null;const l=()=>{p==null&&(p=window.setInterval(()=>{j()&&(u.value=Math.min(u.value+d,T))},c))},x=()=>{p!=null&&(clearInterval(p),p=null)};return M(j,A=>{A?(u.value=g,l()):(u.value=100,setTimeout(()=>{u.value=g,x()},300))},{immediate:!0}),et(x),u}const $t={class:"relative p-3 rounded-lg min-w-[240px] sm:min-w-sm border border-border overflow-hidden flex flex-col justify-between bg-bg-card w-full"},jt={class:"flex justify-between items-start pb-2"},Tt={class:"text-lg font-semibold text-text-primary text-left"},Pt={class:"text-xs text-text-secondary text-left"},Dt={class:"flex items-center gap-2"},It={class:""},Et={class:"flex justify-between text-sm text-text-secondary mb-1"},Lt={key:0,class:"fa-regular text-left fa-arrows-spin animate-spin duration-250"},Mt={key:0},At={key:1},Rt=V({__name:"ProjectCard",props:{title:{},subtitle:{},status:{},progress:{default:0},avatars:{},maxVisible:{default:2},date:{},loading:{type:Boolean,default:!1},color:{default:"#9CA3AF"},totalCard:{default:0},ai:{type:Boolean},doneCard:{}},setup(j){const g=j,T=St(()=>!!g.loading),d=f(()=>g.loading?T.value:g.progress),c=f(()=>Math.round(d.value)>=100),u=S(0);M(c,(l,x)=>{l&&!x&&u.value++});function p(l){switch(l){case"completed":return"bg-green-400/40 border-green-400 text-green-400";case"failed":return"bg-red-400/40 border-red-400 text-red-400";case"in_progress":return"bg-blue-400/20 border-blue-400 text-blue-400";case"pending":return"bg-amber-400/20 border-amber-400 text-amber-400";default:return"progress-default"}}return(l,x)=>(a(),r("div",$t,[e("div",jt,[e("div",null,[e("h3",Tt,n(l.title),1),e("p",Pt,n(l.subtitle),1)]),e("div",Dt,[!l.totalCard&&l.status?(a(),r("span",{key:0,class:E(["text-xs border rounded-full px-2 py-0.5",p(l.status)])},n(l.status),3)):$("",!0)])]),e("div",It,[e("div",Et,[e("div",null,[e("span",null,n(l.status=="in_progress"?"Generating lane with AI...":"Progress"),1),x[0]||(x[0]=z()),l.status=="in_progress"?(a(),r("i",Lt)):$("",!0)]),l.ai?(a(),r("span",Mt,[z(n(Math.round(d.value))+"% ",1),c.value?(a(),r("span",{key:u.value,class:"confetti-icon select-none","aria-label":"Completed"}," ðŸŽ‰ ")):$("",!0)])):(a(),r("span",At,n(l.doneCard??0)+" / "+n(l.totalCard),1))]),L(kt,{class:"mt-2",progress:d.value,fillColor:"bg-accent",indeterminate:!!l.loading},null,8,["progress","indeterminate"])])]))}}),tt=st(Rt,[["__scopeId","data-v-c8d254a0"]]),Nt={class:"flex flex-col gap-4 h-full overflow-x-auto w-full flex-auto"},Ot={class:"p-5 rounded-[6px] bg-bg-card space-y-6"},Bt={class:"flex items-center justify-between"},Ut={class:"flex flex-col w-full"},Vt={class:"text-sm text-text-secondary mt-2"},zt={class:"flex gap-2.5 overflow-x-auto w-full py-8 custom_scroll_bar"},Ht=["onClick"],Jt=["onClick"],Wt={class:"flex flex-grow flex-col sm:flex-row gap-4"},Ft={class:"bg-bg-card w-full max-h-full flex-auto p-5 rounded-lg"},qt={class:"mb-4"},Gt={class:"text-sm text-text-secondary mt-1"},Kt={key:0,class:"ml-1"},Qt={class:"space-y-4"},Yt={key:1,class:"text-center py-8"},Xt={key:2,class:"text-center py-8"},Zt={class:"flex items-center gap-2 w-32 flex-shrink-0"},te={key:0,class:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0"},ee=["src","alt"],se={key:2,class:"w-8 h-8 rounded-full bg-bg-body flex items-center justify-center flex-shrink-0"},oe=["title"],ae={class:"flex-1"},re=["title"],le={class:"bg-bg-card w-full flex-auto p-5 max-h-full rounded-lg overflow-y-auto flex flex-col"},ne={class:"space-y-4 overflow-y-auto flex-1"},de={class:"flex-1 min-w-0"},ue={class:"text-sm text-text-primary"},ie={class:"font-medium text-accent/90 pe-1"},ce=["innerHTML"],pe={href:"#",class:"text-accent/90 hover:underline"},ge={class:"text-xs text-text-secondary mt-1"},fe=V({__name:"Peak",setup(j){const{isDark:g}=ct(),T=pt(),d=gt(),c=f(()=>{var o;return X((o=d==null?void 0:d.params)==null?void 0:o.id)}),u=f(()=>{var o;return X((o=d==null?void 0:d.params)==null?void 0:o.job_id)}),{data:p,isPending:l,error:x,refetch:A}=wt(c),{data:H}=yt(c),{data:ot}=ft(c),at=f(()=>{var b,t,v;const o=(b=H.value)==null?void 0:b.activities,s=((t=T.workspace)==null?void 0:t.created_at)||((v=ot.value)==null?void 0:v.created_at);return o!=null&&o.length&&o[0].created_at||s}),R=S(!1),J=S(!1),h=S(null),m=S(null);let P=!1;const rt="https://backend.streamed.space/api/v1/",W=()=>{if(P||m.value)return;const o=localStorage.getItem("token")||"",s=u.value,b=localStorage.getItem("jobId"),t=s||b||c.value,I=`${rt}common/step2/tasks/${t}/stream?token=${o}&is_manual=${s||b?"false":"true"}`,_=new EventSource(I);m.value=_,_.onopen=()=>{P||(J.value=!0)},_.onmessage=O=>{var Q;if(!P)try{h.value=JSON.parse(O.data);const Y=((Q=h.value)==null?void 0:Q.status)??"cancels";["completed","failed","canceled"].includes(Y)&&D()}catch{}},_.onerror=()=>{D()},m.value.addEventListener("progress",O=>{try{h.value=JSON.parse(O.data)}catch{}})},D=()=>{J.value=!1,m.value&&(m.value.close(),m.value=null)};xt(()=>{P=!1,W()}),et(()=>{P=!0,D()});const k=f(()=>{var o;return((o=h.value)==null?void 0:o.percent)===100}),lt=f(()=>{var o,s;return((s=(o=h.value)==null?void 0:o.result)==null?void 0:s.lanes_summary)??[]}),nt=f(()=>{var o,s;return((s=(o=h.value)==null?void 0:o.progress_details)==null?void 0:s.lanes_progress)??[]}),F=["https://randomuser.me/api/portraits/women/1.jpg","https://randomuser.me/api/portraits/men/2.jpg","https://randomuser.me/api/portraits/men/3.jpg"],q=o=>{console.log("Lane clicked:",o)},G=f(()=>{var o;return(o=p.value)!=null&&o.team_workload?p.value.team_workload.map(s=>({id:s.assignee_id||"unassigned",name:s.assignee_name,initials:s.initials||B(s.assignee_name)||"",avatar:!!s.avatar_url||!!s.assignee_id,avatarUrl:s.avatar_url,color:bt(s.assignee_id,s.assignee_name),workload:s.work_distribution_percentage,totalTasks:s.total_tasks,totalHours:s.total_hours})):[]}),N=f(()=>{var o;return((o=p.value)==null?void 0:o.team_size)||0}),dt=o=>({"DEPLOYED-PROD":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",REOPENED:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200","IN-PROGRESS":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"})[o]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200",ut=V({name:"SkeletonCard",setup(){return()=>C("div",{class:"w-[380px] min-w-[280px] h-[180px] rounded-xl border border-border bg-bg-body/60 animate-pulse p-4"},[C("div",{class:"h-5 w-2/3 rounded bg-bg-card/50 mb-2"}),C("div",{class:"h-3 w-1/2 rounded bg-bg-card/50 mb-4"}),C("div",{class:"h-2 w-full rounded bg-bg-card/50 mb-1"}),C("div",{class:"h-2 w-11/12 rounded bg-bg-card/50 mb-1"}),C("div",{class:"h-2 w-10/12 rounded bg-bg-card/50"})])}}),K=(o,s)=>o?(s.Done??0)/o*100:0,it=vt();return M(k,o=>{o&&it.invalidateQueries({queryKey:["dashboard-teams",c.value]})}),M([c,u],()=>{D(),W()}),(o,s)=>{var b;return a(),r("div",Nt,[e("div",Ot,[e("div",Bt,[e("div",Ut,[s[1]||(s[1]=e("h3",{class:"text-2xl text-text-primary font-semibold"},"Project Overview",-1)),e("p",Vt,"Last update on "+n(i(Ct)(at.value)),1),e("div",zt,[R.value?(a(),r(w,{key:0},y(3,t=>L(i(ut),{key:t})),64)):(a(),_t(mt,{key:1,name:"list",tag:"div",class:"flex gap-2.5"},{default:ht(()=>[k.value?(a(!0),r(w,{key:0},y(lt.value,t=>(a(),r("button",{key:t==null?void 0:t.lane_title,class:"group focus:outline-none border-border border focus-visible:ring-2 focus-visible:ring-primary/50 rounded-xl",type:"button",role:"button","aria-label":"Open lane details",onClick:v=>q(t)},[L(tt,{ai:!1,doneCard:t==null?void 0:t.status_distribution.Done,loading:R.value||(t==null?void 0:t.status)==="in_progress",title:t==null?void 0:t.lane_title,subtitle:"",progress:k.value?K(t==null?void 0:t.total_cards,t==null?void 0:t.status_distribution):t==null?void 0:t.progress,totalCard:t==null?void 0:t.total_cards,status:k.value?"":(t==null?void 0:t.status)??"",avatars:F,date:"May 28",class:"transition-transform duration-200 ease-out group-hover:shadow-lg border border-transparent hover:border-border-subtle rounded-xl cursor-pointer"},null,8,["doneCard","loading","title","progress","totalCard","status"])],8,Ht))),128)):(a(!0),r(w,{key:1},y(nt.value,t=>(a(),r("button",{key:`2-${t==null?void 0:t.lane_title}`,class:"group focus:outline-none border-border border focus-visible:ring-2 focus-visible:ring-primary/50 rounded-xl",type:"button",role:"button","aria-label":"Open lane details",onClick:v=>q(t)},[L(tt,{ai:!0,loading:R.value||(t==null?void 0:t.status)==="in_progress",title:t==null?void 0:t.lane_title,subtitle:"",progress:k.value?K(t==null?void 0:t.total_cards,t==null?void 0:t.status_distribution):t==null?void 0:t.progress,totalCard:t==null?void 0:t.total_cards,status:k.value?"":(t==null?void 0:t.status)??"",avatars:F,date:"May 28",class:"transition-transform duration-200 ease-out group-hover:shadow-lg border border-transparent hover:border-border-subtle rounded-xl cursor-pointer"},null,8,["loading","title","progress","totalCard","status"])],8,Jt))),128))]),_:1}))])])])]),e("div",Wt,[e("div",Ft,[e("div",qt,[s[3]||(s[3]=e("h3",{class:"text-lg font-semibold text-text-primary"},"Team workload",-1)),e("p",Gt,[s[2]||(s[2]=z(" Monitor the capacity of your team. ")),N.value>0?(a(),r("span",Kt,"("+n(N.value)+" member"+n(N.value!==1?"s":"")+")",1)):$("",!0)])]),e("div",Qt,[s[8]||(s[8]=e("div",{class:"flex items-center justify-between text-sm font-medium text-text-secondary mb-2"},[e("span",null,"Assignee"),e("span",null,"Work distribution")],-1)),i(l)?(a(),r(w,{key:0},y(3,t=>e("div",{key:t,class:"flex items-center gap-3 animate-pulse"},s[4]||(s[4]=[e("div",{class:"flex items-center gap-2 w-32 flex-shrink-0"},[e("div",{class:"w-8 h-8 rounded-full bg-bg-body"}),e("div",{class:"h-4 w-20 bg-bg-body rounded"})],-1),e("div",{class:"flex-1 h-6 bg-bg-body rounded"},null,-1)]))),64)):i(x)?(a(),r("div",Yt,[s[5]||(s[5]=e("p",{class:"text-sm text-red-500 mb-2"},"Failed to load team workload",-1)),e("button",{onClick:s[0]||(s[0]=()=>i(A)()),class:"text-xs text-accent hover:underline"}," Try again ")])):G.value.length===0?(a(),r("div",Xt,s[6]||(s[6]=[e("i",{class:"pi pi-users text-3xl text-text-secondary mb-2"},null,-1),e("p",{class:"text-sm text-text-secondary"},"No team members assigned yet",-1)]))):(a(!0),r(w,{key:3},y(G.value,t=>(a(),r("div",{key:t.id,class:"flex items-center gap-3"},[e("div",Zt,[t.avatarUrl?(a(),r("div",te,[e("img",{src:t==null?void 0:t.avatarUrl,alt:t.name,class:"w-full h-full object-cover"},null,8,ee)])):t.avatar?(a(),r("div",{key:1,class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0",style:U({backgroundColor:i(Z)({name:t==null?void 0:t.name})})},n(i(B)(t==null?void 0:t.name)),5)):(a(),r("div",se,s[7]||(s[7]=[e("i",{class:"pi pi-user text-text-secondary"},null,-1)]))),e("span",{class:"text-sm text-text-primary truncate",title:t==null?void 0:t.name},n(t==null?void 0:t.name),9,oe)]),e("div",ae,[e("div",{class:"h-6 bg-bg-body rounded overflow-hidden relative group cursor-help",title:`${t.totalTasks} task${t.totalTasks!==1?"s":""} â€¢ ${t.totalHours}h`},[e("div",{class:E(["h-full transition-all duration-300",i(g)?"bg-accent":"!bg-accent-hover/40"]),style:U({width:t.workload+"%"})},null,6),t.workload>0?(a(),r("span",{key:0,class:E(["absolute inset-0 flex items-center justify-start px-2 text-[11px] font-medium",i(g)?"text-white":"text-black"])},n(t.workload)+"% ",3)):$("",!0)],8,re)])]))),128))])]),e("div",le,[s[10]||(s[10]=e("div",{class:"mb-4"},[e("h3",{class:"text-lg font-semibold text-text-primary"},"Recent activity"),e("p",{class:"text-sm text-text-secondary mt-1"},"Stay up to date with what's happening across the project.")],-1)),e("div",ne,[s[9]||(s[9]=e("div",{class:"text-xs font-semibold text-text-secondary mb-3"},"Today",-1)),(a(!0),r(w,null,y((b=i(H))==null?void 0:b.activities,t=>{var v,I,_;return a(),r("div",{key:t.id,class:"flex gap-3 pb-4 border-b border-border last:border-0"},[e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0",style:U({backgroundColor:i(Z)({email:(v=t==null?void 0:t.user)==null?void 0:v.email})})},n(i(B)((I=t==null?void 0:t.user)==null?void 0:I.name)),5),e("div",de,[e("div",ue,[e("span",ie,n((_=t==null?void 0:t.user)==null?void 0:_.name),1),e("span",{class:"text-text-secondary",innerHTML:t==null?void 0:t.message},null,8,ce),e("a",pe,n(t==null?void 0:t.item),1),t.status?(a(),r("span",{key:0,class:E(["ml-2 px-2 py-0.5 rounded text-xs font-medium",dt(t.status)])},n(t==null?void 0:t.status),3)):$("",!0)]),e("div",ge,n(t==null?void 0:t.time),1)])])}),128))])])])])}}}),he=st(fe,[["__scopeId","data-v-28655b5b"]]);export{he as default};
