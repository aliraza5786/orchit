import{d as O,a as H,N as J,bp as M,r as m,c as w,p as z,j as l,f as t,q as d,aA as K,t as r,i as C,w as x,B as g,g as n,e as W,k as I,au as E,o as a,n as Q}from"./index-B6QqO5al.js";const X={class:"min-h-[100dvh] flex items-center justify-center bg-bg-body px-4"},Z={class:"w-full max-w-xl"},ee={class:"rounded-2xl border border-border bg-bg-card 1F2430] shadow-sm overflow-hidden"},te={key:0,class:"p-6"},se={key:1,class:"p-6"},oe={class:"rounded-lg border border-red-200 bg-red-50 p-4 text-red-800 dark:border-red-900/50 dark:bg-red-950/40 red-200"},ae={class:"text-sm leading-relaxed"},le={class:"mt-4 flex gap-2"},de={key:2,class:"p-6"},ie={key:0},ne={class:"rounded-lg border border-emerald-200 bg-emerald-50 p-4 text-emerald-800 emerald-200"},re={class:"text-sm leading-relaxed"},ue={class:"mt-4 flex gap-2"},ce={key:1},ve={class:"rounded-lg border border-yellow-200 bg-yellow-50 p-4 text-yellow-800"},pe={key:0,class:"text-sm leading-relaxed"},me={key:1,class:"text-sm leading-relaxed"},xe={class:"mt-4 flex gap-2"},ge={key:3,class:"p-6"},be={class:"mt-4 flex gap-2"},fe={key:4,class:"p-6"},_e={class:"flex items-start gap-4"},ye=["src"],ke={class:"text-lg font-medium text-text-primary"},he={class:"text-sm text-text-secondary text-secondary-300"},we={class:"font-medium"},Ce={key:0},Ie={class:"font-medium text-xs"},je={key:0,class:"text-xs text-red-500 mt-1"},Te={key:1,class:"text-xs text-text-secondary -500 text-secondary-400 mt-1"},Ae={key:0,class:"mt-4 rounded-lg border p-3 text-sm text-text-secondary -700 text-secondary-200 dark:border-border 1F2430]"},Le={class:"mt-6 flex flex-wrap gap-2"},Re=["disabled"],Be={key:0},Ne={key:1},Se={key:1,class:"mt-3 text-xs text-emerald-600 emerald-400"},Ve=O({__name:"WorkspaceInvite",setup(We){const c=Q(),j=H(),{token:T}=J(),{data:s,refetch:V,isPending:$}=M(T.value),v=m(null),u=m(!1),p=m(null),A=m(null),h=m(!1),L=m(!1);function D(o){return o?o.replace(/[_-]+/g," ").replace(/\b\w/g,e=>e.toUpperCase()):""}const R=w(()=>j.isAuthenticated),S=w(()=>{var o,e;return(e=(o=j.user)==null?void 0:o.data)==null?void 0:e.u_email}),B=w(()=>{var o;return(o=s.value)==null?void 0:o.email}),P=w(()=>!R.value||!B.value?!1:S.value===B.value);async function U(){var o,e;if(!(!s.value||s.value.status=="expired")){u.value=!0,p.value="accepted",v.value=null;try{await E.post(`/common/invitation/accept/${encodeURIComponent(T.value)}`,{status:"accepted"}),h.value=!0}catch(i){v.value=((e=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:e.message)||"Could not accept the invitation."}finally{u.value=!1,p.value=null}}}async function Y(){var o,e;if(s.value){u.value=!0,p.value="decline",v.value=null;try{await E.post(`/common/invitation/accept/${encodeURIComponent(T.value)}`,{status:"rejected"}),L.value=!0}catch(i){v.value=((e=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:e.message)||"Could not decline the invitation."}finally{u.value=!1,p.value=null}}}function N(){c.push({name:"home"}).catch(()=>{})}function q(){c.push({name:"Login",query:{redirect:c.currentRoute.value.fullPath}})}function F(){j.logout(),c.push({name:"Login",query:{redirect:c.currentRoute.value.fullPath}})}function G(){var o,e,i,b,f,_,y,k;(e=(o=s.value)==null?void 0:o.workspace)!=null&&e._id?(i=s.value)!=null&&i.job_id?c.push(`/workspace/peak/${(y=(_=s.value)==null?void 0:_.workspace)==null?void 0:y._id}/${(k=s.value)==null?void 0:k.job_id}`):(localStorage.removeItem("jobId"),c.push(`/workspace/peak/${(f=(b=s.value)==null?void 0:b.workspace)==null?void 0:f._id}`)):N()}return z(()=>s.value,()=>{var o,e;if(((o=s.value)==null?void 0:o.status)=="rejected"){L.value=!0;return}if(((e=s.value)==null?void 0:e.status)=="accepted"){h.value=!0;return}}),(o,e)=>{var i,b,f,_,y,k;return a(),l("div",X,[t("div",Z,[t("div",ee,[e[20]||(e[20]=t("div",{class:"px-6 py-5 border-b border-border"},[t("h1",{class:"text-2xl font-semibold text-text-primary"},"Workspace invitation"),t("p",{class:"text-sm text-text-secondary text-secondary-300 mt-1"}," Accept the invite to join this workspace, or decline to ignore it. ")],-1)),d($)?(a(),l("div",te,e[1]||(e[1]=[K('<div class="animate-pulse space-y-4"><div class="h-5 w-56 bg-bg-surface"></div><div class="h-4 w-40 bg-bg-surface"></div><div class="h-24 w-full bg-bg-surface rounded-lg"></div><div class="flex gap-2"><div class="h-10 w-28 bg-bg-surface"></div><div class="h-10 w-28 bg-bg-surface"></div></div></div>',1)]))):v.value?(a(),l("div",se,[t("div",oe,[e[2]||(e[2]=t("div",{class:"font-medium mb-1"},"We couldnâ€™t open this invite.",-1)),t("p",ae,r(v.value),1)]),t("div",le,[t("button",{class:"px-4 py-2 rounded-md border text-sm border-border",onClick:e[0]||(e[0]=()=>d(V)())},"Try again"),C(g,{onClick:N},{default:x(()=>e[3]||(e[3]=[n("Go to home")])),_:1,__:[3]})])])):h.value?(a(),l("div",de,[P.value?(a(),l("div",ie,[t("div",ne,[e[6]||(e[6]=t("div",{class:"font-medium mb-1"},"Youâ€™re in! ðŸŽ‰",-1)),t("p",re,[e[4]||(e[4]=n(" Youâ€™ve joined ")),t("strong",null,r((i=d(s))==null?void 0:i.workspace_title),1),e[5]||(e[5]=n(". "))])]),t("div",ue,[C(g,{onClick:G},{default:x(()=>e[7]||(e[7]=[n("Open workspace")])),_:1,__:[7]})])])):(a(),l("div",ce,[t("div",ve,[e[13]||(e[13]=t("div",{class:"font-medium mb-1"},"Invite Accepted",-1)),R.value?(a(),l("p",pe,[e[8]||(e[8]=n(" This invite has been accepted for ")),t("strong",null,r(B.value),1),e[9]||(e[9]=n(".")),e[10]||(e[10]=t("br",null,null,-1)),e[11]||(e[11]=n(" You are currently logged in as ")),t("strong",null,r(S.value),1),e[12]||(e[12]=n(". "))])):(a(),l("p",me," This invite has been accepted. Please log in to access the workspace. "))]),t("div",xe,[R.value?(a(),W(g,{key:1,onClick:F},{default:x(()=>e[15]||(e[15]=[n("Log Out & Switch Account")])),_:1,__:[15]})):(a(),W(g,{key:0,onClick:q},{default:x(()=>e[14]||(e[14]=[n("Log In")])),_:1,__:[14]}))])]))])):L.value?(a(),l("div",ge,[e[17]||(e[17]=t("div",{class:"rounded-lg border border-gray-200 bg-gray-50 p-4 text-text-secondary -800 dark:border-border 1F2430] dark:bg-[#171922] text-secondary-200"},[t("div",{class:"font-medium mb-1"},"Invite declined"),t("p",{class:"text-sm leading-relaxed"},"Weâ€™ve let the workspace know you wonâ€™t be joining.")],-1)),t("div",be,[C(g,{onClick:N},{default:x(()=>e[16]||(e[16]=[n("Go to home")])),_:1,__:[16]})])])):(a(),l("div",fe,[t("div",_e,[t("img",{src:d(s).workspace_logo,alt:"",class:"h-12 w-12 rounded-xl object-contain border border-border"},null,8,ye),t("div",null,[t("h2",ke,r((b=d(s))==null?void 0:b.workspace_title),1),t("p",he,[e[18]||(e[18]=n(" Invited by ")),t("span",we,r(d(s).invited_by||d(s).email),1),d(s).role_title?(a(),l("span",Ce," for the "+r(D(d(s).role_title))+" Role",1)):I("",!0),e[19]||(e[19]=t("br",null,null,-1)),t("span",Ie,r(d(s).email),1)]),(f=d(s))!=null&&f.is_expire?(a(),l("p",je,"This invite has expired.")):(_=d(s))!=null&&_.is_expire?(a(),l("p",Te," This Invitation Link has been Expire ")):I("",!0)])]),(y=A.value)!=null&&y.message?(a(),l("div",Ae," â€œ"+r(A.value.message)+"â€ ",1)):I("",!0),t("div",Le,[C(g,{disabled:d(s).is_expire||u.value,onClick:U},{default:x(()=>[n(r(u.value&&p.value==="accepted"?"Joiningâ€¦":"Accept invitation"),1)]),_:1},8,["disabled"]),t("button",{class:"px-4 py-2 rounded-md text-sm border dark:border-border 353D50] hover:bg-gray-50 dark:hover:bg-[#1a1a1f] disabled:opacity-60 disabled:cursor-not-allowed",disabled:u.value||d(s).is_expire,onClick:Y},[u.value&&p.value==="decline"?(a(),l("span",Be,"Decliningâ€¦")):(a(),l("span",Ne,"Decline"))],8,Re)]),((k=A.value)==null?void 0:k.status)==="accepted"&&!h.value?(a(),l("p",Se," Youâ€™ve already accepted this invite. ")):I("",!0)]))]),e[21]||(e[21]=t("p",{class:"text-center text-xs text-text-secondary -500 text-secondary-400 mt-4"}," If this wasnâ€™t you, you can safely ignore this page. ",-1))])])}}});export{Ve as default};
