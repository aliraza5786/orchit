import{a$ as b,au as D,am as c,i,c as o,d as fe,W as ve,S as be,Q as ge,a3 as ye,a1 as _e,r as Q,a0 as Se,a2 as De,O as R,x as g,f as j,Y as ke,w as P,o as m,g as d,k as I,h as f,m as y,n as _,_ as he,M as U,E as xe,y as Ve,J as Te,G as Ce,F as W,Z as J,t as A,a4 as Ie,A as we,a5 as Ee,B as Y}from"./index-DkDAC3Va.js";const Ne=(s,l,u={})=>D({queryKey:o(()=>["sprint-list",i(s),i(l)]),queryFn:({signal:p})=>c({url:`sprints/${i(s)}`,method:"GET",signal:p,params:{sprintType:i(l)}}),...u}),Qe=(s,l={})=>{const u=o(()=>!!i(s));return D({queryKey:["sprint-cards",s],queryFn:({signal:p})=>c({url:`sprints/${i(s)}/backlog`,method:"GET",signal:p}),enabled:u,...l})},$e=(s,l={})=>D({queryKey:["sprint-kanban",s],queryFn:({signal:u})=>c({url:"workspace/cards/sprintgrouped",method:"GET",signal:u,params:{sprint_id:i(s),variable_id:"68b6c96e0a95eef7d14e6981"}}),...l}),Re=(s,l={})=>b({key:["sprint-complete"]},{mutationFn:u=>c({url:`sprints/${i(s)}/complete`,method:"POST",data:u.payload}),...l}),je=(s,l={})=>{const u=o(()=>!!i(s));return D({queryKey:["sprint-detail",s],queryFn:({signal:p})=>c({url:`sprints/detail/${i(s)}?include_cards=true`,method:"GET",signal:p}),enabled:u,...l})},We=(s={})=>b({key:["delete-sprint-card"]},{mutationFn:l=>c({url:`sprints/${i(l.sprintId)}/cards/${i(l.cardId)}`,method:"DELETE"}),...s}),Je=(s,l,u=null,p={})=>D({queryKey:["backlog-list",s,i(l),i(u)],queryFn:({signal:w})=>c({url:`sprints/workspace/${i(s)}/cards`,method:"GET",signal:w,params:{include_sprint_cards:!1,sprintType:i(l),module_id:i(u)}}),...p}),Ye=(s={})=>b({key:["add-sprint"]},{mutationFn:l=>c({url:"/sprints",method:"POST",data:l.payload}),...s}),Ze=(s={})=>b({key:["move-card-to-sprint"]},{mutationFn:l=>c({url:`/sprints/${l.id}/cards`,method:"POST",data:l.payload}),...s}),He=(s={})=>b({key:["add-sprint"]},{mutationFn:l=>c({url:`/sprints/${l.id}`,method:"PUT",data:l.payload}),...s}),Xe=(s={})=>b({key:["start-sprint"]},{mutationFn:l=>c({url:`/sprints/${l.id}/start`,method:"POST",data:l.payload}),...s}),et=(s={})=>b({key:["delete-sprint"]},{mutationFn:l=>c({url:`/sprints/${l}`,method:"DELETE"}),...s}),tt=(s={})=>b({key:["remove-card-from-sprint"]},{mutationFn:l=>c({url:`sprints/${i(l.sprintId)}/cards/remove `,method:"POST",data:{card_ids:[l.cardId]}}),...s}),qe={class:"px-6 grid grid-cols-1 sm:grid-cols-2 gap-4"},Fe={key:0,class:"flex flex-col"},Be={key:1,class:"flex gap-1 flex-col"},Oe={key:0,class:"text-xs text-red-500"},Pe={key:2,class:"flex gap-1 flex-col"},Ue={key:0,class:"text-xs text-red-500"},Ae={class:"flex flex-col gap-1"},Le={class:"mt-2"},ze={key:3,class:"flex flex-col"},Ke={class:"px-6 mt-2"},Me={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},at=fe({__name:"CreateTaskModal",props:{modelValue:{type:Boolean,default:!1},sheet_id:{},listId:{},selectedVariable:{},pin:{},size:{default:"lg"}},emits:["update:modelValue","created"],setup(s,{emit:l}){const{canCreateCard:u}=ve(),p=we(),w=l,v=s,Z=be(),{workspaceId:S,moduleId:H}=ge(),{mutate:X,isPending:E}=ye({onSuccess:()=>{G(),Z.invalidateQueries({queryKey:["sheet-list"]}),x.value=!1,ee()}}),{refetch:ee}=$e(localStorage.getItem("activeSprintId")||""),{data:$}=_e(S.value),te=Q(localStorage.getItem("selectedModuleId")||""),{data:q}=Se({workspace_id:S,workspace_module_id:te}),ae=o(()=>{var e;return q.value?(e=q.value[0])==null?void 0:e._id:""}),k=Q(ae.value),se=o(()=>v.sheet_id||k.value||""),{data:h}=De(S,H,se),x=o({get:()=>v.modelValue,set:e=>w("update:modelValue",e)}),L=o(()=>((h==null?void 0:h.value)??[]).filter(e=>{var a;return((a=e==null?void 0:e.type)==null?void 0:a.title)==="Select"})),le=e=>e.map(a=>({_id:a,title:a})),F=o(()=>{const e=(($==null?void 0:$.value)??[]).map(a=>{var n;return{_id:a._id,title:((n=a==null?void 0:a.variables)==null?void 0:n["lane-title"])??String(a._id)}});return e.find(a=>a.title==="Main")||e.unshift({_id:"main",title:"Main"}),e}),z=e=>e.slug,t=R({title:"",description:"",startDate:null,endDate:null,lane_id:null,assignee:null,variables:{}});g(L,e=>{for(const a of e){const n=z(a);n in t.variables||(t.variables[n]=null)}},{immediate:!0});const r=R({title:!1,description:!1,startDate:!1,endDate:!1,lane:!1}),ne=o(()=>!!t.title.trim()&&(v.pin?!0:!!t.startDate&&!!t.endDate)&&!B.value&&!V.value&&!T.value&&!O.value);function re(e){t.startDate=e,r.startDate=!0}function ie(e){t.endDate=e,r.endDate=!0}function de(e){t.lane_id=e,r.lane=!0}function K(e){t.assignee=e}const oe=o(()=>(q.value||[]).map(e=>({_id:e._id,title:e==null?void 0:e.variables["sheet-title"],description:e==null?void 0:e.variables["sheet-description"],icon:e.icon,status:(e==null?void 0:e.generation_status)||localStorage.getItem("selectedStatusTitle")})));function M(){x.value=!1,G()}function G(){t.title="",t.description="",t.startDate=null,t.endDate=null,t.lane_id=null,t.assignee=null,t.variables={},r.title=!1,r.description=!1,r.startDate=!1,r.endDate=!1,r.lane=!1,localStorage.removeItem("selectedStatusTitle")}const ue=o(()=>{var e;return(e=h.value)==null?void 0:e.find(a=>(a==null?void 0:a._id)==v.selectedVariable)}),B=o(()=>r.title&&!t.title.trim()?"Title is required":""),V=o(()=>r.startDate?t.startDate?"":"Start date is required":""),T=o(()=>r.endDate?t.endDate?t.startDate&&t.endDate&&t.endDate<t.startDate?"End date cannot be before start date":"":"End date is required":""),O=o(()=>r.lane?t.lane_id?"":"Lane is required":""),N=new Date().toISOString().split("T")[0];function ce(){var n,C;if(r.title=!0,r.description=!0,v.pin||(r.startDate=!0,r.endDate=!0),!ne.value||E.value||!u.value)return;const e=(n=ue.value)==null?void 0:n.slug,a={sheet_list_id:v.listId,workspace_id:S.value,sheet_id:v.sheet_id||k.value,...t.lane_id&&t.lane_id!=="main"?{workspace_lane_id:t.lane_id}:{},variables:{...t.variables,...e?{[e]:v.listId}:{},"card-title":t.title.trim(),"card-description":t.description.trim(),"start-date":t.startDate,"end-date":t.endDate,"card-status":localStorage.getItem("selectedStatusTitle")},seat_id:((C=t.assignee)==null?void 0:C._id)??null,sprint_id:localStorage.getItem("activeSprintId")||null,createdAt:new Date().toISOString()};X(a)}g(()=>t.title,e=>{e!=null&&e.trim()&&r.title&&(r.title=!1)}),g(()=>t.lane_id,e=>{e&&r.lane&&(r.lane=!1)}),g(()=>t.startDate,e=>{e&&r.startDate&&(r.startDate=!1)}),g(()=>t.endDate,e=>{e&&r.endDate&&(r.endDate=!1)}),g(()=>t.description,e=>{e!=null&&e.trim()&&r.description&&(r.description=!1)}),g(F,e=>{if(!t.lane_id){const a=e.find(n=>n.title==="Main");a&&(t.lane_id=a._id)}},{immediate:!0});const pe=o(()=>oe.value.map(e=>({_id:e._id,title:e.title}))),me=e=>{k.value=e};return(e,a)=>(m(),j(ke,{modelValue:x.value,"onUpdate:modelValue":a[5]||(a[5]=n=>x.value=n),modalClass:"!py-0",size:e.size},{default:P(()=>[d("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[d("div",{class:"flex justify-between w-full"},[a[7]||(a[7]=d("h2",{class:"text-xl font-semibold"},"Create Ticket",-1)),d("div",{class:"w-6 h-6 rounded-full cursor-pointer hover:bg-border/50 transition p-0.5",onClick:M,title:"Close"},a[6]||(a[6]=[d("i",{class:"fa-solid fa-xmark text-sm"},null,-1)]))]),a[8]||(a[8]=d("p",{class:"text-sm text-text-secondary mt-1"},[I(" Provide the details below and click "),d("span",{class:"font-medium"},"Add Ticket"),I(". ")],-1))]),d("div",qe,[f(he,{modelValue:t.title,"onUpdate:modelValue":a[0]||(a[0]=n=>t.title=n),label:"Ticket Title",placeholder:"e.g., Implement real-time notifications",error:!!B.value,message:B.value,onBlur:a[1]||(a[1]=n=>r.title=!0)},null,8,["modelValue","error","message"]),F.value.length>0?(m(),y("div",Fe,[f(U,{size:"md",label:"Tab",options:F.value,placeholder:"Select tab",allowCustom:!1,"model-value":t.lane_id,"onUpdate:modelValue":de,error:!!O.value,message:O.value},null,8,["options","model-value","error","message"])])):_("",!0),(m(!0),y(Ce,null,xe(L.value,n=>Ve((m(),j(U,{size:"md",key:z(n),modelValue:t.variables[n.slug],"onUpdate:modelValue":C=>t.variables[n.slug]=C,options:le(n.data),label:n.title,placeholder:"Select value",allowCustom:!0},null,8,["modelValue","onUpdate:modelValue","options","label"])),[[Te,(n==null?void 0:n._id)!=e.selectedVariable&&(n==null?void 0:n.title)!=="Process"]])),128)),e.pin?_("",!0):(m(),y("div",Be,[a[9]||(a[9]=d("label",{class:"text-sm"},"Start date",-1)),d("div",{class:W(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",V.value?"border-red-500":""])},[f(J,{placeholder:"Set start date",class:"w-full","model-value":t.startDate,"emit-as":"ymd","onUpdate:modelValue":re,"min-date":i(N)},null,8,["model-value","min-date"])],2),V.value?(m(),y("p",Oe,A(V.value),1)):_("",!0)])),e.pin?_("",!0):(m(),y("div",Pe,[a[10]||(a[10]=d("label",{class:"text-sm"},"End date",-1)),d("div",{class:W(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",T.value?"border-red-500":""])},[f(J,{placeholder:"Set end date",class:"w-full","model-value":t.endDate,"emit-as":"ymd","onUpdate:modelValue":ie,"min-date":t.startDate||i(N)},null,8,["model-value","min-date"])],2),T.value?(m(),y("p",Ue,A(T.value),1)):_("",!0)])),d("div",Ae,[a[11]||(a[11]=d("label",{class:"text-sm"},"Assignee",-1)),d("div",Le,[f(Ie,{name:!0,workspaceId:i(S),onAssign:K,onUnassign:a[2]||(a[2]=n=>K(null)),assigneeId:t.assignee,seat:null,disabled:!1,skipPermissionCheck:!0,class:"w-full"},null,8,["workspaceId","assigneeId"])])]),i(p).path.includes("/plan")?(m(),y("div",ze,[f(U,{size:"md",label:"Select Sheet",placeholder:"Select Sheet",options:pe.value,"model-value":k.value,allowCustom:!1,"onUpdate:modelValue":me},null,8,["options","model-value"])])):_("",!0)]),d("div",Ke,[f(Ee,{label:"Description",placeholder:"What needs to be done, acceptance criteria, links…",modelValue:t.description,"onUpdate:modelValue":a[3]||(a[3]=n=>t.description=n),onBlur:a[4]||(a[4]=n=>r.description=!0)},null,8,["modelValue"])]),d("div",Me,[f(Y,{variant:"secondary",onClick:M},{default:P(()=>a[12]||(a[12]=[I("Cancel")])),_:1,__:[12]}),f(Y,{variant:"primary",disabled:i(E),onClick:ce},{default:P(()=>[I(A(i(E)?"Adding…":"Add Ticket"),1)]),_:1},8,["disabled"])])]),_:1},8,["modelValue","size"]))}});export{at as _,Je as a,$e as b,We as c,et as d,He as e,Xe as f,Ne as g,je as h,Qe as i,tt as j,Ye as k,Re as l,Ze as u};
