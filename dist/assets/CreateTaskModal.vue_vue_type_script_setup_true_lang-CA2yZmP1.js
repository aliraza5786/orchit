import{d as J,a as X,c as d,K as C,m as Y,b as B,w as V,e as r,f as v,h as o,i as u,j as b,F as Z,x as ee,z as te,A as ae,y as T,t as k,B as E,n as I,o as n}from"./index-By-MWQyp.js";import{B as le}from"./BaseModal-DlLGLIbU.js";import{_ as se}from"./BaseTextField.vue_vue_type_script_setup_true_lang-D0tVbb66.js";import{_ as U}from"./BaseSelectField.vue_vue_type_script_setup_true_lang-DrAMamBX.js";import{g as re,h as de,u as ie}from"./KanbanSkeleton-CIY4vcrv.js";import{a as oe}from"./useQueryParams-Cj5obHVe.js";import{B as ne}from"./BaseRichTextEditor-CFeNLmcN.js";import{D as q}from"./DatePicker-CLYad3t_.js";const ue={class:"px-6 grid grid-cols-2 gap-4"},ce={class:"flex flex-col"},me={key:0,class:"flex gap-1 flex-col"},pe={key:0,class:"text-xs text-red-500"},fe={key:1,class:"flex gap-1 flex-col"},ve={key:0,class:"text-xs text-red-500"},be={class:"px-6 mt-2"},De={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},we=J({__name:"CreateTaskModal",props:{modelValue:{type:Boolean,default:!1},sheet_id:{},listId:{},selectedVariable:{},pin:{}},emits:["update:modelValue","created"],setup(z,{emit:A}){const L=A,i=z,$=X(),{workspaceId:D,moduleId:N}=oe(),{mutate:O,isPending:_}=re({onSuccess:()=>{w(),$.invalidateQueries({queryKey:["sheet-list"]}),m.value=!1}}),{data:g}=de(D.value),{data:c}=ie(D.value,N.value),m=d({get:()=>i.modelValue,set:t=>L("update:modelValue",t)}),y=d(()=>((c==null?void 0:c.value)??[]).filter(t=>{var a;return((a=t==null?void 0:t.type)==null?void 0:a.title)==="Select"})),K=t=>t.map(a=>({_id:a,title:a})),P=d(()=>((g==null?void 0:g.value)??[]).map(t=>{var a;return{_id:t._id,title:((a=t==null?void 0:t.variables)==null?void 0:a["lane-title"])??String(t._id)}})),h=t=>t.slug,e=C({title:"",description:"",startDate:null,endDate:null,lane_id:null,variables:{}});Y(y,t=>{for(const a of t){const l=h(a);l in e.variables||(e.variables[l]=null)}},{immediate:!0});const s=C({title:!1,description:!1,startDate:!1,endDate:!1,lane:!1}),x=d(()=>s.title&&!e.title.trim()?"Title is required":""),p=d(()=>s.startDate?e.startDate?"":"Start date is required":""),f=d(()=>s.endDate?e.endDate?e.startDate&&e.endDate&&e.endDate<e.startDate?"End date cannot be before start date":"":"End date is required":""),j=d(()=>s.lane&&(e.lane_id===null||e.lane_id===void 0||e.lane_id==="")?"Lane is required":""),S=d(()=>!x.value&&!p.value&&!f.value&&!j.value&&!!e.title.trim()&&(i.pin?!0:!!e.startDate&&!!e.endDate));function F(t){e.startDate=t,s.startDate=!0}function M(t){e.endDate=t,s.endDate=!0}function Q(t){e.lane_id=t,s.lane=!0}function R(){m.value=!1,w()}function w(){e.title="",e.description="",e.startDate=null,e.endDate=null,e.lane_id=null,e.variables={},s.title=!1,s.description=!1,s.startDate=!1,s.endDate=!1,s.lane=!1}const W=d(()=>c.value.find(t=>(t==null?void 0:t._id)==i.selectedVariable));function G(){var a;if(s.title=!0,i.pin||(s.startDate=!0,s.endDate=!0),!S.value||_.value)return;const t={sheet_list_id:i.listId,workspace_id:D.value,sheet_id:i.sheet_id,workspace_lane_id:e.lane_id,variables:{...e.variables,[`${(a=W.value)==null?void 0:a.slug}`]:i.listId,"card-title":e.title.trim(),"card-description":e.description.trim(),"start-date":e.startDate,"end-date":e.endDate},createdAt:new Date().toISOString()};O(t)}return(t,a)=>(n(),B(le,{modelValue:m.value,"onUpdate:modelValue":a[4]||(a[4]=l=>m.value=l),modalClass:"!py-0",size:"lg"},{default:V(()=>[a[8]||(a[8]=r("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[r("h2",{class:"text-xl font-semibold"},"Create Ticket"),r("p",{class:"text-sm text-text-secondary mt-1"},[v(" Provide the details below and click "),r("span",{class:"font-medium"},"Add Ticket"),v(". ")])],-1)),r("div",ue,[o(se,{modelValue:e.title,"onUpdate:modelValue":a[0]||(a[0]=l=>e.title=l),label:"Ticket Title",placeholder:"e.g., Implement real-time notifications",error:!!x.value,message:x.value,onBlur:a[1]||(a[1]=l=>s.title=!0)},null,8,["modelValue","error","message"]),r("div",ce,[o(U,{size:"md",label:"Lane",options:P.value,placeholder:"Select lane",allowCustom:!1,"model-value":e.lane_id,"onUpdate:modelValue":Q},null,8,["options","model-value"])]),(n(!0),u(Z,null,ee(y.value,l=>te((n(),B(U,{size:"md",key:h(l),modelValue:e.variables[l.slug],"onUpdate:modelValue":H=>e.variables[l.slug]=H,options:K(l.data),label:l.title,placeholder:"Select value",allowCustom:!0},null,8,["modelValue","onUpdate:modelValue","options","label"])),[[ae,(l==null?void 0:l._id)!=t.selectedVariable]])),128)),t.pin?b("",!0):(n(),u("div",me,[a[5]||(a[5]=r("label",{class:"text-sm"},"Start date",-1)),r("div",{class:T(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",p.value?"border-red-500":""])},[o(q,{placeholder:"Set start date",class:"w-full","model-value":e.startDate,"emit-as":"ymd","onUpdate:modelValue":F},null,8,["model-value"])],2),p.value?(n(),u("p",pe,k(p.value),1)):b("",!0)])),t.pin?b("",!0):(n(),u("div",fe,[a[6]||(a[6]=r("label",{class:"text-sm"},"End date",-1)),r("div",{class:T(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",f.value?"border-red-500":""])},[o(q,{placeholder:"Set end date",class:"w-full","model-value":e.endDate,"emit-as":"ymd","onUpdate:modelValue":M},null,8,["model-value"])],2),f.value?(n(),u("p",ve,k(f.value),1)):b("",!0)]))]),r("div",be,[o(ne,{label:"Description",placeholder:"What needs to be done, acceptance criteria, links…",onBlur:a[2]||(a[2]=l=>s.description=!0),modelValue:e.description,"onUpdate:modelValue":a[3]||(a[3]=l=>e.description=l)},null,8,["modelValue"])]),r("div",De,[o(E,{variant:"secondary",onClick:R},{default:V(()=>a[7]||(a[7]=[v("Cancel")])),_:1,__:[7]}),o(E,{variant:"primary",disabled:!S.value||I(_),onClick:G},{default:V(()=>[v(k(I(_)?"Adding…":"Add Ticket"),1)]),_:1},8,["disabled"])])]),_:1,__:[8]},8,["modelValue"]))}});export{we as _};
