const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/KanbanBoard-IQaCmy6s.js","assets/lodash-B3d4OLnQ.js","assets/index-CjFOheYc.js","assets/index-zy91lDT_.css","assets/DropMenu.vue_vue_type_script_setup_true_lang-Dg2eb-kj.js","assets/ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-C0WwgO6a.js","assets/KanbanBoard-CCl7J72V.css","assets/KanbanCard-IplQse6_.js","assets/usePeople-DCrwFIz6.js"])))=>i.map(i=>d[i]);
import{d as Ue,T as $e,R as Te,r as m,n as C,c as A,b as Ie,ac as Le,ap as Re,j as r,z as G,f as o,i as g,k as D,a8 as Ne,p as c,b2 as Ke,g as Z,t as f,N as Oe,aG as qe,C as ue,M as Be,ab as De,h as E,F as W,y as H,e as ke,H as Ve,a9 as je,ah as Qe,S as ne,o as d,I as ze,K as Me,v as We,b3 as Fe,D as Pe,w as re,B as Se,a5 as Ae,_ as Je,a6 as Ee}from"./index-CjFOheYc.js";import{D as Ye,K as He}from"./Dropdown-CfgwxemG.js";import{e as Ge,f as Ze,a as Xe,g as et,h as tt,i as st,j as at,b as lt,R as it,k as ot}from"./usePeople-DCrwFIz6.js";import{_ as dt}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-C0WwgO6a.js";import{_ as nt}from"./BaseEmailChip.vue_vue_type_script_setup_true_lang-BBhKmPsf.js";import{_ as rt}from"./ProgressBar.vue_vue_type_script_setup_true_lang-DNmXeMsm.js";import{b as ut}from"./usePackages-CxukpSz6.js";import{F as ct}from"./fuse-Ch1WBRTM.js";import{l as mt}from"./lodash-B3d4OLnQ.js";import{_ as pt}from"./SearchBar.vue_vue_type_script_setup_true_lang-DdW8Lb5L.js";const vt={class:"pt-[17px] pb-[18px] flex justify-between items-center border-b border-border px-5 sticky top-0 bg-bg-card z-1"},ft={class:"py-4 px-5"},xt={class:"bg-bg-surface/50 p-2 rounded-lg flex gap-2 items-center"},_t=["src"],bt={key:0,class:"fa-solid fa-user text-white"},yt={class:"text-base font-medium text-text-primary cursor-pointer"},kt={class:"text-sm font-medium text-text-secondary cursor-pointer"},gt={class:"flex flex-col mt-2"},ht={class:"text-sm text-text-secondary mt-2"},wt={key:0},Ct={class:"mb-2 capitalize"},Dt=["onKeydown"],Vt={class:"mt-5 pt-3 border-t border-border-input relstive"},Pt={key:0,class:"w-full mt-4"},St=["onClick"],At={class:"text-sm font-medium text-text-primary"},Et={key:0,class:"px-3 py-2 space-y-2 border-t border-border bg-bg-card"},Ut=["value"],$t={class:"text-xs font-medium text-text-primary"},It={class:"text-[11px] text-text-secondary leading-tight"},Tt={key:1,class:"mt-3"},Lt={key:0,class:"border border-border space-y-1 p-2.5 mt-1 rounded-lg"},Rt={class:"text-sm text-text-primary"},Nt={key:2,class:"mt-3"},Kt={key:0,class:"border border-border space-y-1 p-2.5 mt-1 rounded-lg"},Ot={class:"text-sm text-text-primary"},qt=Ue({__name:"DetailPanel",props:{showPanel:{type:Boolean,default:!0},details:{type:Object,default:()=>({})}},emits:["close","update:details","comment:post","priority:change"],setup(v,{emit:ge}){var ie;const{canEditUser:B}=$e(),j=Te({}),h=m("details"),ce=[{label:"Details",value:"details"},{label:"Tasks",value:"tasks"},{label:"History",value:"history"}],{data:F}=Ge(),{mutate:U}=Ze({onSuccess:()=>{y.invalidateQueries({queryKey:["people-lists"]})}}),l=v,b=m(!1),u=m(l.details["card-title"]??""),me=m(l.details.workspace_lane_id??"");C(()=>l.details["card-title"],s=>{u.value=s,me.value=l.details.workspace_lane_id});const pe=m(l.details["card-description"]);C(()=>l.details,()=>{pe.value=l.details["card-description"]}),C(()=>l.details,()=>{var s;(s=l.details)!=null&&s.variable_values&&l.details.variable_values.forEach(a=>{j[a.module_variable_id]=a.value})},{immediate:!0,deep:!0});const $=m(null);function X(){b.value=!0,Qe(()=>{var s,a;(s=$.value)==null||s.focus(),(a=$.value)==null||a.select()})}function ee(){u.value.trim()||(u.value=l.details["card-title"]??""),I.mutate({card_id:l.details._id,variables:{"card-title":u.value.trim()}}),b.value=!1}function Q(){u.value=l.details["card-title"]??"",b.value=!1}const J=m({startDate:l.details["start-date"],endDate:l.details["end-date"]}),ve=A(()=>l.details["start-date"]);C(ve,s=>{J.value={...J.value,startDate:s}});const y=Ie(),I=Le({onSuccess:()=>{y.invalidateQueries({queryKey:["get-sheets"]}),y.invalidateQueries({queryKey:["sheet-list"]}),y.invalidateQueries({queryKey:["roles"]})}}),te=(s,a)=>{console.log(a,"slug",s),j[a]=s,U({id:l.details._id,payload:{variable_values:[{module_variable_id:a,value:s}]}})};function fe(s){var a,P,_,R;if((a=l==null?void 0:l.details)!=null&&a.variable_values){const N=(P=l==null?void 0:l.details)==null?void 0:P.variable_values.filter(K=>K.module_variable_id==s);return console.log((_=N[0])==null?void 0:_.value,">>>"),(R=N[0])==null?void 0:R.value}}const T=A(()=>{var s;return(s=l.details)==null?void 0:s.workspace_id}),{data:Y}=Re(T,{enabled:A(()=>!!T.value)}),se=A(()=>{var s;return((s=Y.value)==null?void 0:s.company_id)??null}),{data:z}=Xe({company_id:se,workspace_id:T},{enabled:A(()=>!!se.value&&!!T.value)}),V=m(((ie=l.details)==null?void 0:ie.workspace_access_role_id)??""),{mutate:ae}=et({onSuccess:()=>{console.log("Role assigned successfully!"),y.invalidateQueries({queryKey:["people-lists"]})},onError:s=>console.error(s)});C(V,s=>{var a;ae({id:(a=l.details)==null?void 0:a._id,workspace_access_role_id:s})}),C(()=>{var s;return(s=l.details)==null?void 0:s.workspace_access_role_id},s=>{V.value=s??""}),C(()=>{var s;return(s=l.details)==null?void 0:s._id},()=>{var s;V.value=((s=l.details)==null?void 0:s.workspace_access_role_id)??""},{immediate:!0});function xe(){B||ne.error("You have no permission to edit user details")}function _e(s){var a;if(!B){ne.error("You have no permission to edit user details");return}V.value=s,ae({id:(a=l.details)==null?void 0:a._id,workspace_access_role_id:s})}const x=A(()=>!z.value||!V.value?null:z.value.find(s=>s._id===V.value)),M=m({}),L=m([]),{mutate:be}=ut();function le(s){M.value[s]=!M.value[s]}C(x,s=>{if(!s)return;const a=[];s.permission_categories.forEach(P=>{P.permissions.forEach(_=>{_.enabled&&a.push(_._id)})}),L.value=a},{immediate:!0});function ye(){var s;(s=x.value)!=null&&s._id&&be({roleId:x.value._id,payload:{title:x.value.title,description:x.value.description,is_admin:x.value.is_admin,is_editor:x.value.is_editor,is_viewer:x.value.is_viewer,permission_ids:L.value}},{onSuccess:()=>{ne.success("Permissions updated successfully"),y.invalidateQueries({queryKey:["workspace-roles"]})},onError:a=>{console.error("Failed to update permissions",a),ne.error("Failed to update permissions")}})}return(s,a)=>{var P,_,R,N,K,e,t,p,w,O,q,n,S,he,we,Ce;return d(),r("div",{class:G(`max-w-[358px] bg-bg-card  rounded-lg overflow-y-auto overflow-x-hidden relative ${v.showPanel?"!translate-x-0 w-full h-full min-w-[350px] overflow-y-auto":"!translate-x-100 w-0 h-0"} transition-all`)},[o("div",vt,[a[5]||(a[5]=o("h5",{class:"text-[16px] font-medium"},"Profile",-1)),o("i",{class:"cursor-pointer text-text-primary fa-solid fa-close",onClick:a[0]||(a[0]=()=>{s.$emit("close")})})]),o("div",ft,[o("div",xt,[(P=v.details)!=null&&P.avatar?(d(),r("img",{key:0,src:(_=v.details)==null?void 0:_.avatar,class:"w-10 h-10 rounded-full",alt:"avartar"},null,8,_t)):(d(),r("div",{key:1,class:"min-w-10 max-h-10 aspect-square bg-bg-surface flex justify-center items-center rounded-full",style:Ne({backgroundColor:(R=v.details)!=null&&R.name?c(Ke)({email:(N=v.details)==null?void 0:N.email}):""})},[Z(f(c(Oe)((K=v.details)==null?void 0:K.name))+" ",1),(e=v.details)!=null&&e.name?D("",!0):(d(),r("i",bt))],4)),o("div",null,[o("h1",yt,f(v.details.name??v.details.title),1),o("p",kt,f(v.details.email),1)])]),g(qe,{modelValue:h.value,"onUpdate:modelValue":a[1]||(a[1]=i=>h.value=i),class:"my-2",options:ce},null,8,["modelValue"]),o("div",gt,[a[6]||(a[6]=o("h1",{class:"text-base font-medium text-text-primary cursor-pointer"}," Task Progress ",-1)),g(rt,{class:"mt-2",progress:(t=l==null?void 0:l.details)==null?void 0:t.assigned_cards_count,fillColor:"bg-accent ",indeterminate:!0},null,8,["progress"]),o("span",ht,"Completed 10 tasks out of "+f((p=l==null?void 0:l.details)==null?void 0:p.assigned_cards_count),1)]),h.value=="details"?(d(),r("section",wt,[o("div",Ct,[b.value?ue((d(),r("input",{key:0,ref_key:"titleInput",ref:$,"onUpdate:modelValue":a[2]||(a[2]=i=>u.value=i),onBlur:ee,onKeydown:[De(E(ee,["prevent"]),["enter"]),De(E(Q,["prevent"]),["esc"])],class:"border border-border rounded px-2 py-1 w-full text-xl font-medium",type:"text"},null,40,Dt)),[[Be,u.value]]):(d(),r("h1",{key:1,class:"text-xl font-medium text-text-primary cursor-pointer",onClick:X},f(u.value),1))]),o("div",null,[(d(!0),r(W,null,H(c(F),(i,k)=>{var oe;return d(),r("div",{key:k,class:"grid grid-cols-2 capitalize items-center gap-2 text-sm mt-4"},[Z(f(i.title)+" ",1),(d(),ke(Ve,{size:"sm","model-value":j[i._id],key:k,placeholder:` ${i.title}`,onClick:a[3]||(a[3]=E(()=>{},["stop"])),defaultValue:fe(i==null?void 0:i._id),options:i==null?void 0:i.data.map(de=>({_id:de,title:de})),cardId:(oe=v.details)==null?void 0:oe._id,canEditCard:!c(B),"onUpdate:modelValue":de=>te(de,i._id)},null,8,["model-value","placeholder","defaultValue","options","cardId","canEditCard","onUpdate:modelValue"]))])}),128))]),o("div",Vt,[a[8]||(a[8]=o("span",{class:"text-base font-medium text-text-primary mb-1 block"},"Select Role",-1)),(d(),ke(Ve,{size:"sm","model-value":V.value,options:(c(z)||[]).map(i=>({_id:i._id,title:i.title})),placeholder:"Select Role",onClick:E(xe,["stop"]),"onUpdate:modelValue":_e,canEditCard:!c(B),key:(w=c(z))==null?void 0:w.length},null,8,["model-value","options","canEditCard"])),x.value&&!x.value.is_admin?(d(),r("div",Pt,[a[7]||(a[7]=o("h2",{class:"text-base font-medium text-text-primary mb-1"}," Permissions ",-1)),(d(!0),r(W,null,H((O=x.value)==null?void 0:O.permission_categories,i=>(d(),r("div",{key:i==null?void 0:i.category,class:"border border-border mb-2 rounded-lg overflow-hidden bg-bg-surface/30"},[o("button",{onClick:k=>le(i==null?void 0:i.category),class:"w-full px-3 py-2 flex justify-between items-center hover:bg-bg-surface transition"},[o("span",At,f(i==null?void 0:i.category_title),1),o("i",{class:G(["fa-solid fa-chevron-down text-xs text-text-secondary transition-transform",M.value[i==null?void 0:i.category]?"rotate-180":""])},null,2)],8,St),M.value[i==null?void 0:i.category]?(d(),r("div",Et,[(d(!0),r(W,null,H(i==null?void 0:i.permissions,k=>(d(),r("div",{key:k._id,class:"flex items-start gap-2"},[ue(o("input",{type:"checkbox","onUpdate:modelValue":a[4]||(a[4]=oe=>L.value=oe),value:k._id,onChange:ye,class:"h-4 w-4 mt-0.5 rounded border-border accent-accent cursor-pointer flex-shrink-0"},null,40,Ut),[[je,L.value]]),o("div",null,[o("p",$t,f(k.title),1),o("p",It,f(k.description),1)])]))),128))])):D("",!0)]))),128))])):D("",!0)])])):D("",!0),h.value=="tasks"?(d(),r("section",Tt,[a[10]||(a[10]=o("span",{class:"text-base text-text-primary"},"Worked On",-1)),((n=(q=v.details)==null?void 0:q.assigned_cards)==null?void 0:n.length)>0?(d(),r("ul",Lt,[(d(!0),r(W,null,H((S=v.details)==null?void 0:S.assigned_cards,(i,k)=>(d(),r("li",{class:"p-2",key:k},[o("h1",Rt,f(i==null?void 0:i.title),1),a[9]||(a[9]=o("p",{class:"text-xs text-text-secondary"}," Design Project . Olivia Updated on April 9, 2025 ",-1))]))),128))])):D("",!0)])):D("",!0),h.value=="history"?(d(),r("section",Nt,[a[12]||(a[12]=o("span",{class:"text-base text-text-primary"},"history",-1)),((we=(he=v.details)==null?void 0:he.assignment_history)==null?void 0:we.length)>0?(d(),r("ul",Kt,[(d(!0),r(W,null,H((Ce=v.details)==null?void 0:Ce.assignment_history,(i,k)=>(d(),r("li",{class:"p-2",key:k},[o("h1",Ot,f(i==null?void 0:i.title),1),a[11]||(a[11]=o("p",{class:"text-xs text-text-secondary"}," Design Project . Olivia Updated on April 9, 2025 ",-1))]))),128))])):D("",!0)])):D("",!0)])],2)}}}),Bt=ze(qt,[["__scopeId","data-v-05e2eb19"]]),jt={class:"flex-auto flex-grow h-full bg-bg-card rounded-[6px] border border-border overflow-x-auto flex-col flex"},Qt={class:"header px-4 py-3 border-b border-border flex items-center justify-between gap-1"},zt={class:"flex gap-3 items-center"},Mt={class:"flex p-4 overflow-x-auto gap-3 custom_scroll_bar h-full"},Wt=["onClick","disabled"],Ft={key:1,class:"p-4 space-y-2 bg-bg-surface m-4 rounded-md"},Jt={class:"text-sm text-text-primary"},Yt={class:"flex items-center mt-3 gap-3"},Ht=["disabled"],ds=Ue({__name:"People",setup(v){const ge=Ae(()=>Ee(()=>import("./KanbanBoard-IQaCmy6s.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),B=Ae(()=>Ee(()=>import("./KanbanCard-IplQse6_.js"),__vite__mapDeps([7,2,3,4,5,8]))),{canCreateVariable:j,canInviteUser:h}=$e(),ce=[{title:"Role",_id:"role"},{title:"Team",_id:"team"},{title:"Status",_id:"status"}],F=m("role"),U=m(!1),l=m(),{workspaceId:b}=Me(),u=m([]),{mutate:me,isPending:pe}=tt({onSuccess:e=>{u.value=[...u.value||[],e],I.value="",y.value=!1}}),{data:$,isPending:X}=st(b.value,F);C($,e=>{u.value=e?JSON.parse(JSON.stringify(e)):[]}),We(()=>{u.value=$.value?JSON.parse(JSON.stringify($.value)):[]});const ee=m("kanban"),Q=m(),J=e=>{Q.value=e},ve=e=>{},y=m(!1),I=m("");function te(){y.value=!y.value}function fe(){console.log(">>> clicking on adding pepople ");const e=I.value.trim();T(e)}const T=e=>{console.log(">>> clicking on adding pepople ");const t={workspace_id:b.value,title:e,max_num_people:1};me({payload:t})},Y=Ie(),se=Fe({onSuccess:()=>{Y.invalidateQueries({queryKey:["people-lists"]})}}),z=e=>{const t={workspace_id:b.value,title:e==null?void 0:e.title,max_num_people:1};se.mutate({id:e._id,payload:t})},{mutate:V,isPending:ae}=at({onSuccess:e=>{U.value=!1,u.value=u.value.filter(t=>{var p;return t._id!==((p=e.deletedRole)==null?void 0:p._id)})}}),xe=()=>{var e;V({id:(e=l.value)==null?void 0:e.columnId})},_e=e=>{U.value=!0,l.value=e},{mutate:x,isPending:M}=lt({onSuccess:e=>{I.value="",y.value=!1,console.log(l.value,">>>. id local column");const t=u.value.findIndex(q=>q._id===l.value._id);if(t===-1)return;console.log(t,"index>>>");const p=u.value[t],w=[...p.cards??[],e==null?void 0:e.assigned_seat],O={...p,cards:w};u.value=[...u.value.slice(0,t),O,...u.value.slice(t+1)],Y.invalidateQueries({queryKey:["people-lists"]}),Y.invalidateQueries({queryKey:["workspaceRoles"]})}}),L=e=>{l.value=e;const t={name:e!=null&&e.email?be(e==null?void 0:e.email[0]):"",email:e!=null&&e.email?e==null?void 0:e.email[0]:"",role_id:e==null?void 0:e._id,workspace_id:b==null?void 0:b.value,additional_seats:1};x({id:e._id,payload:t})};function be(e){const p=(e.split("@")[0]||"").split("+")[0].split(/[^a-zA-Z]+/).filter(Boolean);return p.length?p.map(w=>w.charAt(0).toUpperCase()+w.slice(1).toLowerCase()).join(" "):e}const le=e=>{h.value&&(window.dispatchEvent(new CustomEvent("close-all-showADDNEW")),e.showADDNEW=!e.showADDNEW)},ye=e=>{L(e)},ie=e=>{Q.value=e},s=it(),a=ot();function P(e){console.log(e,">>"),e.type=="column"?s.mutate({id:b.value,payload:{role_id:e.meta._id,new_sort_order:e.meta.newIndex}}):a.mutate({id:e.meta.toColumnId,payload:{team_member_id:e.meta.moved._id,new_sort_order:e.meta.newIndex}})}const _=m(""),R=m("");C(_,mt.debounce(e=>{R.value=e},200));const N=A(()=>{const e=u.value.flatMap(t=>t.cards.map(p=>({...p,columnId:t.title})));return new ct(e,{keys:["title","name"],threshold:.3})}),K=A(()=>{if(!_.value)return u.value;const e=N.value.search(_.value).map(t=>t.item);return u.value.map(t=>({...t,cards:e.filter(p=>p.columnId===t.title)}))});return(e,t)=>{var p,w,O,q;return d(),r(W,null,[o("div",jt,[o("div",Qt,[g(Ye,{actions:!1,prefix:"View By",modelValue:F.value,"onUpdate:modelValue":t[0]||(t[0]=n=>F.value=n),options:ce,variant:"secondary"},null,8,["modelValue"]),o("div",zt,[g(pt,{class:"max-w-[250px]",onOnChange:t[1]||(t[1]=n=>{_.value=n}),placeholder:"Search in Orchit AI space"})])]),ue(g(He,null,null,512),[[Pe,c(X)]]),ue(o("div",Mt,[((p=K.value)==null?void 0:p.length)>0?(d(),ke(c(ge),{key:0,plusIcon:!1,onOnPlus:t[3]||(t[3]=n=>L(n)),"onDelete:column":t[4]||(t[4]=n=>_e(n)),"onUpdate:column":t[5]||(t[5]=n=>z(n)),onReorder:P,onAddColumn:T,"onSelect:ticket":J,board:K.value,onOnBoardUpdate:ve,variable_id:"",sheet_id:"selected_sheet_id"},{ticket:re(({ticket:n})=>[g(c(B),{onClick:S=>ie(n),ticket:n},null,8,["onClick","ticket"])]),"column-footer":re(({column:n})=>[n.showADDNEW?n.showADDNEW?(d(),r("div",Ft,[o("p",Jt,f(n.title)+" "+f(n.cards.length+1),1),g(nt,{maxEmails:1,placeholder:"team member email",modelValue:n.email,"onUpdate:modelValue":S=>n.email=S},null,8,["modelValue","onUpdate:modelValue"]),t[14]||(t[14]=o("p",{class:"text-sm text-text-secondary"},"You can assign user later",-1)),g(Se,{size:"md",onClick:S=>ye(n)},{default:re(()=>[Z(f(c(M)?"Adding...":"Add Seat"),1)]),_:2},1032,["onClick"]),o("i",{class:"fa-solid fa-close cursor-pointer ml-2",onClick:t[2]||(t[2]=S=>le(""))})])):D("",!0):(d(),r("div",{key:0,onClick:S=>le(n),disabled:!c(h),class:G([c(h)?"cursor-pointer":"cursor-not-allowed","flex py-3 px-3 justify-center text-sm text-text-primary items-center gap-3 border border-text-primary border-dashed mb-4 mx-4 rounded-md"])},t[13]||(t[13]=[o("i",{class:"fa-solid fa-plus"},null,-1),Z(" Add Seat ")]),10,Wt))]),_:1},8,["board"])):D("",!0),o("div",{class:"min-w-[328px]",onClick:t[8]||(t[8]=E(()=>{},["stop"]))},[y.value?(d(),r("form",{key:0,onSubmit:t[7]||(t[7]=E(()=>{},["prevent"])),class:"bg-bg-body rounded-lg p-4"},[g(Je,{autofocus:!0,modelValue:I.value,"onUpdate:modelValue":t[6]||(t[6]=n=>I.value=n),placeholder:"Add New list"},null,8,["modelValue"]),t[15]||(t[15]=o("p",{class:"text-xs mt-1.5"},"You can add details while editing",-1)),o("div",Yt,[g(Se,{disabled:!c(h),class:G([c(h)?"cursor-pointer":"cursor-not-allowed","px-3 py-1 bg-accent text-white rounded"]),onClick:fe,type:"submit",variant:"primary"},{default:re(()=>[Z(f(c(pe)?"Adding...":"Add Team"),1)]),_:1},8,["disabled","class"]),o("i",{class:"fa-solid fa-close cursor-pointer",onClick:te})])],32)):(d(),r("button",{key:1,class:G(["text-sm text-text-primary py-2.5 font-medium flex items-center justify-center w-full gap-2 bg-bg-body rounded-lg",c(j)?"cursor-pointer":"cursor-not-allowed"]),onClick:E(te,["stop"]),disabled:!c(j)}," + Add Team ",10,Ht))])],512),[[Pe,ee.value=="kanban"&&!c(X)]])]),g(dt,{onClick:t[9]||(t[9]=E(()=>{},["stop"])),modelValue:U.value,"onUpdate:modelValue":t[10]||(t[10]=n=>U.value=n),title:"Delete List",itemLabel:"list",itemName:(w=l.value)==null?void 0:w.title,requireMatchText:(O=l.value)==null?void 0:O.title,confirmText:"Delete List",cancelText:"Cancel",size:"md",loading:c(ae),onConfirm:xe,onCancel:t[11]||(t[11]=()=>{U.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),g(Bt,{details:Q.value,onClose:t[12]||(t[12]=()=>{J({})}),showPanel:!!((q=Q.value)!=null&&q.title)},null,8,["details","showPanel"])],64)}}});export{ds as default};
