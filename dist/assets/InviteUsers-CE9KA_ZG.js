import{d as j,c as l,O,r as k,aC as W,L,p as Q,bG as D,e as F,o as G,w as c,f as o,i as d,J,B as x,g as V,q as C,t as K,Y as M,U as p}from"./index-SgxqeUdj.js";import{_ as R}from"./BaseEmailChip.vue_vue_type_script_setup_true_lang-XnYplbUc.js";import{b as T}from"./auth-CdYUgS6B.js";const Y={class:"px-6 flex flex-col gap-4"},Z={class:"flex justify-end gap-2 p-6 mt-6 sticky bottom-0 bg-bg-body border-t border-border"},ae=j({__name:"InviteUsers",props:{modelValue:{type:Boolean,default:!1},defaultWorkspaceId:{}},emits:["update:modelValue","invited"],setup(I,{emit:B}){const v=B,f=I,n=l({get:()=>f.modelValue,set:e=>v("update:modelValue",e)}),E=O(),U=k(1),w=k(100),{data:r}=W(U,w),s=L({workspace_id:null,role_id:"viewer",emails:[]});Q(()=>f.defaultWorkspaceId,e=>{e&&!s.workspace_id?s.workspace_id=e:s.workspace_id=h.value[0]._id},{immediate:!0});const h=l(()=>{var e;return(((e=r==null?void 0:r.value)==null?void 0:e.workspaces)??[]).map(a=>{var t;return{_id:a._id??a.id,title:((t=a==null?void 0:a.variables)==null?void 0:t.title)??a.title??String(a._id??a.id)}})}),_=l(()=>s.role_id?"":"Role is required"),m=l(()=>{const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return s.emails.filter(a=>!e.test(a))}),b=l(()=>m.value.length?`Invalid: ${m.value.join(", ")}`:""),g=l(()=>!!s.workspace_id&&!!s.role_id&&s.emails.length>0&&m.value.length===0);function A(e){}function S(){}const{mutate:N,isPending:u}=T(),{data:q}=D();function z(){!g.value||u.value||N({payload:{company_id:q.value._id,role:s.role_id,emails:s.emails.map(e=>({email:e,name:$(e)}))}},{onSuccess:e=>{var a,t;(a=e==null?void 0:e.failedInvites)!=null&&a.length?p.error(((t=e.failedInvites[0])==null?void 0:t.error)??"Some invites failed"):p.success("Invitations sent"),E.invalidateQueries({queryKey:["all-users"]}),v("invited",e),y(),n.value=!1},onError:e=>{var t,i;const a=((i=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:i.message)||(e==null?void 0:e.message)||"Failed to send invitations.";p.error(a)}})}function P(){y(),n.value=!1}function y(){s.role_id=null,s.emails=[]}function $(e){const t=(e.split("@")[0]||"").split("+")[0].split(/[^a-zA-Z]+/).filter(Boolean);return t.length?t.map(i=>i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()).join(" "):e}return(e,a)=>(G(),F(M,{modelValue:n.value,"onUpdate:modelValue":a[2]||(a[2]=t=>n.value=t),size:"md",modalClass:"!py-0"},{default:c(()=>[a[4]||(a[4]=o("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[o("h2",{class:"text-xl font-semibold"},"Invite Users"),o("p",{class:"text-sm text-text-secondary mt-1"}," Add emails, and pick a permission.")],-1)),o("div",Y,[d(R,{class:"w-full",label:"User emails",modelValue:s.emails,"onUpdate:modelValue":a[0]||(a[0]=t=>s.emails=t),error:!!b.value,message:b.value||"Press Enter after each email",showName:"",onInvalid:A,onAdd:S},null,8,["modelValue","error","message"]),d(J,{size:"md",label:"Permission",options:[{title:"Viewer",_id:"viewer"},{title:"Editor",_id:"editor"},{title:"Admin",_id:"admin"}],placeholder:"Choose role","model-value":s.role_id,"onUpdate:modelValue":a[1]||(a[1]=t=>s.role_id=t),disabled:!s.workspace_id,message:_.value,error:!!_.value},null,8,["model-value","disabled","message","error"])]),o("div",Z,[d(x,{variant:"secondary",onClick:P},{default:c(()=>a[3]||(a[3]=[V("Cancel")])),_:1,__:[3]}),d(x,{variant:"primary",disabled:!g.value||C(u),onClick:z},{default:c(()=>[V(K(C(u)?"Invitingâ€¦":"Send Invites"),1)]),_:1},8,["disabled"])])]),_:1,__:[4]},8,["modelValue"]))}});export{ae as default};
