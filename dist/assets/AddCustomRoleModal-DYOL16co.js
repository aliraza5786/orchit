import{d as M,M as N,N as q,K as z,r as _,c as f,e as F,o as a,i,w as y,f as s,j as n,_ as k,F as w,y as C,D as V,t as v,z as T,an as K,E as Q,B as h,g as B,p as I,Y,aA as G,U as P}from"./index-CM-ocGw6.js";import{_ as H}from"./BaseTextAreaField.vue_vue_type_script_setup_true_lang-mC0x0oXs.js";import{L as J}from"./Loader-DY8UpeO9.js";import{p as O,q as W}from"./usePeople-Bgh-5Gwc.js";import{f as X}from"./permissionUtils-fD2X1oS-.js";import"./favicon-BAFXWHLW.js";const Z={class:"-my-6"},ee={class:"px-6 py-4 space-y-4"},se={key:0,class:"mt-6"},te={class:"space-y-2 max-h-[400px] overflow-y-auto pr-2 custom_scroll_bar"},oe=["onClick"],le={class:"text-sm font-medium text-text-primary"},re={class:"py-2 space-y-1 border-t border-border bg-bg-input"},ae={class:"flex items-center h-5"},ie=["id","value"],ne={class:"ml-2 text-sm"},de=["for"],ue={class:"text-xs text-text-secondary"},me={key:1,class:"flex justify-center py-4"},ce={class:"bg-bg-body px-6 py-6 border-t border-border flex justify-end gap-2 text-right"},ge=M({__name:"AddCustomRoleModal",props:{show:{type:Boolean},workspaceId:{},companyId:{}},emits:["close"],setup(R,{emit:D}){const p=R,$=D,{workspaceId:x}=N(),A=q(),l=z({title:"",slug:"",description:""}),d=_([]),u=_({}),{data:m}=O({scope:f(()=>"workspace"),workspace_id:f(()=>p.workspaceId||x.value)}),c=f(()=>{var e;if(!m.value)return null;const o=m.value.permissions_grouped||((e=m.value.data)==null?void 0:e.permissions_grouped);return Array.isArray(o)&&o.length>0?o[0].categories:m.value}),{mutate:E,isPending:g}=W({onSuccess:()=>{P.success("Role created successfully"),A.invalidateQueries({queryKey:["workspace-roles"]}),$("close"),l.title="",l.slug="",l.description="",d.value=[]},onError:o=>{var e,t;console.error(o),P.error(((t=(e=o.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to create role")}});function S(o){l.slug=o.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"")}function U(o){u.value[o]=!u.value[o]}function j(){if(!c.value)return;const o=[];c.value.forEach(b=>{b.permissions.forEach(L=>o.push(L))});const{permission_ids:e,module_permissions:t}=X(o,d.value),r={title:l.title,slug:l.slug,description:l.description,company_id:p.companyId,workspace_id:p.workspaceId||x.value,permission_ids:e,module_permissions:t};E({payload:r})}return(o,e)=>(a(),F(G,{to:"body"},[i(Y,{modelValue:o.show,"onUpdate:modelValue":e[5]||(e[5]=t=>!t&&o.$emit("close")),class:""},{default:y(()=>[s("div",Z,[e[12]||(e[12]=s("div",{class:"bg-bg-body px-6 py-4 border-b border-border"},[s("h2",{class:"text-xl font-medium text-text-primary"},"Add Custom Role")],-1)),s("div",ee,[s("div",null,[e[6]||(e[6]=s("label",{class:"block text-sm font-medium text-text-primary mb-1"},"Role Title",-1)),i(k,{modelValue:l.title,"onUpdate:modelValue":[e[0]||(e[0]=t=>l.title=t),S],placeholder:"e.g. Content Editor"},null,8,["modelValue"])]),s("div",null,[e[7]||(e[7]=s("label",{class:"block text-sm font-medium text-text-primary mb-1"},"Slug",-1)),i(k,{modelValue:l.slug,"onUpdate:modelValue":e[1]||(e[1]=t=>l.slug=t),placeholder:"e.g. content-editor",disabled:""},null,8,["modelValue"])]),s("div",null,[e[8]||(e[8]=s("label",{class:"block text-sm font-medium text-text-primary mb-1"},"Description",-1)),i(H,{modelValue:l.description,"onUpdate:modelValue":e[2]||(e[2]=t=>l.description=t),placeholder:"Describe the role's responsibilities...",rows:"3"},null,8,["modelValue"])]),c.value?(a(),n("div",se,[e[9]||(e[9]=s("h3",{class:"text-sm font-medium text-text-primary mb-3"},"Permissions",-1)),s("div",te,[(a(!0),n(w,null,C(c.value,t=>(a(),n("div",{key:t.category,class:"border border-border rounded-lg overflow-hidden bg-bg-surface/30"},[s("button",{onClick:r=>U(t.category),class:"w-full px-3 py-2 flex justify-between items-center hover:bg-bg-surface transition"},[s("span",le,v(t.category_title),1),s("i",{class:T(["fa-solid fa-chevron-down text-xs text-text-secondary transition-transform",u.value[t.category]?"rotate-180":""])},null,2)],8,oe),V(s("div",re,[(a(!0),n(w,null,C(t.permissions,r=>(a(),n("div",{key:r._id,class:"flex items-start gap-2 hover:bg-bg-body px-3 py-2"},[s("div",ae,[V(s("input",{type:"checkbox",id:r._id,value:r._id,"onUpdate:modelValue":e[3]||(e[3]=b=>d.value=b),class:"h-4 w-4 rounded border-border accent-accent cursor-pointer"},null,8,ie),[[K,d.value]])]),s("div",ne,[s("label",{for:r._id,class:"font-medium text-text-primary cursor-pointer select-none"},v(r.title),9,de),s("p",ue,v(r.description),1)])]))),128))],512),[[Q,u.value[t.category]]])]))),128))])])):(a(),n("div",me,[i(J)]))]),s("div",ce,[i(h,{variant:"secondary",onClick:e[4]||(e[4]=t=>o.$emit("close"))},{default:y(()=>e[10]||(e[10]=[B("Cancel")])),_:1,__:[10]}),i(h,{onClick:j,disabled:I(g)||!l.title,loading:I(g)},{default:y(()=>e[11]||(e[11]=[B(" Create Role ")])),_:1,__:[11]},8,["disabled","loading"])])])]),_:1},8,["modelValue"])]))}});export{ge as default};
