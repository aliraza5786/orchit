import{d as O,c as l,I as L,X as Q,ar as D,l as F,aj as K,ad as M,af as T,a as X,o as Z,w as v,b as i,g as n,m as d,B as w,e as C,t as G,a5 as f}from"./index-rFytiIBb.js";import{B as H}from"./BaseModal-BCttpRav.js";import{_ as B}from"./BaseSelectField.vue_vue_type_script_setup_true_lang-BIaf5Tw5.js";import{_ as J}from"./BaseEmailChip.vue_vue_type_script_setup_true_lang-BMCU_Nvm.js";import"./cross-DvraoB0R.js";import"./info-DjaLHeD_.js";const Y={class:"px-6 flex flex-col gap-4"},ee={class:"flex justify-end gap-2 p-6 mt-6 sticky bottom-0 bg-bg-body border-t border-border"},ne=O({__name:"InviteUsers",props:{modelValue:{type:Boolean,default:!1},defaultWorkspaceId:{}},emits:["update:modelValue","invited"],setup(h,{emit:E}){const _=E,g=h,r=l({get:()=>g.modelValue,set:e=>_("update:modelValue",e)}),U=L(),{data:m}=Q(),a=D({workspace_id:null,role_id:null,emails:[]});F(()=>g.defaultWorkspaceId,e=>{e&&!a.workspace_id&&(a.workspace_id=e)},{immediate:!0});const S=l(()=>((m==null?void 0:m.value)??[]).map(e=>{var s;return{_id:e._id??e.id,title:((s=e==null?void 0:e.variables)==null?void 0:s.title)??e.title??String(e._id??e.id)}})),W=K(a,"workspace_id"),{data:u,isPending:k}=M(W),P=l(()=>((u==null?void 0:u.value)??[]).map(e=>({_id:e.role_id??e.id,title:e.title??e.name??"Role"}))),b=l(()=>a.workspace_id?"":"Workspace is required"),x=l(()=>a.role_id?"":"Role is required"),c=l(()=>{const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return a.emails.filter(s=>!e.test(s))}),y=l(()=>c.value.length?`Invalid: ${c.value.join(", ")}`:""),I=l(()=>!!a.workspace_id&&!!a.role_id&&a.emails.length>0&&c.value.length===0);function R(e){a.workspace_id=e,a.role_id=null}function z(e){}function N(){}const{mutate:j,isPending:p}=T();function q(){!I.value||p.value||j({workspace_id:a.workspace_id,workspace_role_id:a.role_id,emails:a.emails.map(e=>({name:$(e),email:e}))},{onSuccess:e=>{var s,o;(s=e==null?void 0:e.failedInvites)!=null&&s.length?f.error(((o=e.failedInvites[0])==null?void 0:o.error)??"Some invites failed"):f.success("Invitations sent"),U.invalidateQueries({queryKey:["all-users"]}),_("invited",e),V(),r.value=!1},onError:e=>{var o,t;const s=((t=(o=e==null?void 0:e.response)==null?void 0:o.data)==null?void 0:t.message)||(e==null?void 0:e.message)||"Failed to send invitations.";f.error(s)}})}function A(){V(),r.value=!1}function V(){a.role_id=null,a.emails=[]}function $(e){const o=(e.split("@")[0]||"").split("+")[0].split(/[^a-zA-Z]+/).filter(Boolean);return o.length?o.map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" "):e}return(e,s)=>(Z(),X(H,{modelValue:r.value,"onUpdate:modelValue":s[2]||(s[2]=o=>r.value=o),size:"md",modalClass:"!py-0"},{default:v(()=>[s[4]||(s[4]=i("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[i("h2",{class:"text-xl font-semibold"},"Invite Users"),i("p",{class:"text-sm text-text-secondary mt-1"},"Select a workspace, add emails, and pick a role.")],-1)),i("div",Y,[n(J,{class:"w-full",label:"User emails",modelValue:a.emails,"onUpdate:modelValue":s[0]||(s[0]=o=>a.emails=o),error:!!y.value,message:y.value||"Press Enter after each email",showName:"",onInvalid:z,onAdd:N},null,8,["modelValue","error","message"]),n(B,{size:"md",label:"Role",options:P.value,placeholder:"Choose role","model-value":a.role_id,"onUpdate:modelValue":s[1]||(s[1]=o=>a.role_id=o),disabled:!a.workspace_id||d(k),message:x.value||(d(k)?"Loading roles…":""),error:!!x.value},null,8,["options","model-value","disabled","message","error"]),n(B,{size:"md",label:"Workspace",options:S.value,placeholder:"Choose workspace","model-value":a.workspace_id,"onUpdate:modelValue":R,message:b.value,error:!!b.value},null,8,["options","model-value","message","error"])]),i("div",ee,[n(w,{variant:"secondary",onClick:A},{default:v(()=>s[3]||(s[3]=[C("Cancel")])),_:1,__:[3]}),n(w,{variant:"primary",disabled:!I.value||d(p),onClick:q},{default:v(()=>[C(G(d(p)?"Inviting…":"Send Invites"),1)]),_:1},8,["disabled"])])]),_:1,__:[4]},8,["modelValue"]))}});export{ne as default};
