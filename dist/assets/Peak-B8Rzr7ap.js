import{r as $,x as E,D as et,d as H,c as p,m as a,o as r,g as s,t as l,n as j,F as A,h as L,k as J,N as st,a as pt,u as gt,bc as X,A as ft,C as xt,bd as bt,U,S as vt,i as u,f as _t,G as y,E as C,w as mt,be as ht,ah as z,ad as Z,ac as S}from"./index-BUo6hkzk.js";import{_ as kt}from"./ProgressBar.vue_vue_type_script_setup_true_lang-CAu49lW5.js";import{c as wt,d as yt}from"./usePeople-D3RX3x5O.js";import{a as Ct}from"./FormatDate-DIyppjZM.js";function St(T,{start:g=0,maxWhileLoading:_=90,step:d=.8,intervalMs:f=120}={}){const i=$(g);let c=null;const n=()=>{c==null&&(c=window.setInterval(()=>{T()&&(i.value=Math.min(i.value+d,_))},f))},x=()=>{c!=null&&(clearInterval(c),c=null)};return E(T,M=>{M?(i.value=g,n()):(i.value=100,setTimeout(()=>{i.value=g,x()},300))},{immediate:!0}),et(x),i}const $t={class:"relative p-3 rounded-lg min-w-[240px] sm:min-w-sm border border-border overflow-hidden flex flex-col justify-between bg-bg-card w-full"},jt={class:"flex justify-between items-start pb-2"},Tt={class:"text-lg font-semibold text-text-primary text-left"},Pt={class:"text-xs text-text-secondary text-left"},Dt={class:"flex items-center gap-2"},Et={class:""},It={class:"flex justify-between text-sm text-text-secondary mb-1"},At={key:0,class:"fa-regular text-left fa-arrows-spin animate-spin duration-250"},Lt={key:0},Mt={key:1},Nt=H({__name:"ProjectCard",props:{title:{},subtitle:{},status:{},progress:{default:0},avatars:{},maxVisible:{default:2},date:{},loading:{type:Boolean,default:!1},color:{default:"#9CA3AF"},totalCard:{default:0},ai:{type:Boolean},doneCard:{}},setup(T){const g=T,_=St(()=>!!g.loading),d=p(()=>g.loading?_.value:g.progress),f=p(()=>Math.round(d.value)>=100),i=$(0);E(f,(n,x)=>{n&&!x&&i.value++});function c(n){switch(n){case"completed":return"bg-green-400/40 border-green-400 text-green-400";case"failed":return"bg-red-400/40 border-red-400 text-red-400";case"in_progress":return"bg-blue-400/20 border-blue-400 text-blue-400";case"pending":return"bg-amber-400/20 border-amber-400 text-amber-400";default:return"progress-default"}}return(n,x)=>(r(),a("div",$t,[s("div",jt,[s("div",null,[s("h3",Tt,l(n.title),1),s("p",Pt,l(n.subtitle),1)]),s("div",Dt,[!n.totalCard&&n.status?(r(),a("span",{key:0,class:A(["text-xs border rounded-full px-2 py-0.5 capitalize",c(n.status)])},l(n.status==="in_progress"?"In Progress":n.status),3)):j("",!0)])]),s("div",Et,[s("div",It,[s("div",null,[s("span",null,l(n.status=="in_progress"?"Generating lane with AI...":"Progress"),1),x[0]||(x[0]=J()),n.status=="in_progress"?(r(),a("i",At)):j("",!0)]),n.ai?(r(),a("span",Lt,[J(l(Math.round(d.value))+"% ",1),f.value?(r(),a("span",{key:i.value,class:"confetti-icon select-none","aria-label":"Completed"}," ðŸŽ‰ ")):j("",!0)])):(r(),a("span",Mt,l(n.doneCard??0)+" / "+l(n.totalCard),1))]),L(kt,{class:"mt-2",progress:d.value,fillColor:"bg-accent",indeterminate:!!n.loading},null,8,["progress","indeterminate"])])]))}}),tt=st(Nt,[["__scopeId","data-v-22b8ef07"]]),Ot={class:"flex flex-col gap-4 h-full overflow-x-auto w-full flex-auto"},Rt={class:"p-5 rounded-[6px] bg-bg-card space-y-6 border border-border"},Bt={class:"flex items-center justify-between"},Ut={class:"flex flex-col w-full"},zt={class:"text-sm text-text-secondary mt-2"},Ht={class:"flex gap-2.5 overflow-x-auto w-full py-8 custom_scroll_bar"},Jt=["onClick"],Wt=["onClick"],Ft={class:"flex flex-grow flex-col sm:flex-row gap-4"},Gt={class:"bg-bg-card w-full max-h-full flex-auto p-5 rounded-lg border border-border"},Vt={class:"mb-4"},qt={class:"text-sm text-text-secondary mt-1"},Kt={key:0,class:"ml-1"},Qt={class:"space-y-4"},Yt={key:1,class:"text-center py-8"},Xt={key:2,class:"text-center py-8"},Zt={class:"flex items-center gap-2 w-32 flex-shrink-0"},te={key:0,class:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0"},ee=["src","alt"],se={key:2,class:"w-8 h-8 rounded-full bg-bg-body flex items-center justify-center flex-shrink-0"},oe=["title"],re={class:"flex-1"},ae=["title"],ne={class:"bg-bg-card w-full flex-auto p-5 max-h-full rounded-lg overflow-y-auto flex flex-col border border-border"},le={class:"space-y-4 overflow-y-auto flex-1"},de={class:"flex-1 min-w-0"},ie={class:"text-sm text-text-primary"},ue={class:"font-medium text-accent/90 pe-1"},ce={class:"text-text-secondary"},pe={href:"#",class:"text-accent/90 hover:underline"},ge={class:"text-xs text-text-secondary mt-1"},fe=H({__name:"Peak",setup(T){const{isDark:g}=pt(),_=gt(),d=ft(),f=p(()=>{var o;return X((o=d==null?void 0:d.params)==null?void 0:o.id)}),i=p(()=>{var o;return X((o=d==null?void 0:d.params)==null?void 0:o.job_id)}),{data:c,isPending:n,error:x,refetch:M}=wt(f),{data:W}=yt(f),ot=p(()=>_.singleWorkspace),rt=p(()=>{var b,t,v;const o=(b=W.value)==null?void 0:b.activities,e=((t=_.singleWorkspace)==null?void 0:t.created_at)||((v=ot.value)==null?void 0:v.created_at);return o!=null&&o.length&&o[0].created_at||e});function at(o){const e=document.createElement("div");return e.innerHTML=o,e.textContent||e.innerText||""}const N=$(!1),F=$(!1),h=$(null),k=$(null);let P=!1;const nt="https://backend.streamed.space/api/v1/",O=()=>{if(P||k.value)return;const o=localStorage.getItem("token")||"",e=i.value,b=localStorage.getItem("jobId"),t=e||b||f.value,I=`${nt}common/step2/tasks/${t}/stream?token=${o}&is_manual=${e||b?"false":"true"}`,m=new EventSource(I);k.value=m,m.onopen=()=>{P||(F.value=!0)},m.onmessage=B=>{var Q;if(!P)try{h.value=JSON.parse(B.data);const Y=((Q=h.value)==null?void 0:Q.status)??"cancels";["completed","failed","canceled"].includes(Y)&&D()}catch{}},m.onerror=()=>{D()},k.value.addEventListener("progress",B=>{try{h.value=JSON.parse(B.data)}catch{}})},D=()=>{F.value=!1,k.value&&(k.value.close(),k.value=null)};xt(()=>{P=!1,O()}),et(()=>{P=!0,D()});const w=p(()=>{var o;return((o=h.value)==null?void 0:o.percent)===100}),lt=p(()=>{var o,e;return((e=(o=h.value)==null?void 0:o.result)==null?void 0:e.lanes_summary)??[]}),dt=p(()=>{var o,e;return((e=(o=h.value)==null?void 0:o.progress_details)==null?void 0:e.lanes_progress)??[]}),G=["https://randomuser.me/api/portraits/women/1.jpg","https://randomuser.me/api/portraits/men/2.jpg","https://randomuser.me/api/portraits/men/3.jpg"],V=o=>{console.log("Lane clicked:",o)},q=p(()=>{var o;return(o=c.value)!=null&&o.team_workload?c.value.team_workload.map(e=>({id:e.assignee_id||"unassigned",name:e.assignee_name,initials:e.initials||U(e.assignee_name)||"",avatar:!!e.avatar_url||!!e.assignee_id,avatarUrl:e.avatar_url,color:bt(e.assignee_id,e.assignee_name),workload:e.work_distribution_percentage,totalTasks:e.total_tasks,totalHours:e.total_hours})):[]}),R=p(()=>{var o;return((o=c.value)==null?void 0:o.team_size)||0}),it=o=>({"DEPLOYED-PROD":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",REOPENED:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200","IN-PROGRESS":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"})[o]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200",ut=H({name:"SkeletonCard",setup(){return()=>S("div",{class:"w-[380px] min-w-[280px] h-[180px] rounded-xl border border-border bg-bg-body/60 animate-pulse p-4"},[S("div",{class:"h-5 w-2/3 rounded bg-bg-card/50 mb-2"}),S("div",{class:"h-3 w-1/2 rounded bg-bg-card/50 mb-4"}),S("div",{class:"h-2 w-full rounded bg-bg-card/50 mb-1"}),S("div",{class:"h-2 w-11/12 rounded bg-bg-card/50 mb-1"}),S("div",{class:"h-2 w-10/12 rounded bg-bg-card/50"})])}}),K=(o,e)=>o?(e.Done??0)/o*100:0,ct=vt();return E(w,o=>{o&&ct.invalidateQueries({queryKey:["dashboard-teams",f.value]})}),E([f,i],()=>{D(),O()}),E(()=>_.lanes,(o,e)=>{!o||!e||o!==e&&(D(),O())},{deep:!0}),(o,e)=>{var b;return r(),a("div",Ot,[s("div",Rt,[s("div",Bt,[s("div",Ut,[e[1]||(e[1]=s("h3",{class:"text-2xl text-text-primary font-semibold"},"Project Overview",-1)),s("p",zt,"Last update on "+l(u(Ct)(rt.value)),1),s("div",Ht,[N.value?(r(),a(y,{key:0},C(3,t=>L(u(ut),{key:t})),64)):(r(),_t(ht,{key:1,name:"list",tag:"div",class:"flex gap-2.5"},{default:mt(()=>[w.value?(r(!0),a(y,{key:0},C(lt.value,t=>(r(),a("button",{key:t==null?void 0:t.lane_title,class:"group focus:outline-none border-border border focus-visible:ring-2 focus-visible:ring-primary/50 rounded-xl",type:"button",role:"button","aria-label":"Open lane details",onClick:v=>V(t)},[L(tt,{ai:!1,doneCard:t==null?void 0:t.status_distribution.Done,loading:N.value||(t==null?void 0:t.status)==="in_progress",title:t==null?void 0:t.lane_title,subtitle:"",progress:w.value?K(t==null?void 0:t.total_cards,t==null?void 0:t.status_distribution):t==null?void 0:t.progress,totalCard:t==null?void 0:t.total_cards,status:w.value?"":(t==null?void 0:t.status)??"",avatars:G,date:"May 28",class:"transition-transform duration-200 ease-out group-hover:shadow-lg border border-transparent hover:border-border-subtle rounded-xl cursor-pointer"},null,8,["doneCard","loading","title","progress","totalCard","status"])],8,Jt))),128)):(r(!0),a(y,{key:1},C(dt.value,t=>(r(),a("button",{key:`2-${t==null?void 0:t.lane_title}`,class:"group focus:outline-none border-border border focus-visible:ring-2 focus-visible:ring-primary/50 rounded-xl",type:"button",role:"button","aria-label":"Open lane details",onClick:v=>V(t)},[L(tt,{ai:!0,loading:N.value||(t==null?void 0:t.status)==="in_progress",title:t==null?void 0:t.lane_title,subtitle:"",progress:w.value?K(t==null?void 0:t.total_cards,t==null?void 0:t.status_distribution):t==null?void 0:t.progress,totalCard:t==null?void 0:t.total_cards,status:w.value?"":(t==null?void 0:t.status)??"",avatars:G,date:"May 28",class:"transition-transform duration-200 ease-out group-hover:shadow-lg border border-transparent hover:border-border-subtle rounded-xl cursor-pointer"},null,8,["loading","title","progress","totalCard","status"])],8,Wt))),128))]),_:1}))])])])]),s("div",Ft,[s("div",Gt,[s("div",Vt,[e[3]||(e[3]=s("h3",{class:"text-lg font-semibold text-text-primary"},"Team workload",-1)),s("p",qt,[e[2]||(e[2]=J(" Monitor the capacity of your team. ")),R.value>0?(r(),a("span",Kt,"("+l(R.value)+" member"+l(R.value!==1?"s":"")+")",1)):j("",!0)])]),s("div",Qt,[e[8]||(e[8]=s("div",{class:"flex items-center justify-between text-sm font-medium text-text-secondary mb-2"},[s("span",null,"Assignee"),s("span",null,"Work distribution")],-1)),u(n)?(r(),a(y,{key:0},C(3,t=>s("div",{key:t,class:"flex items-center gap-3 animate-pulse"},e[4]||(e[4]=[s("div",{class:"flex items-center gap-2 w-32 flex-shrink-0"},[s("div",{class:"w-8 h-8 rounded-full bg-bg-body"}),s("div",{class:"h-4 w-20 bg-bg-body rounded"})],-1),s("div",{class:"flex-1 h-6 bg-bg-body rounded"},null,-1)]))),64)):u(x)?(r(),a("div",Yt,[e[5]||(e[5]=s("p",{class:"text-sm text-red-500 mb-2"},"Failed to load team workload",-1)),s("button",{onClick:e[0]||(e[0]=()=>u(M)()),class:"text-xs text-accent hover:underline"}," Try again ")])):q.value.length===0?(r(),a("div",Xt,e[6]||(e[6]=[s("i",{class:"pi pi-users text-3xl text-text-secondary mb-2"},null,-1),s("p",{class:"text-sm text-text-secondary"},"No team members assigned yet",-1)]))):(r(!0),a(y,{key:3},C(q.value,t=>(r(),a("div",{key:t.id,class:"flex items-center gap-3"},[s("div",Zt,[t.avatarUrl?(r(),a("div",te,[s("img",{src:t==null?void 0:t.avatarUrl,alt:t.name,class:"w-full h-full object-cover"},null,8,ee)])):t.avatar?(r(),a("div",{key:1,class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0",style:z({backgroundColor:u(Z)({name:t==null?void 0:t.name})})},l(u(U)(t==null?void 0:t.name)),5)):(r(),a("div",se,e[7]||(e[7]=[s("i",{class:"pi pi-user text-text-secondary"},null,-1)]))),s("span",{class:"text-sm text-text-primary truncate",title:t==null?void 0:t.name},l(t==null?void 0:t.name),9,oe)]),s("div",re,[s("div",{class:"h-6 bg-bg-body rounded overflow-hidden relative group cursor-help",title:`${t.totalTasks} task${t.totalTasks!==1?"s":""} â€¢ ${t.totalHours}h`},[s("div",{class:A(["h-full transition-all duration-300",u(g)?"bg-accent":"!bg-accent-hover/40"]),style:z({width:t.workload+"%"})},null,6),t.workload>0?(r(),a("span",{key:0,class:A(["absolute inset-0 flex items-center justify-start px-2 text-[11px] font-medium",u(g)?"text-white":"text-black"])},l(t.workload)+"% ",3)):j("",!0)],8,ae)])]))),128))])]),s("div",ne,[e[10]||(e[10]=s("div",{class:"mb-4"},[s("h3",{class:"text-lg font-semibold text-text-primary"},"Recent activity"),s("p",{class:"text-sm text-text-secondary mt-1"},"Stay up to date with what's happening across the project.")],-1)),s("div",le,[e[9]||(e[9]=s("div",{class:"text-xs font-semibold text-text-secondary mb-3"},"Today",-1)),(r(!0),a(y,null,C((b=u(W))==null?void 0:b.activities,t=>{var v,I,m;return r(),a("div",{key:t.id,class:"flex gap-3 pb-4 border-b border-border last:border-0"},[s("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0",style:z({backgroundColor:u(Z)({email:(v=t==null?void 0:t.user)==null?void 0:v.email})})},l(u(U)((I=t==null?void 0:t.user)==null?void 0:I.name)),5),s("div",de,[s("div",ie,[s("span",ue,l((m=t==null?void 0:t.user)==null?void 0:m.name),1),s("span",ce,l(at((t==null?void 0:t.message)||"")),1),s("a",pe,l(t==null?void 0:t.item),1),t.status?(r(),a("span",{key:0,class:A(["ml-2 px-2 py-0.5 rounded text-xs font-medium",it(t.status)])},l(t==null?void 0:t.status),3)):j("",!0)]),s("div",ge,l(t==null?void 0:t.time),1)])])}),128))])])])])}}}),me=st(fe,[["__scopeId","data-v-0a629d5e"]]);export{me as default};
