import{D as R}from"./vuedraggable.umd-CZ4PBgie.js";import{d as z,Z as O,u as F,r as C,x as K,c as Q,m as D,o as h,F as U,g as y,h as P,P as _,n as M,f as Z,y as G,al as $,l as S,t as A,T as H,i as c,w,ao as J,N as q,aj as X}from"./index-BMMiwVpy.js";import{_ as Y}from"./DropMenu.vue_vue_type_script_setup_true_lang-C00KAjk7.js";import{u as ee}from"./index-JsrllDjQ.js";import"./_commonjsHelpers-_d1bhYXs.js";const oe={class:"flex items-center justify-between w-full p-4 border-b border-border cursor-grab"},ne={class:"flex items-center gap-2 flex-auto max-w-4/5"},te=["onKeydown"],le=["onKeydown"],se={class:"text-xs bg-muted bg-bg-card aspect-square flex justify-center items-center text-muted-foreground p-1 min-w-6 rounded-full"},ae=z({__name:"KanbanColumn",props:{column:{},variable_id:{},sheet_id:{},canDragList:{type:Boolean},plusIcon:{type:Boolean},index:{},totalColumns:{}},emits:["update:column","delete:column","onPlus","reorder","select:ticket","move:column"],setup(V,{emit:L}){const{canDeleteVariable:I,canEditVariable:p}=O(),o=V,r=L,B=F(),g=()=>{var e,a;B.setTransition({...(e=o==null?void 0:o.column)==null?void 0:e.transitions,currentColumn:(a=o.column)==null?void 0:a.title})},m=()=>{B.setTransition({})},u=C(!1),f=C(o.column.title),x=C(null);K(()=>o.column.title,e=>{f.value=e});function k(){!p.value||!s()||(u.value=!0,J(()=>{x.value&&(x.value.focus(),x.value.select())}))}function E(){const e=(f.value??"").trim()||"Untitled";e!==o.column.title?r("update:column",{...o.column,title:e,oldTitle:o.column.title}):f.value=o.column.title,u.value=!1}function T(){f.value=o.column.title,u.value=!1}const v=C([...o.column.cards??[]]);K(()=>o.column.cards,e=>{v.value=[...e??[]]});const t={backlog:"bg-column-backlog",todo:"bg-column-todo",progress:"bg-column-progress",done:"bg-column-done"},n=Q(()=>{const e=String(o.column._id);return t[e]??"bg-muted/30"});function i(e){var d,W,N,j;const a=e.moved??e.added;a&&r("reorder",{moved:a.element,fromColumnId:((N=(W=(d=e.from)==null?void 0:d.__draggable_component__)==null?void 0:W.$props)==null?void 0:N.listOwnerId)??((j=o.column)==null?void 0:j.title),toColumnId:o.column._id,oldIndex:a.oldIndex??null,newIndex:a.newIndex??null})}function l(){if(!p.value&&!I.value)return[];const e=[];return p.value&&(o.index!==void 0&&o.index>0&&e.push({label:"Move left side",action:()=>{r("move:column",{direction:"left",column:o.column})}}),o.index!==void 0&&o.totalColumns!==void 0&&o.index<o.totalColumns-1&&e.push({label:"Move right side",action:()=>{r("move:column",{direction:"right",column:o.column})}})),I.value&&e.push({label:"Delete",danger:!0,action:()=>b()}),e}function s(){var a;const e=(a=o==null?void 0:o.column)==null?void 0:a.title.trim().toLowerCase();if(e)switch(e){case"admin":return!1;default:return!0}}const b=()=>{var e;r("delete:column",{title:o.column.title,columnId:(e=o.column)==null?void 0:e._id})};return window.addEventListener("close-all-showADDNEW",()=>{o.column.showADDNEW=!1}),(e,a)=>(h(),D("div",{class:U(["flex bg-bg-body flex-col min-h-[565px] h-full w-full rounded-lg transition-all duration-200",n.value])},[y("div",oe,[y("div",ne,[u.value?G((h(),D("input",{key:1,autofocus:"",ref_key:"titleInputRef",ref:x,"onUpdate:modelValue":a[0]||(a[0]=d=>f.value=d),class:"font-semibold inline text-foreground px-1 py-0.5 rounded bg-transparent border border-border focus:outline-none focus:ring-1 focus:ring-border",onKeydown:[$(S(E,["prevent"]),["enter"]),$(S(T,["prevent"]),["esc"])],onBlur:E,onMousedown:a[1]||(a[1]=S(()=>{},["stop"]))},null,40,le)),[[H,f.value]]):(h(),D("button",{key:0,class:"font-semibold overflow-ellipsis line-clamp-1 text-nowrap text-foreground px-1 py-0.5 rounded hover:bg-bg-card focus:outline-none focus:ring-1 focus:ring-border cursor-text",onClick:k,onKeydown:$(S(k,["prevent"]),["enter"]),title:"Click to rename"},A(f.value),41,te)),y("span",se,A(v.value.length),1)]),e.plusIcon?(h(),D("i",{key:0,class:"cursor-pointer fa-solid fa-plus",onClick:a[2]||(a[2]=d=>r("onPlus",e.column))})):M("",!0),s()&&(c(p)||c(I))?(h(),Z(Y,{key:1,items:l()},{trigger:w(()=>a[4]||(a[4]=[y("i",{class:"fa-solid fa-ellipsis cursor-pointer"},null,-1)])),_:1},8,["items"])):M("",!0)]),P(c(R),{disabled:!e.canDragList,modelValue:v.value,"onUpdate:modelValue":a[3]||(a[3]=d=>v.value=d),"item-key":"_id",class:"flex-1 p-4 space-y-3 overflow-y-auto",group:{name:"tickets",pull:!0,put:!0},animation:180,"ghost-class":"kanban-ghost","chosen-class":"kanban-chosen",onStart:g,onEnd:m,"drag-class":"kanban-dragging",onChange:i},{item:w(({element:d})=>[y("div",null,[_(e.$slots,"ticket",{ticket:d},void 0,!0)])]),footer:w(()=>[v.value.length?M("",!0):_(e.$slots,"emptyState",{key:0,column:e.column},void 0,!0)]),_:3},8,["disabled","modelValue"]),_(e.$slots,"footer",{column:e.column},void 0,!0)],2))}}),ie=q(ae,[["__scopeId","data-v-7446b03a"]]),ue=z({__name:"KanbanBoard",props:{board:{},onBoardUpdate:{},variable_id:{},sheet_id:{},plusIcon:{type:Boolean,default:!0}},emits:["update:board","select:ticket","update:column","delete:column","onPlus","reorder","scroll"],setup(V,{emit:L}){const{canCreateCard:I,canEditCard:p}=O(),o=ee("(max-width: 650px)"),r=C(p.value);X(()=>{r.value=p.value});const B=()=>{console.log(">>> strating"),r.value=!1},g=V,m=L,u=C(T(g.board));K(()=>g.board,t=>{u.value=T(t)});function f(t){const n=t.oldIndex,i=t.newIndex,l=u.value.columns[i],s=l!=null&&l.title?l==null?void 0:l.title:"",b=l==null?void 0:l._id;s!=null&&k("column",{id:s,oldIndex:n,newIndex:i,_id:b}),r.value=!0}function x(t){console.log(t),k("ticket",t)}function k(t,n){var l;const i=u.value;m("update:board",i),m("reorder",{type:t,board:i,meta:n}),(l=g.onBoardUpdate)==null||l.call(g,i)}function E({direction:t,column:n}){const i=[...u.value.columns],l=i.findIndex(b=>b.title.toLowerCase()===n.title.toLowerCase());if(l===-1)return;let s=l;if(t==="left"&&l>0?s=l-1:t==="right"&&l<i.length-1&&(s=l+1),s!==l){const[b]=i.splice(l,1);i.splice(s,0,b),u.value.columns=i;const e=i[s],a=e!=null&&e.title?e==null?void 0:e.title:"",d=e==null?void 0:e._id;a!=null&&k("column",{id:a,oldIndex:l,newIndex:s,_id:d})}}function T(t){return{columns:((t==null?void 0:t.length)>0?t:[]).map(n=>({_id:n==null?void 0:n._id,title:n==null?void 0:n.title,transitions:n.transitions,cards:((n==null?void 0:n.cards)??[]).map(i=>({...i}))}))}}const v=t=>{const n=t.target;console.log("scroll updates",n),m("scroll",{scrollLeft:n.scrollLeft,scrollWidth:n.scrollWidth,clientWidth:n.clientWidth})};return(t,n)=>(h(),D("div",{class:"h-full flex gap-3",ref:"kanbanScroll",onScroll:v},[P(c(R),{modelValue:u.value.columns,"onUpdate:modelValue":n[4]||(n[4]=i=>u.value.columns=i),"item-key":"_id",group:"columns",animation:180,"ghost-class":"kanban-ghost","chosen-class":"kanban-chosen","drag-class":"kanban-dragging","force-fallback":!0,disabled:c(o),class:U(["flex gap-3",{"overflow-x-auto snap-x snap-mandatory w-full pb-4 mobile-scroll-visible":c(o),"min-w-max":!c(o)}]),direction:"horizontal",onEnd:f,onStart:B},{item:w(({element:i,index:l})=>[y("div",{class:U(["rounded-lg bg-bg-surface h-full",{"snap-center min-w-[270px] max-w-[270px]":c(o),"min-w-[320px] max-w-[320px]":!c(o)}])},[P(ie,{plusIcon:t.plusIcon&&c(I),canDragList:!c(o)&&r.value,onOnPlus:n[0]||(n[0]=s=>m("onPlus",s)),sheet_id:t.sheet_id,variable_id:t.variable_id,"onUpdate:column":n[1]||(n[1]=s=>m("update:column",s)),index:l,totalColumns:u.value.columns.length,"onSelect:ticket":n[2]||(n[2]=s=>m("select:ticket",s)),"onDelete:column":n[3]||(n[3]=s=>m("delete:column",s)),column:i,onReorder:x,"onMove:column":E},{emptyState:w(({column:s})=>[_(t.$slots,"emptyState",{column:s},void 0,!0)]),ticket:w(({ticket:s})=>[_(t.$slots,"ticket",{ticket:s},void 0,!0)]),footer:w(({column:s})=>[_(t.$slots,"column-footer",{column:s},void 0,!0)]),_:2},1032,["plusIcon","canDragList","sheet_id","variable_id","index","totalColumns","column"])],2)]),_:3},8,["modelValue","disabled","class"])],544))}}),pe=q(ue,[["__scopeId","data-v-5df798d6"]]);export{pe as default};
