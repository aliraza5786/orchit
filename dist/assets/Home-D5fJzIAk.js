import{d as O,c as b,l as v,F as N,y as M,o as p,h as e,a9 as de,t as z,M as ce,f as ee,I as ue,L as me,S as pe,n as q,aq as ve,r as j,e as Z,W as fe,w as D,ar as be,k as E,m as J,H as ae,z as K,C as ge,aa as _e,B as X,i as Y,p as $,T as L,as as le,at as x,au as xe,av as ke,u as he}from"./index-DgOTIn0q.js";import{f as ye}from"./FormatDate--XHqACrs.js";import{_ as we}from"./BaseEmailChip.vue_vue_type_script_setup_true_lang-CJQPQvA7.js";import{u as Ce,a as Ie,b as $e}from"./usePeople-BKLFO8QM.js";import{b as je}from"./usePackages-B3e_0r7f.js";import{f as Pe}from"./permissionUtils-fD2X1oS-.js";const Se=["aria-busy"],Ve=["onClick","aria-label"],ze=["src"],We={class:"flex justify-between gap-2.5 border-t border-border bg-bg-card p-3.5 text-sm"},Ue={class:"flex items-start gap-2.5"},Ee=["src"],Re={class:"min-w-0"},Te={class:"truncate text-sm font-medium text-text-primary w-20"},qe={class:"truncate text-xs text-text-secondary"},De={class:"truncate text-sm font-medium text-text-primary"},Ne={key:1,class:"grid grid-cols-1 gap-5 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4"},Ae={key:2,class:"col-span-full flex items-center justify-center py-10 text-sm text-text-secondary"},Be=O({__name:"ProjectGallery",props:{projects:{},loading:{type:Boolean,default:!1},skeletonCount:{default:8}},setup(A){const R=A,y=ee(),W=b(()=>R.skeletonCount??8),w=r=>{var u;return((u=r==null?void 0:r.variables)==null?void 0:u.title)||(r==null?void 0:r.title)||"Untitled"};function g(r){if(!r)return"—";const u=new Date(r);return Number.isNaN(+u)?"—":new Intl.DateTimeFormat(void 0,{dateStyle:"medium",timeStyle:"short"}).format(u)}function t(r){let u=0;for(let m=0;m<((r==null?void 0:r.length)||0);m++)u=u*31+r.charCodeAt(m)|0;const n=Math.abs(u)%360;return`linear-gradient(135deg, hsl(${n} 55% 55%), hsl(${n} 60% 48%))`}function _(r){return t(w(r))}function U(r){var n;const u=(n=r==null?void 0:r.LatestTask)==null?void 0:n.job_id;u?localStorage.setItem("jobId",u):localStorage.removeItem("jobId"),y.push(`/workspace/peak/${r._id}/${u??""}`)}return(r,u)=>{var n;return!r.loading&&((n=r.projects)!=null&&n.length)?(p(),v("section",{key:0,class:"grid grid-cols-1 gap-5 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4","aria-busy":r.loading?"true":"false","aria-live":"polite"},[(p(!0),v(N,null,M(r.projects,(m,I)=>{var C;return p(),v("article",{key:m._id??I,class:"group relative overflow-hidden rounded-xl cursor-pointer border border-border/70 bg-bg-card shadow-sm outline-none transition-all duration-200 hover:shadow-md focus-within:ring-2 focus-within:ring-orange-300"},[e("button",{type:"button",class:"absolute inset-0 z-10",onClick:f=>U(m),"aria-label":`Open project ${w(m)}`},null,8,Ve),e("div",{class:"flex h-39 items-center justify-center",style:de({background:_(m)})},[e("img",{src:m.logo,class:"aspect-square h-10 w-10 rounded-md object-cover",alt:"",loading:"lazy",decoding:"async"},null,8,ze)],4),e("div",We,[e("div",Ue,[e("img",{src:m.logo,class:"h-6 w-6 rounded-md object-cover",alt:"",loading:"lazy",decoding:"async"},null,8,Ee),e("div",Re,[e("h3",Te,z(w(m)),1),e("p",qe,z(g(m.created_at)),1)])]),e("div",null,[e("h3",De,z((C=m.owner)==null?void 0:C.name),1),u[0]||(u[0]=e("p",{class:"truncate text-xs text-text-secondary"},"Workspace Owner",-1))])])])}),128))],8,Se)):r.loading?(p(),v("section",Ne,[(p(!0),v(N,null,M(W.value,m=>(p(),v("div",{key:"sk-"+m,class:"overflow-hidden rounded-xl border border-border/70 bg-bg-card shadow-sm",role:"status","aria-label":"Loading project"},u[1]||(u[1]=[ce('<div class="h-39 bg-[linear-gradient(90deg,theme(colors.slate.200/20),theme(colors.slate.200/40),theme(colors.slate.200/20))] bg-[length:200%_100%] animate-[shimmer_1.1s_ease_infinite]" data-v-518c688c></div><div class="flex items-start gap-2.5 border-t border-border p-3.5 text-sm" data-v-518c688c><div class="h-6 w-6 rounded-md bg-surface" data-v-518c688c></div><div class="flex w-full flex-col gap-2" data-v-518c688c><div class="h-3 w-32 rounded bg-surface" data-v-518c688c></div><div class="h-2.5 w-20 rounded bg-surface" data-v-518c688c></div></div></div>',2)])))),128))])):(p(),v("div",Ae," No projects yet "))}}}),Le=ue(Be,[["__scopeId","data-v-518c688c"]]),Me={class:"px-6 flex flex-col gap-4"},Qe={key:0,class:"w-full mt-2"},Fe=["onClick"],Ke={class:"text-sm font-medium text-text-primary"},Oe={key:0,class:"py-2 border-t border-border bg-bg-input"},Ge=["value"],He={class:"text-xs font-medium text-text-primary"},Ze={class:"text-[11px] text-text-secondary leading-tight"},Je={class:"flex justify-end gap-2 p-6 mt-6 sticky bottom-0 bg-bg-body border-t border-border"},Xe=O({__name:"InviteUsersWithPermissions",props:{modelValue:{type:Boolean,default:!1},defaultWorkspaceId:{}},emits:["update:modelValue","invited"],setup(A,{emit:R}){const y=R,W=A,w=b({get:()=>W.modelValue,set:s=>y("update:modelValue",s)}),g=me(),t=pe({workspace_id:null,role_id:null,emails:[],additional_seats:1,workspace_access_role_id:null});q(()=>W.defaultWorkspaceId,s=>{s&&(t.workspace_id=s,t.role_id=null)},{immediate:!0});const _=b(()=>t.workspace_id??void 0),{data:U}=Ce(_,{enabled:b(()=>!!t.workspace_id)}),r=b(()=>(U.value||[]).map(s=>({_id:s._id,title:s.title})));q(U,s=>{console.log(s,"workspace roles.......")});const{data:u}=ve(_,{enabled:b(()=>!!t.workspace_id)}),n=b(()=>{var s;return((s=u.value)==null?void 0:s.company_id)??null}),{data:m,refetch:I}=Ie({company_id:n,workspace_id:_},{enabled:b(()=>!!n.value&&!!_.value)});q(_,()=>{_.value&&n.value&&I()});const C=b(()=>(m.value||[]).map(s=>({_id:s._id,title:s.title})));q(C,s=>{s&&s.length>0&&t.role_id});const f=b(()=>!m.value||!t.workspace_access_role_id?null:m.value.find(s=>s._id===t.workspace_access_role_id)),P=j({}),T=j([]),{mutate:G}=je();function Q(s){P.value[s]=!P.value[s]}q(f,s=>{if(!s){T.value=[];return}const i=[];s.permission_categories.forEach(c=>{c.permissions.forEach(o=>{o.enabled&&i.push(o._id)})}),T.value=i},{immediate:!0});function l(s){t.workspace_access_role_id=s}function a(){var c;if(!((c=f.value)!=null&&c._id))return;const s=[];f.value.permission_categories.forEach(o=>{o.permissions.forEach(h=>s.push(h))});const i=Pe(s,T.value);G({roleId:f.value._id,payload:{title:f.value.title,description:f.value.description,is_admin:f.value.is_admin,is_editor:f.value.is_editor,is_viewer:f.value.is_viewer,permission_ids:i.permission_ids,module_permissions:i.module_permissions,workspace_id:t.workspace_id}},{onSuccess:()=>{L.success("Permissions updated successfully"),g.invalidateQueries({queryKey:["workspace-roles"]})},onError:o=>{console.error("Failed to update permissions",o),L.error("Failed to update permissions")}})}const d=b(()=>t.workspace_access_role_id?"":"Role is required"),k=b(()=>{const s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.emails.filter(i=>!s.test(i))}),S=b(()=>k.value.length?`Invalid: ${k.value.join(", ")}`:""),V=b(()=>!!t.workspace_id&&!!t.role_id&&!!t.workspace_access_role_id&&t.emails.length>0&&k.value.length===0);b(()=>{var s;return((s=m.value)==null?void 0:s.find(i=>i._id===t.workspace_access_role_id))||null});function se(s){}function B(){}const{mutate:re,isPending:H}=$e();function ie(){if(!V.value||H.value)return;const i=t.emails.map(c=>({name:ne(c),email:c}))[0];re({id:t.role_id,payload:{name:i.name,email:i.email,workspace_id:t.workspace_id,workspace_access_role_id:t.workspace_access_role_id,role_id:t.role_id,additional_seats:1}},{onSuccess:c=>{var o,h;(o=c==null?void 0:c.failedInvites)!=null&&o.length?L.error(((h=c.failedInvites[0])==null?void 0:h.error)??"Some invites failed"):L.success("Invitations sent"),g.invalidateQueries({queryKey:["all-users"]}),g.invalidateQueries({queryKey:["people-lists"]}),g.invalidateQueries({queryKey:["workspaceRoles"]}),g.invalidateQueries({queryKey:["workspaces"]}),g.invalidateQueries({queryKey:["people"]}),g.invalidateQueries({queryKey:["dashboard-teams"]}),y("invited",c),oe(),w.value=!1},onError:c=>{var h,F;const o=((F=(h=c==null?void 0:c.response)==null?void 0:h.data)==null?void 0:F.message)||(c==null?void 0:c.message)||"Failed to send invitations.";L.error(o)}})}function te(){oe(),w.value=!1}function oe(){t.role_id=null,t.emails=[]}function ne(s){const c=(s.split("@")[0]||"").split("+")[0].split(/[^a-zA-Z]+/).filter(Boolean);return c.length?c.map(o=>o.charAt(0).toUpperCase()+o.slice(1).toLowerCase()).join(" "):s}return(s,i)=>(p(),Z(fe,{modelValue:w.value,"onUpdate:modelValue":i[3]||(i[3]=c=>w.value=c),size:"md",modalClass:"!py-0"},{default:D(()=>{var c;return[e("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[i[5]||(i[5]=e("h2",{class:"text-xl font-semibold"},"Invite Users",-1)),i[6]||(i[6]=e("p",{class:"text-sm text-text-secondary mt-1"}," Add emails, workspace role and pick role based permission. ",-1)),e("button",{onClick:te,class:"absolute top-4 cursor-pointer right-4 text-text-secondary hover:text-text-primary text-xl z-10"},i[4]||(i[4]=[e("img",{"data-v-4ef80912":"",src:be,alt:""},null,-1)]))]),e("div",Me,[E(we,{class:"w-full",label:"User emails",modelValue:t.emails,"onUpdate:modelValue":i[0]||(i[0]=o=>t.emails=o),error:!!S.value,message:S.value||"Press Enter after each email",showName:"",onInvalid:se,onAdd:B},null,8,["modelValue","error","message"]),E(ae,{size:"md",label:"Team Role",options:r.value,placeholder:"Choose team role","model-value":t.role_id,"onUpdate:modelValue":i[1]||(i[1]=o=>t.role_id=o)},null,8,["options","model-value"]),E(ae,{size:"md",label:"Workspace Role",options:C.value,placeholder:"Choose workspace role","model-value":t.workspace_access_role_id,"onUpdate:modelValue":l,disabled:!t.workspace_id,message:d.value,error:!!d.value},null,8,["options","model-value","disabled","message","error"]),f.value&&!f.value.is_admin?(p(),v("div",Qe,[i[7]||(i[7]=e("h2",{class:"text-base font-medium mb-1 flex items-center text-text-primary"}," Permissions ",-1)),(p(!0),v(N,null,M((c=f.value)==null?void 0:c.permission_categories,o=>(p(),v("div",{key:o==null?void 0:o.category,class:"border border-border mb-2 rounded-lg overflow-hidden bg-bg-surface/30"},[e("button",{onClick:h=>Q(o==null?void 0:o.category),class:"w-full px-3 py-2 flex justify-between items-center hover:bg-bg-surface transition"},[e("span",Ke,z(o==null?void 0:o.category_title),1),e("i",{class:K(["fa-solid fa-chevron-down text-xs text-text-secondary transition-transform",P.value[o==null?void 0:o.category]?"rotate-180":""])},null,2)],8,Fe),P.value[o==null?void 0:o.category]?(p(),v("div",Oe,[(p(!0),v(N,null,M(o==null?void 0:o.permissions,h=>(p(),v("div",{key:h._id,class:"flex items-start gap-2 hover:bg-bg-body py-2 px-3"},[ge(e("input",{type:"checkbox","onUpdate:modelValue":i[2]||(i[2]=F=>T.value=F),value:h._id,onChange:a,class:"h-4 w-4 mt-0.5 rounded border-border accent-accent cursor-pointer flex-shrink-0"},null,40,Ge),[[_e,T.value]]),e("div",null,[e("p",He,z(h.title),1),e("p",Ze,z(h.description),1)])]))),128))])):J("",!0)]))),128))])):J("",!0)]),e("div",Je,[E(X,{variant:"secondary",onClick:te},{default:D(()=>i[8]||(i[8]=[Y("Cancel")])),_:1,__:[8]}),E(X,{variant:"primary",disabled:!V.value||$(H),onClick:ie},{default:D(()=>[Y(z($(H)?"Inviting…":"Send Invites"),1)]),_:1},8,["disabled"])])]}),_:1},8,["modelValue"]))}}),Ye={class:"flex -space-x-2"},es=O({__name:"WorkspaceListTable",setup(A){const R=ee(),y=new Map,W=l=>(y.has(l)||y.set(l,ye(l)),y.get(l)),w=l=>{var k;const a=l.row,d=(k=a==null?void 0:a.LatestTask)==null?void 0:k.job_id;d?localStorage.setItem("jobId",d):localStorage.removeItem("jobId"),R.push(`/workspace/peak/${a==null?void 0:a._id}/${d||""}`)},g=j(!1),t=j(void 0),_=l=>{t.value=l,g.value=!0},I=[{key:"variables",label:"Project",render:({row:l,value:a})=>x("div",{class:"flex items-center gap-2"},[l.logo?x("img",{src:l.logo,alt:(a==null?void 0:a.title)||"Project",class:"h-8 w-8 bg-bg-card rounded-full object-cover",loading:"lazy",decoding:"async"}):x("div",{class:"h-8 w-8 rounded-full bg-bg-card"}),x("span",{class:"cursor-pointer hover:underline",onClick:d=>{d.stopPropagation(),w({row:l})}},(a==null?void 0:a.title)||"Untitled")])},{key:"variables",label:"Project type",render:({value:l})=>x("span",{class:"capitalize"},(l==null?void 0:l["workspace-type"])||"-")},{key:"People",label:"People",render:({row:l,value:a})=>x("div",{class:"flex items-center -space-x-3"},[x(ke,{avatars:a||[],image:!0,maxVisible:3}),x("button",{class:l.has_permission_to_manage_user?"flex justify-center items-center rounded-full border border-border text-xs bg-bg-dropdown cursor-pointer hover:bg-bg-dropdown-menu-hover transition  h-8 w-8 cursor-pointer":"hidden",onClick:d=>{d.stopPropagation(),_(l._id)},title:"Invite Users"},[x("i",{class:"fa-solid fa-plus text-gray-500 text-xs"})])])},{key:"created_at",label:"Start Date",render:({value:l})=>x("span",W(l))},{key:"admin",label:"Workspace Owner",render:({row:l})=>{const a=l==null?void 0:l.owner;if(!a)return x("span","-");const d=S=>S.split(" ").map(V=>V[0]).join("").toUpperCase(),k=S=>{let V=0;for(let B=0;B<S.length;B++)V=S.charCodeAt(B)+((V<<5)-V);return`hsl(${Math.abs(V)%360}, 60%, 50%)`};return x("div",{class:"flex items-center gap-2"},[a.profile_img?x("img",{src:a.profile_img,alt:a.name,class:"h-6 w-6 rounded-full object-cover",loading:"lazy",decoding:"async"}):x("div",{class:"h-8 w-8 border-primary border-2 shadow-md flex items-center justify-center rounded-full text-white text-xs font-medium",style:{backgroundColor:k(a.name)}},d(a.name)),x("span",a.name)])}}],C=j(1),f=j(10),{data:P,isPending:T}=le(C,f),G=b(()=>{var l;return((l=P.value)==null?void 0:l.workspaces)??[]}),Q=j(0);return q(P,()=>{var l,a,d,k;(a=(l=P.value)==null?void 0:l.pagination)!=null&&a.totalCount&&(Q.value=(k=(d=P.value)==null?void 0:d.pagination)==null?void 0:k.totalCount)}),(l,a)=>(p(),v(N,null,[E(xe,{columns:I,rows:G.value,loading:$(T),total:Q.value,page:C.value,"onUpdate:page":a[0]||(a[0]=d=>C.value=d),pageSize:f.value,"onUpdate:pageSize":a[1]||(a[1]=d=>f.value=d),pageSizes:[10,20,50,100]},{status:D(({row:d})=>[e("span",{class:K(["px-3 py-1 rounded-full text-xs font-medium",{"bg-blue-100 text-blue-600":d.status==="In progress","bg-red-100 text-red-600":d.status==="Live","bg-green-100 text-green-600":d.status==="Done"}])},z(d.status),3)]),team:D(({row:d})=>[e("div",Ye,[(p(!0),v(N,null,M(d.Roles,(k,S)=>(p(),v("span",{key:S,class:"w-6 h-6 flex items-center justify-center rounded-full bg-gray-200 text-xs"},z(k),1))),128))])]),_:1},8,["rows","loading","total","page","pageSize"]),E(Xe,{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=d=>g.value=d),defaultWorkspaceId:t.value},null,8,["modelValue","defaultWorkspaceId"])],64))}}),ss={class:"w-full bg-bg-body text-text-primary"},ts={class:"mx-auto w-full max-w-[1440px] px-5 py-10 md:px-15 md:py-20"},os={class:"flex flex-wrap items-center justify-between gap-5"},as={class:"flex items-center gap-3"},ls={class:"mt-21 mb-8 flex items-center justify-between"},rs={class:"flex items-center gap-3"},is={key:0,class:"flex items-center justify-center py-10 text-sm text-text-secondary"},vs=O({__name:"Home",setup(A){const R=ee(),y=he(),W=j(1),w=j(10),{data:g,isPending:t}=le(W,w),_=j("list"),U=u=>{_.value=u},r=b(()=>g.value.length===0);return(u,n)=>{var m;return p(),v("div",ss,[e("div",ts,[e("div",os,[n[4]||(n[4]=e("div",{class:"flex flex-col gap-1.5 max-md:gap-1"},[e("h1",{class:"text-2xl font-medium"},"Welcome to Orchit AI!"),e("p",{class:"text-sm text-text-secondary"},"Create, organize, and collaborate seamlessly.")],-1)),e("div",as,[e("div",{to:"/create-workspace",onClick:n[0]||(n[0]=()=>{var I,C;((I=$(y).limits.features[1])==null?void 0:I.usage.current)>=((C=$(y).limits.features[1])==null?void 0:C.limits.limit)?$(y).setLimitExccedModal(!0):$(R).push("/create-workspace")})},[E(X,{variant:"primary"},{default:D(()=>n[3]||(n[3]=[Y("Create a workspace")])),_:1,__:[3]})])])]),e("div",ls,[n[7]||(n[7]=e("h2",{class:"text-xl font-medium"},"All Workspaces",-1)),e("div",rs,[e("button",{class:K(["aspect-square w-8 cursor-pointer rounded-md p-1",_.value==="list"?"text-accent bg-accent-text":" hover:bg-border/50 backdrop-blur-2xl  transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),onClick:n[1]||(n[1]=I=>U("list")),title:"List view"},n[5]||(n[5]=[e("i",{class:"fa-solid fa-align-left"},null,-1)]),2),e("button",{class:K(["aspect-square w-8 cursor-pointer rounded-md p-1",_.value==="gallery"?"text-accent bg-accent-text":"hover:bg-border/50 backdrop-blur-2xl  transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),onClick:n[2]||(n[2]=I=>U("gallery")),title:"Gallery view"},n[6]||(n[6]=[e("i",{class:"fa-solid fa-grid-2"},null,-1)]),2)])]),!$(t)&&r.value?(p(),v("div",is," No Workspace ")):_.value==="list"?(p(),Z(es,{key:1})):_.value==="gallery"?(p(),Z(Le,{key:2,projects:(m=$(g))==null?void 0:m.workspaces,loading:$(t)},null,8,["projects","loading"])):J("",!0)])])}}});export{vs as default};
