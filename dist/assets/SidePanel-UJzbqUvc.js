const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Cg6p-Sqa.js","assets/index-D6Y6XN9b.css","assets/BaseSelectField-BpPt0bFW.js","assets/AssigmentDropdown-BOr1uv8g.js"])))=>i.map(i=>d[i]);
import{d as ft,r as f,Z as gt,Q as bt,S as xt,bz as yt,x as T,C as ke,ax as wt,O as Ce,c as A,a4 as kt,bA as Ct,bB as Dt,bC as St,bD as Et,bE as It,ae as Vt,aP as Qt,f as Tt,ar as Y,w as E,o as r,y as J,J as At,g as a,m as d,i as n,F as K,h as x,G as D,E as O,n as S,t as v,ah as M,al as De,l as Se,T as ue,k as Z,ao as Ee,Y as Ie,H as z,N as Ut}from"./index-Cg6p-Sqa.js";import{u as Lt}from"./sidePanelStore-D1Qn4X2U.js";const Pt={key:0,class:"flex flex-col gap-5 p-6 animate-pulse"},qt={key:1},Kt={class:"sticky top-0 z-10 border-b border-border px-4 sm:px-6 py-[9px] flex items-center justify-between bg-bg-card"},Ot={class:"flex items-center gap-2"},Mt=["aria-label"],zt={class:"py-5 px-4 sm:px-6 flex flex-col gap-5 flex-grow"},Bt={key:0,class:"space-y-2 sm:col-span-1"},Ft={class:"text-xs uppercase tracking-wider text-text-secondary"},jt={class:"capitalize"},Rt=["disabled","title","onKeydown"],$t=["title"],Ht=["disabled"],Nt=["innerHTML"],Yt={key:1,class:"opacity-60"},Wt={key:"tab-details",class:"space-y-6"},Gt={class:"grid grid-cols-2 gap-4 text-sm"},Jt={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-4"},Zt={class:"mt-1 font-medium"},Xt={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-4"},es={class:"mt-1 font-medium"},ts={class:"rounded-2xl border border-orchit-white/10 bg-orchit-white/5 p-4 grid grid-cols-1 gap-4"},ss={class:"space-y-2"},as={class:"space-y-2"},is={class:"space-y-2"},os={class:"h-8 px-3 flex items-center gap-2 rounded-lg bg-bg-input border border-orchit-white/10"},ls={class:"space-y-2"},ns={key:0,class:"text-xs text-red-400 mt-1"},rs={key:0,class:"space-y-2 sm:col-span-1"},ds={class:"text-xs uppercase tracking-wider text-text-secondary"},us={key:1},cs={class:"relative border-l border-orchit-white/10 pl-5 space-y-4 ml-1"},ps={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-3 hover:bg-orchit-white/7 transition"},ms={class:"font-semibold"},vs={class:"font-semibold"},_s={key:"tab-comments",class:"space-y-4"},hs={class:"flex items-center gap-3 mb-2"},fs={class:"h-8 w-8 rounded-full bg-accent/15 text-accent flex items-center justify-center text-xs font-semibold"},gs={class:"flex-1"},bs={class:"text-sm font-medium"},xs={class:"text-xs text-text-secondary"},ys={key:0,class:"flex items-center gap-2"},ws=["disabled","onClick"],ks=["disabled","onClick"],Cs={class:"flex items-center gap-2 justify-end"},Ds={key:0,class:"mt-3 grid grid-cols-2 gap-2"},Ss=["href"],Es={class:"text-xs truncate"},Is={class:"rounded-xl border border-orchit-white/10 bg-orchit-white/5 overflow-hidden"},Vs=["disabled"],Qs={class:"flex items-center w-full justify-between p-2 border-t border-orchit-white/10"},Ts={key:0,class:"text-red-500 text-sm"},As={key:"tab-attachments",class:"space-y-3"},Us={class:"text-xs text-text-secondary"},Ls={class:"grid sm:grid-cols-2 gap-4"},Ps={class:"p-3"},qs={key:0,class:"rounded-lg overflow-hidden"},Ks=["src"],Os={key:1,class:"rounded-lg overflow-hidden"},Ms=["src"],zs={key:2,class:"h-40 rounded-lg bg-black/5 grid place-items-center"},Bs={class:"mt-3"},Fs={class:"font-medium truncate"},js={class:"text-xs text-text-secondary capitalize"},Rs={class:"p-3 pt-0"},$s=["href"],Hs=ft({__name:"SidePanel",props:{pin:{type:Boolean,default:!1},showPanel:{type:Boolean,default:!0},details:{type:Object,default:()=>({})}},emits:["close","closeSidePanel","update:details","comment:post","priority:change","ticketUpdated"],setup(B,{emit:Ve}){var ye,we;const g=Lt(),Qe=M({loader:()=>z(()=>import("./index-Cg6p-Sqa.js").then(e=>e.dr),__vite__mapDeps([0,1])),loadingComponent:{template:'<div class="h-20 w-full animate-pulse bg-neutral-700/30 rounded-lg"></div>'},delay:200}),X=M(()=>z(()=>import("./BaseSelectField-BpPt0bFW.js"),__vite__mapDeps([2,0,1]))),ce=M(()=>z(()=>import("./index-Cg6p-Sqa.js").then(e=>e.ds),__vite__mapDeps([0,1]))),Te=M(()=>z(()=>import("./AssigmentDropdown-BOr1uv8g.js"),__vite__mapDeps([3,0,1]))),ee=M(()=>z(()=>import("./index-Cg6p-Sqa.js").then(e=>e.dq),__vite__mapDeps([0,1]))),Ae=M(()=>z(()=>import("./index-Cg6p-Sqa.js").then(e=>e.du),__vite__mapDeps([0,1]))),F=f(!1),{canCreateComment:te,canEditComment:W,canViewComment:pe,canDeleteComment:Ue,canEditCard:y,canViewAttachment:Le,canAssignCard:Pe}=gt(),{workspaceId:qe}=bt(),p=xt(),_=B,se=Ve,ae=f(_.details._id),G=f(""),{data:l,isPending:me,isFetching:Ke,refetch:Oe}=yt(ae,{initialData:()=>p.getQueryData(["product-card",ae.value]),staleTime:5*60*1e3,gcTime:10*60*1e3,refetchOnWindowFocus:!1});T(_,()=>{ae.value=_.details._id}),T(()=>l.value,e=>{e&&(g.selectedCard=e,g.selectedCardTitle=e["card-title"],g.selectedCardId=e._id)},{immediate:!0});const j=f("details"),Me=[{label:"Details",value:"details"},{label:"Comments",value:"comments",disabled:pe},{label:"History",value:"history"},{label:"Attachment",value:"attachment"}],U=f(!1);function ze(){G.value=""}const I=f(l.value?l.value["card-title"]:""),ve=f(null);function Be(){var e;y.value&&(g.saveTitle(I.value),g.saveLocalId((e=l.value)==null?void 0:e._id),g.saveCardDetails(l.value),U.value=!0,Ee(()=>{var t;return(t=ve.value)==null?void 0:t.focus()}))}T(()=>g.selectedCardTitle,e=>{!U.value&&e!==void 0&&(I.value=e)},{immediate:!0});function Fe(){const e=I.value.trim();if(!e||e===g.selectedCardTitle){U.value=!1;return}Q.mutate({card_id:g.selectedCardId,variables:{"card-title":e}}),U.value=!1}const L=f(l!=null&&l.value?l==null?void 0:l.value["card-description"]:"");T(()=>{var e;return(e=g.selectedCard)==null?void 0:e["card-description"]},e=>{var t;e&&((t=g.selectedCard)==null?void 0:t._id)===g.selectedCardId&&(g.selectedCard["card-description"]=e,g.selectedCard={...g.selectedCard})});const R=f(!1),ie=f(null);function je(e){var c,u;const t=(c=e==null?void 0:e.querySelector)==null?void 0:c.call(e,".ProseMirror");if(!t)return;t.focus();const s=(u=window.getSelection)==null?void 0:u.call(window),i=document.createRange();i.selectNodeContents(t),i.collapse(!1),s==null||s.removeAllRanges(),s==null||s.addRange(i)}async function Re(){y.value&&(R.value=!0,await Ee(),je(ie.value||void 0))}function _e(){var s,i;const e=(s=L.value)==null?void 0:s.trim(),t=((i=l.value)==null?void 0:i["card-description"])??"";if(!e||e===t){R.value=!1;return}Q.mutate({card_id:_.details._id,variables:{"card-description":e}},{onSuccess:()=>{se("ticketUpdated",{cardId:_.details._id,updates:{"card-description":e}})}}),R.value=!1}function he(e){var s;if(!R.value)return;const t=e.target;(s=ie.value)!=null&&s.contains(t)||_e()}ke(()=>document.addEventListener("mousedown",he)),wt(()=>document.removeEventListener("mousedown",he));const oe=Ce({posted_on:((ye=_.details)==null?void 0:ye.posted_on)??((we=_.details)==null?void 0:we.created_at)??""}),$e=A({get:()=>oe.posted_on?new Date(oe.posted_on).toISOString().slice(0,10):"",set:e=>{oe.posted_on=e?new Date(e+"T00:00:00").toISOString():""}}),{data:le}=kt(qe.value),ne=f(l!=null&&l.value?l.value.workspace_lane_id:"");T([()=>l.value,()=>Ke.value],()=>{l!=null&&l.value&&(I.value=l==null?void 0:l.value["card-title"],L.value=l.value["card-description"],ne.value=l.value.workspace_lane_id)});const He=A(()=>((le==null?void 0:le.value)??[]).map(e=>{var t;return{_id:e._id,title:((t=e==null?void 0:e.variables)==null?void 0:t["lane-title"])??String(e._id)}}));function Ne(e){ne.value=e,Q.mutate({card_id:_.details._id,workspace_lane_id:e})}const k=f({startDate:null,endDate:null});T(()=>l.value,e=>{k.value.startDate=(e==null?void 0:e["start-date"])??null,k.value.endDate=(e==null?void 0:e["end-date"])??null},{immediate:!0,deep:!0});const re=A(()=>k!=null&&k.value.startDate&&k.value.endDate&&k.value.endDate<k.value.startDate?"End date cannot be before start date":""),Ye=e=>{k.value.startDate=e??null,Q.mutate({card_id:_.details._id,variables:{"start-date":e}})},We=e=>{k.value.endDate=e??null,Q.mutate({card_id:_.details._id,variables:{"end-date":e}})},Ge=A(()=>l==null?void 0:l.value.assigned_to),Je=e=>{Q.mutate({card_id:_.details._id,seat_id:e==null?void 0:e._id,optimisticUser:e})},Ze=A(()=>{var e;return(e=_.details)==null?void 0:e._id}),{data:Xe}=Ct(Ze),b=A(()=>{var e;return((e=Xe.value)==null?void 0:e.comments)??[]});function et(e,t){p.setQueriesData({queryKey:["sheet-list"]},s=>Array.isArray(s)?s.map(i=>{var c;return{...i,cards:(c=i.cards)==null?void 0:c.map(u=>u._id===e?t(u):u)}}):s)}const{mutate:tt,isPending:st}=Dt({onMutate:async e=>{const t=_.details._id;await p.cancelQueries({queryKey:["comments",t]}),await p.cancelQueries({queryKey:["sheet-list"]});const s=p.getQueryData(["comments",t]),i=p.getQueryData(["sheet-list"]),c={_id:Date.now().toString(),comment_text:e.payload.comment_text,commented_by:{u_full_name:"You",_id:fe.value},attachments:e.payload.attachments||[],created_at:new Date().toISOString()};return p.setQueryData(["comments",t],u=>({...u,comments:[...(u==null?void 0:u.comments)||[],c]})),et(t,u=>({...u,comments:[...u.comments||[],c],comment_count:(u.comment_count||0)+1})),{previousComments:s,previousLists:i}},onError:(e,t,s)=>{s!=null&&s.previousComments&&p.setQueryData(["comments",_.details._id],s.previousComments),s!=null&&s.previousLists&&p.setQueriesData({queryKey:["sheet-list"]},s.previousLists),console.log(e,t)},onSettled:()=>{p.invalidateQueries({queryKey:["comments",_.details._id]}),p.invalidateQueries({queryKey:["sheet-list"]}),p.invalidateQueries({queryKey:["product-card"]})}}),$=f(""),at=e=>(e??"").split(" ").map(t=>t[0]).filter(Boolean).slice(0,2).join("").toUpperCase(),it=e=>e?new Date(e).toLocaleString():"",{data:fe}=St(),ot=e=>{var t;return((t=e==null?void 0:e.created_by)==null?void 0:t._id)===fe.value},H=f(null),V=f(""),{mutate:lt,isPending:ge}=Et({onSuccess:e=>{const t=b.value.findIndex(s=>s._id===e._id);t>-1&&(b.value[t]={...b.value[t],comment_text:e.comment_text}),H.value=null,V.value="",p.invalidateQueries({queryKey:["product-card"]})}}),{mutate:nt}=It();function rt(e){H.value=e._id,V.value=e.comment_text??""}function de(){H.value=null,V.value="",U.value=!1}function dt(e){const t=V.value.trim();if(!t)return;const s=b.value.findIndex(c=>c._id===e._id),i=s>-1?{...b.value[s]}:null;s>-1&&(b.value[s]={...b.value[s],comment_text:t}),lt({id:e._id,payload:{comment_text:t}},{onError:()=>{s>-1&&i&&(b.value[s]=i)},onSuccess:c=>{s>-1&&(b.value[s]=c??b.value[s]),de(),p.invalidateQueries({queryKey:["product-card"]})}})}function ut(e){const t=b.value.findIndex(i=>i._id===e._id),s=t>-1?b.value[t]:null;t>-1&&b.value.splice(t,1),nt({id:e._id},{onError:()=>{s&&b.value.splice(t,0,s)}})}const ct=A(()=>{var e;return(e=l.value)==null?void 0:e.attachments.map(t=>{var s;return{_id:t._id??t.id??((s=crypto.randomUUID)==null?void 0:s.call(crypto))??Math.random(),name:t.name??t.filename??"file",url:t.url,kind:(t.type??t.kind??"").toLowerCase().includes("image")?"image":(t.type??t.kind??"").toLowerCase().includes("video")?"video":"file"}})}),Q=Vt({onMutate:async e=>{const{card_id:t,variables:s}=e;await p.cancelQueries({queryKey:["product-card",t]}),await p.cancelQueries({queryKey:["sheet-list"]});const i=p.getQueryData(["product-card",t]),c=p.getQueryData(["sheet-list"]),u=h=>{if(!h||h._id!==t)return h;const o={...h,variables:Array.isArray(h.variables)?[...h.variables]:[]};return s&&(Object.assign(o,s),Object.entries(s).forEach(([w,m])=>{const q=o.variables.findIndex(C=>C.slug===w);q!==-1?o.variables[q]={...o.variables[q],value:m}:o.variables.push({slug:w,value:m,type:"Text"}),w==="card-description"&&(o["card-description"]=m,o.description=m)})),e.workspace_lane_id&&(o.workspace_lane_id=e.workspace_lane_id),e.optimisticUser&&(o.seat=e.optimisticUser,o.assigned_to=e.optimisticUser),o};return p.setQueryData(["product-card",t],u),p.setQueriesData({queryKey:["sheet-list"]},h=>Array.isArray(h)?h.map(o=>{var w;return{...o,cards:(w=o.cards)==null?void 0:w.map(m=>m._id===t?u(m):m)}}):h),{previousCard:i,previousLists:c}},onSuccess:(e,t)=>{const s=t.card_id;Oe(),e&&(p.setQueryData(["product-card",s],e),p.setQueriesData({queryKey:["sheet-list"]},i=>Array.isArray(i)?i.map(c=>{var u;return{...c,cards:(u=c.cards)==null?void 0:u.map(h=>h._id===s?{...h,...e}:h)}}):i),p.invalidateQueries({queryKey:["product-card",s]}))},onError:(e,t,s)=>{if(!s)return;const i=t.card_id;p.setQueryData(["product-card",i],s.previousCard),p.setQueriesData({queryKey:["sheet-list"]},s.previousLists)},onSettled:(e,t,s)=>{const i=s.card_id;p.invalidateQueries({queryKey:["product-card",i]}),p.invalidateQueries({queryKey:["sheet-list"]})}}),P=f([]),{mutate:pt}=Qt({onSuccess:e=>{P.value=[e],p.invalidateQueries({queryKey:["product-card"]})}});function mt(e){const t=e.target.files;Array.from(t).forEach(s=>{const i=new FormData;i.append("file",s),pt(i)})}function vt(){const e=$.value.trim();if(P.value.length>0&&!e){G.value="Please write a comment when attaching files.";return}if(!e&&!P.value.length)return;const t=_.details._id;p.setQueriesData({queryKey:["sheet-list"]},s=>Array.isArray(s)?s.map(i=>({...i,cards:i.cards.map(c=>c._id===t?{...c,comment_count:(c.comment_count||0)+1}:c)})):s),tt({id:t,payload:{comment_text:e,attachments:P.value.map(s=>({name:s.data.name,url:s.data.url}))}}),$.value="",P.value=[]}const N=Ce({}),be=()=>{var e;(e=l==null?void 0:l.value)!=null&&e.variables&&(l.value.variables??[]).forEach(s=>{var c,u;if(!s||s.type!=="Select")return;const i=Array.isArray(s.data)&&s.data.length?((c=s.data[0])==null?void 0:c.value)??((u=s.data[0])==null?void 0:u._id)??s.data[0]:void 0;N[s.slug]=s.value??N[s.slug]??i??null})};ke(be),T(()=>l.value,be,{deep:!0});function xe(e,t){var i,c;N[t]=e,((c=(((i=l.value)==null?void 0:i.variables)??[]).find(u=>u.slug===t))==null?void 0:c.value)!==e&&Q.mutate({card_id:_.details._id,variables:{[t]:e}})}function _t(e){return e==="comments"&&!pe.value?(Ie.error("You do not have permission to view comments"),!1):e==="attachment"&&!Le.value?(Ie.error("You do not have permission to view attachments"),!1):!0}return(e,t)=>(r(),Tt(Y,{name:"panel",appear:""},{default:E(()=>{var s;return[J(a("div",{class:K(["flex flex-col h-full overflow-y-auto bg-gradient-to-b from-bg-card/95 to-bg-card/90 backdrop-blur rounded-[6px] shadow-[0_10px_40px_-10px_rgba(0,0,0,.5)] border border-orchit-white/5 overflow-hidden transition-all duration-300 ease-in-out",F.value?"min-w-full max-w-full":"min-w-full max-w-[380px] sm:min-w-[380px]"]),role:"complementary","aria-label":"Details panel"},[n(me)&&!n(l)?(r(),d("div",Pt,t[9]||(t[9]=[a("div",{class:"h-8 bg-orchit-white/10 rounded-xl w-3/4"},null,-1),a("div",{class:"space-y-2"},[a("div",{class:"h-4 bg-orchit-white/10 rounded w-full"}),a("div",{class:"h-4 bg-orchit-white/10 rounded w-5/6"})],-1),a("div",{class:"grid grid-cols-2 gap-4"},[a("div",{class:"h-20 bg-orchit-white/10 rounded-xl"}),a("div",{class:"h-20 bg-orchit-white/10 rounded-xl"})],-1)]))):(r(),d("div",qt,[a("div",Kt,[t[11]||(t[11]=a("h5",{class:"text-[18px] font-semibold tracking-tight"},"Details",-1)),a("div",Ot,[a("button",{class:"p-2 rounded-xl hover:bg-orchit-white/5 active:scale-[.98] cursor-pointer transition",onClick:t[0]||(t[0]=i=>F.value=!F.value),"aria-label":F.value?"Collapse details":"Expand details"},[a("i",{class:K(["fa-solid",F.value?"fa-compress":"fa-expand","text-lg"])},null,2)],8,Mt),a("button",{class:"p-2 rounded-xl hover:bg-orchit-white/5 active:scale-[.98] cursor-pointer transition",onClick:t[1]||(t[1]=()=>{se("close"),se("closeSidePanel")}),"aria-label":"Close details"},t[10]||(t[10]=[a("i",{class:"fa-solid fa-xmark text-lg"},null,-1)]))])]),a("div",zt,[(r(!0),d(D,null,O((s=n(l))==null?void 0:s.variables,(i,c)=>(r(),d(D,{key:i.slug||`var-${c}`},[(i==null?void 0:i.type)==="Select"&&i.slug=="card-type"?(r(),d("div",Bt,[a("div",Ft,v(i.title),1),x(n(X),{disabled:!n(y),size:"sm",options:i==null?void 0:i.data.map(u=>({_id:u,title:u})),placeholder:"Select option",allowCustom:!1,"model-value":N[i.slug],"onUpdate:modelValue":u=>xe(u,i.slug)},null,8,["disabled","options","model-value","onUpdate:modelValue"])])):S("",!0)],64))),128)),a("div",jt,[x(Y,{name:"fade-scale",mode:"out-in"},{default:E(()=>[U.value?J((r(),d("input",{disabled:!n(y),title:n(y)?"":"You do not have permission to edit this card",key:"title-edit",ref_key:"titleInput",ref:ve,"onUpdate:modelValue":t[2]||(t[2]=i=>I.value=i),onKeydown:[De(Se(Fe,["prevent"]),["enter"]),De(Se(de,["prevent"]),["esc"])],class:"w-full text-2xl font-semibold rounded-xl px-3 py-2 bg-orchit-white/5 border border-orchit-white/10 focus:outline-none focus:ring-2 focus:ring-accent/40 transition",type:"text","aria-label":"Edit title"},null,40,Rt)),[[ue,I.value]]):(r(),d("h1",{key:"title-view",class:K([n(y)?"cursor-text":"cursor-not-allowed","text-[20px] leading-[28px] font-semibold tracking-tight rounded-lg px-2 py-1 hover:bg-orchit-white/5 transition"]),onClick:t[3]||(t[3]=i=>Be()),"aria-label":"Card title",title:n(y)?"":"You do not have permission to edit this card"},v(I.value||"Untitled"),11,$t))]),_:1})]),a("div",null,[t[12]||(t[12]=a("h3",{class:"mb-2 text-base font-semibold tracking-wide px-1"}," Description ",-1)),x(Y,{name:"fade-scale",mode:"out-in"},{default:E(()=>[R.value?(r(),d("div",{key:"desc-edit",ref_key:"descEditorWrap",ref:ie,class:"rounded-xl overflow-hidden border border-orchit-white/10 shadow-sm"},[x(n(Qe),{modelValue:L.value,"onUpdate:modelValue":t[4]||(t[4]=i=>L.value=i),onFocusOut:_e},null,8,["modelValue"])],512)):(r(),d("div",{key:"desc-view",class:K(["text-[15px] leading-6 text-text-secondary whitespace-pre-wrap rounded-xl px-4 py-3 border border-orchit-white/10 bg-orchit-white/5 hover:border-orchit-white/20 transition",n(y)?"cursor-text":"cursor-not-allowed"]),disabled:!n(y),onClick:Re},[L.value?(r(),d("div",{key:0,innerHTML:L.value},null,8,Nt)):(r(),d("span",Yt,"Click to add a description…"))],10,Ht))]),_:1})]),x(n(Ae),{modelValue:j.value,"onUpdate:modelValue":t[5]||(t[5]=i=>j.value=i),options:Me,size:"md",beforeChange:_t},null,8,["modelValue"]),x(Y,{name:"section",mode:"out-in"},{default:E(()=>{var i,c,u,h;return[j.value==="details"?(r(),d("section",Wt,[a("div",Gt,[a("div",Jt,[t[13]||(t[13]=a("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," Posted On ",-1)),a("div",Zt,v($e.value),1)]),a("div",Xt,[t[14]||(t[14]=a("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," ID ",-1)),a("div",es,v(B.details["card-code"]),1)])]),a("div",ts,[a("div",ss,[t[15]||(t[15]=a("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," Lane ",-1)),x(n(X),{disabled:!n(y),size:"sm",options:He.value,placeholder:"Select lane",allowCustom:!1,"model-value":ne.value,"onUpdate:modelValue":Ne},null,8,["disabled","options","model-value"])]),a("div",as,[t[16]||(t[16]=a("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," Assign ",-1)),x(n(Te),{disabled:!n(Pe),onAssign:t[6]||(t[6]=o=>Je(o)),assigneeId:Ge.value,seat:n(l).seat},null,8,["disabled","assigneeId","seat"])]),B.pin?S("",!0):(r(),d(D,{key:0},[a("div",is,[t[18]||(t[18]=a("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," Start Date ",-1)),a("div",os,[t[17]||(t[17]=a("i",{class:"fa-regular fa-calendar"},null,-1)),x(n(ce),{disabled:!n(y),placeholder:"Set start date",class:"w-full","model-value":k.value.startDate,"emit-as":"ymd","onUpdate:modelValue":Ye},null,8,["disabled","model-value"])])]),a("div",ls,[t[20]||(t[20]=a("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," Target End ",-1)),a("div",{class:K(["h-8 px-3 flex items-center gap-2 rounded-lg bg-bg-input border transition-colors",re.value?"border-red-500":"border-orchit-white/10"])},[t[19]||(t[19]=a("i",{class:"fa-regular fa-calendar"},null,-1)),x(n(ce),{disabled:!n(y),placeholder:"Set end date",class:"w-full","model-value":k.value.endDate,"emit-as":"ymd","onUpdate:modelValue":We},null,8,["disabled","model-value"])],2),re.value?(r(),d("p",ns,v(re.value),1)):S("",!0)])],64)),n(me)?(r(),d(D,{key:1},[t[21]||(t[21]=a("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),t[22]||(t[22]=a("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),t[23]||(t[23]=a("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),t[24]||(t[24]=a("div",{class:"bg-bg-surface/40 w-full animate-pulse h-6 p-1"},null,-1))],64)):(i=n(l))!=null&&i.variables?(r(!0),d(D,{key:2},O((c=n(l))==null?void 0:c.variables,(o,w)=>(r(),d(D,{key:o.slug||`var-${w}`},[o.type==="Select"&&o.slug!=="card-type"&&o.slug!=="ok"&&o.slug!=="process"?(r(),d("div",rs,[a("div",ds,v(o.title),1),x(n(X),{disabled:!n(y),size:"sm",options:o==null?void 0:o.data.filter(m=>m!=="ok"&&m!=="process").map(m=>({_id:m,title:m})),placeholder:"Select option",allowCustom:!1,"model-value":N[o.slug],"onUpdate:modelValue":m=>xe(m,o.slug)},null,8,["disabled","options","model-value","onUpdate:modelValue"])])):S("",!0)],64))),128)):S("",!0)])])):j.value==="history"?(r(),d("section",us,[a("div",null,[t[27]||(t[27]=a("h3",{class:"text-sm font-semibold tracking-wide mb-3"}," History ",-1)),a("ol",cs,[(r(!0),d(D,null,O((u=n(l))==null?void 0:u.history,(o,w)=>(r(),d("li",{key:w,class:"group"},[t[26]||(t[26]=a("span",{class:"absolute -left-[5px] top-0 w-2 h-2 rounded-full bg-accent/70 ring-4 ring-accent/10"},null,-1)),a("div",ps,[a("span",ms,v(o.user.u_full_name),1),t[25]||(t[25]=a("span",{class:"text-text-secondary"}," changed ",-1)),a("span",vs,v(o.field_name),1)])]))),128))])])])):j.value==="comments"?(r(),d("section",_s,[(r(!0),d(D,null,O(b.value??[],o=>{var w,m,q;return r(),d("div",{key:o._id,class:"rounded-xl border border-orchit-white/10 bg-orchit-white/5 p-4 hover:bg-orchit-white/7 transition"},[a("div",hs,[a("div",fs,v(at((w=o.commented_by)==null?void 0:w.u_full_name)),1),a("div",gs,[a("div",bs,v((m=o.commented_by)==null?void 0:m.u_full_name),1),a("div",xs,v(it(o.created_at)),1)]),ot(o)?(r(),d("div",ys,[H.value!==o._id?(r(),d("button",{key:0,disabled:!n(W),class:"text-xs text-accent hover:underline",onClick:C=>rt(o)}," Edit ",8,ws)):S("",!0),a("button",{disabled:!n(Ue),class:"text-xs text-red-400 hover:underline",onClick:C=>ut(o)}," Delete ",8,ks)])):S("",!0)]),x(Y,{name:"fade",mode:"out-in"},{default:E(()=>[H.value!==o._id?(r(),d("p",{key:`c-view-${o._id}`,class:"text-[15px] leading-6"},v(o.comment_text),1)):(r(),d("div",{key:`c-edit-${o._id}`,class:"space-y-2"},[J(a("textarea",{"onUpdate:modelValue":t[7]||(t[7]=C=>V.value=C),rows:"3",class:"w-full p-3 rounded-lg bg-bg-input/80 border border-orchit-white/10 focus:ring-2 focus:ring-accent/40 outline-none"},null,512),[[ue,V.value]]),a("div",Cs,[x(n(ee),{variant:"secondary",size:"sm",onClick:de},{default:E(()=>t[28]||(t[28]=[Z("Cancel")])),_:1,__:[28]}),x(n(ee),{class:"btn",size:"sm",onClick:C=>dt(o),disabled:!V.value.trim()||n(ge)||!n(W)},{default:E(()=>[Z(v(n(ge)?"Saving…":"Save"),1)]),_:2},1032,["onClick","disabled"])])]))]),_:2},1024),(q=o==null?void 0:o.attachments)!=null&&q.length?(r(),d("div",Ds,[(r(!0),d(D,null,O(o.attachments,(C,ht)=>(r(),d("a",{key:ht,href:C.url,target:"_blank",class:"group flex items-center gap-2 rounded-lg border border-orchit-white/10 bg-orchit-white/5 px-2 py-1 hover:bg-orchit-white/10 transition"},[t[29]||(t[29]=a("i",{class:"fa-regular fa-file text-text-secondary group-hover:text-text-primary transition"},null,-1)),a("span",Es,v(C==null?void 0:C.name),1)],8,Ss))),128))])):S("",!0)])}),128)),a("div",Is,[J(a("textarea",{disabled:!n(te)||!n(W),"onUpdate:modelValue":t[8]||(t[8]=o=>$.value=o),rows:"3",class:K([n(te)||n(W)?"cursor-text":"cursor-not-allowed","w-full p-3 bg-transparent outline-none text-sm"]),placeholder:"Write a comment",onFocus:ze},null,42,Vs),[[ue,$.value]]),a("div",Qs,[a("input",{type:"file",multiple:"",onChange:mt,class:"max-w-full text-ellipsis text-xs text-text-secondary file:mr-3 col-span-2 file:px-3 file:py-1.5 file:rounded-md file:border file:border-orchit-white/10 file:bg-orchit-white/10 hover:file:bg-orchit-white/15 file:text-text-primary transition inline w-fit"},null,32),x(n(ee),{variant:"primary",class:"min-w-[70px]",size:"sm",onClick:vt,disabled:!$.value.trim()&&!P.value.length||!n(te)},{default:E(()=>[Z(v(n(st)?"Posting…":"Post"),1)]),_:1},8,["disabled"])])]),G.value?(r(),d("div",Ts,v(G.value),1)):S("",!0)])):(r(),d("section",As,[a("div",Us," Files attached to this "+v(((h=B.details)==null?void 0:h.type)??"item")+". ",1),a("div",Ls,[(r(!0),d(D,null,O(ct.value,o=>(r(),d("div",{key:o._id,class:"rounded-2xl overflow-hidden border border-orchit-white/10 bg-orchit-white/5 hover:bg-orchit-white/8 transition group"},[a("div",Ps,[o.kind==="image"?(r(),d("div",qs,[a("img",{src:o.url,class:"w-full h-40 object-cover group-hover:scale-[1.02] transition"},null,8,Ks)])):o.kind==="video"?(r(),d("div",Os,[a("video",{src:o.url,controls:"",class:"w-full h-40 object-cover"},null,8,Ms)])):(r(),d("div",zs,t[30]||(t[30]=[a("i",{class:"fa-regular fa-file text-3xl text-text-secondary"},null,-1)]))),a("div",Bs,[a("div",Fs,v(o.name),1),a("div",js,v(o.kind),1)])]),a("div",Rs,[a("a",{href:o.url,target:"_blank",rel:"noopener",class:"w-full inline-flex items-center justify-center gap-2 h-9 rounded-lg bg-accent text-orchit-white text-sm hover:opacity-90 transition"},t[31]||(t[31]=[a("i",{class:"fa-regular fa-arrow-up-right-from-square"},null,-1),Z(" View ")]),8,$s)])]))),128))])]))]}),_:1})])]))],2),[[At,B.showPanel]])]}),_:1}))}}),Ws=Ut(Hs,[["__scopeId","data-v-4ec3940b"]]);export{Ws as default};
