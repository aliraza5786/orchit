import{d as G,c as f,j as v,F as B,y as K,o as p,f as e,ah as ue,t as S,O as me,m as se,J as pe,N as ve,K as fe,n as q,an as ge,r as j,e as Y,Y as be,w as A,aA as _e,i as R,k as Z,I as oe,p as I,z as Q,D as xe,ao as ke,B as X,g as ee,U as M,aB as le,ac as _,aC as he,aD as we,u as ye,ag as Ce}from"./index-BCXm2D5k.js";import{f as Ie}from"./FormatDate-DIyppjZM.js";import{_ as $e}from"./BaseEmailChip.vue_vue_type_script_setup_true_lang-C6NaFIJW.js";import{u as je,a as Pe,b as Se}from"./usePeople-C-nuC1AB.js";import{a as Ve}from"./usePackages-DmUleHZp.js";import{f as ze}from"./permissionUtils-fD2X1oS-.js";const We=["aria-busy"],Ue=["onClick","aria-label"],Re=["src"],Ee={class:"flex justify-between gap-2.5 border-t border-border bg-bg-card p-3.5 text-sm"},Te={class:"flex items-start gap-2.5"},De=["src"],Le={class:"min-w-0"},Ne={class:"truncate text-sm font-medium text-text-primary w-20"},qe={class:"truncate text-xs text-text-secondary"},Ae={class:"truncate text-sm font-medium text-text-primary w-30 text-end"},Be={key:1,class:"grid grid-cols-1 gap-5 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4"},Fe={key:2,class:"col-span-full flex items-center justify-center py-10 text-sm text-text-secondary"},Me=G({__name:"ProjectGallery",props:{projects:{},loading:{type:Boolean,default:!1},skeletonCount:{default:8}},setup(F){const E=F,w=se(),V=f(()=>E.skeletonCount??8),y=r=>{var u;return((u=r==null?void 0:r.variables)==null?void 0:u.title)||(r==null?void 0:r.title)||"Untitled"};function g(r){if(!r)return"—";const u=new Date(r);return Number.isNaN(+u)?"—":new Intl.DateTimeFormat(void 0,{dateStyle:"medium",timeStyle:"short"}).format(u)}function t(r){let u=0;for(let m=0;m<((r==null?void 0:r.length)||0);m++)u=u*31+r.charCodeAt(m)|0;const n=Math.abs(u)%360;return`linear-gradient(135deg, hsl(${n} 55% 55%), hsl(${n} 60% 48%))`}function b(r){return t(y(r))}function z(r){var n;const u=(n=r==null?void 0:r.LatestTask)==null?void 0:n.job_id;u?localStorage.setItem("jobId",u):localStorage.removeItem("jobId"),w.push(`/workspace/peak/${r._id}/${u??""}`)}return(r,u)=>{var n;return!r.loading&&((n=r.projects)!=null&&n.length)?(p(),v("section",{key:0,class:"grid grid-cols-1 gap-5 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4","aria-busy":r.loading?"true":"false","aria-live":"polite"},[(p(!0),v(B,null,K(r.projects,(m,x)=>{var W;return p(),v("article",{key:m._id??x,class:"group relative overflow-hidden rounded-xl cursor-pointer border border-border/70 bg-bg-card shadow-sm outline-none transition-all duration-200 hover:shadow-md focus-within:ring-2 focus-within:ring-orange-300"},[e("button",{type:"button",class:"absolute inset-0 z-10",onClick:D=>z(m),"aria-label":`Open project ${y(m)}`},null,8,Ue),e("div",{class:"flex h-39 items-center justify-center",style:ue({background:b(m)})},[e("img",{src:m.logo,class:"aspect-square h-10 w-10 rounded-md object-cover",alt:"",loading:"lazy",decoding:"async"},null,8,Re)],4),e("div",Ee,[e("div",Te,[e("img",{src:m.logo,class:"h-6 w-6 rounded-md object-cover",alt:"",loading:"lazy",decoding:"async"},null,8,De),e("div",Le,[e("h3",Ne,S(y(m)),1),e("p",qe,S(g(m.created_at)),1)])]),e("div",null,[e("h3",Ae,S((W=m.owner)==null?void 0:W.name),1),u[0]||(u[0]=e("p",{class:"truncate text-xs text-text-secondary text-end"},"Workspace Owner",-1))])])])}),128))],8,We)):r.loading?(p(),v("section",Be,[(p(!0),v(B,null,K(V.value,m=>(p(),v("div",{key:"sk-"+m,class:"overflow-hidden rounded-xl border border-border/70 bg-bg-card shadow-sm",role:"status","aria-label":"Loading project"},u[1]||(u[1]=[me('<div class="h-39 bg-[linear-gradient(90deg,theme(colors.slate.200/20),theme(colors.slate.200/40),theme(colors.slate.200/20))] bg-[length:200%_100%] animate-[shimmer_1.1s_ease_infinite]" data-v-3a990292></div><div class="flex items-start gap-2.5 border-t border-border p-3.5 text-sm" data-v-3a990292><div class="h-6 w-6 rounded-md bg-surface" data-v-3a990292></div><div class="flex w-full flex-col gap-2" data-v-3a990292><div class="h-3 w-32 rounded bg-surface" data-v-3a990292></div><div class="h-2.5 w-20 rounded bg-surface" data-v-3a990292></div></div></div>',2)])))),128))])):(p(),v("div",Fe," No projects yet "))}}}),Ke=pe(Me,[["__scopeId","data-v-3a990292"]]),Oe={class:"px-6 flex flex-col gap-4"},Qe={key:0,class:"w-full mt-2"},Ge=["onClick"],He={class:"text-sm font-medium text-text-primary"},Je={key:0,class:"py-2 border-t border-border bg-bg-input"},Ye=["value"],Ze={class:"text-xs font-medium text-text-primary"},Xe={class:"text-[11px] text-text-secondary leading-tight"},es={class:"flex justify-end gap-2 p-6 mt-6 sticky bottom-0 bg-bg-body border-t border-border"},ss=G({__name:"InviteUsersWithPermissions",props:{modelValue:{type:Boolean,default:!1},defaultWorkspaceId:{}},emits:["update:modelValue","invited"],setup(F,{emit:E}){const w=E,V=F,y=f({get:()=>V.modelValue,set:s=>w("update:modelValue",s)}),g=ve(),t=fe({workspace_id:null,role_id:null,emails:[],additional_seats:1,workspace_access_role_id:null});q(()=>V.defaultWorkspaceId,s=>{s&&(t.workspace_id=s,t.role_id=null)},{immediate:!0});const b=f(()=>t.workspace_id??void 0),{data:z,isLoading:r}=je(b,{enabled:f(()=>!!t.workspace_id)}),u=f(()=>(z.value||[]).map(s=>({_id:s._id,title:s.title})));q(z,s=>{console.log(s,"workspace roles.......")});const{data:n}=ge(b,{enabled:f(()=>!!t.workspace_id)}),m=f(()=>{var s;return((s=n.value)==null?void 0:s.company_id)??null}),{data:x,refetch:W,isLoading:D}=Pe({company_id:m,workspace_id:b},{enabled:f(()=>!!m.value&&!!b.value)});q(b,()=>{b.value&&m.value&&W()});const T=f(()=>(x.value||[]).map(s=>({_id:s._id,title:s.title})));q(T,s=>{s&&s.length>0&&t.role_id});const k=f(()=>!x.value||!t.workspace_access_role_id?null:x.value.find(s=>s._id===t.workspace_access_role_id)),L=j({}),U=j([]),{mutate:l}=Ve();function o(s){L.value[s]=!L.value[s]}q(k,s=>{if(!s){U.value=[];return}const i=[];s.permission_categories.forEach(d=>{d.permissions.forEach(a=>{a.enabled&&i.push(a._id)})}),U.value=i},{immediate:!0});function c(s){t.workspace_access_role_id=s}function C(){var d;if(!((d=k.value)!=null&&d._id))return;const s=[];k.value.permission_categories.forEach(a=>{a.permissions.forEach(h=>s.push(h))});const i=ze(s,U.value);l({roleId:k.value._id,payload:{title:k.value.title,description:k.value.description,is_admin:k.value.is_admin,is_editor:k.value.is_editor,is_viewer:k.value.is_viewer,permission_ids:i.permission_ids,module_permissions:i.module_permissions,workspace_id:t.workspace_id}},{onSuccess:()=>{M.success("Permissions updated successfully"),g.invalidateQueries({queryKey:["workspace-roles"]})},onError:a=>{console.error("Failed to update permissions",a),M.error("Failed to update permissions")}})}const P=f(()=>t.workspace_access_role_id?"":"Role is required"),$=f(()=>{const s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.emails.filter(i=>!s.test(i))}),H=f(()=>$.value.length?`Invalid: ${$.value.join(", ")}`:""),N=f(()=>!!t.workspace_id&&!!t.role_id&&!!t.workspace_access_role_id&&t.emails.length>0&&$.value.length===0);f(()=>{var s;return((s=x.value)==null?void 0:s.find(i=>i._id===t.workspace_access_role_id))||null});function re(s){}function ie(){}const{mutate:ne,isPending:J}=Se();function de(){if(!N.value||J.value)return;const i=t.emails.map(d=>({name:ce(d),email:d}))[0];ne({id:t.role_id,payload:{name:i.name,email:i.email,workspace_id:t.workspace_id,workspace_access_role_id:t.workspace_access_role_id,role_id:t.role_id,additional_seats:1}},{onSuccess:d=>{var a,h;(a=d==null?void 0:d.failedInvites)!=null&&a.length?M.error(((h=d.failedInvites[0])==null?void 0:h.error)??"Some invites failed"):M.success("Invitations sent"),g.invalidateQueries({queryKey:["all-users"]}),g.invalidateQueries({queryKey:["people-lists"]}),g.invalidateQueries({queryKey:["workspaceRoles"]}),g.invalidateQueries({queryKey:["workspaces"]}),g.invalidateQueries({queryKey:["people"]}),g.invalidateQueries({queryKey:["dashboard-teams"]}),w("invited",d),ae(),y.value=!1},onError:d=>{var h,O;const a=((O=(h=d==null?void 0:d.response)==null?void 0:h.data)==null?void 0:O.message)||(d==null?void 0:d.message)||"Failed to send invitations.";M.error(a)}})}function te(){ae(),y.value=!1}function ae(){t.role_id=null,t.emails=[]}function ce(s){const d=(s.split("@")[0]||"").split("+")[0].split(/[^a-zA-Z]+/).filter(Boolean);return d.length?d.map(a=>a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()).join(" "):s}return(s,i)=>(p(),Y(be,{modelValue:y.value,"onUpdate:modelValue":i[3]||(i[3]=d=>y.value=d),size:"md",modalClass:"!py-0"},{default:A(()=>{var d;return[e("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[i[5]||(i[5]=e("h2",{class:"text-xl font-semibold"},"Invite Users",-1)),i[6]||(i[6]=e("p",{class:"text-sm text-text-secondary mt-1"}," Add emails, workspace role and pick role based permission. ",-1)),e("button",{onClick:te,class:"absolute top-4 cursor-pointer right-4 text-text-secondary hover:text-text-primary text-xl z-10"},i[4]||(i[4]=[e("img",{"data-v-4ef80912":"",src:_e,alt:""},null,-1)]))]),e("div",Oe,[R($e,{class:"w-full",label:"User emails",modelValue:t.emails,"onUpdate:modelValue":i[0]||(i[0]=a=>t.emails=a),error:!!H.value,message:H.value||"Press Enter after each email",showName:"",onInvalid:re,onAdd:ie},null,8,["modelValue","error","message"]),R(oe,{size:"md",label:"Team Role",options:u.value,placeholder:"Choose team role","model-value":t.role_id,loading:I(r),"onUpdate:modelValue":i[1]||(i[1]=a=>t.role_id=a)},null,8,["options","model-value","loading"]),R(oe,{size:"md",label:"Workspace Role",options:T.value,placeholder:"Choose workspace role","model-value":t.workspace_access_role_id,"onUpdate:modelValue":c,disabled:!t.workspace_id,message:P.value,error:!!P.value,loading:I(D)||!m.value},null,8,["options","model-value","disabled","message","error","loading"]),k.value&&!k.value.is_admin?(p(),v("div",Qe,[i[7]||(i[7]=e("h2",{class:"text-base font-medium mb-1 flex items-center text-text-primary"}," Permissions ",-1)),(p(!0),v(B,null,K((d=k.value)==null?void 0:d.permission_categories,a=>(p(),v("div",{key:a==null?void 0:a.category,class:"border border-border mb-2 rounded-lg overflow-hidden bg-bg-surface/30"},[e("button",{onClick:h=>o(a==null?void 0:a.category),class:"w-full px-3 py-2 flex justify-between items-center hover:bg-bg-surface transition"},[e("span",He,S(a==null?void 0:a.category_title),1),e("i",{class:Q(["fa-solid fa-chevron-down text-xs text-text-secondary transition-transform",L.value[a==null?void 0:a.category]?"rotate-180":""])},null,2)],8,Ge),L.value[a==null?void 0:a.category]?(p(),v("div",Je,[(p(!0),v(B,null,K(a==null?void 0:a.permissions,h=>(p(),v("div",{key:h._id,class:"flex items-start gap-2 hover:bg-bg-body py-2 px-3"},[xe(e("input",{type:"checkbox","onUpdate:modelValue":i[2]||(i[2]=O=>U.value=O),value:h._id,onChange:C,class:"h-4 w-4 mt-0.5 rounded border-border accent-accent cursor-pointer flex-shrink-0"},null,40,Ye),[[ke,U.value]]),e("div",null,[e("p",Ze,S(h.title),1),e("p",Xe,S(h.description),1)])]))),128))])):Z("",!0)]))),128))])):Z("",!0)]),e("div",es,[R(X,{variant:"secondary",onClick:te},{default:A(()=>i[8]||(i[8]=[ee("Cancel")])),_:1,__:[8]}),R(X,{variant:"primary",disabled:!N.value||I(J),onClick:de},{default:A(()=>[ee(S(I(J)?"Inviting…":"Send Invites"),1)]),_:1},8,["disabled"])])]}),_:1},8,["modelValue"]))}}),ts={class:"flex -space-x-2"},as=G({__name:"WorkspaceListTable",setup(F){const E=se(),w=new Map,V=l=>(w.has(l)||w.set(l,Ie(l)),w.get(l)),y=l=>{var C;const o=l.row,c=(C=o==null?void 0:o.LatestTask)==null?void 0:C.job_id;c?localStorage.setItem("jobId",c):localStorage.removeItem("jobId"),E.push(`/workspace/peak/${o==null?void 0:o._id}/${c||""}`)},g=j(!1),t=j(void 0),b=l=>{t.value=l,g.value=!0},x=[{key:"variables",label:"Project",render:({row:l,value:o})=>_("div",{class:"flex items-center gap-2"},[l.logo?_("img",{src:l.logo,alt:(o==null?void 0:o.title)||"Project",class:"h-8 w-8 bg-bg-card rounded-full object-cover",loading:"lazy",decoding:"async"}):_("div",{class:"h-8 w-8 rounded-full bg-bg-card"}),_("span",{class:"cursor-pointer hover:underline",onClick:c=>{c.stopPropagation(),y({row:l})}},(o==null?void 0:o.title)||"Untitled")])},{key:"variables",label:"Project type",render:({value:l})=>_("span",{class:"capitalize"},(l==null?void 0:l["workspace-type"])||"-")},{key:"People",label:"People",render:({row:l,value:o})=>_("div",{class:"flex items-center -space-x-3"},[_(we,{avatars:o||[],image:!0,maxVisible:3}),_("button",{class:l.has_permission_to_manage_user?"flex justify-center items-center rounded-full border border-border text-xs bg-bg-dropdown cursor-pointer hover:bg-bg-dropdown-menu-hover transition  h-8 w-8 cursor-pointer":"hidden",onClick:c=>{c.stopPropagation(),b(l._id)},title:"Invite Users"},[_("i",{class:"fa-solid fa-plus text-gray-500 text-xs"})])])},{key:"created_at",label:"Start Date",render:({value:l})=>_("span",V(l))},{key:"admin",label:"Workspace Owner",render:({row:l})=>{const o=l==null?void 0:l.owner;if(!o)return _("span","-");const c=P=>P.split(" ").map($=>$[0]).join("").toUpperCase(),C=P=>{let $=0;for(let N=0;N<P.length;N++)$=P.charCodeAt(N)+(($<<5)-$);return`hsl(${Math.abs($)%360}, 60%, 50%)`};return _("div",{class:"flex items-center gap-2"},[o.profile_img?_("img",{src:o.profile_img,alt:o.name,class:"h-6 w-6 rounded-full object-cover",loading:"lazy",decoding:"async"}):_("div",{class:"h-8 w-8 border-primary border-2 shadow-md flex items-center justify-center rounded-full text-white text-xs font-medium",style:{backgroundColor:C(o.name)}},c(o.name)),_("span",o.name)])}}],W=j(1),D=j(10),{data:T,isPending:k}=le(W,D),L=f(()=>{var l;return((l=T.value)==null?void 0:l.workspaces)??[]}),U=j(0);return q(T,()=>{var l,o,c,C;(o=(l=T.value)==null?void 0:l.pagination)!=null&&o.totalCount&&(U.value=(C=(c=T.value)==null?void 0:c.pagination)==null?void 0:C.totalCount)}),(l,o)=>(p(),v(B,null,[R(he,{columns:x,rows:L.value,loading:I(k),total:U.value,page:W.value,"onUpdate:page":o[0]||(o[0]=c=>W.value=c),pageSize:D.value,"onUpdate:pageSize":o[1]||(o[1]=c=>D.value=c),pageSizes:[10,20,50,100]},{status:A(({row:c})=>[e("span",{class:Q(["px-3 py-1 rounded-full text-xs font-medium",{"bg-blue-100 text-blue-600":c.status==="In progress","bg-red-100 text-red-600":c.status==="Live","bg-green-100 text-green-600":c.status==="Done"}])},S(c.status),3)]),team:A(({row:c})=>[e("div",ts,[(p(!0),v(B,null,K(c.Roles,(C,P)=>(p(),v("span",{key:P,class:"w-6 h-6 flex items-center justify-center rounded-full bg-gray-200 text-xs"},S(C),1))),128))])]),_:1},8,["rows","loading","total","page","pageSize"]),R(ss,{modelValue:g.value,"onUpdate:modelValue":o[2]||(o[2]=c=>g.value=c),defaultWorkspaceId:t.value},null,8,["modelValue","defaultWorkspaceId"])],64))}}),os={class:"w-full bg-bg-body text-text-primary"},ls={class:"mx-auto w-full max-w-[1440px] px-5 py-10 md:px-15 md:py-20"},rs={class:"flex flex-wrap items-center justify-between gap-5"},is={class:"flex items-center gap-3"},ns={class:"mt-21 mb-8 flex items-center justify-between"},ds={class:"flex items-center gap-3"},cs={key:0,class:"flex items-center justify-center py-10 text-sm text-text-secondary"},bs=G({__name:"Home",setup(F){const E=se(),w=ye();Ce(()=>{console.log(w.limits,"limit  ")});const V=j(1),y=j(10),{data:g,isPending:t}=le(V,y),b=j("list"),z=u=>{b.value=u},r=f(()=>g.value.length===0);return(u,n)=>{var m;return p(),v("div",os,[e("div",ls,[e("div",rs,[n[4]||(n[4]=e("div",{class:"flex flex-col gap-1.5 max-md:gap-1"},[e("h1",{class:"text-2xl font-medium"},"Welcome to Orchit AI!"),e("p",{class:"text-sm text-text-secondary"},"Create, organize, and collaborate seamlessly.")],-1)),e("div",is,[e("div",{to:"/create-workspace",onClick:n[0]||(n[0]=()=>{const x=I(w).getFeature("no-of-workspaces");x&&x.usage.current>=x.limits.limit?I(w).setLimitExccedModal(!0):I(E).push("/create-workspace")})},[R(X,{variant:"primary"},{default:A(()=>n[3]||(n[3]=[ee("Create a workspace")])),_:1,__:[3]})])])]),e("div",ns,[n[7]||(n[7]=e("h2",{class:"text-xl font-medium"},"All Workspaces",-1)),e("div",ds,[e("button",{class:Q(["aspect-square w-8 cursor-pointer rounded-md p-1",b.value==="list"?"text-accent bg-accent-text":" hover:bg-border/50 backdrop-blur-2xl  transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),onClick:n[1]||(n[1]=x=>z("list")),title:"List view"},n[5]||(n[5]=[e("i",{class:"fa-solid fa-align-left"},null,-1)]),2),e("button",{class:Q(["aspect-square w-8 cursor-pointer rounded-md p-1",b.value==="gallery"?"text-accent bg-accent-text":"hover:bg-border/50 backdrop-blur-2xl  transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),onClick:n[2]||(n[2]=x=>z("gallery")),title:"Gallery view"},n[6]||(n[6]=[e("i",{class:"fa-solid fa-grid-2"},null,-1)]),2)])]),!I(t)&&r.value?(p(),v("div",cs," No Workspace ")):b.value==="list"?(p(),Y(as,{key:1})):b.value==="gallery"?(p(),Y(Ke,{key:2,projects:(m=I(g))==null?void 0:m.workspaces,loading:I(t)},null,8,["projects","loading"])):Z("",!0)])])}}});export{bs as default};
