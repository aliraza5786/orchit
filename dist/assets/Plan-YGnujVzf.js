const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CreateTaskModal-Dbd3M0PQ.js","assets/CreateTaskModal.vue_vue_type_script_setup_true_lang-Cd7NkeR7.js","assets/index-kEjyrjW8.js","assets/index-mxm5J2oP.css","assets/ConfirmDeleteModal-DK2d8R8b.js","assets/ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-23WwnWny.js","assets/SidePanel-C8ojWx4u.js","assets/SidePanel-B4A8_x0T.css","assets/KanbanBoard-BQchLTG4.js","assets/DropMenu.vue_vue_type_script_setup_true_lang-DCSCkWRb.js","assets/workspace-CIhEXWTd.js","assets/KanbanBoard-CJVPdV8K.css"])))=>i.map(i=>d[i]);
import{J as be,K as Be,L as Y,n as v,r as B,m as K,M as ge,c as E,N as Se,d as ye,O as Je,i as h,e,g as he,y as Q,b as G,T as Qe,w as A,t as I,P as We,o as m,Q as mt,R as ft,f as W,h as F,_ as Xe,B as re,S as Fe,j as X,U as Ae,A as qe,V as vt,a as Ne,W as Ye,X as gt,Y as et,Z as bt,$ as tt,a0 as yt,F as _e,x as Pe,G as je,C as He,a1 as xt,a2 as kt,a3 as _t,a4 as St,a5 as Ue,a6 as Oe,p as ht,a7 as Ct}from"./index-kEjyrjW8.js";import{K as wt,D as Dt}from"./KanbanSkeleton-DajrmYKF.js";import{_ as Vt}from"./SearchBar.vue_vue_type_script_setup_true_lang-BaJ4I6ya.js";import{_ as Tt}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-23WwnWny.js";import{u as $t}from"./workspace-CIhEXWTd.js";const Lt="data:image/svg+xml,%3csvg%20width='60'%20height='46'%20viewBox='0%200%2060%2046'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20opacity='0.4'%3e%3cpath%20d='M59.7443%2034.8967L50.5682%2025.7206C50.4457%2025.5984%2050.2897%2025.5152%2050.1199%2025.4816C49.9501%2025.4479%2049.7742%2025.4653%2049.6143%2025.5315C49.4544%2025.5976%2049.3176%2025.7097%2049.2213%2025.8535C49.125%2025.9973%2049.0734%2026.1664%2049.073%2026.3394V30.517H25.9775V40.5114H49.0755V44.689C49.0759%2044.8621%2049.1275%2045.0312%2049.2238%2045.175C49.3201%2045.3187%2049.4569%2045.4308%2049.6168%2045.497C49.7767%2045.5632%2049.9527%2045.5805%2050.1224%2045.5468C50.2922%2045.5132%2050.4482%2045.43%2050.5708%2045.3078L59.7468%2036.1318C59.9095%2035.9672%2060.0005%2035.7451%2060.0001%2035.5137C59.9996%2035.2823%2059.9076%2035.0605%2059.7443%2034.8967Z'%20fill='%23C6DBA9'/%3e%3cpath%20d='M32.3149%2030.5293C30.664%2031.5967%2028.7394%2032.1633%2026.7734%2032.1609V40.5237H34.7295C39.2829%2038.5638%2042.9649%2035.0102%2045.0851%2030.5293H32.3149Z'%20fill='url(%23paint0_linear_250_16424)'/%3e%3cpath%20d='M46.2209%2020.2832C46.2317%2015.0884%2044.2448%2010.0884%2040.6714%206.3179C37.0981%202.54738%2032.2119%200.295026%2027.024%200.0269855C21.8362%20-0.241055%2016.7439%201.49574%2012.801%204.87791C8.85809%208.26009%206.36647%2013.0287%205.84178%2018.1969L2.46233%2017.8913C2.31055%2017.8782%202.15829%2017.9103%202.02467%2017.9835C1.89106%2018.0566%201.78205%2018.1677%201.71134%2018.3026C1.64063%2018.4376%201.61138%2018.5904%201.62726%2018.7419C1.64313%2018.8934%201.70343%2019.0368%201.80058%2019.1542L9.51927%2028.406C9.79205%2028.7344%2010.277%2028.7773%2010.378%2028.5045L19.6298%2020.7833C20.3876%2020.3413%2020.1173%2019.4825%2019.4328%2019.4194L15.8008%2019.091C16.0297%2017.1283%2016.8213%2015.2735%2018.0802%2013.7503C19.3391%2012.2271%2021.0115%2011.1004%2022.8961%2010.5059C24.7806%209.9114%2026.7969%209.8745%2028.7019%2010.3996C30.6069%2010.9248%2032.3195%2011.9896%2033.6332%2013.4657C34.947%2014.9419%2035.8059%2016.7664%2036.1065%2018.7195C36.4071%2020.6726%2036.1365%2022.6709%2035.3274%2024.4738C34.5183%2026.2766%2033.2051%2027.8071%2031.5462%2028.8807C29.8872%2029.9544%2027.9531%2030.5254%2025.977%2030.5251H25.9283V40.5094C31.2249%2040.4031%2036.7093%2038.2263%2040.4202%2034.4455C44.1311%2030.6648%2046.2134%2025.5808%2046.2209%2020.2832Z'%20fill='%23D7A39E'/%3e%3cpath%20d='M25.9773%2030.5293H0V40.5237H25.9773V30.5293Z'%20fill='url(%23paint1_linear_250_16424)'/%3e%3c/g%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_250_16424'%20x1='6.53714'%20y1='35.5252'%20x2='47.0198'%20y2='35.5252'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%236C798F'/%3e%3cstop%20offset='1'%20stop-color='%236C798F'%20stop-opacity='0.1'/%3e%3c/linearGradient%3e%3clinearGradient%20id='paint1_linear_250_16424'%20x1='0'%20y1='36'%20x2='26'%20y2='36'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23E8D4D3'%20stop-opacity='0'/%3e%3cstop%20offset='1'%20stop-color='%23E2A39F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",at="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='20'%20height='20'%20rx='3.33333'%20fill='%2329BF7F'/%3e%3cpath%20d='M6.43164%2014.3018L9.29004%2012.167L9.29102%2012.166C9.47176%2012.0328%209.69053%2011.9609%209.91504%2011.9609C10.0834%2011.9609%2010.2482%2012.0017%2010.3965%2012.0781L10.5391%2012.166L10.54%2012.167L13.373%2014.291V5.91699H6.43164V14.3018ZM14.4316%2014.3789C14.4277%2014.5672%2014.3725%2014.7506%2014.2725%2014.9102C14.1723%2015.0699%2014.0303%2015.1996%2013.8623%2015.2852C13.6944%2015.3706%2013.5064%2015.4094%2013.3184%2015.3965C13.1304%2015.3835%2012.9495%2015.3196%2012.7949%2015.2119L12.79%2015.208L9.91504%2013.0518L7.01465%2015.209C6.83427%2015.3432%206.61546%2015.4161%206.39062%2015.417H6.38965C6.2298%2015.4164%206.07171%2015.38%205.92773%2015.3105V15.3096C5.75087%2015.2261%205.60123%2015.0946%205.49609%2014.9297C5.3907%2014.7642%205.33364%2014.5721%205.33301%2014.376V5.87402C5.3338%205.7361%205.36234%205.59971%205.41602%205.47266C5.46971%205.3456%205.54812%205.23049%205.64648%205.13379C5.74485%205.0371%205.86131%204.96069%205.98926%204.90918C6.1165%204.85797%206.2525%204.83272%206.38965%204.83398V4.83301H13.3906C13.6661%204.83457%2013.9302%204.94494%2014.125%205.13965C14.3198%205.33446%2014.4301%205.59852%2014.4316%205.87402V14.3789Z'%20fill='white'%20stroke='white'%20stroke-width='0.333333'/%3e%3c/svg%3e",Mt=(i,n={})=>Be({queryKey:["sprint-list"],queryFn:({signal:_})=>Y({url:`sprints/${i}`,method:"GET",signal:_}),...n}),Bt=(i,n={})=>Be({queryKey:["sprint-cards",i],queryFn:({signal:_})=>Y({url:`sprints/${v(i)}/backlog`,method:"GET",signal:_}),...n}),Et=(i,n={})=>Be({queryKey:["sprint-kanban",i],queryFn:({signal:_})=>Y({url:`workspace/cards/sprintgrouped?sprint_id=${v(i)}&variable_id=68b6c96e0a95eef7d14e6981`,method:"GET",signal:_}),...n}),Pt=(i,n={})=>be({key:["sprint-complete"]},{mutationFn:_=>Y({url:`sprints/${v(i)}/complete`,method:"POST",data:_.payload}),...n}),Ut=(i,n={})=>Be({queryKey:["sprint-detail",i],queryFn:({signal:_})=>Y({url:`sprints/detail/${v(i)}?include_cards=true`,method:"GET",signal:_}),...n}),Ie=(i,n={})=>Be({queryKey:["backlog-list",i],queryFn:({signal:_})=>Y({url:`sprints/workspace/${v(i)}/cards?include_sprint_cards=false`,method:"GET",signal:_}),...n}),Ot=(i={})=>be({key:["add-sprint"]},{mutationFn:n=>Y({url:"/sprints",method:"POST",data:n.payload}),...i}),st=(i={})=>be({key:["move-card-to-sprint"]},{mutationFn:n=>Y({url:`/sprints/${n.id}/cards`,method:"POST",data:n.payload}),...i}),Ke=(i={})=>be({key:["add-sprint"]},{mutationFn:n=>Y({url:`/sprints/${n.id}`,method:"PUT",data:n.payload}),...i}),At=(i={})=>be({key:["start-sprint"]},{mutationFn:n=>Y({url:`/sprints/${n.id}/start`,method:"POST",data:n.payload}),...i}),qt=(i={})=>be({key:["delete-sprint"]},{mutationFn:n=>Y({url:`/sprints/${n}`,method:"DELETE"}),...i}),Ht=(i={})=>be({key:["remove-card-from-sprint"]},{mutationFn:n=>Y({url:`sprints/${v(n.sprintId)}/cards/remove `,method:"POST",data:{card_ids:[n.cardId]}}),...i}),lt="jira-like:";function ze(i="id"){return`${i}_${Math.random().toString(36).slice(2,9)}`}function Ze(i,n){try{localStorage.setItem(lt+i,JSON.stringify(n))}catch{}}function Ge(i,n){try{const _=localStorage.getItem(lt+i);return _?JSON.parse(_):n}catch{return n}}function rt(i){switch(i){case"Highest":return"rounded-md bg-red-50 px-2 py-0.5 text-xs text-red-700";case"High":return"rounded-md bg-orange-50 px-2 py-0.5 text-xs text-orange-700";case"Medium":return"rounded-md bg-amber-50 px-2 py-0.5 text-xs text-amber-700";case"Low":return"rounded-md bg-gray-100 px-2 py-0.5 text-xs text-gray-600"}}function nt(){const i=B(Ge("backlog",[])),n=B(Ge("sprints",[]));if(n.value.length===0)n.value.push({id:ze("sprint"),name:"Sprint 1",goal:"",start:"",end:"",started:!1,tickets:[]});else if(n.value.length>1){for(let s=1;s<n.value.length;s++)i.value.push(...n.value[s].tickets);n.value=[n.value[0]]}const _=B(n.value[0].id);K([i,n],()=>{Ze("backlog",i.value),Ze("sprints",n.value)},{deep:!0});const V=B([]),M=ge({}),y=E(()=>i.value.length>0&&V.value.length===i.value.length),b=s=>{var l;const a=n.value.find(c=>c.id===s);return!!a&&a.tickets.length>0&&(((l=M[s])==null?void 0:l.length)||0)===a.tickets.length};function T(s,a,l){const c=a.target.checked;if(s==="backlog")V.value=c?i.value.map($=>$.id):[];else if(l){const $=n.value.find(k=>k.id===l);M[l]=c&&$?$.tickets.map(k=>k.id):[]}}function P(s,a,l,c){const $=l.target.checked,k=s==="backlog"?V.value:M[c]||(M[c]=[]);if($&&!k.includes(a)&&k.push(a),!$){const j=k.indexOf(a);j>=0&&k.splice(j,1)}}function L(){return n.value.find(s=>s.id===_.value)||n.value[0]}function N(){const a=[...i.value,...n.value.flatMap(c=>c.tickets)].map(c=>Number(String(c.key).replace(/[^0-9]/g,""))).filter(c=>!Number.isNaN(c));return`PRJ-${a.length?Math.max(...a)+1:1}`}const{mutate:H}=st({onSuccess:()=>{Se.success("Cards moved to sprint successfully")},onError:s=>{Se.error("Failed to move cards: "+(s.message||"Unknown error"))}});function q(){var c,$;const s=L();if(!s||!V.value.length)return;const a=[],l=[];for(const k of i.value)(V.value.includes(k.id)?l:a).push(k);i.value=a,s.tickets.push(...l),V.value=[],l.length>0&&H({id:s.id,payload:{card_ids:l.map(k=>k.id),priority:(($=(c=l[0])==null?void 0:c.priority)==null?void 0:$.toLowerCase())||"medium",story_points:l.reduce((k,j)=>k+(j.storyPoints||0),0)}})}function x(s){const a=n.value.find(k=>k.id===s);if(!a)return;const l=M[s]||[],c=[],$=[];for(const k of a.tickets)(l.includes(k.id)?$:c).push(k);a.tickets=c,i.value.push(...$),M[s]=[]}function O(s,a){if(s==="backlog")i.value=i.value.filter(l=>!V.value.includes(l.id)),V.value=[];else if(a){const l=M[a]||[],c=n.value.find($=>$.id===a);if(!c)return;c.tickets=c.tickets.filter($=>!l.includes($.id)),M[a]=[]}}function w(s,a){const l={id:ze("T"),key:N(),createdAt:new Date().toISOString(),...a};if(s==="backlog")i.value.push(l);else{const c=L();c==null||c.tickets.push(l)}}function t(s){const a=L();a&&(a.name=s.name??a.name,a.goal=s.goal??a.goal,a.start=s.start??a.start,a.end=s.end??a.end)}function r(){const s=L();s&&(s.started=!s.started)}function C(s){return s.tickets.reduce((a,l)=>a+(l.storyPoints||0),0)}return{backlog:i,sprints:n,activeSprintId:_,selectedBacklogIds:V,selectedSprintIds:M,allBacklogChecked:y,allSprintChecked:b,toggleAll:T,toggleOne:P,getActiveSprint:L,createTicket:w,saveSprintMeta:t,toggleStartSprint:r,sprintPoints:C,moveSelectedToSprint:q,moveSelectedToBacklog:x,deleteSelected:O,priorityClass:rt}}const It={class:"space-y-3 flex flex-col overflow-y-auto"},Ft={key:0,class:"empty-state flex flex-col justify-center items-center h-full"},Nt={class:"flex items-center gap-2 text-text-secondary float-start"},Rt={class:"inline-block rounded-full px-2 py-0.5 text-xs"},jt={class:"truncate"},Kt={key:0,class:"float-end flex justify-center text-gray-500 items-center text-xs aspect-square max-w-6 min-h-6 bg-gray-500/10 rounded-full"},zt={key:1,class:"text-xs aspect-square max-w-6 flex justify-center items-center text-center min-h-6 bg-accent/30 text-accent border-accent border rounded-full"},Zt=["onDragstart"],Gt=ye({__name:"BacklogTable",props:{sorters:{}},emits:["ticket-dragged-to-sprint","open-ticket","ticket-moved-to-backlog"],setup(i,{emit:n}){const _=n,{workspaceId:V}=Je(),{data:M,isPending:y}=Ie(V),b=B([]);K(M,w=>{w!=null&&w.cards&&(b.value=w.cards.map(t=>{var l,c,$,k,j;const r=((l=t.card)==null?void 0:l.variables)??{},C=((c=t.card)==null?void 0:c._id)??t.card_id,s=String(r["card-status"]??"").trim(),a=String(r.priority??"").trim();return{id:C,key:r["card-code"]||(C==null?void 0:C.slice(-6))||"PRJ-?",summary:r["card-title"]||"(untitled)",type:"Story",status:s,assignee:((k=($=t.card)==null?void 0:$.assigned_to)==null?void 0:k.name)??"Unassigned",storyPoints:Number(t.story_points??0)||0,priority:P(a),createdAt:((j=t.card)==null?void 0:j.created_at)??new Date().toISOString(),description:r["card-description"]||""}}))},{immediate:!0});function T(w){const t=w.toLowerCase();switch(t.trim()){case"todo":return"bg-gray-500/10 text-gray-500";case"to do":return"bg-gray-500/10 text-gray-500";case"in progress":return"bg-gray-amber/10 text-amber-500";case"done":return"bg-green-500/10 text-green-500"}return t.includes("progress")?"In Progress":t.includes("done")||t.includes("complete")?"Done":"Todo"}function P(w){const t=String(w??"").toLowerCase();return t==="highest"||t==="blocker"||t==="critical"?"Highest":t==="high"||t==="major"?"High":t==="medium"||t==="normal"?"Medium":"Low"}const L=B(!1),N=B(null);function H(w,t,r){var s;N.value=t.id;const C=JSON.stringify({id:t.id,from:r,ticket:t});(s=w.dataTransfer)==null||s.setData("text/plain",C),w.dataTransfer&&(w.dataTransfer.effectAllowed="move")}function q(w){var t;L.value=!1,((t=w.dataTransfer)==null?void 0:t.dropEffect)!=="none"&&N.value&&(b.value=b.value.filter(r=>r.id!==N.value)),N.value=null}function x(w){var t;w.preventDefault(),L.value=!1;try{const r=(t=w.dataTransfer)==null?void 0:t.getData("text/plain");if(!r)return;const C=JSON.parse(r);if(C.from!=="sprint"||b.value.some(a=>a.id===C.id))return;b.value.push(C.ticket),_("ticket-moved-to-backlog",C.id,C.sprintId)}catch(r){console.error("Drop error:",r)}}const O=E(()=>[{key:"summary",label:"Summary",sortable:!1},{key:"status",label:"Status",width:120,sortable:!1},{key:"assignee",label:"",width:120,sortable:!1}]);return(w,t)=>(m(),h("section",It,[e("div",{class:Q(["rounded-lg border h-[300px] border-border flex flex-col",L.value?"ring-2 ring-blue-400":""]),onDragover:t[4]||(t[4]=he(()=>{},["prevent"])),onDragenter:t[5]||(t[5]=r=>L.value=!0),onDragleave:t[6]||(t[6]=r=>L.value=!1),onDrop:t[7]||(t[7]=r=>x(r))},[!v(y)&&b.value.length===0?(m(),h("div",Ft,t[8]||(t[8]=[e("img",{src:Lt,class:"mb-4",alt:"backlog-plan"},null,-1),e("h6",{class:"text-sm text-text-primary font-semibold mb-1"},"Get started in the backlog",-1),e("p",{class:"text-sm text-text-primary/90 mb-3"},"Plan and start a sprint to see issues here.",-1)]))):(m(),G(Qe,{key:1,showHeader:!1,pagination:!1,class:"flex-grow h-full",rowDraggable:!0,onRowDragstart:t[1]||(t[1]=({row:r,$event:C})=>H(C,r,"backlog")),onRowDragend:t[2]||(t[2]=({$event:r})=>q(r)),columns:O.value,rows:b.value,"page-size":20,hover:!0,itemKey:r=>r.id,sorters:w.sorters,onRowClick:t[3]||(t[3]=({row:r})=>w.$emit("open-ticket",r))},{summary:A(({row:r})=>[e("div",Nt,[t[9]||(t[9]=e("img",{src:at,alt:""},null,-1)),e("span",Rt,I(r.key),1),e("span",jt,I(r.summary),1)])]),status:A(({row:r})=>[e("span",{class:Q([T(r.status),"px-2 py-1 rounded-md"])},I(r.status),3)]),assignee:A(({row:r})=>[r.assignee=="Unassigned"?(m(),h("span",Kt,"UA")):(m(),h("span",zt,I(v(We)(r.assignee)),1))]),drag:A(({row:r})=>[e("button",{class:"cursor-grab",title:"Drag to Sprint",draggable:"",onClick:t[0]||(t[0]=he(()=>{},["stop"])),onDragstart:C=>H(C,r,"backlog"),onDragend:q},"↕",40,Zt)]),_:1},8,["columns","rows","itemKey","sorters"]))],34)]))}}),Jt="data:image/svg+xml,%3csvg%20width='60'%20height='60'%20viewBox='0%200%2060%2060'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20opacity='0.4'%3e%3cpath%20d='M9.375%2030C11.6402%2030%2013.4766%2028.1637%2013.4766%2025.8984C13.4766%2023.6332%2011.6402%2021.7969%209.375%2021.7969C7.10977%2021.7969%205.27344%2023.6332%205.27344%2025.8984C5.27344%2028.1637%207.10977%2030%209.375%2030Z'%20fill='%23AE2A19'/%3e%3cpath%20d='M26.25%2024.375C28.5152%2024.375%2030.3516%2022.5387%2030.3516%2020.2734C30.3516%2018.0082%2028.5152%2016.1719%2026.25%2016.1719C23.9848%2016.1719%2022.1484%2018.0082%2022.1484%2020.2734C22.1484%2022.5387%2023.9848%2024.375%2026.25%2024.375Z'%20fill='%23BF63F3'/%3e%3cpath%20d='M15.3931%2035.8594H11.0159V33.0938C9.93587%2033.3387%208.81469%2033.3387%207.73465%2033.0938V35.8594H1.87528C1.55115%2035.8601%201.2345%2035.9568%200.965283%2036.1373C0.696064%2036.3178%200.486343%2036.574%200.362583%2036.8736C0.238824%2037.1731%200.206573%2037.5027%200.269899%2037.8205C0.333226%2038.1384%200.489292%2038.4304%200.718404%2038.6597L7.05872%2045L0.718404%2051.3403C0.489292%2051.5696%200.333226%2051.8616%200.269899%2052.1795C0.206573%2052.4973%200.238824%2052.8269%200.362583%2053.1264C0.486343%2053.426%200.696064%2053.6822%200.965283%2053.8627C1.2345%2054.0432%201.55115%2054.1399%201.87528%2054.1406H15.3931L21.7503%2045L15.3931%2035.8594Z'%20fill='%2382B536'/%3e%3cpath%20d='M34.4562%2035.8594H27.8937V27.4688C26.8137%2027.7138%2025.6925%2027.7138%2024.6125%2027.4688V35.8594H19.3896L25.7487%2045L19.3896%2054.1406H34.4562L40.8143%2045L34.4562%2035.8594Z'%20fill='%2382B536'/%3e%3cpath%20d='M43.8281%2019.6875H55.3125C55.7475%2019.6873%2056.1647%2019.5143%2056.4723%2019.2067C56.7799%2018.8991%2056.9529%2018.4819%2056.9531%2018.0469V9.375C56.9529%208.93996%2056.7799%208.5228%2056.4723%208.21518C56.1647%207.90755%2055.7475%207.73462%2055.3125%207.73438H43.8281V7.5C43.8281%207.06488%2043.6553%206.64758%2043.3476%206.3399C43.0399%206.03223%2042.6226%205.85938%2042.1875%205.85938C41.7524%205.85938%2041.3351%206.03223%2041.0274%206.3399C40.7197%206.64758%2040.5469%207.06488%2040.5469%207.5V32.5781H43.8281V19.6875Z'%20fill='%23FCA700'/%3e%3cpath%20d='M59.2843%2043.8403L51.7843%2036.3403C51.6322%2036.1878%2051.4514%2036.0668%2051.2524%2035.9842C51.0534%2035.9017%2050.8401%2035.8593%2050.6246%2035.8594H38.4521L44.8121%2045L38.4531%2054.1406H50.6246C50.8401%2054.1407%2051.0534%2054.0983%2051.2524%2054.0158C51.4514%2053.9332%2051.6322%2053.8122%2051.7843%2053.6597L59.2843%2046.1597C59.4368%2046.0075%2059.5577%2045.8267%2059.6402%2045.6277C59.7228%2045.4287%2059.7652%2045.2154%2059.7652%2045C59.7652%2044.7846%2059.7228%2044.5713%2059.6402%2044.3723C59.5577%2044.1733%2059.4368%2043.9925%2059.2843%2043.8403Z'%20fill='%2382B536'/%3e%3c/g%3e%3c/svg%3e",Qt={class:"rounded-lg flex flex-col"},Wt=["checked"],Xt=["checked","onChange"],Yt={class:"flex items-center gap-2 text-text-secondary float-start"},ea={class:"inline-block rounded-full px-2 py-0.5 text-xs"},ta={class:"truncate"},aa={key:0,class:"float-end flex justify-center text-gray-500 items-center text-xs aspect-square max-w-6 min-h-6 bg-gray-500/10 rounded-full"},sa={key:1,class:"text-xs aspect-square max-w-6 flex justify-center items-center text-center min-h-6 bg-accent/30 text-accent border-accent border rounded-full"},la=["onDragstart"],ra={key:1,class:"empty-state flex flex-col h-full justify-center items-center border-dashed border border-border"},na=ye({__name:"SprintCard",props:{sprint:{},sprintId:{}},emits:["edit-sprint","toggle-start","open-ticket","move-selected-to-backlog","delete-selected-sprint","refresh"],setup(i,{emit:n}){const _=i;K(_,s=>{console.log("props changes",s)});const V=n,M=nt(),{selectedSprintIds:y,allSprintChecked:b,toggleAll:T,toggleOne:P}=M,L=B([]);K(()=>_.sprint.tickets,s=>{L.value=[...s||[]]},{immediate:!0,deep:!0});const N=B(!1),H=B(null),{mutate:q}=st({onSuccess:()=>{Se.success("Card moved to sprint successfully"),V("refresh")},onError:s=>{Se.error("Failed to move card: "+(s.message||"Unknown error"))}});function x(s,a,l,c){var k;H.value=a.id;const $=JSON.stringify({id:a.id,from:l,sprintId:c,ticket:a});(k=s.dataTransfer)==null||k.setData("text/plain",$),s.dataTransfer&&(s.dataTransfer.effectAllowed="move")}function O(s){var a;N.value=!1,((a=s.dataTransfer)==null?void 0:a.dropEffect)!=="none"&&H.value&&(L.value=L.value.filter(l=>l.id!==H.value)),H.value=null}function w(){N.value=!0}function t(){N.value=!1}function r(s){var a;s.preventDefault(),N.value=!1;try{const l=(a=s.dataTransfer)==null?void 0:a.getData("text/plain");if(!l)return;const c=JSON.parse(l);if(c.from!=="backlog"||L.value.some(k=>k.id===c.id))return;L.value.push(c.ticket),q({id:_.sprintId,payload:{card_ids:[c.ticket.id],priority:c.ticket.priority.toLowerCase(),story_points:c.ticket.storyPoints||0}})}catch(l){console.error("Drop error:",l)}}const C=[{key:"summary",label:"Summary",sortable:!0},{key:"status",label:"Status",width:120,sortable:!0},{key:"assignee",label:"Assignee",width:120,sortable:!0}];return(s,a)=>(m(),h("div",Qt,[e("div",{class:Q(["h-[300px]",N.value?"ring-2 ring-blue-400 rounded-lg":""]),onDragover:a[5]||(a[5]=he(()=>{},["prevent"])),onDragenter:w,onDragleave:t,onDrop:r},[L.value.length>0?(m(),G(Qe,{key:0,showHeader:!1,pagination:!1,"row-draggable":!0,class:"h-full",onRowDragstart:a[2]||(a[2]=({row:l,$event:c})=>x(c,l,"sprint",s.sprint.id)),onRowDragend:a[3]||(a[3]=({$event:l})=>O(l)),columns:C,rows:L.value,"page-size":100,hover:!0,"item-key":l=>l.id,onRowClick:a[4]||(a[4]=({row:l})=>s.$emit("open-ticket",l))},{"select-header":A(()=>[e("input",{type:"checkbox",checked:v(b)(s.sprint.id),onChange:a[0]||(a[0]=l=>v(T)("sprint",l,s.sprint.id))},null,40,Wt)]),select:A(({row:l})=>[e("input",{type:"checkbox",checked:(v(y)[s.sprint.id]||[]).includes(l.id),onChange:c=>v(P)("sprint",l.id,c,s.sprint.id)},null,40,Xt)]),summary:A(({row:l})=>[e("div",Yt,[a[6]||(a[6]=e("img",{src:at,alt:""},null,-1)),e("span",ea,I(l.key),1),e("span",ta,I(l.summary),1)])]),status:A(({row:l})=>[e("span",{class:Q([v(mt)(l.status),"px-2 py-1 rounded-md"])},I(l.status),3)]),assignee:A(({row:l})=>[l.assignee=="Unassigned"?(m(),h("span",aa,"UA")):(m(),h("span",sa,I(v(We)(`${l.assignee}`)),1))]),priority:A(({row:l})=>[e("span",{class:Q(v(rt)(l.priority))},I(l.priority),3)]),drag:A(({row:l})=>[e("button",{class:"cursor-grab",title:"Drag to Backlog",draggable:"",onClick:a[1]||(a[1]=he(()=>{},["stop"])),onDragstart:c=>x(c,l,"sprint",s.sprint.id),onDragend:O},"↕",40,la)]),_:1},8,["rows","item-key"])):(m(),h("div",ra,a[7]||(a[7]=[ft('<img src="'+Jt+'" class="mb-4" alt="backlog-plan"><h6 class="text-sm text-text-primary font-semibold mb-1 text-center">Plan your sprint</h6><p class="text-sm text-text-primary/90 mb-3 max-w-120 text-center">Drag work items from the <span class="font-bold"> Backlog </span> section or create new ones to plan the work for this sprint. Select <span class="font-bold">Start sprint</span> when you&#39;re ready.</p>',3)])))],34)]))}}),oa={class:"px-6 gap-4"},ia={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},da=ye({__name:"SprintModal",props:{modelValue:{type:Boolean,default:!1},sprint:{},creatingSprint:{type:Boolean}},emits:["update:modelValue","save","close"],setup(i,{emit:n}){const _=n,V=i,M=E({get:()=>V.modelValue,set:q=>_("update:modelValue",q)}),y=ge({name:""}),b=ge({name:!1}),T=E(()=>b.name&&!String(y.name||"").trim()?"Name is required":""),P=E(()=>!!String(y.name||"").trim()&&!T.value);function L(){M.value=!1,_("close")}function N(){b.name=!0,P.value&&_("save",{name:String(y.name||"").trim()})}function H(){b.name=!1}return K(()=>V.sprint,q=>{if(!q){y.name="";return}y.name=q.name??(q==null?void 0:q.title)??"",H()},{immediate:!0}),(q,x)=>(m(),G(Fe,{modelValue:M.value,"onUpdate:modelValue":x[2]||(x[2]=O=>M.value=O),modalClass:"!py-0",size:"md"},{default:A(()=>[x[5]||(x[5]=e("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[e("h2",{class:"text-xl font-semibold"},"Add Sprint"),e("p",{class:"text-sm text-text-secondary mt-1"},[W(" Add sprint name and then click "),e("span",{class:"font-medium"},"Save"),W(". ")])],-1)),e("div",oa,[F(Xe,{modelValue:y.name,"onUpdate:modelValue":x[0]||(x[0]=O=>y.name=O),label:"Name",placeholder:"Sprint 1",error:!!T.value,message:T.value,onBlur:x[1]||(x[1]=O=>b.name=!0)},null,8,["modelValue","error","message"]),x[3]||(x[3]=e("div",null,null,-1))]),e("div",ia,[F(re,{variant:"secondary",onClick:L},{default:A(()=>x[4]||(x[4]=[W("Cancel")])),_:1,__:[4]}),F(re,{variant:"primary",disabled:!P.value,onClick:N},{default:A(()=>[W(I(q.creatingSprint?"Saving...":"Save"),1)]),_:1},8,["disabled"])])]),_:1,__:[5]},8,["modelValue"]))}}),ua={class:"px-6 grid grid-cols-2 gap-4"},ca={class:"flex gap-1 flex-col"},pa={key:0,class:"text-xs text-red-500"},ma={class:"flex gap-1 flex-col"},fa={key:0,class:"text-xs text-red-500"},va={class:"flex flex-col col-span-2"},ga={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},ba=ye({__name:"StartSprintModal",props:{modelValue:{type:Boolean,default:!1},sprint:{},creatingSprint:{type:Boolean}},emits:["update:modelValue","save","close"],setup(i,{emit:n}){const _=n,V=i,M=E({get:()=>V.modelValue,set:t=>_("update:modelValue",t)}),y=ge({goal:"",start:"",end:""});K(()=>V.sprint,t=>{t&&(y.goal=t.goal??"",y.start=t.start??"",y.end=t.end??"",O())},{immediate:!0});const b=ge({start:!1,end:!1}),T=E(()=>""),P=E(()=>{if(!b.end)return"";if(y.start&&y.end){const t=w(y.start),r=w(y.end);if(Number.isFinite(t)&&Number.isFinite(r)&&r<t)return"End date cannot be before start date"}return""}),L=E(()=>!P.value);function N(t){y.start=t||"",b.start=!0}function H(t){y.end=t||"",b.end=!0}function q(){M.value=!1,_("close")}function x(){b.start=!0,b.end=!0,L.value&&_("save",{goal:y.goal??"",start:y.start||"",end:y.end||""})}function O(){b.start=!1,b.end=!1}function w(t){return t?new Date(`${t}T00:00:00`).getTime():NaN}return(t,r)=>(m(),G(Fe,{modelValue:M.value,"onUpdate:modelValue":r[1]||(r[1]=C=>M.value=C),modalClass:"!py-0",size:"md"},{default:A(()=>[r[6]||(r[6]=e("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[e("h2",{class:"text-xl font-semibold"},"Start Sprint"),e("p",{class:"text-sm text-text-secondary mt-1"},[W(" Update sprint name, goal, and dates, then click "),e("span",{class:"font-medium"},"Start"),W(". ")])],-1)),e("div",ua,[e("div",ca,[r[2]||(r[2]=e("label",{class:"text-sm"},"Start date",-1)),e("div",{class:Q(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",T.value?"border-red-500":""])},[F(Ae,{placeholder:"Set start date",class:"w-full","model-value":y.start,"emit-as":"ymd","onUpdate:modelValue":N},null,8,["model-value"])],2),T.value?(m(),h("p",pa,I(T.value),1)):X("",!0)]),e("div",ma,[r[3]||(r[3]=e("label",{class:"text-sm"},"End date",-1)),e("div",{class:Q(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",P.value?"border-red-500":""])},[F(Ae,{placeholder:"Set end date",class:"w-full","model-value":y.end,"emit-as":"ymd","onUpdate:modelValue":H},null,8,["model-value"])],2),P.value?(m(),h("p",fa,I(P.value),1)):X("",!0)]),e("div",va,[r[4]||(r[4]=e("label",{class:"text-sm"},"Goal (optional)",-1)),qe(e("textarea",{"onUpdate:modelValue":r[0]||(r[0]=C=>y.goal=C),class:"w-full rounded-lg border border-border px-3 py-2 bg-bg-input",rows:"2",placeholder:"Ship onboarding flow"},null,512),[[vt,y.goal]])])]),e("div",ga,[F(re,{variant:"secondary",onClick:q},{default:A(()=>r[5]||(r[5]=[W("Cancel")])),_:1,__:[5]}),F(re,{variant:"primary",disabled:!L.value,onClick:x},{default:A(()=>[W(I(t.creatingSprint?"Starting...":"Start"),1)]),_:1},8,["disabled"])])]),_:1,__:[6]},8,["modelValue"]))}}),ya={class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},xa={class:"text-sm text-text-secondary mt-1"},ka={class:"flex items-center gap-2 mt-4 w-full"},_a={class:"flex items-center gap-2 flex-1"},Sa={class:"px-6 min-h-[400px]"},ha={key:0},Ca={key:0,class:"flex items-center justify-center py-12"},wa={key:1,class:"text-center py-12 text-text-secondary"},Da={key:2,class:"grid grid-cols-2 gap-3"},Va=["onClick"],Ta={class:"flex items-center gap-3"},$a={class:"w-10 h-10 rounded-lg bg-bg-input flex items-center justify-center group-hover:bg-primary/10 transition-colors"},La={class:"font-medium"},Ma={key:1},Ba={key:0,class:"flex items-center justify-center py-12"},Ea={key:1,class:"text-center py-12 text-text-secondary"},Pa={key:2,class:"grid grid-cols-2 gap-3"},Ua=["onClick"],Oa={class:"flex items-center gap-3"},Aa={class:"w-10 h-10 rounded-lg bg-bg-input flex items-center justify-center group-hover:bg-primary/10 transition-colors"},qa={class:"font-medium"},Ha={key:2},Ia={class:"grid grid-cols-2 gap-4"},Fa={key:0,class:"flex flex-col"},Na={class:"flex gap-1 flex-col"},Ra={key:0,class:"text-xs text-red-500"},ja={class:"flex gap-1 flex-col"},Ka={key:0,class:"text-xs text-red-500"},za={class:"mt-4"},Za={key:0,class:"text-xs text-red-500 mt-1 px-1"},Ga={class:"flex justify-between gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},Ja={key:1},Qa={class:"flex gap-2"},Wa=ye({__name:"CreateBacklogTicketWithModuleSelection",props:{modelValue:{type:Boolean,default:!1},listId:{},selectedVariable:{}},emits:["update:modelValue","created"],setup(i,{emit:n}){const _=n,V=i,M=Ne(),{workspaceId:y}=Ye(),b=B(1),T=B(null),P=B(null),{data:L,isLoading:N}=gt(y.value),H=E(()=>{var u;return((u=L.value)==null?void 0:u.modules)||[]}),{data:q,isFetching:x,refetch:O}=et({workspace_module_id:T,workspace_id:y},{enabled:E(()=>!!T.value)});K(()=>T.value,()=>{O()});const w=E(()=>q.value||[]),{data:t}=bt(y.value),{data:r}=tt(y.value,T,{enabled:E(()=>!!T.value)}),{mutate:C,isPending:s}=yt({onSuccess:()=>{xe(),M.invalidateQueries({queryKey:["sheet-list"]}),a.value=!1}}),a=E({get:()=>V.modelValue,set:u=>_("update:modelValue",u)}),l=E(()=>{switch(b.value){case 1:return"Select a module to create the ticket in";case 2:return"Select a sheet within the module";case 3:return"Provide the ticket details below and click Add Ticket";default:return""}}),c=E(()=>((r==null?void 0:r.value)??[]).filter(u=>{var o;return((o=u==null?void 0:u.type)==null?void 0:o.title)==="Select"})),$=u=>u.map(o=>({_id:o,title:o})),k=E(()=>((t==null?void 0:t.value)??[]).map(u=>{var o;return{_id:u._id,title:((o=u==null?void 0:u.variables)==null?void 0:o["lane-title"])??String(u._id)}})),j=u=>u.slug,d=ge({title:"",description:"",startDate:null,endDate:null,lane_id:null,variables:{}});K(c,u=>{for(const o of u){const f=j(o);f in d.variables||(d.variables[f]=null)}},{immediate:!0});const D=ge({title:!1,description:!1,startDate:!1,endDate:!1,lane:!1}),ne=E(()=>!!d.title.trim()&&!!d.lane_id&&!!d.startDate&&!!d.endDate&&!S.value&&!U.value&&!le.value&&!ie.value&&!ae.value);function oe(u){d.startDate=u,D.startDate=!0}function Ce(u){d.endDate=u,D.endDate=!0}function ee(u){d.lane_id=u,D.lane=!0}function pe(u){T.value=u._id,b.value=2}function te(u){P.value=u._id,b.value=3}function z(){b.value>1&&b.value--}function we(){a.value=!1,xe()}function xe(){b.value=1,T.value=null,P.value=null,d.title="",d.description="",d.startDate=null,d.endDate=null,d.lane_id=null,d.variables={},D.title=!1,D.description=!1,D.startDate=!1,D.endDate=!1,D.lane=!1}const De=E(()=>{var u;return(u=r==null?void 0:r.value)==null?void 0:u.find(o=>(o==null?void 0:o._id)==V.selectedVariable)}),S=E(()=>D.title&&!d.title.trim()?"Title is required":""),U=E(()=>D.startDate?d.startDate?"":"Start date is required":""),le=E(()=>D.endDate?d.endDate?d.startDate&&d.endDate&&d.endDate<d.startDate?"End date cannot be before start date":"":"End date is required":""),ie=E(()=>D.lane?d.lane_id?"":"Lane is required":""),ae=E(()=>D.description&&!d.description.trim()?"Description is required":"");function ke(){var o;if(D.title=!0,D.lane=!0,D.description=!0,D.startDate=!0,D.endDate=!0,!ne.value||s.value)return;const u={sheet_list_id:V.listId,workspace_id:y.value,sheet_id:P.value,workspace_lane_id:d.lane_id,variables:{...d.variables,[`${(o=De.value)==null?void 0:o.slug}`]:V.listId,"card-title":d.title.trim(),"card-description":d.description.trim(),"start-date":d.startDate,"end-date":d.endDate},createdAt:new Date().toISOString()};C(u)}return K(()=>d.title,u=>{u!=null&&u.trim()&&D.title&&(D.title=!1)}),K(()=>d.lane_id,u=>{u&&D.lane&&(D.lane=!1)}),K(()=>d.startDate,u=>{u&&D.startDate&&(D.startDate=!1)}),K(()=>d.endDate,u=>{u&&D.endDate&&(D.endDate=!1)}),K(()=>d.description,u=>{u!=null&&u.trim()&&D.description&&(D.description=!1)}),(u,o)=>(m(),G(Fe,{modelValue:a.value,"onUpdate:modelValue":o[4]||(o[4]=f=>a.value=f),modalClass:"!py-0",size:"lg"},{default:A(()=>[e("div",ya,[o[5]||(o[5]=e("h2",{class:"text-xl font-semibold"},"Create Backlog Ticket",-1)),e("p",xa,I(l.value),1),e("div",ka,[(m(),h(_e,null,Pe(3,f=>e("div",{key:f,class:"flex items-center flex-1"},[e("div",_a,[e("div",{class:Q(["h-1 flex-1 rounded-full transition-colors",b.value>=f?"bg-primary":"bg-border"])},null,2)])])),64))])]),e("div",Sa,[b.value===1?(m(),h("div",ha,[o[7]||(o[7]=e("h3",{class:"text-lg font-medium mb-4"},"Select Module",-1)),v(N)?(m(),h("div",Ca,o[6]||(o[6]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)]))):!H.value||H.value.length===0?(m(),h("div",wa," No modules available ")):(m(),h("div",Da,[(m(!0),h(_e,null,Pe(H.value,f=>{var J,se,de,me,Ee;return m(),h("button",{key:f._id,onClick:Re=>pe(f),class:Q(["p-4 border rounded-lg hover:border-primary transition-all text-left group",T.value===f._id?"border-primary bg-primary/5":"border-border"])},[e("div",Ta,[e("div",$a,[e("i",{class:Q([`${(se=(J=f==null?void 0:f.variables)==null?void 0:J["module-icon"])==null?void 0:se.prefix} ${(me=(de=f==null?void 0:f.variables)==null?void 0:de["module-icon"])==null?void 0:me.iconName}`,"text-lg"])},null,2)]),e("div",null,[e("p",La,I(((Ee=f.variables)==null?void 0:Ee["module-title"])||"Untitled"),1)])])],10,Va)}),128))]))])):b.value===2?(m(),h("div",Ma,[o[9]||(o[9]=e("h3",{class:"text-lg font-medium mb-4"},"Select Sheet",-1)),v(x)?(m(),h("div",Ba,o[8]||(o[8]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)]))):!w.value||w.value.length===0?(m(),h("div",Ea," No sheets available for this module ")):(m(),h("div",Pa,[(m(!0),h(_e,null,Pe(w.value,f=>{var J,se;return m(),h("button",{key:f._id,onClick:de=>te(f),class:Q(["p-4 border rounded-lg hover:border-primary transition-all text-left group",P.value===f._id?"border-primary bg-primary/5":"border-border"])},[e("div",Oa,[e("div",Aa,[e("i",{class:Q(`${(J=f==null?void 0:f.variables["sheet-icon"])==null?void 0:J.prefix} ${(se=f==null?void 0:f.variables["sheet-icon"])==null?void 0:se.iconName} text-lg`)},null,2)]),e("div",null,[e("p",qa,I((f==null?void 0:f.variables["sheet-title"])||"Untitled Sheet"),1)])])],10,Ua)}),128))]))])):b.value===3?(m(),h("div",Ha,[o[12]||(o[12]=e("h3",{class:"text-lg font-medium mb-4"},"Ticket Details",-1)),e("div",Ia,[F(Xe,{modelValue:d.title,"onUpdate:modelValue":o[0]||(o[0]=f=>d.title=f),label:"Ticket Title",placeholder:"e.g., Implement real-time notifications",error:!!S.value,message:S.value,onBlur:o[1]||(o[1]=f=>D.title=!0)},null,8,["modelValue","error","message"]),k.value.length>0?(m(),h("div",Fa,[F(je,{size:"md",label:"Lane",options:k.value,placeholder:"Select lane",allowCustom:!1,"model-value":d.lane_id,"onUpdate:modelValue":ee,error:!!ie.value,message:ie.value},null,8,["options","model-value","error","message"])])):X("",!0),(m(!0),h(_e,null,Pe(c.value,f=>qe((m(),G(je,{size:"md",key:j(f),modelValue:d.variables[f.slug],"onUpdate:modelValue":J=>d.variables[f.slug]=J,options:$(f.data),label:f.title,placeholder:"Select value",allowCustom:!0},null,8,["modelValue","onUpdate:modelValue","options","label"])),[[He,(f==null?void 0:f._id)!=u.selectedVariable]])),128)),e("div",Na,[o[10]||(o[10]=e("label",{class:"text-sm"},"Start date",-1)),e("div",{class:Q(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",U.value?"border-red-500":""])},[F(Ae,{placeholder:"Set start date",class:"w-full","model-value":d.startDate,"emit-as":"ymd","onUpdate:modelValue":oe},null,8,["model-value"])],2),U.value?(m(),h("p",Ra,I(U.value),1)):X("",!0)]),e("div",ja,[o[11]||(o[11]=e("label",{class:"text-sm"},"End date",-1)),e("div",{class:Q(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",le.value?"border-red-500":""])},[F(Ae,{placeholder:"Set end date",class:"w-full","model-value":d.endDate,"emit-as":"ymd","onUpdate:modelValue":Ce},null,8,["model-value"])],2),le.value?(m(),h("p",Ka,I(le.value),1)):X("",!0)])]),e("div",za,[F(xt,{label:"Description",placeholder:"What needs to be done, acceptance criteria, links…",modelValue:d.description,"onUpdate:modelValue":o[2]||(o[2]=f=>d.description=f),onBlur:o[3]||(o[3]=f=>D.description=!0)},null,8,["modelValue"]),ae.value?(m(),h("p",Za,I(ae.value),1)):X("",!0)])])):X("",!0)]),e("div",Ga,[b.value>1?(m(),G(re,{key:0,variant:"secondary",onClick:z},{default:A(()=>o[13]||(o[13]=[W("Back")])),_:1,__:[13]})):(m(),h("div",Ja)),e("div",Qa,[F(re,{variant:"secondary",onClick:we},{default:A(()=>o[14]||(o[14]=[W("Cancel")])),_:1,__:[14]}),b.value===3?(m(),G(re,{key:0,variant:"primary",disabled:!ne.value||v(s),onClick:ke},{default:A(()=>[W(I(v(s)?"Adding…":"Add Ticket"),1)]),_:1},8,["disabled"])):X("",!0)])])]),_:1},8,["modelValue"]))}}),Xa={class:"flex gap-2 flex-auto overflow-y-auto"},Ya={class:"flex-auto bg-gradient-to-b from-bg-card/95 to-bg-card/90 backdrop-blur rounded-2xl shadow-[0_10px_40px_-10px_rgba(0,0,0,.5)] flex-grow h-full bg-bg-card border border-border overflow-x-auto flex"},es={class:"flex overflow-x-auto gap-3 p-4"},ts={key:0,class:"mx-auto text-text-secondary/80 m-2 w-[90%] h-full justify-center flex items-center border border-dashed border-border"},as=ye({__name:"ActiveSprint",props:{sptint_id:{}},setup(i){const n=i,_=Ue(()=>Oe(()=>import("./CreateTaskModal-Dbd3M0PQ.js"),__vite__mapDeps([0,1,2,3]))),V=Ue(()=>Oe(()=>import("./ConfirmDeleteModal-DK2d8R8b.js"),__vite__mapDeps([4,5,2,3]))),M=Ue(()=>Oe(()=>import("./SidePanel-C8ojWx4u.js"),__vite__mapDeps([6,2,3,7]))),y=Ue(()=>Oe(()=>import("./KanbanBoard-BQchLTG4.js"),__vite__mapDeps([8,2,3,9,5,10,11]))),b=ht(),{workspaceId:T,moduleId:P}=Ye(),{data:L}=tt(T.value,P.value),N=Ne(),{mutate:H,isPending:q}=kt({onSuccess:()=>{N.invalidateQueries({queryKey:["sheet-list"]}),ee.value="",te.value=!1,Ce.value=!1,te.value=!1}}),x=S=>{H({workspace_id:T.value,module_id:P.value,variable_id:C.value,value:S})},{data:O}=et({workspace_id:T,workspace_module_id:P}),w=E(()=>{var S;return O.value?(S=O.value[0])==null?void 0:S._id:""}),t=B(w),r=E(()=>{var S;return L.value?(S=L.value[0])==null?void 0:S._id:""}),C=B(r),s=$t(),a=E(()=>n.sptint_id),{data:l,isPending:c}=Et(a),$=B(!1),k=B(),j=S=>{k.value=S},d=_t(),D=St();function ne(S){S.type=="column"?d.mutate({payload:{workspace_id:T.value,workspace_module_id:P.value,variable_id:C.value,moved_value:S.meta.id,new_index:S.meta.newIndex}}):D.mutate({payload:{workspace_id:T.value,card_id:S.meta.moved._id,group_value:S.meta.fromColumnId,group_variable_id:C.value,new_index:S.meta.newIndex,sheet_id:t.value}})}const oe=S=>{};K(O,S=>{var U;(S==null?void 0:S.length)>0&&(t.value=(U=S[0])==null?void 0:U._id)});const Ce=B(!1),ee=B(""),pe=S=>{H({workspace_id:b.params.id,module_id:b.params.module_id,new_value:S.title,value:S.oldTitle,variable_id:C.value})},te=B(!1),z=B(),we=()=>{H({value:z.value.title,workspace_id:T.value,module_id:P.value,newValue:z.value.title,variable_id:C.value,is_trash:!0})},xe=S=>{te.value=!0,z.value=S},De=S=>{$.value=!0,z.value=S};return(S,U)=>{var le,ie,ae,ke,u;return m(),h("div",Xa,[e("div",Ya,[qe(F(wt,null,null,512),[[He,v(c)]]),qe(e("div",es,[F(v(y),{onOnPlus:De,"onDelete:column":U[0]||(U[0]=o=>xe(o)),"onUpdate:column":U[1]||(U[1]=o=>pe(o)),onReorder:ne,onAddColumn:x,"onSelect:ticket":j,board:v(l),onOnBoardUpdate:oe,variable_id:C.value,sheet_id:t.value},{"column-footer":A(o=>{var f,J,se,de,me;return[(J=(f=v(s))==null?void 0:f.transitions)!=null&&J.all_allowed&&!((me=(de=(se=v(s))==null?void 0:se.transitions)==null?void 0:de.all_allowed)!=null&&me.includes(o.column.title))&&v(s).transitions.currentColumn!=o.column.title?(m(),h("div",ts," Disbale ( you can't drop here )")):X("",!0)]}),_:1},8,["board","variable_id","sheet_id"])],512),[[He,!v(c)]])]),F(v(V),{onClick:U[2]||(U[2]=he(()=>{},["stop"])),modelValue:te.value,"onUpdate:modelValue":U[3]||(U[3]=o=>te.value=o),title:"Delete List",itemLabel:"list",itemName:(le=z.value)==null?void 0:le.title,requireMatchText:(ie=z.value)==null?void 0:ie.title,confirmText:"Delete workspace",cancelText:"Cancel",size:"md",loading:v(q),onConfirm:we,onCancel:U[4]||(U[4]=()=>{te.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),$.value?(m(),G(v(_),{selectedVariable:C.value,listId:(ae=z.value)==null?void 0:ae.title,sheet_id:t.value,key:"createTaskModalKey",modelValue:$.value,"onUpdate:modelValue":U[5]||(U[5]=o=>$.value=o),onSubmit:U[6]||(U[6]=()=>{})},null,8,["selectedVariable","listId","sheet_id","modelValue"])):X("",!0),(ke=k.value)!=null&&ke._id?(m(),G(v(M),{key:1,details:k.value,onClose:U[7]||(U[7]=()=>{j({variables:{}})}),showPanel:!!((u=k.value)!=null&&u._id)},null,8,["details","showPanel"])):X("",!0)])}}}),ss={class:"flex-auto flex-grow h-full bg-bg-card rounded-lg border border-border overflow-x-auto flex-col flex"},ls={class:"header px-4 py-3 border-b border-border flex items-center justify-between gap-1"},rs={class:"flex gap-3 items-center"},ns={key:1,class:"space-y-6 p-4 w-full flex-auto overflow-y-auto"},os={class:"flex flex-col gap-6"},is={class:"space-y-4 bg-bg-surface/30 p-4 rounded-md"},ds={class:"flex items-center justify-between"},us={class:"text-sm font-semibold"},cs={key:0,class:"w-full h-full min-h-[250px] flex justify-center items-center"},ps={class:"space-y-4 bg-bg-surface/30 p-4 rounded-md"},ms={class:"flex items-center justify-between"},fs={class:"text-sm font-semibold"},vs={key:0,class:"w-full h-full min-h-[250px] flex justify-center items-center"},_s=ye({__name:"Plan",setup(i){const n=B(!1),_=()=>{n.value=!1},{workspaceId:V}=Je(),M=B(!1),{moveSelectedToSprint:y,moveSelectedToBacklog:b,deleteSelected:T,saveSprintMeta:P,toggleStartSprint:L}=nt(),{data:N}=Ie(V),{mutate:H,isPending:q}=qt({onSuccess:()=>{J.invalidateQueries({queryKey:["sprint-list"]}),O.value=!1}}),x=B(null),O=B(!1),w=()=>{var g;H((g=x.value)==null?void 0:g._id)},{mutate:t,isPending:r}=Ke({onSuccess:g=>{P({name:g.title}),C({id:d.value}),oe.value=!1}}),{mutate:C,isPending:s}=At({onSuccess:()=>{ne()}}),a=g=>{console.log("helo",x.value,g),t({id:d.value,payload:{goal:g.goal,start_date:g.start,end_date:g.end}})},{data:l,refetch:c}=Mt(V.value),{refetch:$,isPending:k}=Ie(V),j=E(()=>{var g,p;return(p=(g=l==null?void 0:l.value)==null?void 0:g.sprints[0])==null?void 0:p._id}),d=B(j.value);K(()=>j.value,g=>{d.value=g});const{data:D,refetch:ne}=Ut(j),oe=B(!1),Ce=()=>{oe.value=!0},{data:ee,isPending:pe,refetch:te}=Bt(d);K(()=>pe.value,g=>{console.log(g,pe.value,">>>> laoding state changes")});const z=E(()=>{var fe,ue;const g=(fe=ee==null?void 0:ee.value)==null?void 0:fe.backlog_items;if(!g)return null;const p=(((ue=ee==null?void 0:ee.value)==null?void 0:ue.backlog_items)||[]).map(R=>{var Ve,Te,$e,Le,Me;const ce=((Ve=R==null?void 0:R.card)==null?void 0:Ve.variables)||{},ve=((Te=R==null?void 0:R.card)==null?void 0:Te._id)||R.card_id;return{id:ve,key:ce["card-code"]||(ve==null?void 0:ve.slice(-6))||"PRJ-?",summary:ce["card-title"]||"(untitled)",type:"Story",status:we(String(ce["card-status"]||"").trim()),assignee:((Le=($e=R==null?void 0:R.card)==null?void 0:$e.assigned_to)==null?void 0:Le.name)||"Unassigned",storyPoints:Number(R.story_points||0),priority:xe(String(ce.priority||"").trim()),createdAt:((Me=R==null?void 0:R.card)==null?void 0:Me.created_at)||new Date().toISOString(),description:ce["card-description"]||""}});return{id:g._id,name:g.title||"Sprint 1",title:g.title,goal:"",start:"",end:"",started:!1,tickets:p}});function we(g){const p=g.toLowerCase();return p.includes("progress")?"In Progress":p.includes("done")||p.includes("complete")?"Done":"Todo"}function xe(g){const p=g.toLowerCase();return p==="highest"||p==="blocker"||p==="critical"?"Highest":p==="high"||p==="major"?"High":p==="medium"||p==="normal"?"Medium":"Low"}const{mutate:De}=Ht({onSuccess:()=>{Se.success("Card removed from sprint successfully"),S()},onError:g=>{Se.error("Failed to remove card from sprint"),console.error("Failed to remove card from sprint:",g)}});function S(){te(),c(),$(),ne()}function U(g){console.log(">>> moving back to backlog"),d&&De({sprintId:d,cardId:g})}const le={createdAt:(g,p,fe)=>{const ue=new Date(g.createdAt).getTime(),R=new Date(p.createdAt).getTime();return fe==="asc"?ue-R:R-ue}},ie=B(!1),ae=B(null);function ke(){M.value=!0,ae.value=null}function u(g){ae.value=g,n.value=!0,ie.value=!0}const o=B(!1);function f(){o.value=!0}const J=Ne(),{mutate:se,isPending:de}=Ot({onSuccess:g=>{P({name:g.title}),J.invalidateQueries({queryKey:["sprint-list"]}),o.value=!1}}),{mutate:me,isPending:Ee}=Ke({onSuccess:g=>{P({name:g.title}),J.invalidateQueries({queryKey:["sprint-list"]}),o.value=!1}});function Re(g){var p;x.value?me({id:(p=x.value)==null?void 0:p._id,payload:{workspace_id:V.value,title:g.name}}):se({payload:{workspace_id:V.value,title:g.name}})}function ot(){x.value=null,console.log(">>> felo"),o.value=!0}function it(g){x.value=g,o.value=!0}function dt(g){x.value=g,O.value=!0}const{mutate:ut,isPending:ct}=Pt(d,{onSuccess:()=>{ne()}}),pt=()=>{ut({})};return(g,p)=>{var fe,ue,R,ce,ve,Ve,Te,$e,Le,Me;return m(),h(_e,null,[e("div",ss,[e("div",ls,[F(Dt,{prefix:"View By",modelValue:d.value,"onUpdate:modelValue":p[1]||(p[1]=Z=>d.value=Z),options:(fe=v(l))==null?void 0:fe.sprints,variant:"secondary",onEditOption:it,onDeleteOption:dt},{more:A(()=>[e("div",{onClick:p[0]||(p[0]=Z=>ot()),class:"capitalize border-t border-border px-4 py-2 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-1 overflow-hidden overflow-ellipsis text-nowrap"},p[11]||(p[11]=[e("i",{class:"fa-solid fa-plus"},null,-1),W(" Add new ")]))]),_:1},8,["modelValue","options"]),e("div",rs,[F(Vt,{placeholder:"Search in Orchit AI space"}),((ue=v(D))==null?void 0:ue.status)=="active"?(m(),G(re,{key:0,size:"sm",onClick:pt},{default:A(()=>[W(I(v(ct)?"Ending...":"End"),1)]),_:1})):(m(),G(re,{key:1,size:"sm",onClick:Ce,disabled:!z.value||z.value.tickets.length==0},{default:A(()=>p[12]||(p[12]=[W("Start Sprint")])),_:1,__:[12]},8,["disabled"]))])]),((R=v(D))==null?void 0:R.status)=="active"?(m(),G(as,{key:0,sptint_id:d.value},null,8,["sptint_id"])):(m(),h("div",ns,[e("div",os,[e("section",is,[e("div",ds,[e("h2",us,"Sprint ("+I((ve=(ce=z.value)==null?void 0:ce.tickets)==null?void 0:ve.length)+" Taks)",1)]),v(pe)?(m(),h("div",cs,p[13]||(p[13]=[e("div",{role:"status","aria-label":"Loading",class:"h-10 w-10 rounded-full border-4 border-neutral-700 border-t-transparent animate-spin"},null,-1)]))):(m(),h(_e,{key:1},[z.value?(m(),G(na,{key:0,sprintId:d.value,sprint:z.value,onOpenTicket:u,onEditSprint:f,onToggleStart:v(L),onMoveSelectedToBacklog:v(b),onDeleteSelectedSprint:p[2]||(p[2]=Z=>v(T)("sprint",Z)),onRefresh:S},null,8,["sprintId","sprint","onToggleStart","onMoveSelectedToBacklog"])):X("",!0)],64))]),e("section",ps,[e("div",ms,[e("h2",fs,"Backlog ("+I((Te=(Ve=v(N))==null?void 0:Ve.cards)==null?void 0:Te.length)+" Tasks)",1),e("div",{class:"flex items-center gap-2"},[e("button",{class:"w-8 h-8 rounded-md border cursor-pointer aspect-square text-sm border-border hover:bg-bg-surface/80",onClick:ke},p[14]||(p[14]=[e("i",{class:"text-text-primary fa-regular fa-plus"},null,-1)]))])]),v(k)?(m(),h("div",vs,p[15]||(p[15]=[e("div",{role:"status","aria-label":"Loading",class:"h-10 w-10 rounded-full border-4 border-neutral-700 border-t-transparent animate-spin"},null,-1)]))):(m(),G(Gt,{key:1,sorters:le,onMoveSelectedToSprint:v(y),onDeleteSelectedBacklog:p[3]||(p[3]=Z=>v(T)("backlog")),onOpenTicket:u,onTicketMovedToBacklog:U},null,8,["onMoveSelectedToSprint"]))])])]))]),F(Tt,{onClick:p[4]||(p[4]=he(()=>{},["stop"])),modelValue:O.value,"onUpdate:modelValue":p[5]||(p[5]=Z=>O.value=Z),title:"Delete Sprint",itemLabel:"Sprint",itemName:($e=x.value)==null?void 0:$e.title,requireMatchText:(Le=x.value)==null?void 0:Le.title,confirmText:"Delete Ticket",cancelText:"Cancel",size:"md",loading:v(q),onConfirm:w,onCancel:p[6]||(p[6]=()=>{x.value=null,O.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),F(da,{modelValue:o.value,"onUpdate:modelValue":p[7]||(p[7]=Z=>o.value=Z),onSave:Re,sprint:x.value,creatingSprint:x.value?v(Ee):v(de)},null,8,["modelValue","sprint","creatingSprint"]),F(ba,{sprint:x.value,modelValue:oe.value,"onUpdate:modelValue":p[8]||(p[8]=Z=>oe.value=Z),onSave:a,creatingSprint:v(s)||v(r)},null,8,["sprint","modelValue","creatingSprint"]),F(Ct,{modelValue:n.value,"onUpdate:modelValue":p[9]||(p[9]=Z=>n.value=Z),cardId:(Me=ae.value)==null?void 0:Me.id,onClose:_},null,8,["modelValue","cardId"]),F(Wa,{modelValue:M.value,"onUpdate:modelValue":p[10]||(p[10]=Z=>M.value=Z)},null,8,["modelValue"])],64)}}});export{_s as default};
