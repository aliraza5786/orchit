import{r as C,n as L,x as st,d as U,c as f,j as r,o,f as e,t as n,k as S,z as E,i as I,g as V,J as at,V as ct,u as pt,b9 as Z,q as gt,$ as ft,af as xt,v as vt,ba as bt,Q as R,N as mt,p as u,e as _t,F as y,y as k,w as ht,bb as yt,ag as B,ad as tt,ac as w}from"./index-0GaFUcCF.js";import{_ as kt}from"./ProgressBar.vue_vue_type_script_setup_true_lang-DoIUZaDB.js";import{d as wt,e as Ct}from"./usePeople-COcuXyqZ.js";import{a as St}from"./FormatDate-DIyppjZM.js";function $t($,{start:g=0,maxWhileLoading:b=90,step:d=.8,intervalMs:c=120}={}){const i=C(g);let p=null;const l=()=>{p==null&&(p=window.setInterval(()=>{$()&&(i.value=Math.min(i.value+d,b))},c))},x=()=>{p!=null&&(clearInterval(p),p=null)};return L($,M=>{M?(i.value=g,l()):(i.value=100,setTimeout(()=>{i.value=g,x()},300))},{immediate:!0}),st(x),i}const jt={class:"relative p-3 rounded-lg min-w-[240px] sm:min-w-sm border border-border overflow-hidden flex flex-col justify-between bg-bg-card w-full"},Tt={class:"flex justify-between items-start pb-2"},Dt={class:"text-lg font-semibold text-text-primary text-left"},Pt={class:"text-xs text-text-secondary text-left"},Et={class:"flex items-center gap-2"},It={class:""},Lt={class:"flex justify-between text-sm text-text-secondary mb-1"},Mt={key:0,class:"fa-regular text-left fa-arrows-spin animate-spin duration-250"},Nt={key:0},At={key:1},Ot=U({__name:"ProjectCard",props:{title:{},subtitle:{},status:{},progress:{default:0},avatars:{},maxVisible:{default:2},date:{},loading:{type:Boolean,default:!1},color:{default:"#9CA3AF"},totalCard:{default:0},ai:{type:Boolean},doneCard:{}},setup($){const g=$,b=$t(()=>!!g.loading),d=f(()=>g.loading?b.value:g.progress),c=f(()=>Math.round(d.value)>=100),i=C(0);L(c,(l,x)=>{l&&!x&&i.value++});function p(l){switch(l){case"completed":return"bg-green-400/40 border-green-400 text-green-400";case"failed":return"bg-red-400/40 border-red-400 text-red-400";case"in_progress":return"bg-blue-400/20 border-blue-400 text-blue-400";case"pending":return"bg-amber-400/20 border-amber-400 text-amber-400";default:return"progress-default"}}return(l,x)=>(o(),r("div",jt,[e("div",Tt,[e("div",null,[e("h3",Dt,n(l.title),1),e("p",Pt,n(l.subtitle),1)]),e("div",Et,[!l.totalCard&&l.status?(o(),r("span",{key:0,class:E(["text-xs border rounded-full px-2 py-0.5",p(l.status)])},n(l.status),3)):S("",!0)])]),e("div",It,[e("div",Lt,[e("div",null,[e("span",null,n(l.status=="in_progress"?"Generating lane with AI...":"Progress"),1),x[0]||(x[0]=V()),l.status=="in_progress"?(o(),r("i",Mt)):S("",!0)]),l.ai?(o(),r("span",Nt,[V(n(Math.round(d.value))+"% ",1),c.value?(o(),r("span",{key:i.value,class:"confetti-icon select-none","aria-label":"Completed"}," ðŸŽ‰ ")):S("",!0)])):(o(),r("span",At,n(l.doneCard??0)+" / "+n(l.totalCard),1))]),I(kt,{class:"mt-2",progress:d.value,fillColor:"bg-accent",indeterminate:!!l.loading},null,8,["progress","indeterminate"])])]))}}),et=at(Ot,[["__scopeId","data-v-c8d254a0"]]),Rt={class:"flex flex-col gap-4 h-full overflow-x-auto w-full flex-auto"},Bt={class:"p-5 rounded-[6px] bg-bg-card space-y-6"},Ut={class:"flex items-center justify-between"},Vt={class:"flex flex-col w-full"},Jt={class:"text-sm text-text-secondary mt-2"},zt={class:"flex gap-2.5 overflow-x-auto w-full py-8 custom_scroll_bar"},Ht=["onClick"],Ft=["onClick"],Wt={class:"flex flex-grow flex-col sm:flex-row gap-4"},qt={class:"bg-bg-card w-full max-h-full flex-auto p-5 rounded-lg"},Gt={class:"mb-4"},Qt={class:"text-sm text-text-secondary mt-1"},Kt={key:0,class:"ml-1"},Yt={class:"space-y-4"},Xt={key:1,class:"text-center py-8"},Zt={key:2,class:"text-center py-8"},te={class:"flex items-center gap-2 w-32 flex-shrink-0"},ee={key:0,class:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0"},se=["src","alt"],ae={key:2,class:"w-8 h-8 rounded-full bg-bg-body flex items-center justify-center flex-shrink-0"},oe=["title"],re={class:"flex-1"},le=["title"],ne={class:"bg-bg-card w-full flex-auto p-5 max-h-full rounded-lg overflow-y-auto flex flex-col"},de={class:"space-y-4 overflow-y-auto flex-1"},ie={class:"flex-1 min-w-0"},ue={class:"text-sm text-text-primary"},ce={class:"font-medium text-accent/90 pe-1"},pe=["innerHTML"],ge={href:"#",class:"text-accent/90 hover:underline"},fe={class:"text-xs text-text-secondary mt-1"},xe=U({__name:"Peak",setup($){const{isDark:g}=ct(),b=pt(),d=gt(),c=f(()=>{var a;return Z((a=d==null?void 0:d.params)==null?void 0:a.id)}),i=f(()=>{var a;return Z((a=d==null?void 0:d.params)==null?void 0:a.job_id)}),{data:p,isPending:l,error:x,refetch:M}=wt(c),{data:J}=Ct(c),{data:z}=ft(c),H=f(()=>{var v,t,T;const a=(v=J.value)==null?void 0:v.activities,s=((t=b.workspace)==null?void 0:t.created_at)||((T=z.value)==null?void 0:T.created_at);return a!=null&&a.length&&a[0].created_at||s});xt(()=>{console.log("lastUpdateDate:",H.value),console.log("workspaceStore.workspace:",b.workspace),console.log("workspaceData:",z.value)});const N=C(!1),F=C(!1),m=C(null),_=C(null);let j=!1;const ot="https://backend.streamed.space/api/v1/",W=()=>{if(j||_.value)return;const a=localStorage.getItem("token")||"",s=i.value,v=localStorage.getItem("jobId"),t=s||v||c.value,ut=`${ot}common/step2/tasks/${t}/stream?token=${a}&is_manual=${s||v?"false":"true"}`,P=new EventSource(ut);_.value=P,P.onopen=()=>{j||(F.value=!0)},P.onmessage=O=>{var Y;if(!j)try{m.value=JSON.parse(O.data);const X=((Y=m.value)==null?void 0:Y.status)??"cancels";["completed","failed","canceled"].includes(X)&&D()}catch{}},P.onerror=()=>{D()},_.value.addEventListener("progress",O=>{console.log(">> trki g");try{m.value=JSON.parse(O.data)}catch{}})},D=()=>{F.value=!1,_.value&&(_.value.close(),_.value=null)};vt(()=>{j=!1,W()}),st(()=>{j=!0,D()});const h=f(()=>{var a;return((a=m.value)==null?void 0:a.percent)===100}),rt=f(()=>{var a,s;return((s=(a=m.value)==null?void 0:a.result)==null?void 0:s.lanes_summary)??[]}),lt=f(()=>{var a,s;return((s=(a=m.value)==null?void 0:a.progress_details)==null?void 0:s.lanes_progress)??[]}),q=["https://randomuser.me/api/portraits/women/1.jpg","https://randomuser.me/api/portraits/men/2.jpg","https://randomuser.me/api/portraits/men/3.jpg"],G=a=>{console.log("Lane clicked:",a)},Q=f(()=>{var a;return(a=p.value)!=null&&a.team_workload?p.value.team_workload.map(s=>({id:s.assignee_id||"unassigned",name:s.assignee_name,initials:s.initials||R(s.assignee_name)||"",avatar:!!s.avatar_url||!!s.assignee_id,avatarUrl:s.avatar_url,color:bt(s.assignee_id,s.assignee_name),workload:s.work_distribution_percentage,totalTasks:s.total_tasks,totalHours:s.total_hours})):[]}),A=f(()=>{var a;return((a=p.value)==null?void 0:a.team_size)||0}),nt=a=>({"DEPLOYED-PROD":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",REOPENED:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200","IN-PROGRESS":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"})[a]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200",dt=U({name:"SkeletonCard",setup(){return()=>w("div",{class:"w-[380px] min-w-[280px] h-[180px] rounded-xl border border-border bg-bg-body/60 animate-pulse p-4"},[w("div",{class:"h-5 w-2/3 rounded bg-bg-card/50 mb-2"}),w("div",{class:"h-3 w-1/2 rounded bg-bg-card/50 mb-4"}),w("div",{class:"h-2 w-full rounded bg-bg-card/50 mb-1"}),w("div",{class:"h-2 w-11/12 rounded bg-bg-card/50 mb-1"}),w("div",{class:"h-2 w-10/12 rounded bg-bg-card/50"})])}}),K=(a,s)=>a?(s.Done??0)/a*100:0,it=mt();return L(h,a=>{a&&it.invalidateQueries({queryKey:["dashboard-teams",c.value]})}),L([c,i],()=>{D(),W()}),(a,s)=>{var v;return o(),r("div",Rt,[e("div",Bt,[e("div",Ut,[e("div",Vt,[s[1]||(s[1]=e("h3",{class:"text-2xl text-text-primary font-semibold"},"Project Overview",-1)),e("p",Jt,"Last update on "+n(u(St)(H.value)),1),e("div",zt,[N.value?(o(),r(y,{key:0},k(3,t=>I(u(dt),{key:t})),64)):(o(),_t(yt,{key:1,name:"list",tag:"div",class:"flex gap-2.5"},{default:ht(()=>[h.value?(o(!0),r(y,{key:0},k(rt.value,t=>(o(),r("button",{key:t==null?void 0:t.lane_title,class:"group focus:outline-none border-border border focus-visible:ring-2 focus-visible:ring-primary/50 rounded-xl",type:"button",role:"button","aria-label":"Open lane details",onClick:T=>G(t)},[I(et,{ai:!1,doneCard:t==null?void 0:t.status_distribution.Done,loading:N.value||(t==null?void 0:t.status)==="in_progress",title:t==null?void 0:t.lane_title,subtitle:"",progress:h.value?K(t==null?void 0:t.total_cards,t==null?void 0:t.status_distribution):t==null?void 0:t.progress,totalCard:t==null?void 0:t.total_cards,status:h.value?"":(t==null?void 0:t.status)??"",avatars:q,date:"May 28",class:"transition-transform duration-200 ease-out group-hover:shadow-lg border border-transparent hover:border-border-subtle rounded-xl cursor-pointer"},null,8,["doneCard","loading","title","progress","totalCard","status"])],8,Ht))),128)):(o(!0),r(y,{key:1},k(lt.value,t=>(o(),r("button",{key:`2-${t==null?void 0:t.lane_title}`,class:"group focus:outline-none border-border border focus-visible:ring-2 focus-visible:ring-primary/50 rounded-xl",type:"button",role:"button","aria-label":"Open lane details",onClick:T=>G(t)},[I(et,{ai:!0,loading:N.value||(t==null?void 0:t.status)==="in_progress",title:t==null?void 0:t.lane_title,subtitle:"",progress:h.value?K(t==null?void 0:t.total_cards,t==null?void 0:t.status_distribution):t==null?void 0:t.progress,totalCard:t==null?void 0:t.total_cards,status:h.value?"":(t==null?void 0:t.status)??"",avatars:q,date:"May 28",class:"transition-transform duration-200 ease-out group-hover:shadow-lg border border-transparent hover:border-border-subtle rounded-xl cursor-pointer"},null,8,["loading","title","progress","totalCard","status"])],8,Ft))),128))]),_:1}))])])])]),e("div",Wt,[e("div",qt,[e("div",Gt,[s[3]||(s[3]=e("h3",{class:"text-lg font-semibold text-text-primary"},"Team workload",-1)),e("p",Qt,[s[2]||(s[2]=V(" Monitor the capacity of your team. ")),A.value>0?(o(),r("span",Kt,"("+n(A.value)+" member"+n(A.value!==1?"s":"")+")",1)):S("",!0)])]),e("div",Yt,[s[8]||(s[8]=e("div",{class:"flex items-center justify-between text-sm font-medium text-text-secondary mb-2"},[e("span",null,"Assignee"),e("span",null,"Work distribution")],-1)),u(l)?(o(),r(y,{key:0},k(3,t=>e("div",{key:t,class:"flex items-center gap-3 animate-pulse"},s[4]||(s[4]=[e("div",{class:"flex items-center gap-2 w-32 flex-shrink-0"},[e("div",{class:"w-8 h-8 rounded-full bg-bg-body"}),e("div",{class:"h-4 w-20 bg-bg-body rounded"})],-1),e("div",{class:"flex-1 h-6 bg-bg-body rounded"},null,-1)]))),64)):u(x)?(o(),r("div",Xt,[s[5]||(s[5]=e("p",{class:"text-sm text-red-500 mb-2"},"Failed to load team workload",-1)),e("button",{onClick:s[0]||(s[0]=()=>u(M)()),class:"text-xs text-accent hover:underline"}," Try again ")])):Q.value.length===0?(o(),r("div",Zt,s[6]||(s[6]=[e("i",{class:"pi pi-users text-3xl text-text-secondary mb-2"},null,-1),e("p",{class:"text-sm text-text-secondary"},"No team members assigned yet",-1)]))):(o(!0),r(y,{key:3},k(Q.value,t=>(o(),r("div",{key:t.id,class:"flex items-center gap-3"},[e("div",te,[t.avatarUrl?(o(),r("div",ee,[e("img",{src:t.avatarUrl,alt:t.name,class:"w-full h-full object-cover"},null,8,se)])):t.avatar?(o(),r("div",{key:1,class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0",style:B({backgroundColor:u(tt)({name:t==null?void 0:t.name})})},n(u(R)(t.name)),5)):(o(),r("div",ae,s[7]||(s[7]=[e("i",{class:"pi pi-user text-text-secondary"},null,-1)]))),e("span",{class:"text-sm text-text-primary truncate",title:t.name},n(t.name),9,oe)]),e("div",re,[e("div",{class:"h-6 bg-bg-body rounded overflow-hidden relative group cursor-help",title:`${t.totalTasks} task${t.totalTasks!==1?"s":""} â€¢ ${t.totalHours}h`},[e("div",{class:E(["h-full transition-all duration-300",u(g)?"bg-accent":"!bg-accent-hover/40"]),style:B({width:t.workload+"%"})},null,6),t.workload>0?(o(),r("span",{key:0,class:E(["absolute inset-0 flex items-center justify-start px-2 text-[11px] font-medium",u(g)?"text-white":"text-black"])},n(t.workload)+"% ",3)):S("",!0)],8,le)])]))),128))])]),e("div",ne,[s[10]||(s[10]=e("div",{class:"mb-4"},[e("h3",{class:"text-lg font-semibold text-text-primary"},"Recent activity"),e("p",{class:"text-sm text-text-secondary mt-1"},"Stay up to date with what's happening across the project.")],-1)),e("div",de,[s[9]||(s[9]=e("div",{class:"text-xs font-semibold text-text-secondary mb-3"},"Today",-1)),(o(!0),r(y,null,k((v=u(J))==null?void 0:v.activities,t=>(o(),r("div",{key:t.id,class:"flex gap-3 pb-4 border-b border-border last:border-0"},[e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0",style:B({backgroundColor:u(tt)({email:t.user.email})})},n(u(R)(t.user.name)),5),e("div",ie,[e("div",ue,[e("span",ce,n(t.user.name),1),e("span",{class:"text-text-secondary",innerHTML:t.message},null,8,pe),e("a",ge,n(t.item),1),t.status?(o(),r("span",{key:0,class:E(["ml-2 px-2 py-0.5 rounded text-xs font-medium",nt(t.status)])},n(t.status),3)):S("",!0)]),e("div",fe,n(t.time),1)])]))),128))])])])])}}}),he=at(xe,[["__scopeId","data-v-22f1f8c9"]]);export{he as default};
