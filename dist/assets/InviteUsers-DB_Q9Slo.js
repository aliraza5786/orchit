import{d as j,c as l,M as q,r as k,as as M,J as O,n as Q,bE as T,e as D,o as F,w as c,h as o,k as d,H,B as x,i as V,p as I,t as J,W as K,T as p}from"./index-DPI-BQvI.js";import{_ as L}from"./BaseEmailChip.vue_vue_type_script_setup_true_lang-DLuYLACk.js";import{b as R}from"./auth-Du-W0IJB.js";const Z={class:"px-6 flex flex-col gap-4"},G={class:"flex justify-end gap-2 p-6 mt-6 sticky bottom-0 bg-bg-body border-t border-border"},ae=j({__name:"InviteUsers",props:{modelValue:{type:Boolean,default:!1},defaultWorkspaceId:{}},emits:["update:modelValue","invited"],setup(C,{emit:E}){const v=E,f=C,n=l({get:()=>f.modelValue,set:e=>v("update:modelValue",e)}),B=q(),h=k(1),w=k(100),{data:r}=M(h,w),s=O({workspace_id:null,role_id:"viewer",emails:[]});Q(()=>f.defaultWorkspaceId,e=>{e&&!s.workspace_id?s.workspace_id=e:s.workspace_id=U.value[0]._id},{immediate:!0});const U=l(()=>{var e;return(((e=r==null?void 0:r.value)==null?void 0:e.workspaces)??[]).map(a=>{var t;return{_id:a._id??a.id,title:((t=a==null?void 0:a.variables)==null?void 0:t.title)??a.title??String(a._id??a.id)}})}),_=l(()=>s.role_id?"":"Role is required"),m=l(()=>{const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return s.emails.filter(a=>!e.test(a))}),b=l(()=>m.value.length?`Invalid: ${m.value.join(", ")}`:""),g=l(()=>!!s.workspace_id&&!!s.role_id&&s.emails.length>0&&m.value.length===0);function A(e){}function S(){}const{mutate:N,isPending:u}=R(),{data:z}=T();function P(){!g.value||u.value||N({payload:{company_id:z.value._id,role:s.role_id,emails:s.emails.map(e=>({email:e,name:$(e)}))}},{onSuccess:e=>{var a,t;(a=e==null?void 0:e.failedInvites)!=null&&a.length?p.error(((t=e.failedInvites[0])==null?void 0:t.error)??"Some invites failed"):p.success("Invitations sent"),B.invalidateQueries({queryKey:["all-users"]}),v("invited",e),y(),n.value=!1},onError:e=>{var t,i;const a=((i=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:i.message)||(e==null?void 0:e.message)||"Failed to send invitations.";p.error(a)}})}function W(){y(),n.value=!1}function y(){s.role_id=null,s.emails=[]}function $(e){const t=(e.split("@")[0]||"").split("+")[0].split(/[^a-zA-Z]+/).filter(Boolean);return t.length?t.map(i=>i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()).join(" "):e}return(e,a)=>(F(),D(K,{modelValue:n.value,"onUpdate:modelValue":a[2]||(a[2]=t=>n.value=t),size:"md",modalClass:"!py-0"},{default:c(()=>[a[4]||(a[4]=o("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[o("h2",{class:"text-xl font-semibold"},"Invite Users"),o("p",{class:"text-sm text-text-secondary mt-1"}," Add emails, and pick a permission.")],-1)),o("div",Z,[d(L,{class:"w-full",label:"User emails",modelValue:s.emails,"onUpdate:modelValue":a[0]||(a[0]=t=>s.emails=t),error:!!b.value,message:b.value||"Press Enter after each email",showName:"",onInvalid:A,onAdd:S},null,8,["modelValue","error","message"]),d(H,{size:"md",label:"Permission",options:[{title:"Viewer",_id:"viewer"},{title:"Editor",_id:"editor"},{title:"Admin",_id:"admin"}],placeholder:"Choose role","model-value":s.role_id,"onUpdate:modelValue":a[1]||(a[1]=t=>s.role_id=t),disabled:!s.workspace_id,message:_.value,error:!!_.value},null,8,["model-value","disabled","message","error"])]),o("div",G,[d(x,{variant:"secondary",onClick:W},{default:c(()=>a[3]||(a[3]=[V("Cancel")])),_:1,__:[3]}),d(x,{variant:"primary",disabled:!g.value||I(u),onClick:P},{default:c(()=>[V(J(I(u)?"Invitingâ€¦":"Send Invites"),1)]),_:1},8,["disabled"])])]),_:1,__:[4]},8,["modelValue"]))}});export{ae as default};
