import{n as Q,b as ee,d as te,r,q as F,ax as ae,j as l,o as c,C as N,G as se,k as b,H as ne,f as _,t as U,v as A,g as oe,an as re}from"./index-Cl_zIigK.js";const ie=Q.create({baseURL:"https://api.openai.com/v1",headers:{"Content-Type":"application/json",Authorization:"Bearer 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"}}),le=(R={})=>ee({mutationFn:async B=>{const a=new FormData;return a.append("file",B),a.append("model","whisper-1"),a.append("response_format","json"),(await ie.post("/audio/transcriptions",a,{headers:{Authorization:"Bearer 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","Content-Type":"multipart/form-data"}})).data.text},...R}),ce={key:0,class:"absolute top-3 left-2 text-xs text-accent ml-2 mt-1"},ue={key:0,class:"w-8 h-8 aspect-square rounded-lg cursor-pointer bg-accent p-2 flex items-center justify-center"},de={key:1,class:"w-8 h-8 aspect-square rounded-lg bg-accent flex justify-center items-center text-center cursor-pointer"},he={key:2,class:"text-text-secondary"},ve={key:3,class:"text-red-500"},pe={key:4,class:"text-white mt-2 text-sm"},fe=3,P=200,ge=te({__name:"AudioRecorder",props:{class:{type:String,default:""}},emits:["transcribed","update:isRecording","update:hasAudio"],setup(R,{emit:B}){const a=B,Z=R,y=r(0);let w=null;const X=r(null),n=r(null),o=r(!1),S=r(null);let L=[],u=null;const{mutate:H,data:T,isPending:V,isError:G}=le({onSuccess:e=>{a("update:isRecording",!1),a("update:hasAudio",!1),a("transcribed",e)}});F(T,e=>{e&&a("transcribed",e)});let d=null,v,x,D,E=0;const i=r(null),J=r(!1),W=r(0),p=new Array(P).fill(0),M=()=>{if(!S.value||!v)return;const e=S.value,t=e.getContext("2d");if(!t)return;v.getByteFrequencyData(x);const f=x.reduce((O,Y)=>O+Y,0)/x.length/255*.8;E++,E%fe===0&&(p.push(f),p.length>P&&p.shift()),t.clearRect(0,0,e.width,e.height);const h=e.height/2;t.strokeStyle="var(--accent)",t.setLineDash([2,2]),t.beginPath(),t.moveTo(0,h),t.lineTo(e.width,h),t.stroke(),t.setLineDash([]);const m=1,g=m+1,C=e.width-p.length*g;t.fillStyle="var(--accent)",p.forEach((O,Y)=>{const j=O*e.height*1,I=C+Y*g;t.fillRect(I,h-j,m,j||5),t.fillRect(I,h,m,j||5)}),D=requestAnimationFrame(M)},q=()=>{cancelAnimationFrame(D),d==null||d.close(),d=null},$=async()=>{if(o.value)u==null||u.stop(),q(),o.value=!1,w&&(clearInterval(w),w=null);else{const e=await navigator.mediaDevices.getUserMedia({audio:!0});u=new MediaRecorder(e),L=[],u.ondataavailable=s=>{s.data.size>0&&L.push(s.data)},u.onstop=()=>{const s=new Blob(L,{type:"audio/webm"});X.value=s,n.value=URL.createObjectURL(s);const f=new File([s],"recording.webm",{type:"audio/webm"});H(f),i.value=new Audio(n.value),i.value.addEventListener("timeupdate",()=>{W.value=Math.floor(i.value.currentTime)}),i.value.addEventListener("ended",()=>{J.value=!1,W.value=0}),n.value=URL.createObjectURL(s),i.value=new Audio(n.value),i.value.addEventListener("timeupdate",()=>{W.value=Math.floor(i.value.currentTime)}),i.value.addEventListener("ended",()=>{J.value=!1})},d=new AudioContext;const t=d.createMediaStreamSource(e);v=d.createAnalyser(),v.fftSize=2048,x=new Uint8Array(v.frequencyBinCount),t.connect(v),M(),u.start(),o.value=!0,y.value=0,w=setInterval(()=>{y.value++},1e3)}},z=r(null),K=()=>{if(!z.value||!X.value)return;const e=z.value,t=e.getContext("2d");if(!t)return;e.width=e.clientWidth,e.height=e.clientHeight,t.clearRect(0,0,e.width,e.height);const s=e.height/2,f=300,h=2,m=2;for(let k=0;k<f;k++){const g=Math.random()*e.height*.6+4,C=k*(h+m);t.fillStyle="white",t.fillRect(C,s-g/2,h,g)}};return F(n,e=>{e?(a("update:hasAudio",!0),re(K)):a("update:hasAudio",!1)}),F(o,e=>{e&&a("update:isRecording",e)}),ae(()=>{q()}),(e,t)=>(c(),l("div",{class:N(["",o.value?"relative":` ${Z.class} `])},[se(_("canvas",{ref_key:"canvasRef",ref:S,class:"w-full h-12 rounded-xl p-3 bg-bg-surface"},null,512),[[ne,o.value]]),o.value?(c(),l("div",ce,U(Math.floor(y.value/60))+":"+U((y.value%60).toString().padStart(2,"0")),1)):b("",!0),n.value?b("",!0):(c(),l("button",{key:1,onClick:$,class:N([" text-sm overflow-hidden",o.value?"text-red-500 mt-1  absolute right-2 top-1":"text-text-primary"])},[o.value?(c(),l("div",ue,t[0]||(t[0]=[_("div",{class:"w-2 bg-white h-2 aspect-square"},null,-1)]))):(c(),l("div",de,t[1]||(t[1]=[_("i",{class:"text-white fa-solid fa-microphone font-base"},null,-1)])))],2)),A(V)&&n.value?(c(),l("p",he,"Transcribing...")):b("",!0),A(G)&&n.value?(c(),l("p",ve,"Transcription failed.")):b("",!0),A(T)&&n.value?(c(),l("p",pe,[t[2]||(t[2]=_("strong",null,"Transcirpt:",-1)),oe(" "+U(A(T)),1)])):b("",!0)],2))}});export{ge as _};
