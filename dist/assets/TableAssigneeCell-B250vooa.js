import{d as xe,W as ge,N as we,aU as _e,c as j,r as f,p as ye,x as he,av as be,j as a,o,A as ke,f as d,ah as A,q as z,ad as ae,t as g,Q as re,g as Ie,E as Ce,e as Ee,P as Le,ai as le,k as Ue,h as V,F as Be,z as Re,ay as je,al as ze}from"./index-B6QqO5al.js";const Te={key:0,class:"flex gap-2 items-center truncate"},Ae=["src"],Ve={key:2,class:"w-6 h-6 bg-bg-body border border-border rounded-full flex justify-center items-center flex-shrink-0"},Me={class:"text-[11px] text-text-primary truncate"},Ne={key:1,class:"truncate text-text-secondary opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1.5 text-xs"},He={key:1,class:"relative w-full"},$e={class:"max-h-60 overflow-y-auto py-1"},qe=["onMousedown"],De={class:"flex items-center gap-3 min-w-0"},Oe=["src"],Se={key:2,class:"w-6 h-6 bg-bg-body border border-border rounded-full flex justify-center items-center flex-shrink-0"},Fe={class:"min-w-0"},Ke={class:"text-xs font-medium truncate"},Pe={class:"text-[10px] text-text-secondary truncate"},We={class:"text-xs font-medium text-text-secondary whitespace-nowrap ml-2"},Ye={key:0,class:"text-[10px] px-2 py-1 border rounded-full border-red-500 transition group-hover:bg-red-500 group-hover:text-white"},Qe={key:1,class:"text-red-500"},Xe={key:2,class:"text-[10px] px-2 py-1 border rounded-full border-accent group-hover:bg-accent transition group-hover:text-white"},Ge={key:1,class:"px-4 py-3 text-center text-sm text-text-secondary"},et=xe({__name:"TableAssigneeCell",props:{assigneeId:{},disabled:{type:Boolean},seat:{},workspaceId:{},name:{},emptyText:{}},emits:["update:modelValue","assign","unassign"],setup(ie,{emit:de}){const u=ie,w=de,{canAssignCard:ue}=ge(),{workspaceId:ce}=we(),{data:M}=_e(j(()=>(u==null?void 0:u.workspaceId)??ce.value)),L=f(u.assigneeId??u.seat);ye(()=>[u.assigneeId,u.seat],()=>{L.value=u.assigneeId??u.seat},{deep:!0});const _=f(!1),U=f(!1),y=f(""),h=f(null),T=f(null),b=f(null),N=f({top:"0px",left:"0px",width:"100%"}),s=j(()=>{const e=L.value;if(!e)return null;const t=e._id||e.id||e;return(M.value||[]).find(i=>{var m,v;const c=i._id||i.id,l=((m=i.user)==null?void 0:m._id)||((v=i.user)==null?void 0:v.id);return c==t||l==t})||e}),H=j(()=>{const e=s.value,t=M.value||[];if(e&&(e._id||e.id)){const r=e._id||e.id,i=e,c=t.filter(l=>{var k,I,C,E;const m=l._id||l.id,v=((k=l.user)==null?void 0:k._id)||((I=l.user)==null?void 0:I.id),R=((C=e.user)==null?void 0:C._id)||((E=e.user)==null?void 0:E.id);return!(m==r||v&&v==(R||r))});return[i,...c]}return[...t]}),B=j(()=>{const e=y.value.trim().toLowerCase(),t=H.value;return e?t.filter(r=>(r.title||r.name||"").toLowerCase().includes(e)||(r.email||"").toLowerCase().includes(e)):t}),p=()=>{if(!h.value||!b.value)return;const e=h.value.getBoundingClientRect(),t=b.value.offsetHeight||200,i=window.innerHeight-e.bottom;let l=e.bottom+window.scrollY+6;i<t&&e.top>t&&(l=e.top+window.scrollY-t-5),N.value={top:`${l}px`,left:`${e.left+window.scrollX}px`,width:`${e.width}px`}},ve=async()=>{var t,r,i,c,l;if(u.disabled||!ue.value)return;_.value=!0,U.value=!0;const e=((t=s.value)==null?void 0:t.name)||((r=s.value)==null?void 0:r.title)||((i=s.value)==null?void 0:i.u_full_name);y.value=e||"",await ze(),(c=h.value)==null||c.focus(),(l=h.value)==null||l.select(),p(),window.addEventListener("scroll",p,!0),window.addEventListener("resize",p)},x=()=>{_.value=!1,U.value=!1,y.value="",window.removeEventListener("scroll",p,!0),window.removeEventListener("resize",p)};function fe(e){const t=H.value.find(r=>r._id==e);t&&(L.value=t,w("assign",t),w("update:modelValue",e)),x()}function $(){L.value=null,w("unassign"),w("assign",{_id:null}),w("update:modelValue",null),x()}function q(e){if(e._id==null){$();return}if(s.value&&e._id===s.value._id){$();return}fe(e._id)}const pe=()=>{B.value.length>0?q(B.value[0]):x()},me=()=>{setTimeout(()=>{_.value&&x()},150)},D=e=>{T.value&&!T.value.contains(e.target)&&b.value&&!b.value.contains(e.target)&&_.value&&x()};return he(()=>{document.addEventListener("mousedown",D)}),be(()=>{document.removeEventListener("mousedown",D),window.removeEventListener("scroll",p,!0),window.removeEventListener("resize",p)}),(e,t)=>{var r,i,c,l,m,v,R,k,I,C,E,O,S,F,K,P,W,Y,Q,X,G,J,Z,ee,te,se;return o(),a("div",{class:"relative w-full h-full",ref_key:"containerRef",ref:T,onClick:t[3]||(t[3]=V(()=>{},["stop"]))},[_.value?(o(),a("div",He,[Ce(d("input",{ref_key:"inputRef",ref:h,"onUpdate:modelValue":t[0]||(t[0]=n=>y.value=n),onBlur:me,onKeydown:[le(pe,["enter"]),le(x,["esc"])],onInput:t[1]||(t[1]=n=>U.value=!0),class:"absolute left-0 top-1/2 h-8 -translate-y-1/2 min-w-[200px] w-full p-1 border border-accent/60 rounded-sm focus:outline-none focus:ring-1 focus:ring-accent bg-bg-body z-50 text-[12px]",placeholder:"Add people by name or email"},null,544),[[Le,y.value]]),(o(),Ee(je,{to:"body"},[U.value?(o(),a("div",{key:0,ref_key:"dropdownRef",ref:b,class:"fixed z-[9999] bg-bg-dropdown border border-border rounded-md shadow-lg",style:A(N.value),onMousedown:t[2]||(t[2]=V(()=>{},["prevent"]))},[d("ul",$e,[B.value.length>0?(o(!0),a(Be,{key:0},Re(B.value,n=>{var ne,oe;return o(),a("li",{key:n._id??"unassign",onMousedown:V(Je=>q(n),["prevent"]),class:"px-3 py-2 cursor-pointer hover:bg-bg-dropdown-menu-hover text-[12px] text-text-primary flex items-center justify-between group"},[d("div",De,[(ne=n==null?void 0:n.user)!=null&&ne.avatar?(o(),a("img",{key:0,src:n.user.avatar,class:"w-6 h-6 rounded-full object-cover flex-shrink-0",alt:""},null,8,Oe)):n.name&&n._id?(o(),a("div",{key:1,class:"w-6 h-6 border border-border rounded-full text-xs font-semibold flex items-center justify-center flex-shrink-0",style:A({backgroundColor:n!=null&&n.email?z(ae)({name:n.name,email:n.email,_id:n._id}):""})},g(z(re)(n.name)),5)):(o(),a("div",Se,t[6]||(t[6]=[d("i",{class:"fa-regular fa-user text-xs"},null,-1)]))),d("div",Fe,[d("div",Ke,g(n.name||n.title),1),d("div",Pe,g(n.role_title),1)])]),d("div",We,[n._id&&((oe=s.value)==null?void 0:oe._id)===n._id?(o(),a("span",Ye," Unassign ")):n._id==null?(o(),a("span",Qe)):(o(),a("span",Xe," Assign to "))])],40,qe)}),128)):(o(),a("div",Ge," No match found "))])],36)):Ue("",!0)]))])):(o(),a("div",{key:0,onClick:ve,class:ke(["w-full h-full flex items-center px-3 py-1.5 cursor-pointer hover:bg-bg-surface-hover rounded-md truncate transition-all duration-200 min-h-[36px] group",{"opacity-50 cursor-not-allowed":e.disabled}])},[(i=(r=s.value)==null?void 0:r.user)!=null&&i.avatar||(c=s.value)!=null&&c._id||(l=e.seat)!=null&&l._id?(o(),a("div",Te,[(v=(m=s.value)==null?void 0:m.avatar)!=null&&v.src||(k=(R=s.value)==null?void 0:R.user)!=null&&k.avatar||(I=s.value)!=null&&I.u_profile_image?(o(),a("img",{key:0,src:((E=(C=s.value)==null?void 0:C.avatar)==null?void 0:E.src)??((O=s.value)==null?void 0:O.u_profile_image)??((F=(S=s.value)==null?void 0:S.user)==null?void 0:F.avatar),class:"w-5 h-5 object-cover rounded-full flex-shrink-0",alt:""},null,8,Ae)):(K=s.value)!=null&&K.u_full_name||(P=s.value)!=null&&P.name?(o(),a("div",{key:1,class:"w-5 h-5 aspect-square rounded-full text-[11px] bg-bg-surface text-text-primary flex items-center justify-center flex-shrink-0",style:A({backgroundColor:((W=s.value)==null?void 0:W.u_full_name)??((Y=s.value)==null?void 0:Y.title)?z(ae)({name:((Q=s.value)==null?void 0:Q.u_full_name)??((X=s.value)==null?void 0:X.title),_id:(G=s.value)==null?void 0:G._id}):""})},g(z(re)(((J=s.value)==null?void 0:J.u_full_name)??((Z=s.value)==null?void 0:Z.name))),5)):(o(),a("div",Ve,t[4]||(t[4]=[d("i",{class:"fa-regular fa-user text-xs"},null,-1)]))),d("span",Me,g((((ee=s.value)==null?void 0:ee.name)||((te=s.value)==null?void 0:te.title)||((se=s.value)==null?void 0:se.u_full_name))??"Unassigned"),1)])):(o(),a("span",Ne,[t[5]||(t[5]=d("i",{class:"fa-solid fa-plus text-[10px]"},null,-1)),Ie(" Add "+g(e.emptyText||"Assignee"),1)]))],2))],512)}}});export{et as default};
