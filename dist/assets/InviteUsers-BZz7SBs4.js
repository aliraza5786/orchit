import{d as L,c as l,a as O,a0 as K,K as Q,m as D,aj as F,ac as M,ae as T,b as Z,o as G,w as v,e as i,h as n,n as d,B as w,f as C,t as H,L as f}from"./index-BZn88Tk7.js";import{B as J}from"./BaseModal-Lpve6HiZ.js";import{_ as h}from"./BaseSelectField.vue_vue_type_script_setup_true_lang-CfXGO0EQ.js";import{_ as X}from"./BaseEmailChip.vue_vue_type_script_setup_true_lang-DvZ1gVNN.js";import"./cross-DvraoB0R.js";import"./info-DjaLHeD_.js";const Y={class:"px-6 flex flex-col gap-4"},ee={class:"flex justify-end gap-2 p-6 mt-6 sticky bottom-0 bg-bg-body border-t border-border"},ne=L({__name:"InviteUsers",props:{modelValue:{type:Boolean,default:!1},defaultWorkspaceId:{}},emits:["update:modelValue","invited"],setup(B,{emit:E}){const _=E,k=B,r=l({get:()=>k.modelValue,set:e=>_("update:modelValue",e)}),U=O(),{data:m}=K(1,100),a=Q({workspace_id:null,role_id:null,emails:[]});D(()=>k.defaultWorkspaceId,e=>{e&&!a.workspace_id&&(a.workspace_id=e)},{immediate:!0});const S=l(()=>((m==null?void 0:m.value)??[]).map(e=>{var s;return{_id:e._id??e.id,title:((s=e==null?void 0:e.variables)==null?void 0:s.title)??e.title??String(e._id??e.id)}})),W=F(a,"workspace_id"),{data:u,isPending:b}=M(W),P=l(()=>((u==null?void 0:u.value)??[]).map(e=>({_id:e.role_id??e.id,title:e.title??e.name??"Role"}))),g=l(()=>a.workspace_id?"":"Workspace is required"),x=l(()=>a.role_id?"":"Role is required"),c=l(()=>{const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return a.emails.filter(s=>!e.test(s))}),y=l(()=>c.value.length?`Invalid: ${c.value.join(", ")}`:""),V=l(()=>!!a.workspace_id&&!!a.role_id&&a.emails.length>0&&c.value.length===0);function R(e){a.workspace_id=e,a.role_id=null}function z(e){}function N(){}const{mutate:j,isPending:p}=T();function q(){!V.value||p.value||j({workspace_id:a.workspace_id,workspace_role_id:a.role_id,emails:a.emails.map(e=>({name:$(e),email:e}))},{onSuccess:e=>{var s,o;(s=e==null?void 0:e.failedInvites)!=null&&s.length?f.error(((o=e.failedInvites[0])==null?void 0:o.error)??"Some invites failed"):f.success("Invitations sent"),U.invalidateQueries({queryKey:["all-users"]}),_("invited",e),I(),r.value=!1},onError:e=>{var o,t;const s=((t=(o=e==null?void 0:e.response)==null?void 0:o.data)==null?void 0:t.message)||(e==null?void 0:e.message)||"Failed to send invitations.";f.error(s)}})}function A(){I(),r.value=!1}function I(){a.role_id=null,a.emails=[]}function $(e){const o=(e.split("@")[0]||"").split("+")[0].split(/[^a-zA-Z]+/).filter(Boolean);return o.length?o.map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" "):e}return(e,s)=>(G(),Z(J,{modelValue:r.value,"onUpdate:modelValue":s[2]||(s[2]=o=>r.value=o),size:"md",modalClass:"!py-0"},{default:v(()=>[s[4]||(s[4]=i("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[i("h2",{class:"text-xl font-semibold"},"Invite Users"),i("p",{class:"text-sm text-text-secondary mt-1"},"Select a workspace, add emails, and pick a role.")],-1)),i("div",Y,[n(X,{class:"w-full",label:"User emails",modelValue:a.emails,"onUpdate:modelValue":s[0]||(s[0]=o=>a.emails=o),error:!!y.value,message:y.value||"Press Enter after each email",showName:"",onInvalid:z,onAdd:N},null,8,["modelValue","error","message"]),n(h,{size:"md",label:"Role",options:P.value,placeholder:"Choose role","model-value":a.role_id,"onUpdate:modelValue":s[1]||(s[1]=o=>a.role_id=o),disabled:!a.workspace_id||d(b),message:x.value||(d(b)?"Loading roles…":""),error:!!x.value},null,8,["options","model-value","disabled","message","error"]),n(h,{size:"md",label:"Workspace",options:S.value,placeholder:"Choose workspace","model-value":a.workspace_id,"onUpdate:modelValue":R,message:g.value,error:!!g.value},null,8,["options","model-value","message","error"])]),i("div",ee,[n(w,{variant:"secondary",onClick:A},{default:v(()=>s[3]||(s[3]=[C("Cancel")])),_:1,__:[3]}),n(w,{variant:"primary",disabled:!V.value||d(p),onClick:q},{default:v(()=>[C(H(d(p)?"Inviting…":"Send Invites"),1)]),_:1},8,["disabled"])])]),_:1,__:[4]},8,["modelValue"]))}});export{ne as default};
