import{d as We,W as Ge,bm as Ze,r as v,m as D,q as oe,al as Je,M as ne,c as x,Z as Xe,bn as Ye,bo as et,bp as tt,bq as st,br as at,a as lt,aa as it,ah as ot,b as nt,w as g,A as O,C as dt,e as s,h as m,a8 as L,i as o,a9 as de,g as re,V as W,t as c,a1 as rt,aD as ct,j as S,G as ce,bf as ut,F as b,U as ue,y as vt,n as U,x as M,B as G,f as q,af as ve,o as i,H as mt}from"./index-C0EDYk9O.js";const pt={class:"flex flex-col max-w-[380px] min-w-[380px] h-full overflow-y-auto bg-gradient-to-b from-bg-card/95 to-bg-card/90 backdrop-blur rounded-2xl shadow-[0_10px_40px_-10px_rgba(0,0,0,.5)] border border-orchit-white/5 overflow-hidden",role:"complementary","aria-label":"Details panel"},ft={class:"sticky top-0 z-10 backdrop-blur-2xl border-b border-orchit-white/5 px-6 py-4 flex items-center justify-between"},ht={class:"py-5 px-6 flex flex-col gap-5 flex-grow"},xt={class:"capitalize"},gt=["onKeydown"],bt=["innerHTML"],_t={key:1,class:"opacity-60"},wt={key:"tab-details",class:"space-y-6"},yt={class:"grid grid-cols-2 gap-4 text-sm"},kt={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-4"},Ct={class:"mt-1 font-medium"},Dt={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-4"},St={class:"mt-1 font-medium"},Vt={class:"rounded-2xl border border-orchit-white/10 bg-orchit-white/5 p-4 grid grid-cols-1 sm:grid-cols-2 gap-4"},Et={class:"space-y-2"},Ut={class:"space-y-2"},It={class:"space-y-2"},Tt={class:"h-8 px-3 flex items-center gap-2 rounded-lg bg-bg-input border border-orchit-white/10"},Pt={class:"space-y-2"},Bt={key:0,class:"text-xs text-red-400 mt-1"},Lt={key:0,class:"space-y-2 sm:col-span-1"},Mt={class:"text-xs uppercase tracking-wider text-text-secondary"},jt={key:1},zt={class:"relative border-l border-orchit-white/10 pl-5 space-y-4 ml-1"},At={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-3 hover:bg-orchit-white/7 transition"},Ot={class:"font-semibold"},qt={class:"font-semibold"},Ft={key:"tab-comments",class:"space-y-4"},$t={class:"flex items-center gap-3 mb-2"},Ht={class:"h-8 w-8 rounded-full bg-accent/15 text-accent flex items-center justify-center text-xs font-semibold"},Kt={class:"flex-1"},Nt={class:"text-sm font-medium"},Rt={class:"text-xs text-text-secondary"},Qt={key:0,class:"flex items-center gap-2"},Wt=["onClick"],Gt=["onClick"],Zt={class:"flex items-center gap-2 justify-end"},Jt={key:0,class:"mt-3 grid grid-cols-2 gap-2"},Xt=["href"],Yt={class:"text-xs truncate"},es={class:"rounded-xl border border-orchit-white/10 bg-orchit-white/5 overflow-hidden"},ts={class:"grid grid-cols-3 items-center w-full justify-between p-2 border-t border-orchit-white/10"},ss={key:"tab-attachments",class:"space-y-3"},as={class:"text-xs text-text-secondary"},ls={class:"grid sm:grid-cols-2 gap-4"},is={class:"p-3"},os={key:0,class:"rounded-lg overflow-hidden"},ns=["src"],ds={key:1,class:"rounded-lg overflow-hidden"},rs=["src"],cs={key:2,class:"h-40 rounded-lg bg-black/5 grid place-items-center"},us={class:"mt-3"},vs={class:"font-medium truncate"},ms={class:"text-xs text-text-secondary capitalize"},ps={class:"p-3 pt-0"},fs=["href"],hs=We({__name:"SidePanel",props:{pin:{type:Boolean,default:!1},showPanel:{type:Boolean,default:!0},details:{type:Object,default:()=>({})}},emits:["close","update:details","comment:post","priority:change"],setup(_,{emit:me}){var ae,le;const{workspaceId:pe}=Ge(),n=_,fe=me,{data:h,isPending:he}=Ze(n.details._id),I=v("details"),xe=[{label:"Details",value:"details"},{label:"Comments",value:"comments"},{label:"History",value:"history"},{label:"Attachment",value:"attachment"}],j=v(!1),w=v(n.details["card-title"]??"");D(()=>n.details["card-title"],t=>{w.value=t});const F=v(null);function ge(){j.value=!0,ve(()=>{var t,e;(t=F.value)==null||t.focus(),(e=F.value)==null||e.select()})}function Z(){w.value.trim()||(w.value=n.details["card-title"]??""),k.mutate({card_id:n.details._id,variables:{"card-title":w.value.trim()}}),j.value=!1}const V=v(n.details["card-description"]);D(()=>n.details,()=>{V.value=n.details["card-description"]});const z=v(!1),$=v(null);function be(t){var u,a;const e=(u=t==null?void 0:t.querySelector)==null?void 0:u.call(t,".ProseMirror");if(!e)return;e.focus();const l=(a=window.getSelection)==null?void 0:a.call(window),d=document.createRange();d.selectNodeContents(e),d.collapse(!1),l==null||l.removeAllRanges(),l==null||l.addRange(d)}async function _e(){z.value=!0,await ve(),be($.value||void 0)}function J(t){k.mutate({card_id:n.details._id,attachments:t??[],variables:{"card-description":V.value}}),z.value=!1}function X(t){var l;if(!z.value)return;const e=t.target;(l=$.value)!=null&&l.contains(e)||J()}oe(()=>document.addEventListener("mousedown",X)),Je(()=>document.removeEventListener("mousedown",X));const Y=ne({posted_on:((ae=n.details)==null?void 0:ae.posted_on)??((le=n.details)==null?void 0:le.created_at)??new Date().toISOString()}),we=x({get:()=>new Date(Y.posted_on).toISOString().slice(0,10),set:t=>{Y.posted_on=new Date(t+"T00:00:00").toISOString()}}),{data:H}=Xe(pe.value),K=v(n.details.workspace_lane_id??"");D(()=>n.details.workspace_lane_id,t=>{K.value=t});const ye=x(()=>((H==null?void 0:H.value)??[]).map(t=>{var e;return{_id:t._id,title:((e=t==null?void 0:t.variables)==null?void 0:e["lane-title"])??String(t._id)}}));function ke(t){K.value=t,k.mutate({card_id:n.details._id,workspace_lane_id:t})}const p=v({startDate:n.details["start-date"],endDate:n.details["end-date"]}),Ce=x(()=>n.details["start-date"]),De=x(()=>n.details["end-date"]);D(Ce,t=>{p.value={...p.value,startDate:t}}),D(De,t=>{p.value={...p.value,endDate:t}});const N=x(()=>p!=null&&p.value.startDate&&p.value.endDate&&p.value.endDate<p.value.startDate?"End date cannot be before start date":""),Se=t=>k.mutate({card_id:n.details._id,variables:{"start-date":t}}),Ve=t=>k.mutate({card_id:n.details._id,variables:{"end-date":t}}),Ee=x(()=>n.details.assigned_to),Ue=t=>{k.mutate({card_id:n.details._id,seat_id:t==null?void 0:t._id})},r=v([]),Ie=x(()=>{var t;return(t=n.details)==null?void 0:t._id}),{data:ee}=Ye(Ie);D(()=>ee.value,()=>{var t;r.value=(t=ee.value)==null?void 0:t.comments});const{mutate:Te,isPending:Pe}=et({onSuccess:t=>{T.value="",B.value=[],r.value=[...r.value,t]}}),T=v(""),Be=t=>(t??"").split(" ").map(e=>e[0]).filter(Boolean).slice(0,2).join("").toUpperCase(),Le=t=>t?new Date(t).toLocaleString():"",{data:Me}=tt(),je=t=>{var e;return((e=t==null?void 0:t.created_by)==null?void 0:e._id)===Me.value},P=v(null),y=v(""),{mutate:ze,isPending:te}=st({onSuccess:t=>{const e=r.value.findIndex(l=>l._id===t._id);e>-1&&(r.value[e]={...r.value[e],comment_text:t.comment_text}),P.value=null,y.value=""}}),{mutate:Ae}=at();function Oe(t){P.value=t._id,y.value=t.comment_text??""}function R(){P.value=null,y.value="",j.value=!1}function qe(t){const e=y.value.trim();if(!e)return;const l=r.value.findIndex(u=>u._id===t._id),d=l>-1?{...r.value[l]}:null;l>-1&&(r.value[l]={...r.value[l],comment_text:e}),ze({id:t._id,payload:{comment_text:e}},{onError:()=>{l>-1&&d&&(r.value[l]=d)},onSuccess:u=>{l>-1&&(r.value[l]=u??r.value[l]),R()}})}function Fe(t){const e=r.value.findIndex(d=>d._id===t._id),l=e>-1?r.value[e]:null;e>-1&&r.value.splice(e,1),Ae({id:t._id},{onError:()=>{l&&r.value.splice(e,0,l)}})}const $e=x(()=>{var t;return(((t=n.details)==null?void 0:t.attachments)??[]).map(e=>{var l;return{_id:e._id??e.id??((l=crypto.randomUUID)==null?void 0:l.call(crypto))??Math.random(),name:e.name??e.filename??"file",url:e.url,kind:(e.type??e.kind??"").toLowerCase().includes("image")?"image":(e.type??e.kind??"").toLowerCase().includes("video")?"video":"file"}})}),Q=lt(),k=it({onSuccess:()=>{Q.invalidateQueries({queryKey:["get-sheets"]}),Q.invalidateQueries({queryKey:["sheet-list"]}),Q.invalidateQueries({queryKey:["roles"]})}}),B=v([]),{mutate:He}=ot({onSuccess:t=>{B.value=[t]}});function Ke(t){const e=t.target.files;Array.from(e).forEach(l=>{const d=new FormData;d.append("file",l),He(d)})}function Ne(){const t=T.value.trim();!t&&!B.value.length||Te({id:n.details._id,payload:{comment_text:t,attachments:B.value.map(e=>({name:e.data.name,url:e.data.url}))}})}const A=ne({}),se=()=>{var t;(t=h==null?void 0:h.value)!=null&&t.variables&&(h.value.variables??[]).forEach(l=>{var u,a;if(!l||l.type!=="Select")return;const d=Array.isArray(l.data)&&l.data.length?((u=l.data[0])==null?void 0:u.value)??((a=l.data[0])==null?void 0:a._id)??l.data[0]:void 0;A[l.slug]=l.value??A[l.slug]??d??null})};oe(se),D(()=>h.value,se,{deep:!0});function Re(t,e){var d,u;A[e]=t,((u=(((d=h.value)==null?void 0:d.variables)??[]).find(a=>a.slug===e))==null?void 0:u.value)!==t&&k.mutate({card_id:n.details._id,variables:{[e]:t}})}return(t,e)=>(i(),nt(L,{name:"panel",appear:""},{default:g(()=>[O(s("div",pt,[s("div",ft,[e[8]||(e[8]=s("h5",{class:"text-[18px] font-semibold tracking-tight"},"Details",-1)),s("button",{class:"p-2 rounded-xl hover:bg-orchit-white/5 active:scale-[.98] cursor-pointer transition",onClick:e[0]||(e[0]=()=>fe("close")),"aria-label":"Close details"},e[7]||(e[7]=[s("i",{class:"fa-solid fa-xmark text-xl"},null,-1)]))]),s("div",ht,[s("div",xt,[m(L,{name:"fade-scale",mode:"out-in"},{default:g(()=>[j.value?O((i(),o("input",{key:"title-edit",ref_key:"titleInput",ref:F,"onUpdate:modelValue":e[1]||(e[1]=l=>w.value=l),onBlur:Z,onKeydown:[de(re(Z,["prevent"]),["enter"]),de(re(R,["prevent"]),["esc"])],class:"w-full text-2xl font-semibold rounded-xl px-3 py-2 bg-orchit-white/5 border border-orchit-white/10 focus:outline-none focus:ring-2 focus:ring-accent/40 transition",type:"text","aria-label":"Edit title"},null,40,gt)),[[W,w.value]]):(i(),o("h1",{key:"title-view",class:"text-2xl font-semibold tracking-tight cursor-text rounded-lg px-2 py-1 hover:bg-orchit-white/5 transition",onClick:ge,"aria-label":"Card title"},c(w.value||"Untitled"),1))]),_:1})]),s("div",null,[e[9]||(e[9]=s("h3",{class:"mb-2 text-base font-semibold tracking-wide px-1"},"Description",-1)),m(L,{name:"fade-scale",mode:"out-in"},{default:g(()=>[z.value?(i(),o("div",{key:"desc-edit",ref_key:"descEditorWrap",ref:$,class:"rounded-xl overflow-hidden border border-orchit-white/10 shadow-sm"},[m(rt,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=l=>V.value=l),onFocusOut:J},null,8,["modelValue"])],512)):(i(),o("div",{key:"desc-view",class:"text-[15px] leading-6 text-text-secondary whitespace-pre-wrap cursor-text rounded-xl px-4 py-3 border border-orchit-white/10 bg-orchit-white/5 hover:border-orchit-white/20 transition",onClick:_e},[V.value?(i(),o("div",{key:0,innerHTML:V.value},null,8,bt)):(i(),o("span",_t,"Click to add a description…"))]))]),_:1})]),m(ct,{modelValue:I.value,"onUpdate:modelValue":e[3]||(e[3]=l=>I.value=l),options:xe,size:"md"},null,8,["modelValue"]),m(L,{name:"section",mode:"out-in"},{default:g(()=>{var l,d,u;return[I.value==="details"?(i(),o("section",wt,[s("div",yt,[s("div",kt,[e[10]||(e[10]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"Posted On",-1)),s("div",Ct,c(we.value),1)]),s("div",Dt,[e[11]||(e[11]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"ID",-1)),s("div",St,c(_.details["card-code"]),1)])]),s("div",Vt,[s("div",Et,[e[12]||(e[12]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"Lane",-1)),m(ce,{size:"sm",options:ye.value,placeholder:"Select lane",allowCustom:!1,"model-value":K.value,"onUpdate:modelValue":ke},null,8,["options","model-value"])]),s("div",Ut,[e[13]||(e[13]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"Assign",-1)),m(ut,{onAssign:e[4]||(e[4]=a=>Ue(a)),assigneeId:Ee.value,seat:_.details.seat},null,8,["assigneeId","seat"])]),_.pin?S("",!0):(i(),o(b,{key:0},[s("div",It,[e[15]||(e[15]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"Start Date",-1)),s("div",Tt,[e[14]||(e[14]=s("i",{class:"fa-regular fa-calendar"},null,-1)),m(ue,{placeholder:"Set start date",class:"w-full","model-value":p.value.startDate,"emit-as":"ymd","onUpdate:modelValue":Se},null,8,["model-value"])])]),s("div",Pt,[e[17]||(e[17]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"Target End",-1)),s("div",{class:vt(["h-8 px-3 flex items-center gap-2 rounded-lg bg-bg-input border transition-colors",N.value?"border-red-500":"border-orchit-white/10"])},[e[16]||(e[16]=s("i",{class:"fa-regular fa-calendar"},null,-1)),m(ue,{placeholder:"Set end date",class:"w-full","model-value":p.value.endDate,"emit-as":"ymd","onUpdate:modelValue":Ve},null,8,["model-value"])],2),N.value?(i(),o("p",Bt,c(N.value),1)):S("",!0)])],64)),U(he)?(i(),o(b,{key:1},[e[18]||(e[18]=s("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),e[19]||(e[19]=s("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),e[20]||(e[20]=s("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),e[21]||(e[21]=s("div",{class:"bg-bg-surface/40 w-full animate-pulse h-6 p-1"},null,-1))],64)):(l=U(h))!=null&&l.variables?(i(!0),o(b,{key:2},M((d=U(h))==null?void 0:d.variables,(a,E)=>(i(),o(b,{key:a.slug||`var-${E}`},[(a==null?void 0:a.type)==="Select"?(i(),o("div",Lt,[s("div",Mt,c(a.title),1),m(ce,{size:"sm",options:a==null?void 0:a.data.map(C=>({_id:C,title:C})),placeholder:"Select option",allowCustom:!1,"model-value":A[a.slug],"onUpdate:modelValue":C=>Re(C,a.slug)},null,8,["options","model-value","onUpdate:modelValue"])])):S("",!0)],64))),128)):S("",!0)])])):I.value==="history"?(i(),o("section",jt,[s("div",null,[e[24]||(e[24]=s("h3",{class:"text-sm font-semibold tracking-wide mb-3"},"History",-1)),s("ol",zt,[(i(!0),o(b,null,M(_.details.history,(a,E)=>(i(),o("li",{key:E,class:"group"},[e[23]||(e[23]=s("span",{class:"absolute -left-[5px] top-0 w-2 h-2 rounded-full bg-accent/70 ring-4 ring-accent/10"},null,-1)),s("div",At,[s("span",Ot,c(a.user.u_full_name),1),e[22]||(e[22]=s("span",{class:"text-text-secondary"}," changed ",-1)),s("span",qt,c(a.field_name),1)])]))),128))])])])):I.value==="comments"?(i(),o("section",Ft,[(i(!0),o(b,null,M(r.value??[],a=>{var E,C,ie;return i(),o("div",{key:a._id,class:"rounded-xl border border-orchit-white/10 bg-orchit-white/5 p-4 hover:bg-orchit-white/7 transition"},[s("div",$t,[s("div",Ht,c(Be((E=a.commented_by)==null?void 0:E.u_full_name)),1),s("div",Kt,[s("div",Nt,c((C=a.commented_by)==null?void 0:C.u_full_name),1),s("div",Rt,c(Le(a.created_at)),1)]),je(a)?(i(),o("div",Qt,[P.value!==a._id?(i(),o("button",{key:0,class:"text-xs text-accent hover:underline",onClick:f=>Oe(a)},"Edit",8,Wt)):S("",!0),s("button",{class:"text-xs text-red-400 hover:underline",onClick:f=>Fe(a)},"Delete",8,Gt)])):S("",!0)]),m(L,{name:"fade",mode:"out-in"},{default:g(()=>[P.value!==a._id?(i(),o("p",{key:`c-view-${a._id}`,class:"text-[15px] leading-6"},c(a.comment_text),1)):(i(),o("div",{key:`c-edit-${a._id}`,class:"space-y-2"},[O(s("textarea",{"onUpdate:modelValue":e[5]||(e[5]=f=>y.value=f),rows:"3",class:"w-full p-3 rounded-lg bg-bg-input/80 border border-orchit-white/10 focus:ring-2 focus:ring-accent/40 outline-none"},null,512),[[W,y.value]]),s("div",Zt,[m(G,{variant:"secondary",size:"sm",onClick:R},{default:g(()=>e[25]||(e[25]=[q("Cancel")])),_:1,__:[25]}),m(G,{class:"btn",size:"sm",onClick:f=>qe(a),disabled:!y.value.trim()||U(te)},{default:g(()=>[q(c(U(te)?"Saving…":"Save"),1)]),_:2},1032,["onClick","disabled"])])]))]),_:2},1024),(ie=a==null?void 0:a.attachments)!=null&&ie.length?(i(),o("div",Jt,[(i(!0),o(b,null,M(a.attachments,(f,Qe)=>(i(),o("a",{key:Qe,href:f.url,target:"_blank",class:"group flex items-center gap-2 rounded-lg border border-orchit-white/10 bg-orchit-white/5 px-2 py-1 hover:bg-orchit-white/10 transition"},[e[26]||(e[26]=s("i",{class:"fa-regular fa-file text-text-secondary group-hover:text-text-primary transition"},null,-1)),s("span",Yt,c(f==null?void 0:f.name),1)],8,Xt))),128))])):S("",!0)])}),128)),s("div",es,[O(s("textarea",{"onUpdate:modelValue":e[6]||(e[6]=a=>T.value=a),rows:"3",class:"w-full p-3 bg-transparent outline-none text-sm",placeholder:"Write a comment"},null,512),[[W,T.value]]),s("div",ts,[s("input",{type:"file",multiple:"",onChange:Ke,class:"max-w-full text-ellipsis text-xs text-text-secondary file:mr-3 col-span-2 file:px-3 file:py-1.5 file:rounded-md file:border file:border-orchit-white/10 file:bg-orchit-white/10 hover:file:bg-orchit-white/15 file:text-text-primary transition inline w-fit"},null,32),m(G,{variant:"primary",class:"",size:"sm",onClick:Ne,disabled:!T.value.trim()&&!B.value.length},{default:g(()=>[q(c(U(Pe)?"Posting…":"Post"),1)]),_:1},8,["disabled"])])])])):(i(),o("section",ss,[s("div",as," Files attached to this "+c(((u=_.details)==null?void 0:u.type)??"item")+". ",1),s("div",ls,[(i(!0),o(b,null,M($e.value,a=>(i(),o("div",{key:a._id,class:"rounded-2xl overflow-hidden border border-orchit-white/10 bg-orchit-white/5 hover:bg-orchit-white/8 transition group"},[s("div",is,[a.kind==="image"?(i(),o("div",os,[s("img",{src:a.url,class:"w-full h-40 object-cover group-hover:scale-[1.02] transition"},null,8,ns)])):a.kind==="video"?(i(),o("div",ds,[s("video",{src:a.url,controls:"",class:"w-full h-40 object-cover"},null,8,rs)])):(i(),o("div",cs,e[27]||(e[27]=[s("i",{class:"fa-regular fa-file text-3xl text-text-secondary"},null,-1)]))),s("div",us,[s("div",vs,c(a.name),1),s("div",ms,c(a.kind),1)])]),s("div",ps,[s("a",{href:a.url,target:"_blank",rel:"noopener",class:"w-full inline-flex items-center justify-center gap-2 h-9 rounded-lg bg-accent text-orchit-white text-sm hover:opacity-90 transition"},e[28]||(e[28]=[s("i",{class:"fa-regular fa-arrow-up-right-from-square"},null,-1),q(" View ")]),8,fs)])]))),128))])]))]}),_:1})])],512),[[dt,_.showPanel]])]),_:1}))}}),gs=mt(hs,[["__scopeId","data-v-f7b3d86d"]]);export{gs as default};
