import{d as H,u as J,a as K,b as Q,r as _,c as p,e as B,f as X,w as n,o as E,g as a,s as d,h as r,i as Y,j as i,k as Z,l as ee,_ as L,t as V,B as k,m as S,n as te,p as se,q as oe,v as ae}from"./index-DhNbIl3H.js";import{_ as re,a as ne,l as le}from"./Header-h8YsuDZu.js";import{_ as ie}from"./AuthLayout.vue_vue_type_script_setup_true_lang-Crn6Uvu8.js";import{l as ue,s as pe}from"./auth-CfJuJlUR.js";import"./dark-logo-Mcb_sJlF.js";import"./favicon-BAFXWHLW.js";const me={class:"max-w-[500px] md:mx-auto w-full text-text-primary bg-bg-body"},de=["src"],ce={key:0,class:"text-red-500 text-sm text-center mt-2"},ge={class:"text-center mt-4"},ke=H({name:"LoginPage",__name:"Login",setup(fe){const h=J(),{isDark:C}=K(),N=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,U=Q(),c=_(""),g=_(""),l=_(""),m={email:!1,password:!1},x=p(()=>m.email?c.value.trim()?N.test(c.value)?"":"Invalid email":"Email is required":""),$=p(()=>!!x.value),w=p(()=>m.password?g.value?g.value.length<6?"Password must be at least 6 characters":"":"Password is required":""),z=p(()=>!!w.value),R=p(()=>!x.value&&!w.value),v=ae(),{mutateAsync:T,isPending:I}=B({mutationFn:ue}),{mutateAsync:P}=B({mutationFn:pe}),D=p(()=>I.value),F=p(()=>I.value?"Signing In...":"Sign in");function A(){l.value&&(l.value="")}async function M(){var s,e;try{const t=await se(),o=await oe.get("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${t.access_token}`}}),f=await P({u_email:o.data.email,u_social_id:o.data.sub,u_social_type:"google",u_full_name:o.data.name});y(f)}catch(t){(t==null?void 0:t.message)!=="Popup closed"&&(l.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"Google Login failed. Please try again.")}}async function O(){var s,e;try{AppleID.auth.init({clientId:"100465282340299456069",scope:"name email",redirectURI:window.location.origin+"/login",usePopup:!0});const t=await AppleID.auth.signIn(),u=t.authorization.id_token.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),j=decodeURIComponent(atob(u).split("").map(function(G){return"%"+("00"+G.charCodeAt(0).toString(16)).slice(-2)}).join("")),b=JSON.parse(j),q=await P({u_email:b.email,u_social_id:b.sub,u_social_type:"apple",u_full_name:(s=t.user)!=null&&s.name?`${t.user.name.firstName} ${t.user.name.lastName}`:((e=b.email)==null?void 0:e.split("@")[0])||""});y(q)}catch(t){(t==null?void 0:t.error)!=="popup_closed_by_user"&&(l.value=(t==null?void 0:t.message)||"Apple Login failed. Please try again.")}}async function y(s){var t,o,f;localStorage.setItem("token",(t=s==null?void 0:s.data)==null?void 0:t.token),await U.bootstrap();const e=localStorage.getItem("post_auth_intent");if(e)try{const u=JSON.parse(e);localStorage.removeItem("post_auth_intent"),u.aiResponse&&h.setWorkspace(u.aiResponse),v.push(u.path||"/dashboard");return}catch(u){console.error("Failed to parse post_auth_intent",u),localStorage.removeItem("post_auth_intent")}if(console.log((o=s==null?void 0:s.data)==null?void 0:o.isNewUser,"new user"),(f=s==null?void 0:s.data)!=null&&f.isNewUser){v.push("/create-profile");return}h.pricing?v.push("/dashboard?stripePayment=true"):v.push("/dashboard")}async function W(){var s,e;if(l.value="",m.email=!0,m.password=!0,!R.value){l.value="Please fill all fields correctly.";return}try{const t=await T({u_email:c.value,u_password:g.value});y(t)}catch(t){l.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"Login failed. Please try again."}}return(s,e)=>{const t=te("router-link");return E(),X(ie,null,{form:n(()=>[a("div",me,[e[0]||(d(-1,!0),(e[0]=a("h2",{class:"text-[32px] font-medium mb-12 text-center text-text-primary"},[e[7]||(e[7]=r(" Sign in to Orchit AI "))])).cacheIndex=0,d(1),e[0]),a("form",{onSubmit:Y(W,["prevent"]),class:"space-y-4 w-full"},[i(L,{modelValue:c.value,"onUpdate:modelValue":[e[1]||(e[1]=o=>c.value=o),A],label:"Email",placeholder:"Email address",size:"lg",error:$.value,message:x.value,onBlur:e[2]||(e[2]=o=>m.email=!0)},null,8,["modelValue","error","message"]),i(L,{modelValue:g.value,"onUpdate:modelValue":[e[3]||(e[3]=o=>g.value=o),A],label:"Password",placeholder:"Enter your password",size:"lg",type:"password",error:z.value,message:w.value,onBlur:e[4]||(e[4]=o=>m.password=!0)},null,8,["modelValue","error","message"]),i(k,{disabled:D.value,size:"lg",block:!0,type:"submit"},{default:n(()=>[r(V(F.value),1)]),_:1},8,["disabled"]),e[12]||(e[12]=a("div",{class:"flex items-center"},[a("div",{class:"flex-grow border-t border-border"}),a("span",{class:"mx-3 text-[12px] text-primary"},"OR"),a("div",{class:"flex-grow border-t border-border"})],-1)),i(k,{size:"lg",block:!0,appearance:"outlined",variant:"ghost",type:"button",onClick:M},{icon:n(()=>e[8]||(e[8]=[a("img",{src:re,class:"w-5 h-5 mr-4"},null,-1)])),default:n(()=>[e[9]||(e[9]=r(" Continue with google "))]),_:1,__:[9]}),i(k,{size:"lg",block:!0,appearance:"outlined",variant:"ghost",type:"button",class:"felx flex-row",onClick:O},{icon:n(()=>[a("img",{src:S(C)?S(ne):S(le),alt:"Apple icon",class:"w-[24px] mr-4"},null,8,de)]),default:n(()=>[e[10]||(e[10]=r(" Continue with apple "))]),_:1,__:[10]}),l.value?(E(),Z("p",ce,V(l.value),1)):ee("",!0),a("div",ge,[i(t,{to:"/forgot-password",class:"text-sm text-accent hover:underline"},{default:n(()=>e[11]||(e[11]=[r(" Forgot password? ")])),_:1,__:[11]})])],32),e[5]||(d(-1,!0),(e[5]=a("p",{class:"text-sm font-medium text-text-secondary text-center mt-6"},[e[15]||(e[15]=r(" By signing in, you agree to the ")),i(t,{to:"/privacy-policy",class:"text-text-primary font-bold hover:underline"},{default:n(()=>e[13]||(e[13]=[r(" Privacy Policy ")])),_:1,__:[13]}),e[16]||(e[16]=r(" and ")),i(t,{to:"/terms-of-services",class:"text-text-primary font-bold hover:underline"},{default:n(()=>e[14]||(e[14]=[r(" Terms of Service ")])),_:1,__:[14]})])).cacheIndex=5,d(1),e[5]),e[6]||(d(-1,!0),(e[6]=a("p",{class:"text-sm font-medium text-text-secondary text-center mt-8"},[e[18]||(e[18]=r(" Donâ€™t have an account? ")),i(t,{to:"/register",class:"text-text-primary font-bold underline"},{default:n(()=>e[17]||(e[17]=[r("Sign up")])),_:1,__:[17]})])).cacheIndex=6,d(1),e[6])])]),_:1})}}});export{ke as default};
