import{r as w,q as L,z as tt,d as U,c as f,j as r,o,f as e,t as n,k as C,C as I,i as E,g as V,L as et,W as ct,u as pt,bc as Y,x as gt,a0 as ft,y as xt,bd as vt,R as O,P as bt,v as u,e as mt,F as h,A as y,w as _t,be as ht,ai as B,ae as X,ad as k}from"./index-DE2P75bg.js";import{_ as yt}from"./ProgressBar.vue_vue_type_script_setup_true_lang-DLHxLw5U.js";import{c as kt,d as wt}from"./usePeople-0rWtLqQ4.js";import{a as Ct}from"./FormatDate-DIyppjZM.js";function St(S,{start:g=0,maxWhileLoading:$=90,step:d=.8,intervalMs:c=120}={}){const i=w(g);let p=null;const l=()=>{p==null&&(p=window.setInterval(()=>{S()&&(i.value=Math.min(i.value+d,$))},c))},x=()=>{p!=null&&(clearInterval(p),p=null)};return L(S,M=>{M?(i.value=g,l()):(i.value=100,setTimeout(()=>{i.value=g,x()},300))},{immediate:!0}),tt(x),i}const $t={class:"relative p-3 rounded-lg min-w-[240px] sm:min-w-sm border border-border overflow-hidden flex flex-col justify-between bg-bg-card w-full"},jt={class:"flex justify-between items-start pb-2"},Tt={class:"text-lg font-semibold text-text-primary text-left"},Pt={class:"text-xs text-text-secondary text-left"},Dt={class:"flex items-center gap-2"},It={class:""},Et={class:"flex justify-between text-sm text-text-secondary mb-1"},Lt={key:0,class:"fa-regular text-left fa-arrows-spin animate-spin duration-250"},Mt={key:0},At={key:1},Rt=U({__name:"ProjectCard",props:{title:{},subtitle:{},status:{},progress:{default:0},avatars:{},maxVisible:{default:2},date:{},loading:{type:Boolean,default:!1},color:{default:"#9CA3AF"},totalCard:{default:0},ai:{type:Boolean},doneCard:{}},setup(S){const g=S,$=St(()=>!!g.loading),d=f(()=>g.loading?$.value:g.progress),c=f(()=>Math.round(d.value)>=100),i=w(0);L(c,(l,x)=>{l&&!x&&i.value++});function p(l){switch(l){case"completed":return"bg-green-400/40 border-green-400 text-green-400";case"failed":return"bg-red-400/40 border-red-400 text-red-400";case"in_progress":return"bg-blue-400/20 border-blue-400 text-blue-400";case"pending":return"bg-amber-400/20 border-amber-400 text-amber-400";default:return"progress-default"}}return(l,x)=>(o(),r("div",$t,[e("div",jt,[e("div",null,[e("h3",Tt,n(l.title),1),e("p",Pt,n(l.subtitle),1)]),e("div",Dt,[!l.totalCard&&l.status?(o(),r("span",{key:0,class:I(["text-xs border rounded-full px-2 py-0.5",p(l.status)])},n(l.status),3)):C("",!0)])]),e("div",It,[e("div",Et,[e("div",null,[e("span",null,n(l.status=="in_progress"?"Generating lane with AI...":"Progress"),1),x[0]||(x[0]=V()),l.status=="in_progress"?(o(),r("i",Lt)):C("",!0)]),l.ai?(o(),r("span",Mt,[V(n(Math.round(d.value))+"% ",1),c.value?(o(),r("span",{key:i.value,class:"confetti-icon select-none","aria-label":"Completed"}," ðŸŽ‰ ")):C("",!0)])):(o(),r("span",At,n(l.doneCard??0)+" / "+n(l.totalCard),1))]),E(yt,{class:"mt-2",progress:d.value,fillColor:"bg-accent",indeterminate:!!l.loading},null,8,["progress","indeterminate"])])]))}}),Z=et(Rt,[["__scopeId","data-v-c8d254a0"]]),Nt={class:"flex flex-col gap-4 h-full overflow-x-auto w-full flex-auto"},Ot={class:"p-5 rounded-[6px] bg-bg-card space-y-6"},Bt={class:"flex items-center justify-between"},Ut={class:"flex flex-col w-full"},Vt={class:"text-sm text-text-secondary mt-2"},zt={class:"flex gap-2.5 overflow-x-auto w-full py-8 custom_scroll_bar"},Ht=["onClick"],Jt=["onClick"],Wt={class:"flex flex-grow flex-col sm:flex-row gap-4"},Ft={class:"bg-bg-card w-full max-h-full flex-auto p-5 rounded-lg"},qt={class:"mb-4"},Gt={class:"text-sm text-text-secondary mt-1"},Kt={key:0,class:"ml-1"},Qt={class:"space-y-4"},Yt={key:1,class:"text-center py-8"},Xt={key:2,class:"text-center py-8"},Zt={class:"flex items-center gap-2 w-32 flex-shrink-0"},te={key:0,class:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0"},ee=["src","alt"],se={key:2,class:"w-8 h-8 rounded-full bg-bg-body flex items-center justify-center flex-shrink-0"},ae=["title"],oe={class:"flex-1"},re=["title"],le={class:"bg-bg-card w-full flex-auto p-5 max-h-full rounded-lg overflow-y-auto flex flex-col"},ne={class:"space-y-4 overflow-y-auto flex-1"},de={class:"flex-1 min-w-0"},ie={class:"text-sm text-text-primary"},ue={class:"font-medium text-accent/90 pe-1"},ce=["innerHTML"],pe={href:"#",class:"text-accent/90 hover:underline"},ge={class:"text-xs text-text-secondary mt-1"},fe=U({__name:"Peak",setup(S){const{isDark:g}=ct(),$=pt(),d=gt(),c=f(()=>{var a;return Y((a=d==null?void 0:d.params)==null?void 0:a.id)}),i=f(()=>{var a;return Y((a=d==null?void 0:d.params)==null?void 0:a.job_id)}),{data:p,isPending:l,error:x,refetch:M}=kt(c),{data:z}=wt(c),{data:st}=ft(c),at=f(()=>{var v,t,T;const a=(v=z.value)==null?void 0:v.activities,s=((t=$.workspace)==null?void 0:t.created_at)||((T=st.value)==null?void 0:T.created_at);return a!=null&&a.length&&a[0].created_at||s}),A=w(!1),H=w(!1),b=w(null),m=w(null);let j=!1;const ot="https://backend.orchit.ai/api/v1/",J=()=>{if(j||m.value)return;const a=localStorage.getItem("token")||"",s=i.value,v=localStorage.getItem("jobId"),t=s||v||c.value,ut=`${ot}common/step2/tasks/${t}/stream?token=${a}&is_manual=${s||v?"false":"true"}`,D=new EventSource(ut);m.value=D,D.onopen=()=>{j||(H.value=!0)},D.onmessage=N=>{var K;if(!j)try{b.value=JSON.parse(N.data);const Q=((K=b.value)==null?void 0:K.status)??"cancels";["completed","failed","canceled"].includes(Q)&&P()}catch{}},D.onerror=()=>{P()},m.value.addEventListener("progress",N=>{try{b.value=JSON.parse(N.data)}catch{}})},P=()=>{H.value=!1,m.value&&(m.value.close(),m.value=null)};xt(()=>{j=!1,J()}),tt(()=>{j=!0,P()});const _=f(()=>{var a;return((a=b.value)==null?void 0:a.percent)===100}),rt=f(()=>{var a,s;return((s=(a=b.value)==null?void 0:a.result)==null?void 0:s.lanes_summary)??[]}),lt=f(()=>{var a,s;return((s=(a=b.value)==null?void 0:a.progress_details)==null?void 0:s.lanes_progress)??[]}),W=["https://randomuser.me/api/portraits/women/1.jpg","https://randomuser.me/api/portraits/men/2.jpg","https://randomuser.me/api/portraits/men/3.jpg"],F=a=>{console.log("Lane clicked:",a)},q=f(()=>{var a;return(a=p.value)!=null&&a.team_workload?p.value.team_workload.map(s=>({id:s.assignee_id||"unassigned",name:s.assignee_name,initials:s.initials||O(s.assignee_name)||"",avatar:!!s.avatar_url||!!s.assignee_id,avatarUrl:s.avatar_url,color:vt(s.assignee_id,s.assignee_name),workload:s.work_distribution_percentage,totalTasks:s.total_tasks,totalHours:s.total_hours})):[]}),R=f(()=>{var a;return((a=p.value)==null?void 0:a.team_size)||0}),nt=a=>({"DEPLOYED-PROD":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",REOPENED:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200","IN-PROGRESS":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"})[a]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200",dt=U({name:"SkeletonCard",setup(){return()=>k("div",{class:"w-[380px] min-w-[280px] h-[180px] rounded-xl border border-border bg-bg-body/60 animate-pulse p-4"},[k("div",{class:"h-5 w-2/3 rounded bg-bg-card/50 mb-2"}),k("div",{class:"h-3 w-1/2 rounded bg-bg-card/50 mb-4"}),k("div",{class:"h-2 w-full rounded bg-bg-card/50 mb-1"}),k("div",{class:"h-2 w-11/12 rounded bg-bg-card/50 mb-1"}),k("div",{class:"h-2 w-10/12 rounded bg-bg-card/50"})])}}),G=(a,s)=>a?(s.Done??0)/a*100:0,it=bt();return L(_,a=>{a&&it.invalidateQueries({queryKey:["dashboard-teams",c.value]})}),L([c,i],()=>{P(),J()}),(a,s)=>{var v;return o(),r("div",Nt,[e("div",Ot,[e("div",Bt,[e("div",Ut,[s[1]||(s[1]=e("h3",{class:"text-2xl text-text-primary font-semibold"},"Project Overview",-1)),e("p",Vt,"Last update on "+n(u(Ct)(at.value)),1),e("div",zt,[A.value?(o(),r(h,{key:0},y(3,t=>E(u(dt),{key:t})),64)):(o(),mt(ht,{key:1,name:"list",tag:"div",class:"flex gap-2.5"},{default:_t(()=>[_.value?(o(!0),r(h,{key:0},y(rt.value,t=>(o(),r("button",{key:t==null?void 0:t.lane_title,class:"group focus:outline-none border-border border focus-visible:ring-2 focus-visible:ring-primary/50 rounded-xl",type:"button",role:"button","aria-label":"Open lane details",onClick:T=>F(t)},[E(Z,{ai:!1,doneCard:t==null?void 0:t.status_distribution.Done,loading:A.value||(t==null?void 0:t.status)==="in_progress",title:t==null?void 0:t.lane_title,subtitle:"",progress:_.value?G(t==null?void 0:t.total_cards,t==null?void 0:t.status_distribution):t==null?void 0:t.progress,totalCard:t==null?void 0:t.total_cards,status:_.value?"":(t==null?void 0:t.status)??"",avatars:W,date:"May 28",class:"transition-transform duration-200 ease-out group-hover:shadow-lg border border-transparent hover:border-border-subtle rounded-xl cursor-pointer"},null,8,["doneCard","loading","title","progress","totalCard","status"])],8,Ht))),128)):(o(!0),r(h,{key:1},y(lt.value,t=>(o(),r("button",{key:`2-${t==null?void 0:t.lane_title}`,class:"group focus:outline-none border-border border focus-visible:ring-2 focus-visible:ring-primary/50 rounded-xl",type:"button",role:"button","aria-label":"Open lane details",onClick:T=>F(t)},[E(Z,{ai:!0,loading:A.value||(t==null?void 0:t.status)==="in_progress",title:t==null?void 0:t.lane_title,subtitle:"",progress:_.value?G(t==null?void 0:t.total_cards,t==null?void 0:t.status_distribution):t==null?void 0:t.progress,totalCard:t==null?void 0:t.total_cards,status:_.value?"":(t==null?void 0:t.status)??"",avatars:W,date:"May 28",class:"transition-transform duration-200 ease-out group-hover:shadow-lg border border-transparent hover:border-border-subtle rounded-xl cursor-pointer"},null,8,["loading","title","progress","totalCard","status"])],8,Jt))),128))]),_:1}))])])])]),e("div",Wt,[e("div",Ft,[e("div",qt,[s[3]||(s[3]=e("h3",{class:"text-lg font-semibold text-text-primary"},"Team workload",-1)),e("p",Gt,[s[2]||(s[2]=V(" Monitor the capacity of your team. ")),R.value>0?(o(),r("span",Kt,"("+n(R.value)+" member"+n(R.value!==1?"s":"")+")",1)):C("",!0)])]),e("div",Qt,[s[8]||(s[8]=e("div",{class:"flex items-center justify-between text-sm font-medium text-text-secondary mb-2"},[e("span",null,"Assignee"),e("span",null,"Work distribution")],-1)),u(l)?(o(),r(h,{key:0},y(3,t=>e("div",{key:t,class:"flex items-center gap-3 animate-pulse"},s[4]||(s[4]=[e("div",{class:"flex items-center gap-2 w-32 flex-shrink-0"},[e("div",{class:"w-8 h-8 rounded-full bg-bg-body"}),e("div",{class:"h-4 w-20 bg-bg-body rounded"})],-1),e("div",{class:"flex-1 h-6 bg-bg-body rounded"},null,-1)]))),64)):u(x)?(o(),r("div",Yt,[s[5]||(s[5]=e("p",{class:"text-sm text-red-500 mb-2"},"Failed to load team workload",-1)),e("button",{onClick:s[0]||(s[0]=()=>u(M)()),class:"text-xs text-accent hover:underline"}," Try again ")])):q.value.length===0?(o(),r("div",Xt,s[6]||(s[6]=[e("i",{class:"pi pi-users text-3xl text-text-secondary mb-2"},null,-1),e("p",{class:"text-sm text-text-secondary"},"No team members assigned yet",-1)]))):(o(!0),r(h,{key:3},y(q.value,t=>(o(),r("div",{key:t.id,class:"flex items-center gap-3"},[e("div",Zt,[t.avatarUrl?(o(),r("div",te,[e("img",{src:t.avatarUrl,alt:t.name,class:"w-full h-full object-cover"},null,8,ee)])):t.avatar?(o(),r("div",{key:1,class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0",style:B({backgroundColor:u(X)({name:t==null?void 0:t.name})})},n(u(O)(t.name)),5)):(o(),r("div",se,s[7]||(s[7]=[e("i",{class:"pi pi-user text-text-secondary"},null,-1)]))),e("span",{class:"text-sm text-text-primary truncate",title:t.name},n(t.name),9,ae)]),e("div",oe,[e("div",{class:"h-6 bg-bg-body rounded overflow-hidden relative group cursor-help",title:`${t.totalTasks} task${t.totalTasks!==1?"s":""} â€¢ ${t.totalHours}h`},[e("div",{class:I(["h-full transition-all duration-300",u(g)?"bg-accent":"!bg-accent-hover/40"]),style:B({width:t.workload+"%"})},null,6),t.workload>0?(o(),r("span",{key:0,class:I(["absolute inset-0 flex items-center justify-start px-2 text-[11px] font-medium",u(g)?"text-white":"text-black"])},n(t.workload)+"% ",3)):C("",!0)],8,re)])]))),128))])]),e("div",le,[s[10]||(s[10]=e("div",{class:"mb-4"},[e("h3",{class:"text-lg font-semibold text-text-primary"},"Recent activity"),e("p",{class:"text-sm text-text-secondary mt-1"},"Stay up to date with what's happening across the project.")],-1)),e("div",ne,[s[9]||(s[9]=e("div",{class:"text-xs font-semibold text-text-secondary mb-3"},"Today",-1)),(o(!0),r(h,null,y((v=u(z))==null?void 0:v.activities,t=>(o(),r("div",{key:t.id,class:"flex gap-3 pb-4 border-b border-border last:border-0"},[e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0",style:B({backgroundColor:u(X)({email:t.user.email})})},n(u(O)(t.user.name)),5),e("div",de,[e("div",ie,[e("span",ue,n(t.user.name),1),e("span",{class:"text-text-secondary",innerHTML:t.message},null,8,ce),e("a",pe,n(t.item),1),t.status?(o(),r("span",{key:0,class:I(["ml-2 px-2 py-0.5 rounded text-xs font-medium",nt(t.status)])},n(t.status),3)):C("",!0)]),e("div",ge,n(t.time),1)])]))),128))])])])])}}}),_e=et(fe,[["__scopeId","data-v-d0ce66b3"]]);export{_e as default};
