import{d as R,W,aF as A,c as h,r as c,m as D,a as E,aa as G,ab as J,$ as O,i as u,F as X,e as s,ac as Y,y as Z,j as V,t as r,h as n,g as i,w as ee,s as M,bc as te,n as _,U as se,o as m,H as ae}from"./index-CpoWQO0F.js";import{_ as ie}from"./DropMenu.vue_vue_type_script_setup_true_lang-D6Z2jqrC.js";import{_ as le}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-BkoYS2hk.js";const oe={class:"flex justify-between gap-2 items-start mb-3"},re={class:"flex gap-2 flex-wrap items-center"},ne={key:0,class:"text-[10px] px-2 py-1 h-6 rounded bg-bg-surface/60 text-text-secondary font-medium uppercase"},de={key:1,class:"text-[10px] px-2 py-1 h-6 rounded bg-accent/20 text-accent font-medium"},ce={class:"product-menu-icon transition-all w-6 py-1 px-2 h-6 flex justify-center items-center duration-100 ease-in-out bg-bg-surface/40 rounded-md"},ue={class:"text-sm font-medium text-card-foreground leading-tight mb-2 capitalize"},me={class:"flex justify-between items-center mt-3 pt-3 border-t border-border/50"},pe={class:"flex items-center gap-3 flex-1"},ge={class:"flex items-center gap-2"},fe={class:"flex items-center gap-1 text-xs text-text-secondary"},ke={class:"flex items-center gap-1 text-xs text-text-secondary"},ve=R({__name:"KanbanTicket",props:{ticket:{},selectedVar:{}},emits:["select"],setup(q,{emit:I}){const{workspaceId:p,moduleId:K}=W(),{data:B}=A(p.value),a=q,Q={critical:"border-l-priority-critical",high:"border-l-priority-high",medium:"border-l-priority-medium",low:"border-l-priority-low"},z=h(()=>Q[a.ticket.priority]??"border-l-gray-300"),l=c(!1),g=c(a.ticket["end-date"]??null),N=c(a.ticket["start-date"]??null);D(()=>{var e;return(e=a.ticket)==null?void 0:e["end-date"]},e=>{g.value=e??null}),D(()=>{var e;return(e=a.ticket)==null?void 0:e["start-date"]},e=>{N.value=e??null});const o=E(),f=G({onSuccess:()=>{o.invalidateQueries({queryKey:["people-lists"]}),o.invalidateQueries({queryKey:["get-sheets"]}),o.invalidateQueries({queryKey:["sheet-list"]}),o.invalidateQueries({queryKey:["roles"]})}}),{mutate:S,isPending:j}=J(a.ticket._id,{onSuccess:()=>{o.invalidateQueries({queryKey:["sheet-list"]}),l.value=!1}});function H(){return[{label:"Delete",danger:!0,action:()=>{l.value=!0}}]}const $=()=>{S({})},F=e=>{const t={card_id:a.ticket._id,seat_id:e==null?void 0:e._id};f.mutate(t)},L=e=>{f.mutate({card_id:a.ticket._id,variables:{"end-date":e}})},{data:d}=O(p.value,K.value),k=h(()=>((d==null?void 0:d.value)??[]).filter(e=>e._id==a.selectedVar)),P=I;return(e,t)=>{var v,x,y,b,C,w,T;return m(),u(X,null,[s("div",{onClick:t[4]||(t[4]=()=>{P("select")}),class:Z(["product-ticket relative bg-bg-card rounded-lg p-4 shadow-sm cursor-grab border-t-4 hover:shadow-md transition-all duration-200 active:cursor-grabbing",z.value]),style:Y({borderColor:(x=(v=e.ticket)==null?void 0:v.lane)==null?void 0:x.variables["lane-color"]})},[s("div",oe,[s("div",re,[e.ticket["card-type"]&&((y=k.value[0])==null?void 0:y.slug)!="card-type"?(m(),u("span",ne,r(e.ticket["card-type"]),1)):V("",!0),e.ticket["card-status"]&&((b=k.value[0])==null?void 0:b.slug)!="card-status"?(m(),u("span",de,r(e.ticket["card-status"]),1)):V("",!0)]),s("div",ce,[n(ie,{onClick:t[0]||(t[0]=i(()=>{},["stop"])),items:H()},{trigger:ee(()=>t[11]||(t[11]=[s("i",{class:"cursor-pointer text-sm fa-solid fa-ellipsis"},null,-1)])),_:1},8,["items"])])]),s("h3",ue,r(e.ticket["card-title"]),1),t[1]||(M(-1,!0),(t[1]=s("p",{innerHTML:e.ticket["card-description"],class:"text-xs text-muted-foreground mb-3 text-text-secondary line-clamp-2"},null,8,["innerHTML"])).cacheIndex=1,M(1),t[1]),s("div",me,[s("div",pe,[s("div",{onClick:t[2]||(t[2]=i(()=>{},["stop"]))},[n(te,{users:_(B),onAssign:F,assigneeId:e.ticket.assigned_to,seat:(C=e.ticket)==null?void 0:C.seat},null,8,["users","assigneeId","seat"])]),s("div",{onClick:t[3]||(t[3]=i(()=>{},["stop"])),class:"flex items-center gap-2 text-nowrap overflow-ellipsis text-xs text-text-secondary"},[n(se,{placeholder:"end date","model-value":g.value,theme:"dark","emit-as":"ymd","onUpdate:modelValue":L},null,8,["model-value"])])]),s("div",ge,[s("div",fe,[t[12]||(t[12]=s("i",{class:"fa-regular fa-message text-[10px]"},null,-1)),s("span",null,r((w=e.ticket)==null?void 0:w.comments_count),1)]),s("div",ke,[t[13]||(t[13]=s("i",{class:"fa-regular fa-file text-[10px]"},null,-1)),s("span",null,r((T=e.ticket)==null?void 0:T.attachments.length),1)])])])],6),s("div",{class:"no-drag-zone",draggable:"false",onMousedown:t[8]||(t[8]=i(()=>{},["stop"])),onTouchstart:t[9]||(t[9]=i(()=>{},["stop"])),onPointerdown:t[10]||(t[10]=i(()=>{},["stop"]))},[n(le,{onClick:t[5]||(t[5]=i(()=>{},["stop"])),modelValue:l.value,"onUpdate:modelValue":t[6]||(t[6]=U=>l.value=U),title:"Delete Ticket",itemLabel:"Ticket",itemName:e.ticket.title,requireMatchText:e.ticket.title,confirmText:"Delete Ticket",cancelText:"Cancel",size:"md",loading:_(j),onConfirm:$,onCancel:t[7]||(t[7]=()=>{l.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"])],32)],64)}}}),Ce=ae(ve,[["__scopeId","data-v-8099efcd"]]);export{Ce as K};
