import{d as D,u as T,a as W,r as y,c as i,b as I,e as q,w as n,o as h,f as u,s as d,g as a,h as G,i as l,j as H,k as O,_ as P,t as B,B as E,l as j,m as J,n as K,p as Q}from"./index-3ojefXkT.js";import{_ as X}from"./Header-bD7I_ZKX.js";import{_ as Y}from"./AuthLayout.vue_vue_type_script_setup_true_lang-Dj5hvoBs.js";import{l as Z,s as ee}from"./auth-CS1uX_Er.js";import"./dark-logo-Mcb_sJlF.js";import"./favicon-BAFXWHLW.js";const te={class:"max-w-[500px] md:mx-auto w-full text-text-primary bg-bg-body"},se={key:0,class:"text-red-500 text-sm text-center mt-2"},oe={class:"text-center mt-4"},de=D({name:"LoginPage",__name:"Login",setup(ae){const b=T(),V=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,L=W(),p=y(""),g=y(""),r=y(""),m={email:!1,password:!1},x=i(()=>m.email?p.value.trim()?V.test(p.value)?"":"Invalid email":"Email is required":""),N=i(()=>!!x.value),w=i(()=>m.password?g.value?g.value.length<6?"Password must be at least 6 characters":"":"Password is required":""),A=i(()=>!!w.value),C=i(()=>!x.value&&!w.value),f=Q(),{mutateAsync:F,isPending:_}=I({mutationFn:Z}),{mutateAsync:$}=I({mutationFn:ee}),z=i(()=>_.value),M=i(()=>_.value?"Signing In...":"Sign in");function k(){r.value&&(r.value="")}async function R(){var s,e;try{const t=await J(),o=await K.get("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${t.access_token}`}}),v=await $({u_email:o.data.email,u_social_id:o.data.sub,u_social_type:"google",u_full_name:o.data.name});S(v)}catch(t){(t==null?void 0:t.message)!=="Popup closed"&&(r.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"Google Login failed. Please try again.")}}async function S(s){var t,o,v;localStorage.setItem("token",(t=s==null?void 0:s.data)==null?void 0:t.token),await L.bootstrap();const e=localStorage.getItem("post_auth_intent");if(e)try{const c=JSON.parse(e);localStorage.removeItem("post_auth_intent"),c.aiResponse&&b.setWorkspace(c.aiResponse),f.push(c.path||"/dashboard");return}catch(c){console.error("Failed to parse post_auth_intent",c),localStorage.removeItem("post_auth_intent")}if(console.log((o=s==null?void 0:s.data)==null?void 0:o.isNewUser,"new user"),(v=s==null?void 0:s.data)!=null&&v.isNewUser){f.push("/create-profile");return}b.pricing?f.push("/dashboard?stripePayment=true"):f.push("/dashboard")}async function U(){var s,e;if(r.value="",m.email=!0,m.password=!0,!C.value){r.value="Please fill all fields correctly.";return}try{const t=await F({u_email:p.value,u_password:g.value});S(t)}catch(t){r.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"Login failed. Please try again."}}return(s,e)=>{const t=j("router-link");return h(),q(Y,null,{form:n(()=>[u("div",te,[e[0]||(d(-1,!0),(e[0]=u("h2",{class:"text-[32px] font-medium mb-12 text-center text-text-primary"},[e[7]||(e[7]=a(" Sign in to Orchit AI "))])).cacheIndex=0,d(1),e[0]),u("form",{onSubmit:G(U,["prevent"]),class:"space-y-4 w-full"},[l(P,{modelValue:p.value,"onUpdate:modelValue":[e[1]||(e[1]=o=>p.value=o),k],label:"Email",placeholder:"Email address",size:"lg",error:N.value,message:x.value,onBlur:e[2]||(e[2]=o=>m.email=!0)},null,8,["modelValue","error","message"]),l(P,{modelValue:g.value,"onUpdate:modelValue":[e[3]||(e[3]=o=>g.value=o),k],label:"Password",placeholder:"Enter your password",size:"lg",type:"password",error:A.value,message:w.value,onBlur:e[4]||(e[4]=o=>m.password=!0)},null,8,["modelValue","error","message"]),l(E,{disabled:z.value,size:"lg",block:!0,type:"submit"},{default:n(()=>[a(B(M.value),1)]),_:1},8,["disabled"]),l(E,{size:"lg",block:!0,appearance:"outlined",variant:"ghost",type:"button",onClick:R},{icon:n(()=>e[8]||(e[8]=[u("img",{src:X,class:"w-5 h-5 mr-4"},null,-1)])),default:n(()=>[e[9]||(e[9]=a(" Continue with google "))]),_:1,__:[9]}),r.value?(h(),H("p",se,B(r.value),1)):O("",!0),u("div",oe,[l(t,{to:"/forgot-password",class:"text-sm text-accent hover:underline"},{default:n(()=>e[10]||(e[10]=[a(" Forgot password? ")])),_:1,__:[10]})])],32),e[5]||(d(-1,!0),(e[5]=u("p",{class:"text-sm font-medium text-text-secondary text-center mt-6"},[e[13]||(e[13]=a(" By signing in, you agree to the ")),l(t,{to:"/privacy-policy",class:"text-text-primary font-bold hover:underline"},{default:n(()=>e[11]||(e[11]=[a(" Privacy Policy ")])),_:1,__:[11]}),e[14]||(e[14]=a(" and ")),l(t,{to:"/terms-of-services",class:"text-text-primary font-bold hover:underline"},{default:n(()=>e[12]||(e[12]=[a(" Terms of Service ")])),_:1,__:[12]})])).cacheIndex=5,d(1),e[5]),e[6]||(d(-1,!0),(e[6]=u("p",{class:"text-sm font-medium text-text-secondary text-center mt-8"},[e[16]||(e[16]=a(" Donâ€™t have an account? ")),l(t,{to:"/register",class:"text-text-primary font-bold underline"},{default:n(()=>e[15]||(e[15]=[a("Sign up")])),_:1,__:[15]})])).cacheIndex=6,d(1),e[6])])]),_:1})}}});export{de as default};
