import{d as xe,W as we,Q as ge,aU as _e,c as T,r as f,x as ye,C as he,aw as be,m as a,o,F as ke,g as d,ah as V,i as j,ad as ae,t as w,U as re,k as Ce,y as Ie,f as Ee,T as Ue,ai as le,n as Le,l as M,G as Be,E as Re,ay as Te,al as je}from"./index-BU3L0Kpb.js";const ze={key:0,class:"flex gap-2 items-center truncate"},Ve=["src"],Me={key:2,class:"w-6 h-6 bg-bg-body border border-border rounded-full flex justify-center items-center flex-shrink-0"},Ae={class:"text-[11px] text-text-primary truncate"},He={key:1,class:"truncate text-text-secondary opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1.5 text-xs"},Ne={key:1,class:"relative w-full"},$e={class:"max-h-60 overflow-y-auto py-1"},De=["onMousedown"],Oe={class:"flex items-center gap-3 min-w-0"},Se=["src"],qe={key:2,class:"w-6 h-6 bg-bg-body border border-border rounded-full flex justify-center items-center flex-shrink-0"},Fe={class:"min-w-0"},Ke={class:"text-xs font-medium truncate"},We={class:"text-[10px] text-text-secondary truncate"},Ye={class:"text-xs font-medium text-text-secondary whitespace-nowrap ml-2"},Ge={key:0,class:"text-[10px] px-2 py-1 border rounded-full border-red-500 transition group-hover:bg-red-500 group-hover:text-white"},Pe={key:1,class:"text-red-500"},Qe={key:2,class:"text-[10px] px-2 py-1 border rounded-full border-accent group-hover:bg-accent transition group-hover:text-white"},Xe={key:1,class:"px-4 py-3 text-center text-sm text-text-secondary"},et=xe({__name:"TableAssigneeCell",props:{assigneeId:{},disabled:{type:Boolean},seat:{},workspaceId:{},name:{},emptyText:{}},emits:["update:modelValue","assign","unassign"],setup(ie,{emit:de}){const u=ie,g=de,{canAssignCard:ue}=we(),{workspaceId:ce}=ge(),{data:A}=_e(T(()=>(u==null?void 0:u.workspaceId)??ce.value)),U=f(u.assigneeId??u.seat);ye(()=>[u.assigneeId,u.seat],()=>{U.value=u.assigneeId??u.seat},{deep:!0});const _=f(!1),L=f(!1),y=f(""),h=f(null),z=f(null),b=f(null),H=f({top:"0px",left:"0px",width:"100%"}),s=T(()=>{const e=U.value;if(!e)return null;const t=e._id||e.id||e;return(A.value||[]).find(i=>{var m,v;const c=i._id||i.id,l=((m=i.user)==null?void 0:m._id)||((v=i.user)==null?void 0:v.id);return c==t||l==t})||e}),N=T(()=>{const e=s.value,t=A.value||[];if(e&&(e._id||e.id)){const r=e._id||e.id,i=e,c=t.filter(l=>{var k,C,I,E;const m=l._id||l.id,v=((k=l.user)==null?void 0:k._id)||((C=l.user)==null?void 0:C.id),R=((I=e.user)==null?void 0:I._id)||((E=e.user)==null?void 0:E.id);return!(m==r||v&&v==(R||r))});return[i,...c]}return[...t]}),B=T(()=>{const e=y.value.trim().toLowerCase(),t=N.value;return e?t.filter(r=>(r.title||r.name||"").toLowerCase().includes(e)||(r.email||"").toLowerCase().includes(e)):t}),p=()=>{if(!h.value||!b.value)return;const e=h.value.getBoundingClientRect(),t=b.value.offsetHeight||200,i=window.innerHeight-e.bottom;let l=e.bottom+window.scrollY+6;i<t&&e.top>t&&(l=e.top+window.scrollY-t-5),H.value={top:`${l}px`,left:`${e.left+window.scrollX}px`,width:`${e.width}px`}},ve=async()=>{var t,r,i,c,l;if(u.disabled||!ue.value)return;_.value=!0,L.value=!0;const e=((t=s.value)==null?void 0:t.name)||((r=s.value)==null?void 0:r.title)||((i=s.value)==null?void 0:i.u_full_name);y.value=e||"",await je(),(c=h.value)==null||c.focus(),(l=h.value)==null||l.select(),p(),window.addEventListener("scroll",p,!0),window.addEventListener("resize",p)},x=()=>{_.value=!1,L.value=!1,y.value="",window.removeEventListener("scroll",p,!0),window.removeEventListener("resize",p)};function fe(e){const t=N.value.find(r=>r._id==e);t&&(U.value=t,g("assign",t),g("update:modelValue",e)),x()}function $(){U.value=null,g("unassign"),g("assign",{_id:null}),g("update:modelValue",null),x()}function D(e){if(e._id==null){$();return}if(s.value&&e._id===s.value._id){$();return}fe(e._id)}const pe=()=>{B.value.length>0?D(B.value[0]):x()},me=()=>{setTimeout(()=>{_.value&&x()},150)},O=e=>{z.value&&!z.value.contains(e.target)&&b.value&&!b.value.contains(e.target)&&_.value&&x()};return he(()=>{document.addEventListener("mousedown",O)}),be(()=>{document.removeEventListener("mousedown",O),window.removeEventListener("scroll",p,!0),window.removeEventListener("resize",p)}),(e,t)=>{var r,i,c,l,m,v,R,k,C,I,E,S,q,F,K,W,Y,G,P,Q,X,J,Z,ee,te,se;return o(),a("div",{class:"relative w-full h-full",ref_key:"containerRef",ref:z,onClick:t[3]||(t[3]=M(()=>{},["stop"]))},[_.value?(o(),a("div",Ne,[Ie(d("input",{ref_key:"inputRef",ref:h,"onUpdate:modelValue":t[0]||(t[0]=n=>y.value=n),onBlur:me,onKeydown:[le(pe,["enter"]),le(x,["esc"])],onInput:t[1]||(t[1]=n=>L.value=!0),class:"absolute left-0 top-1/2 h-8 -translate-y-1/2 min-w-[200px] w-full p-1 border border-accent/60 rounded-sm focus:outline-none focus:ring-1 focus:ring-accent bg-bg-body z-50 text-[12px]",placeholder:"Search people by name"},null,544),[[Ue,y.value]]),(o(),Ee(Te,{to:"body"},[L.value?(o(),a("div",{key:0,ref_key:"dropdownRef",ref:b,class:"fixed z-[9999] bg-bg-dropdown border border-border rounded-md shadow-lg",style:V(H.value),onMousedown:t[2]||(t[2]=M(()=>{},["prevent"]))},[d("ul",$e,[B.value.length>0?(o(!0),a(Be,{key:0},Re(B.value,n=>{var ne,oe;return o(),a("li",{key:n._id??"unassign",onMousedown:M(Je=>D(n),["prevent"]),class:"px-3 py-2 cursor-pointer hover:bg-bg-dropdown-menu-hover text-[12px] text-text-primary flex items-center justify-between group"},[d("div",Oe,[(ne=n==null?void 0:n.user)!=null&&ne.avatar?(o(),a("img",{key:0,src:n.user.avatar,class:"w-6 h-6 rounded-full object-cover flex-shrink-0",alt:""},null,8,Se)):n.name&&n._id?(o(),a("div",{key:1,class:"w-6 h-6 border border-border rounded-full text-xs font-semibold flex items-center justify-center flex-shrink-0",style:V({backgroundColor:n!=null&&n.email?j(ae)({name:n.name,email:n.email,_id:n._id}):""})},w(j(re)(n.name)),5)):(o(),a("div",qe,t[6]||(t[6]=[d("i",{class:"fa-regular fa-user text-xs"},null,-1)]))),d("div",Fe,[d("div",Ke,w(n.name||n.title),1),d("div",We,w(n.role_title),1)])]),d("div",Ye,[n._id&&((oe=s.value)==null?void 0:oe._id)===n._id?(o(),a("span",Ge," Unassign ")):n._id==null?(o(),a("span",Pe)):(o(),a("span",Qe," Assign to "))])],40,De)}),128)):(o(),a("div",Xe," No match found "))])],36)):Le("",!0)]))])):(o(),a("div",{key:0,onClick:ve,class:ke(["w-full h-full flex items-center px-3 py-1.5 cursor-pointer hover:bg-bg-surface-hover rounded-md truncate transition-all duration-200 min-h-[36px] group",{"opacity-50 cursor-not-allowed":e.disabled}])},[(i=(r=s.value)==null?void 0:r.user)!=null&&i.avatar||(c=s.value)!=null&&c._id||(l=e.seat)!=null&&l._id?(o(),a("div",ze,[(v=(m=s.value)==null?void 0:m.avatar)!=null&&v.src||(k=(R=s.value)==null?void 0:R.user)!=null&&k.avatar||(C=s.value)!=null&&C.u_profile_image?(o(),a("img",{key:0,src:((E=(I=s.value)==null?void 0:I.avatar)==null?void 0:E.src)??((S=s.value)==null?void 0:S.u_profile_image)??((F=(q=s.value)==null?void 0:q.user)==null?void 0:F.avatar),class:"w-5 h-5 object-cover rounded-full flex-shrink-0",alt:""},null,8,Ve)):(K=s.value)!=null&&K.u_full_name||(W=s.value)!=null&&W.name?(o(),a("div",{key:1,class:"w-5 h-5 aspect-square rounded-full text-[11px] bg-bg-surface text-text-primary flex items-center justify-center flex-shrink-0",style:V({backgroundColor:((Y=s.value)==null?void 0:Y.u_full_name)??((G=s.value)==null?void 0:G.title)?j(ae)({name:((P=s.value)==null?void 0:P.u_full_name)??((Q=s.value)==null?void 0:Q.title),_id:(X=s.value)==null?void 0:X._id}):""})},w(j(re)(((J=s.value)==null?void 0:J.u_full_name)??((Z=s.value)==null?void 0:Z.name))),5)):(o(),a("div",Me,t[4]||(t[4]=[d("i",{class:"fa-regular fa-user text-xs"},null,-1)]))),d("span",Ae,w((((ee=s.value)==null?void 0:ee.name)||((te=s.value)==null?void 0:te.title)||((se=s.value)==null?void 0:se.u_full_name))??"Unassigned"),1)])):(o(),a("span",He,[t[5]||(t[5]=d("i",{class:"fa-solid fa-plus text-[10px]"},null,-1)),Ce(" Add "+w(e.emptyText||"Assignee"),1)]))],2))],512)}}});export{et as default};
