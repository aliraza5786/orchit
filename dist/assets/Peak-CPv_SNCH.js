import{r as k,n as B,x as Z,d as R,c as g,j as l,o,f as e,t as n,k as w,z as T,i as I,g as A,J as tt,u as it,v as ut,p as c,e as ct,F as _,y as h,w as pt,b8 as gt,ad as N,ai as Q,Q as O,ah as y,q as ft,b9 as Y,ba as xt}from"./index-DC4wf0QQ.js";import{_ as vt}from"./ProgressBar.vue_vue_type_script_setup_true_lang-7p49OCf6.js";import{c as bt,d as mt}from"./usePeople-BBSWXuuY.js";import{u as _t}from"./useTheme-C0UPAoFf.js";import{a as ht}from"./FormatDate-jdRmSPDV.js";function yt(C,{start:p=0,maxWhileLoading:b=90,step:v=.8,intervalMs:x=120}={}){const u=k(p);let d=null;const r=()=>{d==null&&(d=window.setInterval(()=>{C()&&(u.value=Math.min(u.value+v,b))},x))},i=()=>{d!=null&&(clearInterval(d),d=null)};return B(C,D=>{D?(u.value=p,r()):(u.value=100,setTimeout(()=>{u.value=p,i()},300))},{immediate:!0}),Z(i),u}const kt={class:"relative p-3 rounded-lg min-w-[240px] sm:min-w-sm border border-border overflow-hidden flex flex-col justify-between bg-bg-card w-full"},wt={class:"flex justify-between items-start pb-2"},Ct={class:"text-lg font-semibold text-text-primary text-left"},$t={class:"text-xs text-text-secondary text-left"},jt={class:"flex items-center gap-2"},St={class:""},Pt={class:"flex justify-between text-sm text-text-secondary mb-1"},Tt={key:0,class:"fa-regular text-left fa-arrows-spin animate-spin duration-250"},It={key:0},Dt={key:1},Et=R({__name:"ProjectCard",props:{title:{},subtitle:{},status:{},progress:{default:0},avatars:{},maxVisible:{default:2},date:{},loading:{type:Boolean,default:!1},color:{default:"#9CA3AF"},totalCard:{default:0},ai:{type:Boolean},doneCard:{}},setup(C){const p=C,b=yt(()=>!!p.loading),v=g(()=>p.loading?b.value:p.progress),x=g(()=>Math.round(v.value)>=100),u=k(0);B(x,(r,i)=>{r&&!i&&u.value++});function d(r){switch(r){case"completed":return"bg-green-400/40 border-green-400 text-green-400";case"failed":return"bg-red-400/40 border-red-400 text-red-400";case"in_progress":return"bg-blue-400/20 border-blue-400 text-blue-400";case"pending":return"bg-amber-400/20 border-amber-400 text-amber-400";default:return"progress-default"}}return(r,i)=>(o(),l("div",kt,[e("div",wt,[e("div",null,[e("h3",Ct,n(r.title),1),e("p",$t,n(r.subtitle),1)]),e("div",jt,[!r.totalCard&&r.status?(o(),l("span",{key:0,class:T(["text-xs border rounded-full px-2 py-0.5",d(r.status)])},n(r.status),3)):w("",!0)])]),e("div",St,[e("div",Pt,[e("div",null,[e("span",null,n(r.status=="in_progress"?"Generating lane with AI...":"Progress"),1),i[0]||(i[0]=A()),r.status=="in_progress"?(o(),l("i",Tt)):w("",!0)]),r.ai?(o(),l("span",It,[A(n(Math.round(v.value))+"% ",1),x.value?(o(),l("span",{key:u.value,class:"confetti-icon select-none","aria-label":"Completed"}," ðŸŽ‰ ")):w("",!0)])):(o(),l("span",Dt,n(r.doneCard??0)+" / "+n(r.totalCard),1))]),I(vt,{class:"mt-2",progress:v.value,fillColor:"bg-accent",indeterminate:!!r.loading},null,8,["progress","indeterminate"])])]))}}),X=tt(Et,[["__scopeId","data-v-c8d254a0"]]),Lt={class:"flex flex-col gap-4 h-full overflow-x-auto w-full flex-auto"},Mt={class:"p-5 rounded-[6px] bg-bg-card space-y-6"},Nt={class:"flex items-center justify-between"},Ot={class:"flex flex-col w-full"},Rt={class:"text-sm text-text-secondary mt-2"},At={class:"flex gap-2.5 overflow-x-auto w-full py-8 custom_scroll_bar"},Bt=["onClick"],Jt=["onClick"],Ut={class:"flex flex-grow flex-col sm:flex-row gap-4"},Vt={class:"bg-bg-card w-full max-h-full flex-auto p-5 rounded-lg"},zt={class:"mb-4"},Ft={class:"text-sm text-text-secondary mt-1"},Gt={key:0,class:"ml-1"},Ht={class:"space-y-4"},Wt={key:1,class:"text-center py-8"},qt={key:2,class:"text-center py-8"},Kt={class:"flex items-center gap-2 w-32 flex-shrink-0"},Qt={key:0,class:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0"},Yt=["src","alt"],Xt={key:2,class:"w-8 h-8 rounded-full bg-bg-body flex items-center justify-center flex-shrink-0"},Zt=["title"],te={class:"flex-1"},ee=["title"],se={class:"bg-bg-card w-full flex-auto p-5 max-h-full rounded-lg overflow-y-auto flex flex-col"},ae={class:"space-y-4 overflow-y-auto flex-1"},oe={class:"flex-1 min-w-0"},re={class:"text-sm text-text-primary"},le={class:"font-medium text-accent/90 pe-1"},ne={class:"text-text-secondary"},de={href:"#",class:"text-accent/90 hover:underline"},ie={class:"text-xs text-text-secondary mt-1"},ue=R({__name:"Peak",setup(C){const{theme:p}=_t(),b=it(),v=g(()=>{var s,f,t;const a=(s=F.value)==null?void 0:s.activities;return a!=null&&a.length?a[0].created_at||((f=b.workspace)==null?void 0:f.updated_at):(t=b.workspace)==null?void 0:t.updated_at}),x=k(!1),u=k(!1),d=k(null),r=k(null);let i=!1;const D="https://backend.streamed.space/api/v1/",J=()=>{if(i||r.value)return;const a=localStorage.getItem("token")||"",s=V.value,f=localStorage.getItem("jobId"),t=s||f||S.value,dt=`${D}common/step2/tasks/${t}/stream?token=${a}&is_manual=${s||f?"false":"true"}`,P=new EventSource(dt);r.value=P,P.onopen=()=>{i||(u.value=!0)},P.onmessage=M=>{var q;if(!i)try{d.value=JSON.parse(M.data);const K=((q=d.value)==null?void 0:q.status)??"cancels";["completed","failed","canceled"].includes(K)&&j()}catch{}},P.onerror=()=>{j()},r.value.addEventListener("progress",M=>{console.log(">> trki g");try{d.value=JSON.parse(M.data)}catch{}})},j=()=>{u.value=!1,r.value&&(r.value.close(),r.value=null)};ut(()=>{i=!1,J()}),Z(()=>{i=!0,j()});const $=g(()=>{var a;return((a=d.value)==null?void 0:a.percent)===100}),et=g(()=>{var a,s;return((s=(a=d.value)==null?void 0:a.result)==null?void 0:s.lanes_summary)??[]}),st=g(()=>{var a,s;return((s=(a=d.value)==null?void 0:a.progress_details)==null?void 0:s.lanes_progress)??[]}),U=["https://randomuser.me/api/portraits/women/1.jpg","https://randomuser.me/api/portraits/men/2.jpg","https://randomuser.me/api/portraits/men/3.jpg"],m=ft(),S=g(()=>{var a;return Y((a=m==null?void 0:m.params)==null?void 0:a.id)}),V=g(()=>{var a;return Y((a=m==null?void 0:m.params)==null?void 0:a.job_id)}),z=a=>{console.log("Lane clicked:",a)},{data:E,isPending:at,error:ot,refetch:rt}=bt(S),{data:F}=mt(S),G=g(()=>{var a;return(a=E.value)!=null&&a.team_workload?E.value.team_workload.map(s=>({id:s.assignee_id||"unassigned",name:s.assignee_name,initials:s.initials||O(s.assignee_name)||"",avatar:!!s.avatar_url||!!s.assignee_id,avatarUrl:s.avatar_url,color:xt(s.assignee_id,s.assignee_name),workload:s.work_distribution_percentage,totalTasks:s.total_tasks,totalHours:s.total_hours})):[]}),L=g(()=>{var a;return((a=E.value)==null?void 0:a.team_size)||0}),lt=a=>({"DEPLOYED-PROD":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",REOPENED:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200","IN-PROGRESS":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"})[a]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200",nt=R({name:"SkeletonCard",setup(){return()=>y("div",{class:"w-[380px] min-w-[280px] h-[180px] rounded-xl border border-border bg-bg-body/60 animate-pulse p-4"},[y("div",{class:"h-5 w-2/3 rounded bg-bg-card/50 mb-2"}),y("div",{class:"h-3 w-1/2 rounded bg-bg-card/50 mb-4"}),y("div",{class:"h-2 w-full rounded bg-bg-card/50 mb-1"}),y("div",{class:"h-2 w-11/12 rounded bg-bg-card/50 mb-1"}),y("div",{class:"h-2 w-10/12 rounded bg-bg-card/50"})])}}),H=(a,s)=>a?(s.Done??0)/a*100:0;return B([S,V],()=>{j(),J()}),(a,s)=>{var f;return o(),l("div",Lt,[e("div",Mt,[e("div",Nt,[e("div",Ot,[s[1]||(s[1]=e("h3",{class:"text-2xl text-text-primary font-semibold"},"Project Overview",-1)),e("p",Rt,"Last update on "+n(c(ht)(v.value)),1),e("div",At,[x.value?(o(),l(_,{key:0},h(3,t=>I(c(nt),{key:t})),64)):(o(),ct(gt,{key:1,name:"list",tag:"div",class:"flex gap-2.5"},{default:pt(()=>[$.value?(o(!0),l(_,{key:0},h(et.value,t=>(o(),l("button",{key:t==null?void 0:t.lane_title,class:"group focus:outline-none border-border border focus-visible:ring-2 focus-visible:ring-primary/50 rounded-xl",type:"button",role:"button","aria-label":"Open lane details",onClick:W=>z(t)},[I(X,{ai:!1,doneCard:t==null?void 0:t.status_distribution.Done,loading:x.value||(t==null?void 0:t.status)==="in_progress",title:t==null?void 0:t.lane_title,subtitle:"",progress:$.value?H(t==null?void 0:t.total_cards,t==null?void 0:t.status_distribution):t==null?void 0:t.progress,totalCard:t==null?void 0:t.total_cards,status:$.value?"":(t==null?void 0:t.status)??"",avatars:U,date:"May 28",class:"transition-transform duration-200 ease-out group-hover:shadow-lg border border-transparent hover:border-border-subtle rounded-xl cursor-pointer"},null,8,["doneCard","loading","title","progress","totalCard","status"])],8,Bt))),128)):(o(!0),l(_,{key:1},h(st.value,t=>(o(),l("button",{key:`2-${t==null?void 0:t.lane_title}`,class:"group focus:outline-none border-border border focus-visible:ring-2 focus-visible:ring-primary/50 rounded-xl",type:"button",role:"button","aria-label":"Open lane details",onClick:W=>z(t)},[I(X,{ai:!0,loading:x.value||(t==null?void 0:t.status)==="in_progress",title:t==null?void 0:t.lane_title,subtitle:"",progress:$.value?H(t==null?void 0:t.total_cards,t==null?void 0:t.status_distribution):t==null?void 0:t.progress,totalCard:t==null?void 0:t.total_cards,status:$.value?"":(t==null?void 0:t.status)??"",avatars:U,date:"May 28",class:"transition-transform duration-200 ease-out group-hover:shadow-lg border border-transparent hover:border-border-subtle rounded-xl cursor-pointer"},null,8,["loading","title","progress","totalCard","status"])],8,Jt))),128))]),_:1}))])])])]),e("div",Ut,[e("div",Vt,[e("div",zt,[s[3]||(s[3]=e("h3",{class:"text-lg font-semibold text-text-primary"},"Team workload",-1)),e("p",Ft,[s[2]||(s[2]=A(" Monitor the capacity of your team. ")),L.value>0?(o(),l("span",Gt,"("+n(L.value)+" member"+n(L.value!==1?"s":"")+")",1)):w("",!0)])]),e("div",Ht,[s[8]||(s[8]=e("div",{class:"flex items-center justify-between text-sm font-medium text-text-secondary mb-2"},[e("span",null,"Assignee"),e("span",null,"Work distribution")],-1)),c(at)?(o(),l(_,{key:0},h(3,t=>e("div",{key:t,class:"flex items-center gap-3 animate-pulse"},s[4]||(s[4]=[e("div",{class:"flex items-center gap-2 w-32 flex-shrink-0"},[e("div",{class:"w-8 h-8 rounded-full bg-bg-body"}),e("div",{class:"h-4 w-20 bg-bg-body rounded"})],-1),e("div",{class:"flex-1 h-6 bg-bg-body rounded"},null,-1)]))),64)):c(ot)?(o(),l("div",Wt,[s[5]||(s[5]=e("p",{class:"text-sm text-red-500 mb-2"},"Failed to load team workload",-1)),e("button",{onClick:s[0]||(s[0]=()=>c(rt)()),class:"text-xs text-accent hover:underline"}," Try again ")])):G.value.length===0?(o(),l("div",qt,s[6]||(s[6]=[e("i",{class:"pi pi-users text-3xl text-text-secondary mb-2"},null,-1),e("p",{class:"text-sm text-text-secondary"},"No team members assigned yet",-1)]))):(o(!0),l(_,{key:3},h(G.value,t=>(o(),l("div",{key:t.id,class:"flex items-center gap-3"},[e("div",Kt,[t.avatarUrl?(o(),l("div",Qt,[e("img",{src:t.avatarUrl,alt:t.name,class:"w-full h-full object-cover"},null,8,Yt)])):t.avatar?(o(),l("div",{key:1,class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0",style:N({backgroundColor:c(Q)({name:t==null?void 0:t.name})})},n(c(O)(t.name)),5)):(o(),l("div",Xt,s[7]||(s[7]=[e("i",{class:"pi pi-user text-text-secondary"},null,-1)]))),e("span",{class:"text-sm text-text-primary truncate",title:t.name},n(t.name),9,Zt)]),e("div",te,[e("div",{class:"h-6 bg-bg-body rounded overflow-hidden relative group cursor-help",title:`${t.totalTasks} task${t.totalTasks!==1?"s":""} â€¢ ${t.totalHours}h`},[e("div",{class:T(["h-full transition-all duration-300",c(p)==="dark"?"bg-accent":"!bg-accent-hover/40"]),style:N({width:t.workload+"%"})},null,6),t.workload>0?(o(),l("span",{key:0,class:T(["absolute inset-0 flex items-center justify-start px-2 text-[11px] font-medium",c(p)==="dark"?"text-white":"text-black"])},n(t.workload)+"% ",3)):w("",!0)],8,ee)])]))),128))])]),e("div",se,[s[10]||(s[10]=e("div",{class:"mb-4"},[e("h3",{class:"text-lg font-semibold text-text-primary"},"Recent activity"),e("p",{class:"text-sm text-text-secondary mt-1"},"Stay up to date with what's happening across the project.")],-1)),e("div",ae,[s[9]||(s[9]=e("div",{class:"text-xs font-semibold text-text-secondary mb-3"},"Today",-1)),(o(!0),l(_,null,h((f=c(F))==null?void 0:f.activities,t=>(o(),l("div",{key:t.id,class:"flex gap-3 pb-4 border-b border-border last:border-0"},[e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0",style:N({backgroundColor:c(Q)({email:t.user.email})})},n(c(O)(t.user.name)),5),e("div",oe,[e("div",re,[e("span",le,n(t.user.name),1),e("span",ne,n(t.message),1),e("a",de,n(t.item),1),t.status?(o(),l("span",{key:0,class:T(["ml-2 px-2 py-0.5 rounded text-xs font-medium",lt(t.status)])},n(t.status),3)):w("",!0)]),e("div",ie,n(t.time),1)])]))),128))])])])])}}}),ve=tt(ue,[["__scopeId","data-v-e37856d8"]]);export{ve as default};
