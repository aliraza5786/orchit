import{d as ee,Z as te,S as ae,Q as se,a6 as le,a4 as ie,a5 as ne,r as re,c as n,O as z,x as u,f as A,a0 as de,w as C,o as d,g as i,k as _,h as o,m as c,n as f,_ as oe,M as $,E as ue,y as ce,J as fe,G as me,F as q,i as m,a1 as M,t as S,a7 as pe,a8 as be,B as O}from"./index-BMMiwVpy.js";const ve={class:"px-6 grid grid-cols-1 sm:grid-cols-2 gap-4"},ge={key:0,class:"flex flex-col"},De={key:1,class:"flex gap-1 flex-col"},_e={key:0,class:"text-xs text-red-500"},xe={key:2,class:"flex gap-1 flex-col"},ke={key:0,class:"text-xs text-red-500"},Ve={class:"flex flex-col gap-1"},ye={class:"mt-2"},we={class:"px-6 mt-2"},Ce={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},he=ee({__name:"CreateTaskModal",props:{modelValue:{type:Boolean,default:!1},sheet_id:{},listId:{},selectedVariable:{},pin:{},size:{default:"lg"}},emits:["update:modelValue","created"],setup(P,{emit:L}){const{canCreateCard:N}=te(),Q=L,r=P,j=ae(),{workspaceId:p,moduleId:F}=se(),{mutate:K,isPending:x}=le({onSuccess:()=>{E(),j.invalidateQueries({queryKey:["sheet-list"]}),v.value=!1}}),{data:k}=ie(p.value),{data:b}=ne(p,F,re(r.sheet_id??"")),v=n({get:()=>r.modelValue,set:t=>Q("update:modelValue",t)}),h=n(()=>((b==null?void 0:b.value)??[]).filter(t=>{var a;return((a=t==null?void 0:t.type)==null?void 0:a.title)==="Select"})),R=t=>t.map(a=>({_id:a,title:a})),V=n(()=>{const t=((k==null?void 0:k.value)??[]).map(a=>{var s;return{_id:a._id,title:((s=a==null?void 0:a.variables)==null?void 0:s["lane-title"])??String(a._id)}});return t.find(a=>a.title==="Main")||t.unshift({_id:"main",title:"Main"}),t}),I=t=>t.slug,e=z({title:"",description:"",startDate:null,endDate:null,lane_id:null,assignee:null,variables:{}});u(h,t=>{for(const a of t){const s=I(a);s in e.variables||(e.variables[s]=null)}},{immediate:!0});const l=z({title:!1,description:!1,startDate:!1,endDate:!1,lane:!1}),G=n(()=>!!e.title.trim()&&(r.pin?!0:!!e.startDate&&!!e.endDate)&&!y.value&&!g.value&&!D.value&&!w.value);function J(t){e.startDate=t,l.startDate=!0}function W(t){e.endDate=t,l.endDate=!0}function Z(t){e.lane_id=t,l.lane=!0}function T(t){e.assignee=t}function B(){v.value=!1,E()}function E(){e.title="",e.description="",e.startDate=null,e.endDate=null,e.lane_id=null,e.assignee=null,e.variables={},l.title=!1,l.description=!1,l.startDate=!1,l.endDate=!1,l.lane=!1}const H=n(()=>b.value.find(t=>(t==null?void 0:t._id)==r.selectedVariable)),y=n(()=>l.title&&!e.title.trim()?"Title is required":""),g=n(()=>l.startDate?e.startDate?"":"Start date is required":""),D=n(()=>l.endDate?e.endDate?e.startDate&&e.endDate&&e.endDate<e.startDate?"End date cannot be before start date":"":"End date is required":""),w=n(()=>l.lane?e.lane_id?"":"Lane is required":""),U=new Date().toISOString().split("T")[0];function X(){var a,s;if(l.title=!0,l.description=!0,r.pin||(l.startDate=!0,l.endDate=!0),!G.value||x.value||!N.value)return;const t={sheet_list_id:r.listId,workspace_id:p.value,sheet_id:r.sheet_id,...e.lane_id&&e.lane_id!=="main"?{workspace_lane_id:e.lane_id}:{},variables:{...e.variables,[`${(a=H.value)==null?void 0:a.slug}`]:r.listId,"card-title":e.title.trim(),"card-description":e.description.trim(),"start-date":e.startDate,"end-date":e.endDate},seat_id:((s=e.assignee)==null?void 0:s._id)??null,createdAt:new Date().toISOString()};K(t)}return u(()=>e.title,t=>{t!=null&&t.trim()&&l.title&&(l.title=!1)}),u(()=>e.lane_id,t=>{t&&l.lane&&(l.lane=!1)}),u(()=>e.startDate,t=>{t&&l.startDate&&(l.startDate=!1)}),u(()=>e.endDate,t=>{t&&l.endDate&&(l.endDate=!1)}),u(()=>e.description,t=>{t!=null&&t.trim()&&l.description&&(l.description=!1)}),u(V,t=>{if(!e.lane_id){const a=t.find(s=>s.title==="Main");a&&(e.lane_id=a._id)}},{immediate:!0}),(t,a)=>(d(),A(de,{modelValue:v.value,"onUpdate:modelValue":a[5]||(a[5]=s=>v.value=s),modalClass:"!py-0",size:t.size},{default:C(()=>[i("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[i("div",{class:"flex justify-between w-full"},[a[7]||(a[7]=i("h2",{class:"text-xl font-semibold"},"Create Ticket",-1)),i("div",{class:"w-6 h-6 rounded-full cursor-pointer hover:bg-border/50 transition p-0.5",onClick:B,title:"Close"},a[6]||(a[6]=[i("i",{class:"fa-solid fa-xmark text-sm"},null,-1)]))]),a[8]||(a[8]=i("p",{class:"text-sm text-text-secondary mt-1"},[_(" Provide the details below and click "),i("span",{class:"font-medium"},"Add Ticket"),_(". ")],-1))]),i("div",ve,[o(oe,{modelValue:e.title,"onUpdate:modelValue":a[0]||(a[0]=s=>e.title=s),label:"Ticket Title",placeholder:"e.g., Implement real-time notifications",error:!!y.value,message:y.value,onBlur:a[1]||(a[1]=s=>l.title=!0)},null,8,["modelValue","error","message"]),V.value.length>0?(d(),c("div",ge,[o($,{size:"md",label:"Tab",options:V.value,placeholder:"Select tab",allowCustom:!1,"model-value":e.lane_id,"onUpdate:modelValue":Z,error:!!w.value,message:w.value},null,8,["options","model-value","error","message"])])):f("",!0),(d(!0),c(me,null,ue(h.value,s=>ce((d(),A($,{size:"md",key:I(s),modelValue:e.variables[s.slug],"onUpdate:modelValue":Y=>e.variables[s.slug]=Y,options:R(s.data),label:s.title,placeholder:"Select value",allowCustom:!0},null,8,["modelValue","onUpdate:modelValue","options","label"])),[[fe,(s==null?void 0:s._id)!=t.selectedVariable&&(s==null?void 0:s.title)!=="Process"]])),128)),t.pin?f("",!0):(d(),c("div",De,[a[9]||(a[9]=i("label",{class:"text-sm"},"Start date",-1)),i("div",{class:q(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",g.value?"border-red-500":""])},[o(M,{placeholder:"Set start date",class:"w-full","model-value":e.startDate,"emit-as":"ymd","onUpdate:modelValue":J,"min-date":m(U)},null,8,["model-value","min-date"])],2),g.value?(d(),c("p",_e,S(g.value),1)):f("",!0)])),t.pin?f("",!0):(d(),c("div",xe,[a[10]||(a[10]=i("label",{class:"text-sm"},"End date",-1)),i("div",{class:q(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",D.value?"border-red-500":""])},[o(M,{placeholder:"Set end date",class:"w-full","model-value":e.endDate,"emit-as":"ymd","onUpdate:modelValue":W,"min-date":e.startDate||m(U)},null,8,["model-value","min-date"])],2),D.value?(d(),c("p",ke,S(D.value),1)):f("",!0)])),i("div",Ve,[a[11]||(a[11]=i("label",{class:"text-sm"},"Assignee",-1)),i("div",ye,[o(pe,{name:!0,workspaceId:m(p),onAssign:T,onUnassign:a[2]||(a[2]=s=>T(null)),assigneeId:e.assignee,seat:null,disabled:!1,skipPermissionCheck:!0,class:"w-full"},null,8,["workspaceId","assigneeId"])])])]),i("div",we,[o(be,{label:"Description",placeholder:"What needs to be done, acceptance criteria, links…",modelValue:e.description,"onUpdate:modelValue":a[3]||(a[3]=s=>e.description=s),onBlur:a[4]||(a[4]=s=>l.description=!0)},null,8,["modelValue"])]),i("div",Ce,[o(O,{variant:"secondary",onClick:B},{default:C(()=>a[12]||(a[12]=[_("Cancel")])),_:1,__:[12]}),o(O,{variant:"primary",disabled:m(x),onClick:X},{default:C(()=>[_(S(m(x)?"Adding…":"Add Ticket"),1)]),_:1},8,["disabled"])])]),_:1},8,["modelValue","size"]))}});export{he as _};
