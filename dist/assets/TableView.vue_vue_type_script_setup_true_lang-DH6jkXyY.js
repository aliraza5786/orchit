import{d as pe,r as i,Q as me,a0 as fe,c as _,a2 as we,O as z,x as O,D as ge,m as d,g as o,f as G,n as m,G as f,E as y,l as $,k as B,i as ye,A as he,o as l,ah as R,t as Q,y as xe,P as ke,T as _e,b4 as Ce,ac as Ve,al as Me}from"./index-BU3L0Kpb.js";import{_ as Ee}from"./CreateTaskModal.vue_vue_type_script_setup_true_lang-DdazD_5D.js";const ze={class:"kanban-table space-y-4 mt-4 overflow-y-auto overflow-x-auto ps-4 mb-5"},$e={class:"w-full table-fixed border-collapse rounded-[6px] shadow-sm bg-bg-body/20 text-sm border border-border/60"},Be={class:"bg-bg-surface border-b border-border sticky top-[-1px] z-10"},Re={class:"text-text-secondary"},De=["onMousedown"],Ie={class:"w-10 p-2 text-center relative"},Le={class:"relative inline-block"},Se={key:0,class:"column-menu absolute w-[200px] -right-1 bg-bg-dropdown border border-border rounded shadow z-50"},Te=["checked","onChange"],Ae={class:"bg-bg-surface/20"},Ne=["colspan"],Pe=["onClick"],Ue=["colspan"],We=["onMouseenter"],Xe={class:"w-8 group text-center align-middle border-r border-border/40 relative"},je={class:"flex justify-center items-center h-full w-full relative"},Fe=["onClick"],Oe={key:0,class:"absolute left-6 top-6 bg-bg-dropdown border border-border rounded shadow-md z-50 min-w-[120px] text-left overflow-hidden row-action-menu"},Ge=["onClick"],Qe=["colspan"],qe=["onUpdate:modelValue","onBlur"],He=["colspan"],Ye=pe({__name:"TableView",props:{columns:{},rows:{},isPending:{type:Boolean},canCreate:{type:Boolean,default:!0},canCreateVariable:{type:Boolean,default:!0},canDelete:{type:Boolean,default:!1}},emits:["update:rows","create","toggleVisibility","addVar","delete","scroll"],setup(q,{emit:H}){const D=he(),C=i(!1),J=i(),{workspaceId:I}=me(),L=i("");function K(){D.path.includes("/plan")&&(C.value=!0)}const v=q,{data:S}=fe({workspace_id:I.value,workspace_module_id:L}),Y=_(()=>{var e;return S.value?(e=S.value[0])==null?void 0:e._id:""}),T=i(Y),{data:A}=we(I,L,T),Z=_(()=>{var e;return A.value?(e=A.value[0])==null?void 0:e._id:""}),ee=i(Z),p=H,u=z(v.rows||[]),se=e=>{p("scroll",e)};O(()=>v.rows,e=>{e&&u.splice(0,u.length,...e)});const a=z({id:null,field:""}),w=i(null),N=i(null),P=_(()=>u.some(e=>a.id===e.id&&!e[a.field])),te=(e,s)=>{a.id=e.id,a.field=s,Me(()=>{var r;return(r=N.value)==null?void 0:r.focus()})},oe=()=>{a.id=null,a.field=""},ne=e=>{var s;if(!((s=e[a.field])!=null&&s.trim())){const r=u.findIndex(t=>t.id===e.id);r!==-1&&u.splice(r,1)}oe(),p("update:rows",u.slice()),p("create",e)},re=e=>{var r;const s={id:Date.now()};v.columns.forEach(t=>s[t.key]=""),u.splice(e,0,s),te(s,((r=v.columns[0])==null?void 0:r.key)||""),w.value=null,p("update:rows",u.slice())};function le(e,s){if(!(!e||!s))return s.includes(".")?s.split(".").reduce((r,t)=>r==null?r:r[t],e):e[s]}function ae(e,s){return s!=null&&s.accessor?s.accessor(e):le(e,s.key)}const de=e=>{var r;const s=ae(e.row,e.column);return(r=e.column)!=null&&r.render?e.column.render({row:e==null?void 0:e.row,column:e==null?void 0:e.column,value:s,index:e==null?void 0:e.index}):Ve("span",String(s??""))},c=z({});O(()=>v.columns,e=>{e.forEach((s,r)=>{r==0?c[s.key]=250:c[s.key]||(c[s.key]=150)})},{immediate:!0});let V=null,U=0,W=0;const ue=(e,s)=>{V=s,U=e.clientX,W=c[s],document.addEventListener("mousemove",X),document.addEventListener("mouseup",j)},X=e=>{if(!V)return;const s=e.clientX-U,r=Math.max(80,W+s);c[V]=r},j=()=>{V=null,document.removeEventListener("mousemove",X),document.removeEventListener("mouseup",j)},h=i(v.columns.filter(e=>e.visible??!0).map(e=>e.key)),x=_(()=>v.columns.filter(e=>h.value.includes(e.key)&&e.label.toLowerCase()!=="process")),M=i(!1),g=i(null),ie=e=>{g.value===e?g.value=null:g.value=e},F=e=>{e.target.closest(".column-menu")||(M.value=!1),!e.target.closest(".row-action-btn")&&!e.target.closest(".row-action-menu")&&(g.value=null)};document.addEventListener("click",F),ge(()=>{document.removeEventListener("click",F)});const ce=e=>{const s=h.value.indexOf(e);s===-1?(p("toggleVisibility",e,!0),h.value.push(e)):(p("toggleVisibility",e,!1),h.value.splice(s,1))},be=_(()=>1+x.value.length+1);return(e,s)=>{var r;return l(),d("div",{class:"",onScroll:se},[o("div",ze,[o("table",$e,[o("thead",Be,[o("tr",Re,[s[8]||(s[8]=o("th",{class:"w-8 p-0 sticky left-0 z-20 bg-bg-surface"},null,-1)),(l(!0),d(f,null,y(x.value,t=>(l(),d("th",{key:t==null?void 0:t.key,class:"relative font-bold p-2 uppercase text-left text-[11px] tracking-wide border-r border-border/40 select-none whitespace-nowrap min-w-[200px]",style:R({width:c[t.key]?c[t.key]+"px":"100%"})},[o("span",null,Q(t==null?void 0:t.label),1),o("div",{class:"absolute right-0 top-0 h-full w-2 cursor-col-resize z-30 hover:bg-accent/20 active:bg-accent/40 transition",onMousedown:b=>ue(b,t.key)},null,40,De)],4))),128)),o("th",Ie,[o("div",Le,[o("button",{onClick:s[0]||(s[0]=$(t=>M.value=!M.value,["stop"])),class:"p-1 rounded hover:bg-bg-surface/50 cursor-pointer"},s[6]||(s[6]=[o("i",{class:"fa-regular fa-columns-3"},null,-1)])),M.value?(l(),d("div",Se,[(l(!0),d(f,null,y(v.columns.filter(t=>t.label.toLowerCase()!=="process"),t=>(l(),d("div",{key:"toggle-"+t.key,class:"flex items-center space-x-2 px-3 py-1.5 capitalize font-medium cursor-pointer hover:bg-bg-dropdown-menu-hover text-[12px] text-text-primary gap-2"},[o("input",{type:"checkbox",checked:h.value.includes(t.key),onChange:b=>ce(t.key),class:"h-4 w-4 mt-0.5 rounded border-border accent-accent cursor-pointer flex-shrink-0"},null,40,Te),o("span",null,Q(t.label),1)]))),128)),e.canCreateVariable?(l(),d("div",{key:0,onClick:s[1]||(s[1]=t=>p("addVar")),class:"sticky bottom-0 bg-bg-dropdown shadow-md mt-2 shadow-border capitalize border-t border-border px-4 py-2 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-1 overflow-hidden overflow-ellipsis text-nowrap"},s[7]||(s[7]=[o("i",{class:"fa-solid fa-plus"},null,-1),B(" Add new ")]))):m("",!0)])):m("",!0)])])])]),o("tbody",Ae,[e.isPending?(l(),d(f,{key:0},y(5,t=>o("tr",{key:"sk-"+t,class:"border-b border-border animate-pulse"},[s[10]||(s[10]=o("td",null,[o("div",{class:"w-4 h-4 bg-bg-surface rounded"})],-1)),(l(!0),d(f,null,y(e.columns,(b,E)=>(l(),d("td",{key:b.key,class:"border-r border-border h-8",style:R({width:c[b.key]+"px"}),colspan:E===x.value.length-1?2:1},s[9]||(s[9]=[o("div",{class:"w-full h-4 bg-bg-surface rounded"},null,-1)]),12,Ne))),128))])),64)):(l(!0),d(f,{key:1},y(u,(t,b)=>{var E;return l(),d(f,{key:t==null?void 0:t.id},[w.value===b&&!P.value?(l(),d("tr",{key:0,class:"relative bg-bg-surface/20 transition-all cursor-pointer border border-accent",onMouseleave:s[2]||(s[2]=n=>w.value=null)},[o("td",{class:"!p-0 w-8",onClick:n=>re(b)},s[11]||(s[11]=[o("span",{class:"absolute left-[-20px] top-[-14px] bg-bg-surface border border-border w-6 h-6 text-sm rounded-md flex justify-center items-center shadow-sm hover:bg-bg-surface pb-[0.5px]"},"+",-1)]),8,Pe),o("td",{class:"!p-0",colspan:(E=e.columns)==null?void 0:E.length},null,8,Ue)],32)):m("",!0),o("tr",{onMouseenter:n=>w.value=b,class:"border-b border-border hover:bg-bg-surface/40 transition-colors"},[o("td",Xe,[o("div",je,[o("div",{class:"h-6 w-5 flex items-center justify-center rounded hover:bg-bg-dropdown-menu-hover cursor-pointer text-text-secondary row-action-btn",onClick:$(n=>ie(t._id||t.id),["stop"])},s[12]||(s[12]=[o("i",{class:"fa-solid fa-ellipsis-vertical text-xs"},null,-1)]),8,Fe),g.value===(t._id||t.id)?(l(),d("div",Oe,[e.canDelete?(l(),d("div",{key:0,onClick:$(()=>{p("delete",t),g.value=null},["stop"]),class:"px-3 py-2 text-xs text-red-500 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-2"},s[13]||(s[13]=[o("i",{class:"fa-solid fa-trash"},null,-1),B(" Delete ")]),8,Ge)):m("",!0)])):m("",!0)])]),(l(!0),d(f,null,y(x.value,(n,ve)=>(l(),d("td",{key:n==null?void 0:n.key,class:"border-r border-border overflow-visible relative h-8",style:R({width:c[n.key]+"px"}),colspan:ve===x.value.length-1?2:1},[(a==null?void 0:a.id)===(t==null?void 0:t.id)&&(a==null?void 0:a.field)===(n==null?void 0:n.key)?xe((l(),d("input",{key:0,"onUpdate:modelValue":k=>t[n==null?void 0:n.key]=k,onBlur:k=>ne(t),class:"min-w-[200px] w-full p-1 border border-accent/60 rounded-sm focus:outline-none focus:ring-1 focus:ring-accent bg-bg-body text-[12px] h-8",ref_for:!0,ref:k=>k&&(a==null?void 0:a.id)===(t==null?void 0:t.id)&&(a==null?void 0:a.field)===(n==null?void 0:n.key)&&(N.value=k)},null,40,qe)),[[_e,t[n==null?void 0:n.key]]]):ke(e.$slots,n.key,{key:2,row:t,column:n,index:`r-${t._id}`},()=>[(l(),G(Ce(de),{row:t,column:n,index:t._id},null,8,["row","column","index"]))])],12,Qe))),128))],40,We)],64)}),128)),!P.value&&e.canCreate?(l(),d("tr",{key:2,onClick:K,class:"bg-bg-surface border-t border-border cursor-pointer transition hover:bg-bg-body",onMouseenter:s[3]||(s[3]=t=>w.value=u==null?void 0:u.length),onMouseleave:s[4]||(s[4]=t=>w.value=null)},[o("td",{colspan:be.value,class:"text-text-secondary h-8 px-3"},s[14]||(s[14]=[o("span",{class:"inline-flex w-5 h-5 border border-border-input rounded-full justify-center items-center text-secondary hover:bg-bg-surface/50 transition pb-0.5"}," + ",-1),B(" Add New Row ")]),8,He)],32)):m("",!0)])]),C.value&&ye(D).path.includes("/plan")?(l(),G(Ee,{key:0,modelValue:C.value,"onUpdate:modelValue":s[5]||(s[5]=t=>C.value=t),selectedVariable:ee.value,listId:(r=J.value)==null?void 0:r.title,sheet_id:T.value},null,8,["modelValue","selectedVariable","listId","sheet_id"])):m("",!0)])],32)}}});export{Ye as _};
