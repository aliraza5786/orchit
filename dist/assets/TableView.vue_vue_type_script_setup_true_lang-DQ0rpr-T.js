import{d as Z,N as M,x as T,r as x,c as V,A as ee,k as d,g as n,F as v,C as m,l as g,i as z,h as E,o as t,ai as $,t as F,H as se,O as re,R as ne,f as oe,b4 as te,am as le,ad as de}from"./index-DhNbIl3H.js";const ae={class:"px-4"},ue={class:"kanban-table space-y-4 h-[85vh] mt-4 overflow-y-auto overflow-x-auto ps-6 mb-5"},ie={class:"w-full table-fixed border-collapse rounded-[6px] shadow-sm bg-bg-body/20 text-sm border border-border/60"},be={class:"bg-bg-surface border-b border-border sticky top-[-1px] z-10"},ce={class:"text-text-secondary"},ve=["onMousedown"],pe={class:"w-10 p-2 text-center relative"},fe={class:"relative inline-block"},me={key:0,class:"column-menu absolute w-[200px] -right-1 bg-bg-dropdown border border-border rounded shadow z-50"},ge=["checked","onChange"],we={class:"bg-bg-surface/20"},ye=["colspan"],he=["onClick"],xe=["colspan"],ke=["onMouseenter"],Ce={class:"w-8 group text-center align-middle border-r border-border/40 relative"},_e={class:"flex justify-center items-center h-full w-full relative"},Me=["onClick"],Ve={key:0,class:"absolute left-6 top-6 bg-bg-dropdown border border-border rounded shadow-md z-50 min-w-[120px] text-left overflow-hidden row-action-menu"},ze=["onClick"],Ee=["colspan"],$e=["onUpdate:modelValue","onBlur"],Be=["colspan"],Re=Z({__name:"TableView",props:{columns:{},rows:{},isPending:{type:Boolean},canCreate:{type:Boolean,default:!0},canCreateVariable:{type:Boolean,default:!0},canDelete:{type:Boolean,default:!1}},emits:["update:rows","create","toggleVisibility","addVar","delete"],setup(P,{emit:U}){const b=P,c=U,a=M(b.rows||[]);T(()=>b.rows,e=>{e&&a.splice(0,a.length,...e)});const l=M({id:null,field:""}),p=x(null),B=x(null),L=V(()=>a.some(e=>l.id===e.id&&!e[l.field])),W=(e,s)=>{l.id=e.id,l.field=s,le(()=>{var r;return(r=B.value)==null?void 0:r.focus()})},X=()=>{l.id=null,l.field=""},j=e=>{var s;if(!((s=e[l.field])!=null&&s.trim())){const r=a.findIndex(u=>u.id===e.id);r!==-1&&a.splice(r,1)}X(),c("update:rows",a.slice()),c("create",e)},R=e=>{var r;const s={id:Date.now()};b.columns.forEach(u=>s[u.key]=""),a.splice(e,0,s),W(s,((r=b.columns[0])==null?void 0:r.key)||""),p.value=null,c("update:rows",a.slice())};function O(e,s){if(!(!e||!s))return s.includes(".")?s.split(".").reduce((r,u)=>r==null?r:r[u],e):e[s]}function H(e,s){return s!=null&&s.accessor?s.accessor(e):O(e,s.key)}const q=e=>{var r;const s=H(e.row,e.column);return(r=e.column)!=null&&r.render?e.column.render({row:e==null?void 0:e.row,column:e==null?void 0:e.column,value:s,index:e==null?void 0:e.index}):de("span",String(s??""))},i=M({});T(()=>b.columns,e=>{e.forEach((s,r)=>{r==0?i[s.key]=250:i[s.key]||(i[s.key]=150)})},{immediate:!0});let k=null,D=0,N=0;const G=(e,s)=>{k=s,D=e.clientX,N=i[s],document.addEventListener("mousemove",A),document.addEventListener("mouseup",I)},A=e=>{if(!k)return;const s=e.clientX-D,r=Math.max(80,N+s);i[k]=r},I=()=>{k=null,document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",I)},w=x(b.columns.filter(e=>e.visible??!0).map(e=>e.key)),y=V(()=>b.columns.filter(e=>w.value.includes(e.key)&&e.label.toLowerCase()!=="process")),C=x(!1),f=x(null),J=e=>{f.value===e?f.value=null:f.value=e},S=e=>{e.target.closest(".column-menu")||(C.value=!1),!e.target.closest(".row-action-btn")&&!e.target.closest(".row-action-menu")&&(f.value=null)};document.addEventListener("click",S),ee(()=>{document.removeEventListener("click",S)});const K=e=>{const s=w.value.indexOf(e);s===-1?(c("toggleVisibility",e,!0),w.value.push(e)):(c("toggleVisibility",e,!1),w.value.splice(s,1))},Q=V(()=>1+y.value.length+1);return(e,s)=>(t(),d("div",ae,[n("div",ue,[n("table",ie,[n("thead",be,[n("tr",ce,[s[8]||(s[8]=n("th",{class:"w-8 p-0 sticky left-0 z-20 bg-bg-surface"},null,-1)),(t(!0),d(v,null,m(y.value,r=>(t(),d("th",{key:r==null?void 0:r.key,class:"relative font-bold p-2 uppercase text-left text-[11px] tracking-wide border-r border-border/40 select-none whitespace-nowrap min-w-[200px]",style:$({width:i[r.key]?i[r.key]+"px":"100%"})},[n("span",null,F(r==null?void 0:r.label),1),n("div",{class:"absolute right-0 top-0 h-full w-2 cursor-col-resize z-30 hover:bg-accent/20 active:bg-accent/40 transition",onMousedown:u=>G(u,r.key)},null,40,ve)],4))),128)),n("th",pe,[n("div",fe,[n("button",{onClick:s[0]||(s[0]=z(r=>C.value=!C.value,["stop"])),class:"p-1 rounded hover:bg-bg-surface/50 cursor-pointer"},s[6]||(s[6]=[n("i",{class:"fa-regular fa-columns-3"},null,-1)])),C.value?(t(),d("div",me,[(t(!0),d(v,null,m(b.columns.filter(r=>r.label.toLowerCase()!=="process"),r=>(t(),d("div",{key:"toggle-"+r.key,class:"flex items-center space-x-2 px-3 py-1.5 capitalize font-medium cursor-pointer hover:bg-bg-dropdown-menu-hover text-[12px] text-text-primary gap-2"},[n("input",{type:"checkbox",checked:w.value.includes(r.key),onChange:u=>K(r.key),class:"h-4 w-4 mt-0.5 rounded border-border accent-accent cursor-pointer flex-shrink-0"},null,40,ge),n("span",null,F(r.label),1)]))),128)),e.canCreateVariable?(t(),d("div",{key:0,onClick:s[1]||(s[1]=r=>c("addVar")),class:"sticky bottom-0 bg-bg-dropdown shadow-md mt-2 shadow-border capitalize border-t border-border px-4 py-2 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-1 overflow-hidden overflow-ellipsis text-nowrap"},s[7]||(s[7]=[n("i",{class:"fa-solid fa-plus"},null,-1),E(" Add new ")]))):g("",!0)])):g("",!0)])])])]),n("tbody",we,[e.isPending?(t(),d(v,{key:0},m(5,r=>n("tr",{key:"sk-"+r,class:"border-b border-border animate-pulse"},[s[10]||(s[10]=n("td",null,[n("div",{class:"w-4 h-4 bg-bg-surface rounded"})],-1)),(t(!0),d(v,null,m(e.columns,(u,_)=>(t(),d("td",{key:u.key,class:"border-r border-border h-8",style:$({width:i[u.key]+"px"}),colspan:_===y.value.length-1?2:1},s[9]||(s[9]=[n("div",{class:"w-full h-4 bg-bg-surface rounded"},null,-1)]),12,ye))),128))])),64)):(t(!0),d(v,{key:1},m(a,(r,u)=>{var _;return t(),d(v,{key:r==null?void 0:r.id},[p.value===u&&!L.value?(t(),d("tr",{key:0,class:"relative bg-bg-surface/20 transition-all cursor-pointer border border-accent",onMouseleave:s[2]||(s[2]=o=>p.value=null)},[n("td",{class:"!p-0 w-8",onClick:o=>R(u)},s[11]||(s[11]=[n("span",{class:"absolute left-[-20px] top-[-14px] bg-bg-surface border border-border w-6 h-6 text-sm rounded-md flex justify-center items-center shadow-sm hover:bg-bg-surface pb-[0.5px]"},"+",-1)]),8,he),n("td",{class:"!p-0",colspan:(_=e.columns)==null?void 0:_.length},null,8,xe)],32)):g("",!0),n("tr",{onMouseenter:o=>p.value=u,class:"border-b border-border hover:bg-bg-surface/40 transition-colors"},[n("td",Ce,[n("div",_e,[n("div",{class:"h-6 w-5 flex items-center justify-center rounded hover:bg-bg-dropdown-menu-hover cursor-pointer text-text-secondary row-action-btn",onClick:z(o=>J(r._id||r.id),["stop"])},s[12]||(s[12]=[n("i",{class:"fa-solid fa-ellipsis-vertical text-xs"},null,-1)]),8,Me),f.value===(r._id||r.id)?(t(),d("div",Ve,[e.canDelete?(t(),d("div",{key:0,onClick:z(()=>{c("delete",r),f.value=null},["stop"]),class:"px-3 py-2 text-xs text-red-500 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-2"},s[13]||(s[13]=[n("i",{class:"fa-solid fa-trash"},null,-1),E(" Delete ")]),8,ze)):g("",!0)])):g("",!0)])]),(t(!0),d(v,null,m(y.value,(o,Y)=>(t(),d("td",{key:o==null?void 0:o.key,class:"border-r border-border overflow-visible relative h-8",style:$({width:i[o.key]+"px"}),colspan:Y===y.value.length-1?2:1},[(l==null?void 0:l.id)===(r==null?void 0:r.id)&&(l==null?void 0:l.field)===(o==null?void 0:o.key)?se((t(),d("input",{key:0,"onUpdate:modelValue":h=>r[o==null?void 0:o.key]=h,onBlur:h=>j(r),class:"min-w-[200px] w-full p-1 border border-accent/60 rounded-sm focus:outline-none focus:ring-1 focus:ring-accent bg-bg-body text-[12px] h-8",ref_for:!0,ref:h=>h&&(l==null?void 0:l.id)===(r==null?void 0:r.id)&&(l==null?void 0:l.field)===(o==null?void 0:o.key)&&(B.value=h)},null,40,$e)),[[ne,r[o==null?void 0:o.key]]]):re(e.$slots,o.key,{key:2,row:r,column:o,index:`r-${r._id}`},()=>[(t(),oe(te(q),{row:r,column:o,index:r._id},null,8,["row","column","index"]))])],12,Ee))),128))],40,ke)],64)}),128)),!L.value&&e.canCreate?(t(),d("tr",{key:2,onClick:s[3]||(s[3]=r=>R(a==null?void 0:a.length)),class:"bg-bg-surface border-t border-border cursor-pointer transition hover:bg-bg-body",onMouseenter:s[4]||(s[4]=r=>p.value=a==null?void 0:a.length),onMouseleave:s[5]||(s[5]=r=>p.value=null)},[n("td",{colspan:Q.value,class:"text-text-secondary h-8 px-3"},s[14]||(s[14]=[n("span",{class:"inline-flex w-5 h-5 border border-border-input rounded-full justify-center items-center text-secondary hover:bg-bg-surface/50 transition pb-0.5"},"+",-1),E(" Add New Row ")]),8,Be)],32)):g("",!0)])])])]))}});export{Re as _};
