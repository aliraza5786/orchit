import{d as O,u as T,a as W,b as G,r as b,c as l,e as I,f as H,w as n,o as L,g as a,h as i,i as _,j,s as v,k as m,l as J,m as K,n as Q,_ as B,t as E,B as V,p as X,q as Y,v as Z}from"./index-Cg6p-Sqa.js";import{_ as ee,a as te}from"./AuthLayout.vue_vue_type_script_setup_true_lang-BAw54GRi.js";import{l as se,s as oe}from"./auth-ThN0FRjB.js";import{d as ae,l as re}from"./dark-logo-Mcb_sJlF.js";const le={class:"max-w-[500px] md:mx-auto w-full text-text-primary bg-bg-body"},ne=["src"],ie={class:"text-end mt-1"},ue={key:0,class:"text-red-500 text-sm text-center mt-2"},fe=O({name:"LoginPage",__name:"Login",props:{isDark:{type:Boolean}},setup(me){const y=T(),{isDark:P}=W(),N=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,A=G(),d=b(""),p=b(""),r=b(""),u={email:!1,password:!1},x=l(()=>u.email?d.value.trim()?N.test(d.value)?"":"Invalid email":"Email is required":""),C=l(()=>!!x.value),w=l(()=>u.password?p.value?p.value.length<6?"Password must be at least 6 characters":"":"Password is required":""),F=l(()=>!!w.value),$=l(()=>!x.value&&!w.value),g=Z(),{mutateAsync:z,isPending:k}=I({mutationFn:se}),{mutateAsync:D}=I({mutationFn:oe}),M=l(()=>k.value),R=l(()=>k.value?"Signing In...":"Sign in");function h(){r.value&&(r.value="")}async function U(){var s,e;try{const t=await X(),o=await Y.get("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${t.access_token}`}}),f=await D({u_email:o.data.email,u_social_id:o.data.sub,u_social_type:"google",u_full_name:o.data.name});S(f)}catch(t){(t==null?void 0:t.message)!=="Popup closed"&&(r.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"Google Login failed. Please try again.")}}async function S(s){var t,o,f;localStorage.setItem("token",(t=s==null?void 0:s.data)==null?void 0:t.token),await A.bootstrap();const e=localStorage.getItem("post_auth_intent");if(e)try{const c=JSON.parse(e);localStorage.removeItem("post_auth_intent"),c.aiResponse&&y.setWorkspace(c.aiResponse),g.push(c.path||"/dashboard");return}catch(c){console.error("Failed to parse post_auth_intent",c),localStorage.removeItem("post_auth_intent")}if(console.log((o=s==null?void 0:s.data)==null?void 0:o.isNewUser,"new user"),(f=s==null?void 0:s.data)!=null&&f.isNewUser){g.push("/create-profile");return}y.pricing?g.push("/dashboard?stripePayment=true"):g.push("/dashboard")}async function q(){var s,e;if(r.value="",u.email=!0,u.password=!0,!$.value){r.value="Please fill all fields correctly.";return}try{const t=await z({u_email:d.value,u_password:p.value});S(t)}catch(t){r.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"Login failed. Please try again."}}return(s,e)=>{const t=j("router-link");return L(),H(ee,null,{form:n(()=>[a("div",le,[i(t,{to:"/"},{default:n(()=>[a("img",{src:_(P)?_(ae):_(re),class:"w-[150px] d-block mx-auto",alt:"image"},null,8,ne)]),_:1}),e[0]||(v(-1,!0),(e[0]=a("h2",{class:"text-[24px] md:text-[32px] font-medium mb-8 sm:mb-12 text-center text-text-primary"},[e[6]||(e[6]=m(" Sign in to Orchit AI "))])).cacheIndex=0,v(1),e[0]),a("form",{onSubmit:J(q,["prevent"]),class:"space-y-4 w-full"},[i(B,{modelValue:d.value,"onUpdate:modelValue":[e[1]||(e[1]=o=>d.value=o),h],label:"Email",placeholder:"Email address",size:"lg",error:C.value,message:x.value,onBlur:e[2]||(e[2]=o=>u.email=!0)},null,8,["modelValue","error","message"]),a("div",null,[i(B,{modelValue:p.value,"onUpdate:modelValue":[e[3]||(e[3]=o=>p.value=o),h],label:"Password",placeholder:"Enter your password",size:"lg",type:"password",error:F.value,message:w.value,onBlur:e[4]||(e[4]=o=>u.password=!0)},null,8,["modelValue","error","message"]),a("div",ie,[i(t,{to:"/forgot-password",class:"text-sm text-accent hover:underline"},{default:n(()=>e[7]||(e[7]=[m(" Forgot password? ")])),_:1,__:[7]})])]),i(V,{disabled:M.value,size:"lg",block:!0,type:"submit"},{default:n(()=>[m(E(R.value),1)]),_:1},8,["disabled"]),e[10]||(e[10]=a("div",{class:"flex items-center"},[a("div",{class:"flex-grow border-t border-border"}),a("span",{class:"mx-3 text-[12px] text-primary"},"OR"),a("div",{class:"flex-grow border-t border-border"})],-1)),i(V,{size:"lg",block:!0,appearance:"outlined",variant:"ghost",type:"button",onClick:U},{icon:n(()=>e[8]||(e[8]=[a("img",{src:te,class:"w-5 h-5 mr-4"},null,-1)])),default:n(()=>[e[9]||(e[9]=m(" Continue with google "))]),_:1,__:[9]}),r.value?(L(),K("p",ue,E(r.value),1)):Q("",!0)],32),e[5]||(v(-1,!0),(e[5]=a("p",{class:"text-sm font-medium text-text-secondary text-center mt-8"},[e[12]||(e[12]=m(" Donâ€™t have an account? ")),i(t,{to:"/register",class:"text-text-primary font-bold underline"},{default:n(()=>e[11]||(e[11]=[m("Sign up")])),_:1,__:[11]})])).cacheIndex=5,v(1),e[5])])]),_:1})}}});export{fe as default};
