import{d as xe,W as ge,M as _e,aT as we,c as T,r as f,n as ye,v as he,av as be,j as a,o,z as ke,f as d,ah as M,p as j,ad as ae,t as g,Q as re,g as Ie,D as Ce,e as Ue,P as Ee,ai as le,k as Le,h as V,F as Be,y as Re,ay as Te,al as je}from"./index-BCXm2D5k.js";const ze={key:0,class:"flex gap-2 items-center truncate"},Me=["src"],Ve={key:2,class:"w-6 h-6 bg-bg-body border border-border rounded-full flex justify-center items-center flex-shrink-0"},Ae={class:"text-[11px] text-text-primary truncate"},De={key:1,class:"truncate text-text-secondary opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1.5 text-xs"},He={key:1,class:"relative w-full"},Ne={class:"max-h-60 overflow-y-auto py-1"},$e=["onMousedown"],Oe={class:"flex items-center gap-3 min-w-0"},qe=["src"],Se={key:2,class:"w-6 h-6 bg-bg-body border border-border rounded-full flex justify-center items-center flex-shrink-0"},Fe={class:"min-w-0"},Ke={class:"text-xs font-medium truncate"},Pe={class:"text-[10px] text-text-secondary truncate"},We={class:"text-xs font-medium text-text-secondary whitespace-nowrap ml-2"},Ye={key:0,class:"text-[10px] px-2 py-1 border rounded-full border-red-500 transition group-hover:bg-red-500 group-hover:text-white"},Qe={key:1,class:"text-red-500"},Xe={key:2,class:"text-[10px] px-2 py-1 border rounded-full border-accent group-hover:bg-accent transition group-hover:text-white"},Ge={key:1,class:"px-4 py-3 text-center text-sm text-text-secondary"},et=xe({__name:"TableAssigneeCell",props:{assigneeId:{},disabled:{type:Boolean},seat:{},workspaceId:{},name:{},emptyText:{}},emits:["update:modelValue","assign","unassign"],setup(ie,{emit:de}){const u=ie,_=de,{canAssignCard:ue}=ge(),{workspaceId:ce}=_e(),{data:A}=we(T(()=>(u==null?void 0:u.workspaceId)??ce.value)),E=f(u.assigneeId??u.seat);ye(()=>[u.assigneeId,u.seat],()=>{E.value=u.assigneeId??u.seat},{deep:!0});const w=f(!1),L=f(!1),y=f(""),h=f(null),z=f(null),b=f(null),D=f({top:"0px",left:"0px",width:"100%"}),s=T(()=>{const e=E.value;if(!e)return null;const t=e._id||e.id||e;return(A.value||[]).find(i=>{var m,v;const c=i._id||i.id,l=((m=i.user)==null?void 0:m._id)||((v=i.user)==null?void 0:v.id);return c==t||l==t})||e}),H=T(()=>{const e=s.value,t=A.value||[];if(e&&(e._id||e.id)){const r=e._id||e.id,i=e,c=t.filter(l=>{var k,I,C,U;const m=l._id||l.id,v=((k=l.user)==null?void 0:k._id)||((I=l.user)==null?void 0:I.id),R=((C=e.user)==null?void 0:C._id)||((U=e.user)==null?void 0:U.id);return!(m==r||v&&v==(R||r))});return[i,{_id:null,name:"Unassign",email:""},...c]}return[{_id:null,name:"Unassign",email:""},...t]}),B=T(()=>{const e=y.value.trim().toLowerCase(),t=H.value;return e?t.filter(r=>(r.title||r.name||"").toLowerCase().includes(e)||(r.email||"").toLowerCase().includes(e)):t}),p=()=>{if(!h.value||!b.value)return;const e=h.value.getBoundingClientRect(),t=b.value.offsetHeight||200,i=window.innerHeight-e.bottom;let l=e.bottom+window.scrollY+6;i<t&&e.top>t&&(l=e.top+window.scrollY-t-5),D.value={top:`${l}px`,left:`${e.left+window.scrollX}px`,width:`${e.width}px`}},ve=async()=>{var t,r,i,c,l;if(u.disabled||!ue.value)return;w.value=!0,L.value=!0;const e=((t=s.value)==null?void 0:t.name)||((r=s.value)==null?void 0:r.title)||((i=s.value)==null?void 0:i.u_full_name);y.value=e||"",await je(),(c=h.value)==null||c.focus(),(l=h.value)==null||l.select(),p(),window.addEventListener("scroll",p,!0),window.addEventListener("resize",p)},x=()=>{w.value=!1,L.value=!1,y.value="",window.removeEventListener("scroll",p,!0),window.removeEventListener("resize",p)};function fe(e){const t=H.value.find(r=>r._id==e);t&&(E.value=t,_("assign",t),_("update:modelValue",e)),x()}function N(){E.value=null,_("unassign"),_("assign",{_id:null}),_("update:modelValue",null),x()}function $(e){if(e._id==null){N();return}if(s.value&&e._id===s.value._id){N();return}fe(e._id)}const pe=()=>{B.value.length>0?$(B.value[0]):x()},me=()=>{setTimeout(()=>{w.value&&x()},150)},O=e=>{z.value&&!z.value.contains(e.target)&&b.value&&!b.value.contains(e.target)&&w.value&&x()};return he(()=>{document.addEventListener("mousedown",O)}),be(()=>{document.removeEventListener("mousedown",O),window.removeEventListener("scroll",p,!0),window.removeEventListener("resize",p)}),(e,t)=>{var r,i,c,l,m,v,R,k,I,C,U,q,S,F,K,P,W,Y,Q,X,G,J,Z,ee,te,se;return o(),a("div",{class:"relative w-full h-full",ref_key:"containerRef",ref:z,onClick:t[3]||(t[3]=V(()=>{},["stop"]))},[w.value?(o(),a("div",He,[Ce(d("input",{ref_key:"inputRef",ref:h,"onUpdate:modelValue":t[0]||(t[0]=n=>y.value=n),onBlur:me,onKeydown:[le(pe,["enter"]),le(x,["esc"])],onInput:t[1]||(t[1]=n=>L.value=!0),class:"absolute left-0 top-1/2 h-8 -translate-y-1/2 min-w-[200px] w-full p-1 border border-accent/60 rounded-sm focus:outline-none focus:ring-1 focus:ring-accent bg-bg-body z-50 text-[12px]",placeholder:"Add people by name or email"},null,544),[[Ee,y.value]]),(o(),Ue(Te,{to:"body"},[L.value?(o(),a("div",{key:0,ref_key:"dropdownRef",ref:b,class:"fixed z-[9999] bg-bg-dropdown border border-border rounded-md shadow-lg",style:M(D.value),onMousedown:t[2]||(t[2]=V(()=>{},["prevent"]))},[d("ul",Ne,[B.value.length>0?(o(!0),a(Be,{key:0},Re(B.value,n=>{var ne,oe;return o(),a("li",{key:n._id??"unassign",onMousedown:V(Je=>$(n),["prevent"]),class:"px-3 py-2 cursor-pointer hover:bg-bg-dropdown-menu-hover text-[12px] text-text-primary flex items-center justify-between group"},[d("div",Oe,[(ne=n==null?void 0:n.user)!=null&&ne.avatar?(o(),a("img",{key:0,src:n.user.avatar,class:"w-6 h-6 rounded-full object-cover flex-shrink-0",alt:""},null,8,qe)):n.name&&n._id?(o(),a("div",{key:1,class:"w-6 h-6 border border-border rounded-full text-xs font-semibold flex items-center justify-center flex-shrink-0",style:M({backgroundColor:n!=null&&n.email?j(ae)({name:n.name,email:n.email,_id:n._id}):""})},g(j(re)(n.name)),5)):(o(),a("div",Se,t[6]||(t[6]=[d("i",{class:"fa-regular fa-user text-xs"},null,-1)]))),d("div",Fe,[d("div",Ke,g(n.name||n.title),1),d("div",Pe,g(n.role_title),1)])]),d("div",We,[n._id&&((oe=s.value)==null?void 0:oe._id)===n._id?(o(),a("span",Ye," Unassign ")):n._id==null?(o(),a("span",Qe)):(o(),a("span",Xe," Assign to "))])],40,$e)}),128)):(o(),a("div",Ge," No match found "))])],36)):Le("",!0)]))])):(o(),a("div",{key:0,onClick:ve,class:ke(["w-full h-full flex items-center px-3 py-1.5 cursor-pointer hover:bg-bg-surface-hover rounded-md truncate transition-all duration-200 min-h-[36px] group",{"opacity-50 cursor-not-allowed":e.disabled}])},[(i=(r=s.value)==null?void 0:r.user)!=null&&i.avatar||(c=s.value)!=null&&c._id||(l=e.seat)!=null&&l._id?(o(),a("div",ze,[(v=(m=s.value)==null?void 0:m.avatar)!=null&&v.src||(k=(R=s.value)==null?void 0:R.user)!=null&&k.avatar||(I=s.value)!=null&&I.u_profile_image?(o(),a("img",{key:0,src:((U=(C=s.value)==null?void 0:C.avatar)==null?void 0:U.src)??((q=s.value)==null?void 0:q.u_profile_image)??((F=(S=s.value)==null?void 0:S.user)==null?void 0:F.avatar),class:"w-5 h-5 object-cover rounded-full flex-shrink-0",alt:""},null,8,Me)):(K=s.value)!=null&&K.u_full_name||(P=s.value)!=null&&P.name?(o(),a("div",{key:1,class:"w-5 h-5 aspect-square rounded-full text-[11px] bg-bg-surface text-text-primary flex items-center justify-center flex-shrink-0",style:M({backgroundColor:((W=s.value)==null?void 0:W.u_full_name)??((Y=s.value)==null?void 0:Y.title)?j(ae)({name:((Q=s.value)==null?void 0:Q.u_full_name)??((X=s.value)==null?void 0:X.title),_id:(G=s.value)==null?void 0:G._id}):""})},g(j(re)(((J=s.value)==null?void 0:J.u_full_name)??((Z=s.value)==null?void 0:Z.name))),5)):(o(),a("div",Ve,t[4]||(t[4]=[d("i",{class:"fa-regular fa-user text-xs"},null,-1)]))),d("span",Ae,g((((ee=s.value)==null?void 0:ee.name)||((te=s.value)==null?void 0:te.title)||((se=s.value)==null?void 0:se.u_full_name))??"Unassigned"),1)])):(o(),a("span",De,[t[5]||(t[5]=d("i",{class:"fa-solid fa-plus text-[10px]"},null,-1)),Ie(" Add "+g(e.emptyText||"Assignee"),1)]))],2))],512)}}});export{et as default};
