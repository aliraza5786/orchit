import{r as w,n as R,x as Q,d as N,c as f,j as r,o as a,f as e,t as n,k as C,z as T,i as I,g as O,J as Y,v as nt,e as dt,F as h,y,w as it,b8 as ut,p as c,ad as A,ai as W,Q as L,ah as k,q as ct,b9 as q,ba as pt}from"./index-DM4dv9p1.js";import{_ as gt}from"./ProgressBar.vue_vue_type_script_setup_true_lang-DBwsVtec.js";import{c as ft,d as xt}from"./usePeople-CuGG8CNC.js";import{u as vt}from"./useTheme-6EwmB2dn.js";function bt($,{start:p=0,maxWhileLoading:v=90,step:x=.8,intervalMs:u=120}={}){const d=w(p);let i=null;const l=()=>{i==null&&(i=window.setInterval(()=>{$()&&(d.value=Math.min(d.value+x,v))},u))},g=()=>{i!=null&&(clearInterval(i),i=null)};return R($,b=>{b?(d.value=p,l()):(d.value=100,setTimeout(()=>{d.value=p,g()},300))},{immediate:!0}),Q(g),d}const mt={class:"relative p-3 rounded-lg min-w-[240px] sm:min-w-sm border border-border overflow-hidden flex flex-col justify-between bg-bg-card w-full"},_t={class:"flex justify-between items-start pb-2"},ht={class:"text-lg font-semibold text-text-primary text-left"},yt={class:"text-xs text-text-secondary text-left"},kt={class:"flex items-center gap-2"},wt={class:""},Ct={class:"flex justify-between text-sm text-text-secondary mb-1"},$t={key:0,class:"fa-regular text-left fa-arrows-spin animate-spin duration-250"},jt={key:0},St={key:1},Pt=N({__name:"ProjectCard",props:{title:{},subtitle:{},status:{},progress:{default:0},avatars:{},maxVisible:{default:2},date:{},loading:{type:Boolean,default:!1},color:{default:"#9CA3AF"},totalCard:{default:0},ai:{type:Boolean},doneCard:{}},setup($){const p=$,v=bt(()=>!!p.loading),x=f(()=>p.loading?v.value:p.progress),u=f(()=>Math.round(x.value)>=100),d=w(0);R(u,(l,g)=>{l&&!g&&d.value++});function i(l){switch(l){case"completed":return"bg-green-400/40 border-green-400 text-green-400";case"failed":return"bg-red-400/40 border-red-400 text-red-400";case"in_progress":return"bg-blue-400/20 border-blue-400 text-blue-400";case"pending":return"bg-amber-400/20 border-amber-400 text-amber-400";default:return"progress-default"}}return(l,g)=>(a(),r("div",mt,[e("div",_t,[e("div",null,[e("h3",ht,n(l.title),1),e("p",yt,n(l.subtitle),1)]),e("div",kt,[!l.totalCard&&l.status?(a(),r("span",{key:0,class:T(["text-xs border rounded-full px-2 py-0.5",i(l.status)])},n(l.status),3)):C("",!0)])]),e("div",wt,[e("div",Ct,[e("div",null,[e("span",null,n(l.status=="in_progress"?"Generating lane with AI...":"Progress"),1),g[0]||(g[0]=O()),l.status=="in_progress"?(a(),r("i",$t)):C("",!0)]),l.ai?(a(),r("span",jt,[O(n(Math.round(x.value))+"% ",1),u.value?(a(),r("span",{key:d.value,class:"confetti-icon select-none","aria-label":"Completed"}," ðŸŽ‰ ")):C("",!0)])):(a(),r("span",St,n(l.doneCard??0)+" / "+n(l.totalCard),1))]),I(gt,{class:"mt-2",progress:x.value,fillColor:"bg-accent",indeterminate:!!l.loading},null,8,["progress","indeterminate"])])]))}}),K=Y(Pt,[["__scopeId","data-v-c8d254a0"]]),Tt={class:"flex flex-col gap-4 h-full overflow-x-auto w-full flex-auto"},It={class:"p-5 rounded-[6px] bg-bg-card space-y-6"},Et={class:"flex items-center justify-between"},Dt={class:"flex flex-col w-full"},Mt={class:"flex gap-2.5 overflow-x-auto w-full py-8 custom_scroll_bar"},At=["onClick"],Lt=["onClick"],Nt={class:"flex flex-grow flex-col sm:flex-row gap-4"},Ot={class:"bg-bg-card w-full max-h-full flex-auto p-5 rounded-lg"},Rt={class:"mb-4"},Bt={class:"text-sm text-text-secondary mt-1"},Jt={key:0,class:"ml-1"},Vt={class:"space-y-4"},zt={key:1,class:"text-center py-8"},Ut={key:2,class:"text-center py-8"},Ft={class:"flex items-center gap-2 w-32 flex-shrink-0"},Gt={key:0,class:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0"},Ht=["src","alt"],Wt={key:2,class:"w-8 h-8 rounded-full bg-bg-body flex items-center justify-center flex-shrink-0"},qt=["title"],Kt={class:"flex-1"},Qt=["title"],Yt={class:"bg-bg-card w-full flex-auto p-5 max-h-full rounded-lg overflow-y-auto flex flex-col"},Xt={class:"space-y-4 overflow-y-auto flex-1"},Zt={class:"flex-1 min-w-0"},te={class:"text-sm text-text-primary"},ee={class:"font-medium text-accent/90 pe-1"},se={class:"text-text-secondary"},oe={href:"#",class:"text-accent/90 hover:underline"},ae={class:"text-xs text-text-secondary mt-1"},re=N({__name:"Peak",setup($){const{theme:p}=vt(),v=w(!1),x=w(!1),u=w(null),d=w(null);let i=!1;const l="https://backend.streamed.space/api/v1/",g=()=>{if(i||d.value)return;const o=localStorage.getItem("token")||"",s=J.value,_=localStorage.getItem("jobId"),t=s||_||S.value,lt=`${l}common/step2/tasks/${t}/stream?token=${o}&is_manual=${s||_?"false":"true"}`,P=new EventSource(lt);d.value=P,P.onopen=()=>{i||(x.value=!0)},P.onmessage=M=>{var G;if(!i)try{u.value=JSON.parse(M.data);const H=((G=u.value)==null?void 0:G.status)??"cancels";["completed","failed","canceled"].includes(H)&&b()}catch{}},P.onerror=()=>{b()},d.value.addEventListener("progress",M=>{console.log(">> trki g");try{u.value=JSON.parse(M.data)}catch{}})},b=()=>{x.value=!1,d.value&&(d.value.close(),d.value=null)};nt(()=>{i=!1,g()}),Q(()=>{i=!0,b()});const j=f(()=>{var o;return((o=u.value)==null?void 0:o.percent)===100}),X=f(()=>{var o,s;return((s=(o=u.value)==null?void 0:o.result)==null?void 0:s.lanes_summary)??[]}),Z=f(()=>{var o,s;return((s=(o=u.value)==null?void 0:o.progress_details)==null?void 0:s.lanes_progress)??[]}),B=["https://randomuser.me/api/portraits/women/1.jpg","https://randomuser.me/api/portraits/men/2.jpg","https://randomuser.me/api/portraits/men/3.jpg"],m=ct(),S=f(()=>{var o;return q((o=m==null?void 0:m.params)==null?void 0:o.id)}),J=f(()=>{var o;return q((o=m==null?void 0:m.params)==null?void 0:o.job_id)}),V=o=>{console.log("Lane clicked:",o)},{data:E,isPending:tt,error:et,refetch:st}=ft(S),{data:ot}=xt(S),z=f(()=>{var o;return(o=E.value)!=null&&o.team_workload?E.value.team_workload.map(s=>({id:s.assignee_id||"unassigned",name:s.assignee_name,initials:s.initials||L(s.assignee_name)||"",avatar:!!s.avatar_url||!!s.assignee_id,avatarUrl:s.avatar_url,color:pt(s.assignee_id,s.assignee_name),workload:s.work_distribution_percentage,totalTasks:s.total_tasks,totalHours:s.total_hours})):[]}),D=f(()=>{var o;return((o=E.value)==null?void 0:o.team_size)||0}),at=o=>({"DEPLOYED-PROD":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",REOPENED:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200","IN-PROGRESS":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"})[o]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200",rt=N({name:"SkeletonCard",setup(){return()=>k("div",{class:"w-[380px] min-w-[280px] h-[180px] rounded-xl border border-border bg-bg-body/60 animate-pulse p-4"},[k("div",{class:"h-5 w-2/3 rounded bg-bg-card/50 mb-2"}),k("div",{class:"h-3 w-1/2 rounded bg-bg-card/50 mb-4"}),k("div",{class:"h-2 w-full rounded bg-bg-card/50 mb-1"}),k("div",{class:"h-2 w-11/12 rounded bg-bg-card/50 mb-1"}),k("div",{class:"h-2 w-10/12 rounded bg-bg-card/50"})])}}),U=(o,s)=>o?(s.Done??0)/o*100:0;return R([S,J],()=>{b(),g()}),(o,s)=>{var _;return a(),r("div",Tt,[e("div",It,[e("div",Et,[e("div",Dt,[s[1]||(s[1]=e("h3",{class:"text-2xl text-text-primary font-semibold"},"Project Overview",-1)),s[2]||(s[2]=e("p",{class:"text-sm text-text-secondary mt-2"},"Last update on Sep 12, 2024 - 09.45 AM",-1)),e("div",Mt,[v.value?(a(),r(h,{key:0},y(3,t=>I(c(rt),{key:t})),64)):(a(),dt(ut,{key:1,name:"list",tag:"div",class:"flex gap-2.5"},{default:it(()=>[j.value?(a(!0),r(h,{key:0},y(X.value,t=>(a(),r("button",{key:t==null?void 0:t.lane_title,class:"group focus:outline-none border-border border focus-visible:ring-2 focus-visible:ring-primary/50 rounded-xl",type:"button",role:"button","aria-label":"Open lane details",onClick:F=>V(t)},[I(K,{ai:!1,doneCard:t==null?void 0:t.status_distribution.Done,loading:v.value||(t==null?void 0:t.status)==="in_progress",title:t==null?void 0:t.lane_title,subtitle:"",progress:j.value?U(t==null?void 0:t.total_cards,t==null?void 0:t.status_distribution):t==null?void 0:t.progress,totalCard:t==null?void 0:t.total_cards,status:j.value?"":(t==null?void 0:t.status)??"",avatars:B,date:"May 28",class:"transition-transform duration-200 ease-out group-hover:shadow-lg border border-transparent hover:border-border-subtle rounded-xl cursor-pointer"},null,8,["doneCard","loading","title","progress","totalCard","status"])],8,At))),128)):(a(!0),r(h,{key:1},y(Z.value,t=>(a(),r("button",{key:`2-${t==null?void 0:t.lane_title}`,class:"group focus:outline-none border-border border focus-visible:ring-2 focus-visible:ring-primary/50 rounded-xl",type:"button",role:"button","aria-label":"Open lane details",onClick:F=>V(t)},[I(K,{ai:!0,loading:v.value||(t==null?void 0:t.status)==="in_progress",title:t==null?void 0:t.lane_title,subtitle:"",progress:j.value?U(t==null?void 0:t.total_cards,t==null?void 0:t.status_distribution):t==null?void 0:t.progress,totalCard:t==null?void 0:t.total_cards,status:j.value?"":(t==null?void 0:t.status)??"",avatars:B,date:"May 28",class:"transition-transform duration-200 ease-out group-hover:shadow-lg border border-transparent hover:border-border-subtle rounded-xl cursor-pointer"},null,8,["loading","title","progress","totalCard","status"])],8,Lt))),128))]),_:1}))])])])]),e("div",Nt,[e("div",Ot,[e("div",Rt,[s[4]||(s[4]=e("h3",{class:"text-lg font-semibold text-text-primary"},"Team workload",-1)),e("p",Bt,[s[3]||(s[3]=O(" Monitor the capacity of your team. ")),D.value>0?(a(),r("span",Jt,"("+n(D.value)+" member"+n(D.value!==1?"s":"")+")",1)):C("",!0)])]),e("div",Vt,[s[9]||(s[9]=e("div",{class:"flex items-center justify-between text-sm font-medium text-text-secondary mb-2"},[e("span",null,"Assignee"),e("span",null,"Work distribution")],-1)),c(tt)?(a(),r(h,{key:0},y(3,t=>e("div",{key:t,class:"flex items-center gap-3 animate-pulse"},s[5]||(s[5]=[e("div",{class:"flex items-center gap-2 w-32 flex-shrink-0"},[e("div",{class:"w-8 h-8 rounded-full bg-bg-body"}),e("div",{class:"h-4 w-20 bg-bg-body rounded"})],-1),e("div",{class:"flex-1 h-6 bg-bg-body rounded"},null,-1)]))),64)):c(et)?(a(),r("div",zt,[s[6]||(s[6]=e("p",{class:"text-sm text-red-500 mb-2"},"Failed to load team workload",-1)),e("button",{onClick:s[0]||(s[0]=()=>c(st)()),class:"text-xs text-accent hover:underline"}," Try again ")])):z.value.length===0?(a(),r("div",Ut,s[7]||(s[7]=[e("i",{class:"pi pi-users text-3xl text-text-secondary mb-2"},null,-1),e("p",{class:"text-sm text-text-secondary"},"No team members assigned yet",-1)]))):(a(!0),r(h,{key:3},y(z.value,t=>(a(),r("div",{key:t.id,class:"flex items-center gap-3"},[e("div",Ft,[t.avatarUrl?(a(),r("div",Gt,[e("img",{src:t.avatarUrl,alt:t.name,class:"w-full h-full object-cover"},null,8,Ht)])):t.avatar?(a(),r("div",{key:1,class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0",style:A({backgroundColor:c(W)({name:t==null?void 0:t.name})})},n(c(L)(t.name)),5)):(a(),r("div",Wt,s[8]||(s[8]=[e("i",{class:"pi pi-user text-text-secondary"},null,-1)]))),e("span",{class:"text-sm text-text-primary truncate",title:t.name},n(t.name),9,qt)]),e("div",Kt,[e("div",{class:"h-6 bg-bg-body rounded overflow-hidden relative group cursor-help",title:`${t.totalTasks} task${t.totalTasks!==1?"s":""} â€¢ ${t.totalHours}h`},[e("div",{class:T(["h-full transition-all duration-300",c(p)==="dark"?"bg-accent":"!bg-accent-hover/40"]),style:A({width:t.workload+"%"})},null,6),t.workload>0?(a(),r("span",{key:0,class:T(["absolute inset-0 flex items-center justify-start px-2 text-[11px] font-medium",c(p)==="dark"?"text-white":"text-black"])},n(t.workload)+"% ",3)):C("",!0)],8,Qt)])]))),128))])]),e("div",Yt,[s[11]||(s[11]=e("div",{class:"mb-4"},[e("h3",{class:"text-lg font-semibold text-text-primary"},"Recent activity"),e("p",{class:"text-sm text-text-secondary mt-1"},"Stay up to date with what's happening across the project.")],-1)),e("div",Xt,[s[10]||(s[10]=e("div",{class:"text-xs font-semibold text-text-secondary mb-3"},"Today",-1)),(a(!0),r(h,null,y((_=c(ot))==null?void 0:_.activities,t=>(a(),r("div",{key:t.id,class:"flex gap-3 pb-4 border-b border-border last:border-0"},[e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0",style:A({backgroundColor:c(W)({email:t.user.email})})},n(c(L)(t.user.name)),5),e("div",Zt,[e("div",te,[e("span",ee,n(t.user.name),1),e("span",se,n(t.message),1),e("a",oe,n(t.item),1),t.status?(a(),r("span",{key:0,class:T(["ml-2 px-2 py-0.5 rounded text-xs font-medium",at(t.status)])},n(t.status),3)):C("",!0)]),e("div",ae,n(t.time),1)])]))),128))])])])])}}}),ue=Y(re,[["__scopeId","data-v-9baa4191"]]);export{ue as default};
