import{r as b,m as G,v as Y,d as L,c as _,i as r,e,t as d,j as S,y as q,h as D,f as R,o,H as K,aV as U,p as ot,q as rt,aW as lt,P as nt,b as it,F as k,x as w,n as P,w as dt,aX as ut,a9 as B,aY as ct,ai as C}from"./index-Dp_Ec3Oc.js";import{_ as gt}from"./ProgressBar.vue_vue_type_script_setup_true_lang-DavCatOP.js";import{u as pt}from"./usePeople-SZdY3nYa.js";function vt(E,{start:c=0,maxWhileLoading:p=90,step:i=.8,intervalMs:g=120}={}){const l=b(c);let v=null;const n=()=>{v==null&&(v=window.setInterval(()=>{E()&&(l.value=Math.min(l.value+i,p))},g))},f=()=>{v!=null&&(clearInterval(v),v=null)};return G(E,T=>{T?(l.value=c,n()):(l.value=100,setTimeout(()=>{l.value=c,f()},300))},{immediate:!0}),Y(f),l}const ft={class:"relative p-3 rounded-lg min-w-sm border border-border overflow-hidden flex flex-col justify-between bg-bg-card w-full"},mt={class:"flex justify-between items-start pb-2"},xt={class:"text-lg font-semibold text-text-primary text-left"},bt={class:"text-xs text-text-secondary text-left"},_t={class:"flex items-center gap-2"},yt={class:""},ht={class:"flex justify-between text-sm text-text-secondary mb-1"},kt={key:0,class:"fa-regular text-left fa-arrows-spin animate-spin duration-250"},wt={key:0},Ct={key:1},St=L({__name:"ProjectCard",props:{title:{},subtitle:{},status:{},progress:{default:0},avatars:{},maxVisible:{default:2},date:{},loading:{type:Boolean,default:!1},color:{default:"#9CA3AF"},totalCard:{default:0},ai:{type:Boolean},doneCard:{}},setup(E){const c=E,p=vt(()=>!!c.loading),i=_(()=>c.loading?p.value:c.progress),g=_(()=>Math.round(i.value)>=100),l=b(0);G(g,(n,f)=>{n&&!f&&l.value++});function v(n){switch(n){case"completed":return"bg-green-400/40 border-green-400 text-green-400";case"failed":return"bg-red-400/40 border-red-400 text-red-400";case"in_progress":return"bg-blue-400/20 border-blue-400 text-blue-400";case"pending":return"bg-amber-400/20 border-amber-400 text-amber-400";default:return"progress-default"}}return(n,f)=>(o(),r("div",ft,[e("div",mt,[e("div",null,[e("h3",xt,d(n.title),1),e("p",bt,d(n.subtitle),1)]),e("div",_t,[!n.totalCard&&n.status?(o(),r("span",{key:0,class:q(["text-xs border rounded-full px-2 py-0.5",v(n.status)])},d(n.status),3)):S("",!0)])]),e("div",yt,[e("div",ht,[e("div",null,[e("span",null,d(n.status=="in_progress"?"Generating lane with AI...":"Progress"),1),f[0]||(f[0]=R()),n.status=="in_progress"?(o(),r("i",kt)):S("",!0)]),n.ai?(o(),r("span",wt,[R(d(Math.round(i.value))+"% ",1),g.value?(o(),r("span",{key:l.value,class:"confetti-icon select-none","aria-label":"Completed"}," ðŸŽ‰ ")):S("",!0)])):(o(),r("span",Ct,d(n.doneCard)+" / "+d(n.totalCard),1))]),D(gt,{class:"mt-2",progress:i.value,fillColor:"bg-accent",indeterminate:!!n.loading},null,8,["progress","indeterminate"])])]))}}),z=K(St,[["__scopeId","data-v-88ab03cf"]]),Et={class:"flex flex-col gap-4 h-full overflow-x-auto w-full flex-auto"},It={class:"p-5 rounded-lg bg-bg-card space-y-6"},Pt={class:"flex items-center justify-between"},Dt={class:"flex flex-col w-full"},Tt={class:"flex gap-2.5 overflow-x-auto w-full py-8"},$t=["onClick"],Ot=["onClick"],Mt={class:"flex flex-grow gap-4"},jt={class:"bg-bg-card w-full flex-auto p-5 rounded-lg"},Bt={class:"mb-4"},Lt={class:"text-sm text-text-secondary mt-1"},Rt={key:0,class:"ml-1"},At={class:"space-y-4"},Vt={key:1,class:"text-center py-8"},Nt={key:2,class:"text-center py-8"},Ft={class:"flex items-center gap-2 w-32 flex-shrink-0"},Wt={key:0,class:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0"},Ht=["src","alt"],Ut={key:2,class:"w-8 h-8 rounded-full bg-bg-body flex items-center justify-center flex-shrink-0"},zt=["title"],Jt={class:"flex-1"},Gt=["title"],Yt={key:0,class:"absolute inset-0 flex items-center justify-start px-2 text-xs text-text-primary font-medium"},qt={class:"bg-bg-card w-full flex-auto p-5 rounded-lg overflow-hidden flex flex-col"},Kt={class:"space-y-4 overflow-y-auto flex-1"},Xt={class:"flex-1 min-w-0"},Qt={class:"text-sm text-text-primary"},Zt={class:"font-medium text-accent/90"},te={class:"text-text-secondary"},ee={href:"#",class:"text-accent/90 hover:underline"},se={class:"text-xs text-text-secondary mt-1"},J=5,ae=L({__name:"Peak",setup(E){const c=b(!1),p=b(null),i=b(null),g=b(0),l=b({}),v="https://backend.streamed.space/api/v1/workspace",n=_(()=>{var a;return((a=p.value)==null?void 0:a.percent)==100}),f=_(()=>{var a,s;return((s=(a=p.value)==null?void 0:a.result)==null?void 0:s.lanes_summary)??[]}),T=_(()=>{var a,s;return((s=(a=p.value)==null?void 0:a.progress_details)==null?void 0:s.lanes_progress)??[]}),I=b(!1),A=["https://randomuser.me/api/portraits/women/1.jpg","https://randomuser.me/api/portraits/men/2.jpg","https://randomuser.me/api/portraits/men/3.jpg"],y=ot(),V=_(()=>{var a;return U((a=y==null?void 0:y.params)==null?void 0:a.id)}),m=_(()=>{var a;return U((a=y==null?void 0:y.params)==null?void 0:a.job_id)}),$=()=>{if(i.value&&i.value.readyState===EventSource.OPEN||g.value>=J)return;i.value&&i.value.close();const a=localStorage.getItem("token")||"",s=m!=null&&m.value?m==null?void 0:m.value:localStorage.getItem("jobId")?localStorage.getItem("jobId"):V.value,t=localStorage.getItem("jobId")||m!=null&&m.value?"false":"true",h=`${v}/step2/tasks/${s}/stream?token=${a}&is_manual=${t}`;try{i.value=new EventSource(h,{withCredentials:!1}),i.value.onopen=()=>{I.value=!0,c.value=!0,g.value=0,l.value={...l.value,connectionStatus:"Connected",lastConnected:new Date().toISOString(),url:h},I.value=!1},i.value.onmessage=u=>{try{const x=JSON.parse(u.data);p.value=x,l.value={...l.value,lastMessage:x,lastMessageTime:new Date().toISOString()},["completed","failed","canceled"].includes(x.status)&&setTimeout(O,1200)}catch(x){l.value={...l.value,parseError:x==null?void 0:x.message,rawMessage:u.data}}},i.value.addEventListener("progress",u=>{try{p.value=JSON.parse(u.data)}catch{}}),i.value.addEventListener("error",u=>{try{l.value={...l.value,serverError:JSON.parse(u.data)}}catch{}}),i.value.onerror=()=>{var u;if(c.value=!1,l.value={...l.value,connectionError:!0,errorTime:new Date().toISOString(),readyState:(u=i.value)==null?void 0:u.readyState},g.value<J){g.value++;const x=Math.min(3e4,1e3*2**g.value);setTimeout($,x)}}}catch(u){l.value={...l.value,creationError:u==null?void 0:u.message,errorTime:new Date().toISOString()}}},O=()=>{i.value&&(i.value.close(),i.value=null),c.value=!1,l.value={...l.value,disconnectedAt:new Date().toISOString()}},X=()=>{O(),g.value=0,setTimeout($,600)};rt(()=>{$(),document.addEventListener("visibilitychange",N)}),Y(()=>{O(),document.removeEventListener("visibilitychange",N)});const N=()=>{!document.hidden&&!c.value&&(!i.value||i.value.readyState===EventSource.CLOSED)&&X()},F=a=>{console.log("Lane clicked:",a)},{data:M,isPending:Q,error:Z,refetch:tt}=pt(V),W=_(()=>{var s;if(!((s=M.value)!=null&&s.team_workload))return console.log("Returning empty array - no team workload data"),[];const a=M.value.team_workload.map(t=>({id:t.assignee_id||"unassigned",name:t.assignee_name,initials:t.initials||nt(t.assignee_name)||"",avatar:!!t.avatar_url||!!t.assignee_id,avatarUrl:t.avatar_url,color:lt(t.assignee_id,t.assignee_name),workload:t.work_distribution_percentage,totalTasks:t.total_tasks,totalHours:t.total_hours}));return console.log("Mapped team workload:",a),a}),j=_(()=>{var a;return((a=M.value)==null?void 0:a.team_size)||0}),et=b([{id:1,user:"Streamed Bot",userInitials:"VB",userColor:"#06B6D4",action:'updated field "RemoteWorkItemLink" on',item:"VFC-33073: IPU: Agenda Multilingual Issue (global issue)",status:"DEPLOYED-PROD",time:"about 4 hours ago"},{id:2,user:"Streamed Bot",userInitials:"VB",userColor:"#06B6D4",action:'updated field "RemoteWorkItemLink" on',item:"VFC-31468: Show/Hide Team Members on Booth",status:"REOPENED",time:"about 4 hours ago"},{id:3,user:"Streamed Bot",userInitials:"VB",userColor:"#06B6D4",action:'updated field "RemoteWorkItemLink" on',item:"VFC-32359: Favicon not displaying after uploading from Event Settings",status:"",time:"about 4 hours ago"}]),st=a=>({"DEPLOYED-PROD":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",REOPENED:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200","IN-PROGRESS":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"})[a]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200",at=L({name:"SkeletonCard",setup(){return()=>C("div",{class:"w-[380px] min-w-[280px] h-[180px] rounded-xl border border-border bg-bg-body/60 animate-pulse p-4"},[C("div",{class:"h-5 w-2/3 rounded bg-bg-card/50 mb-2"}),C("div",{class:"h-3 w-1/2 rounded bg-bg-card/50 mb-4"}),C("div",{class:"h-2 w-full rounded bg-bg-card/50 mb-1"}),C("div",{class:"h-2 w-11/12 rounded bg-bg-card/50 mb-1"}),C("div",{class:"h-2 w-10/12 rounded bg-bg-card/50"})])}}),H=(a,s)=>{if(a==0)return 0;const t=s.Done??0,h=t/a*100;return console.log(t,">>",a),h};return(a,s)=>(o(),r("div",Et,[e("div",It,[e("div",Pt,[e("div",Dt,[s[1]||(s[1]=e("h3",{class:"text-2xl text-text-primary font-semibold"},"Project Overview",-1)),s[2]||(s[2]=e("p",{class:"text-sm text-text-secondary mt-2"},"Last update on Sep 12, 2024 - 09.45 AM",-1)),e("div",Tt,[I.value?(o(),r(k,{key:0},w(3,t=>D(P(at),{key:t})),64)):(o(),it(ut,{key:1,name:"list",tag:"div",class:"flex gap-2.5"},{default:dt(()=>[n.value?(o(!0),r(k,{key:0},w(f.value,t=>(o(),r("button",{key:t==null?void 0:t.lane_title,class:"group focus:outline-none border-border border focus-visible:ring-2 focus-visible:ring-primary/50 rounded-xl",type:"button",role:"button","aria-label":"Open lane details",onClick:h=>F(t)},[D(z,{ai:!1,doneCard:t==null?void 0:t.status_distribution.Done,loading:I.value||(t==null?void 0:t.status)==="in_progress",title:t==null?void 0:t.lane_title,subtitle:"Mobile Application",progress:n.value?H(t==null?void 0:t.total_cards,t==null?void 0:t.status_distribution):t==null?void 0:t.progress,totalCard:t==null?void 0:t.total_cards,status:n.value?"":(t==null?void 0:t.status)??"",avatars:A,date:"May 28",class:"transition-transform duration-200 ease-out group-hover:shadow-lg border border-transparent hover:border-border-subtle rounded-xl cursor-pointer"},null,8,["doneCard","loading","title","progress","totalCard","status"])],8,$t))),128)):(o(!0),r(k,{key:1},w(T.value,t=>(o(),r("button",{key:`2-${t==null?void 0:t.lane_title}`,class:"group focus:outline-none border-border border focus-visible:ring-2 focus-visible:ring-primary/50 rounded-xl",type:"button",role:"button","aria-label":"Open lane details",onClick:h=>F(t)},[D(z,{ai:!0,loading:I.value||(t==null?void 0:t.status)==="in_progress",title:t==null?void 0:t.lane_title,subtitle:"Mobile Application",progress:n.value?H(t==null?void 0:t.total_cards,t==null?void 0:t.status_distribution):t==null?void 0:t.progress,totalCard:t==null?void 0:t.total_cards,status:n.value?"":(t==null?void 0:t.status)??"",avatars:A,date:"May 28",class:"transition-transform duration-200 ease-out group-hover:shadow-lg border border-transparent hover:border-border-subtle rounded-xl cursor-pointer"},null,8,["loading","title","progress","totalCard","status"])],8,Ot))),128))]),_:1}))])])])]),e("div",Mt,[e("div",jt,[e("div",Bt,[s[4]||(s[4]=e("h3",{class:"text-lg font-semibold text-text-primary"},"Team workload",-1)),e("p",Lt,[s[3]||(s[3]=R(" Monitor the capacity of your team. ")),j.value>0?(o(),r("span",Rt,"("+d(j.value)+" member"+d(j.value!==1?"s":"")+")",1)):S("",!0)])]),e("div",At,[s[9]||(s[9]=e("div",{class:"flex items-center justify-between text-sm font-medium text-text-secondary mb-2"},[e("span",null,"Assignee"),e("span",null,"Work distribution")],-1)),P(Q)?(o(),r(k,{key:0},w(3,t=>e("div",{key:t,class:"flex items-center gap-3 animate-pulse"},s[5]||(s[5]=[e("div",{class:"flex items-center gap-2 w-32 flex-shrink-0"},[e("div",{class:"w-8 h-8 rounded-full bg-bg-body"}),e("div",{class:"h-4 w-20 bg-bg-body rounded"})],-1),e("div",{class:"flex-1 h-6 bg-bg-body rounded"},null,-1)]))),64)):P(Z)?(o(),r("div",Vt,[s[6]||(s[6]=e("p",{class:"text-sm text-red-500 mb-2"},"Failed to load team workload",-1)),e("button",{onClick:s[0]||(s[0]=()=>P(tt)()),class:"text-xs text-accent hover:underline"}," Try again ")])):W.value.length===0?(o(),r("div",Nt,s[7]||(s[7]=[e("i",{class:"pi pi-users text-3xl text-text-secondary mb-2"},null,-1),e("p",{class:"text-sm text-text-secondary"},"No team members assigned yet",-1)]))):(o(!0),r(k,{key:3},w(W.value,t=>(o(),r("div",{key:t.id,class:"flex items-center gap-3"},[e("div",Ft,[t.avatar_url?(o(),r("div",Wt,[e("img",{src:t.avatar_url,alt:t.name,class:"w-full h-full object-cover"},null,8,Ht)])):t.avatar?(o(),r("div",{key:1,class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0",style:B({backgroundColor:P(ct)({email:t==null?void 0:t.assignee_id})})},d(t.initials),5)):(o(),r("div",Ut,s[8]||(s[8]=[e("i",{class:"pi pi-user text-text-secondary"},null,-1)]))),e("span",{class:"text-sm text-text-primary truncate",title:t.name},d(t.name),9,zt)]),e("div",Jt,[e("div",{class:"h-6 bg-bg-body rounded overflow-hidden relative group cursor-help",title:`${t.totalTasks} task${t.totalTasks!==1?"s":""} â€¢ ${t.totalHours}h`},[e("div",{class:"h-full bg-border-subtle transition-all duration-300",style:B({width:t.workload+"%"})},null,4),t.workload>10?(o(),r("span",Yt,d(t.workload)+"% ",1)):S("",!0)],8,Gt)])]))),128))])]),e("div",qt,[s[11]||(s[11]=e("div",{class:"mb-4"},[e("h3",{class:"text-lg font-semibold text-text-primary"},"Recent activity"),e("p",{class:"text-sm text-text-secondary mt-1"},"Stay up to date with what's happening across the project.")],-1)),e("div",Kt,[s[10]||(s[10]=e("div",{class:"text-xs font-semibold text-text-secondary mb-3"},"Today",-1)),(o(!0),r(k,null,w(et.value,t=>(o(),r("div",{key:t.id,class:"flex gap-3 pb-4 border-b border-border last:border-0"},[e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0",style:B({backgroundColor:t.userColor})},d(t.userInitials),5),e("div",Xt,[e("div",Qt,[e("span",Zt,d(t.user),1),e("span",te,d(t.action),1),e("a",ee,d(t.item),1),t.status?(o(),r("span",{key:0,class:q(["ml-2 px-2 py-0.5 rounded text-xs font-medium",st(t.status)])},d(t.status),3)):S("",!0)]),e("div",se,d(t.time),1)])]))),128))])])])]))}}),ne=K(ae,[["__scopeId","data-v-551a509f"]]);export{ne as default};
