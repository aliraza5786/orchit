import{r as S,x as L,D as et,d as V,c as f,m as a,o as r,g as s,t as l,n as $,F as I,h as A,k as z,N as st,a as pt,u as gt,bc as X,A as ft,a2 as xt,C as bt,bd as vt,U as B,S as _t,i as u,f as mt,G as w,E as y,w as ht,be as kt,ak as U,ag as Z,af as C}from"./index-CHrAgj-f.js";import{_ as wt}from"./ProgressBar.vue_vue_type_script_setup_true_lang-BXVYniwR.js";import{c as yt,d as Ct}from"./usePeople-DEtKEEs7.js";import{a as St}from"./FormatDate-DIyppjZM.js";function $t(j,{start:g=0,maxWhileLoading:T=90,step:d=.8,intervalMs:c=120}={}){const i=S(g);let p=null;const n=()=>{p==null&&(p=window.setInterval(()=>{j()&&(i.value=Math.min(i.value+d,T))},c))},x=()=>{p!=null&&(clearInterval(p),p=null)};return L(j,M=>{M?(i.value=g,n()):(i.value=100,setTimeout(()=>{i.value=g,x()},300))},{immediate:!0}),et(x),i}const jt={class:"relative p-3 rounded-lg min-w-[240px] sm:min-w-sm border border-border overflow-hidden flex flex-col justify-between bg-bg-card w-full"},Tt={class:"flex justify-between items-start pb-2"},Pt={class:"text-lg font-semibold text-text-primary text-left"},Dt={class:"text-xs text-text-secondary text-left"},Et={class:"flex items-center gap-2"},It={class:""},At={class:"flex justify-between text-sm text-text-secondary mb-1"},Lt={key:0,class:"fa-regular text-left fa-arrows-spin animate-spin duration-250"},Mt={key:0},Nt={key:1},Ot=V({__name:"ProjectCard",props:{title:{},subtitle:{},status:{},progress:{default:0},avatars:{},maxVisible:{default:2},date:{},loading:{type:Boolean,default:!1},color:{default:"#9CA3AF"},totalCard:{default:0},ai:{type:Boolean},doneCard:{}},setup(j){const g=j,T=$t(()=>!!g.loading),d=f(()=>g.loading?T.value:g.progress),c=f(()=>Math.round(d.value)>=100),i=S(0);L(c,(n,x)=>{n&&!x&&i.value++});function p(n){switch(n){case"completed":return"bg-green-400/40 border-green-400 text-green-400";case"failed":return"bg-red-400/40 border-red-400 text-red-400";case"in_progress":return"bg-blue-400/20 border-blue-400 text-blue-400";case"pending":return"bg-amber-400/20 border-amber-400 text-amber-400";default:return"progress-default"}}return(n,x)=>(r(),a("div",jt,[s("div",Tt,[s("div",null,[s("h3",Pt,l(n.title),1),s("p",Dt,l(n.subtitle),1)]),s("div",Et,[!n.totalCard&&n.status?(r(),a("span",{key:0,class:I(["text-xs border rounded-full px-2 py-0.5 capitalize",p(n.status)])},l(n.status==="in_progress"?"In Progress":n.status),3)):$("",!0)])]),s("div",It,[s("div",At,[s("div",null,[s("span",null,l(n.status=="in_progress"?"Generating lane with AI...":"Progress"),1),x[0]||(x[0]=z()),n.status=="in_progress"?(r(),a("i",Lt)):$("",!0)]),n.ai?(r(),a("span",Mt,[z(l(Math.round(d.value))+"% ",1),c.value?(r(),a("span",{key:i.value,class:"confetti-icon select-none","aria-label":"Completed"}," ðŸŽ‰ ")):$("",!0)])):(r(),a("span",Nt,l(n.doneCard??0)+" / "+l(n.totalCard),1))]),A(wt,{class:"mt-2",progress:d.value,fillColor:"bg-accent",indeterminate:!!n.loading},null,8,["progress","indeterminate"])])]))}}),tt=st(Ot,[["__scopeId","data-v-22b8ef07"]]),Rt={class:"flex flex-col gap-4 h-full overflow-x-auto w-full flex-auto"},Bt={class:"p-5 rounded-[6px] bg-bg-card space-y-6 border border-border"},Ut={class:"flex items-center justify-between"},Vt={class:"flex flex-col w-full"},zt={class:"text-sm text-text-secondary mt-2"},Ht={class:"flex gap-2.5 overflow-x-auto w-full py-8 custom_scroll_bar"},Jt=["onClick"],Ft=["onClick"],Gt={class:"flex flex-grow flex-col sm:flex-row gap-4"},Wt={class:"bg-bg-card w-full max-h-full flex-auto p-5 rounded-lg border border-border"},qt={class:"mb-4"},Kt={class:"text-sm text-text-secondary mt-1"},Qt={key:0,class:"ml-1"},Yt={class:"space-y-4"},Xt={key:1,class:"text-center py-8"},Zt={key:2,class:"text-center py-8"},te={class:"flex items-center gap-2 w-32 flex-shrink-0"},ee={key:0,class:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0"},se=["src","alt"],oe={key:2,class:"w-8 h-8 rounded-full bg-bg-body flex items-center justify-center flex-shrink-0"},re=["title"],ae={class:"flex-1"},ne=["title"],le={class:"bg-bg-card w-full flex-auto p-5 max-h-full rounded-lg overflow-y-auto flex flex-col border border-border"},de={class:"space-y-4 overflow-y-auto flex-1"},ie={class:"flex-1 min-w-0"},ue={class:"text-sm text-text-primary"},ce={class:"font-medium text-accent/90 pe-1"},pe={class:"text-text-secondary"},ge={href:"#",class:"text-accent/90 hover:underline"},fe={class:"text-xs text-text-secondary mt-1"},xe=V({__name:"Peak",setup(j){const{isDark:g}=pt(),T=gt(),d=ft(),c=f(()=>{var o;return X((o=d==null?void 0:d.params)==null?void 0:o.id)}),i=f(()=>{var o;return X((o=d==null?void 0:d.params)==null?void 0:o.job_id)}),{data:p,isPending:n,error:x,refetch:M}=yt(c),{data:H}=Ct(c),{data:ot}=xt(c),rt=f(()=>{var b,t,v;const o=(b=H.value)==null?void 0:b.activities,e=((t=T.workspace)==null?void 0:t.created_at)||((v=ot.value)==null?void 0:v.created_at);return o!=null&&o.length&&o[0].created_at||e});function at(o){const e=document.createElement("div");return e.innerHTML=o,e.textContent||e.innerText||""}const N=S(!1),J=S(!1),m=S(null),h=S(null);let P=!1;const nt="https://backend.streamed.space/api/v1/",F=()=>{if(P||h.value)return;const o=localStorage.getItem("token")||"",e=i.value,b=localStorage.getItem("jobId"),t=e||b||c.value,E=`${nt}common/step2/tasks/${t}/stream?token=${o}&is_manual=${e||b?"false":"true"}`,_=new EventSource(E);h.value=_,_.onopen=()=>{P||(J.value=!0)},_.onmessage=R=>{var Q;if(!P)try{m.value=JSON.parse(R.data);const Y=((Q=m.value)==null?void 0:Q.status)??"cancels";["completed","failed","canceled"].includes(Y)&&D()}catch{}},_.onerror=()=>{D()},h.value.addEventListener("progress",R=>{try{m.value=JSON.parse(R.data)}catch{}})},D=()=>{J.value=!1,h.value&&(h.value.close(),h.value=null)};bt(()=>{P=!1,F()}),et(()=>{P=!0,D()});const k=f(()=>{var o;return((o=m.value)==null?void 0:o.percent)===100}),lt=f(()=>{var o,e;return((e=(o=m.value)==null?void 0:o.result)==null?void 0:e.lanes_summary)??[]}),dt=f(()=>{var o,e;return((e=(o=m.value)==null?void 0:o.progress_details)==null?void 0:e.lanes_progress)??[]}),G=["https://randomuser.me/api/portraits/women/1.jpg","https://randomuser.me/api/portraits/men/2.jpg","https://randomuser.me/api/portraits/men/3.jpg"],W=o=>{console.log("Lane clicked:",o)},q=f(()=>{var o;return(o=p.value)!=null&&o.team_workload?p.value.team_workload.map(e=>({id:e.assignee_id||"unassigned",name:e.assignee_name,initials:e.initials||B(e.assignee_name)||"",avatar:!!e.avatar_url||!!e.assignee_id,avatarUrl:e.avatar_url,color:vt(e.assignee_id,e.assignee_name),workload:e.work_distribution_percentage,totalTasks:e.total_tasks,totalHours:e.total_hours})):[]}),O=f(()=>{var o;return((o=p.value)==null?void 0:o.team_size)||0}),it=o=>({"DEPLOYED-PROD":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",REOPENED:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200","IN-PROGRESS":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"})[o]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200",ut=V({name:"SkeletonCard",setup(){return()=>C("div",{class:"w-[380px] min-w-[280px] h-[180px] rounded-xl border border-border bg-bg-body/60 animate-pulse p-4"},[C("div",{class:"h-5 w-2/3 rounded bg-bg-card/50 mb-2"}),C("div",{class:"h-3 w-1/2 rounded bg-bg-card/50 mb-4"}),C("div",{class:"h-2 w-full rounded bg-bg-card/50 mb-1"}),C("div",{class:"h-2 w-11/12 rounded bg-bg-card/50 mb-1"}),C("div",{class:"h-2 w-10/12 rounded bg-bg-card/50"})])}}),K=(o,e)=>o?(e.Done??0)/o*100:0,ct=_t();return L(k,o=>{o&&ct.invalidateQueries({queryKey:["dashboard-teams",c.value]})}),L([c,i],()=>{D(),F()}),(o,e)=>{var b;return r(),a("div",Rt,[s("div",Bt,[s("div",Ut,[s("div",Vt,[e[1]||(e[1]=s("h3",{class:"text-2xl text-text-primary font-semibold"},"Project Overview",-1)),s("p",zt,"Last update on "+l(u(St)(rt.value)),1),s("div",Ht,[N.value?(r(),a(w,{key:0},y(3,t=>A(u(ut),{key:t})),64)):(r(),mt(kt,{key:1,name:"list",tag:"div",class:"flex gap-2.5"},{default:ht(()=>[k.value?(r(!0),a(w,{key:0},y(lt.value,t=>(r(),a("button",{key:t==null?void 0:t.lane_title,class:"group focus:outline-none border-border border focus-visible:ring-2 focus-visible:ring-primary/50 rounded-xl",type:"button",role:"button","aria-label":"Open lane details",onClick:v=>W(t)},[A(tt,{ai:!1,doneCard:t==null?void 0:t.status_distribution.Done,loading:N.value||(t==null?void 0:t.status)==="in_progress",title:t==null?void 0:t.lane_title,subtitle:"",progress:k.value?K(t==null?void 0:t.total_cards,t==null?void 0:t.status_distribution):t==null?void 0:t.progress,totalCard:t==null?void 0:t.total_cards,status:k.value?"":(t==null?void 0:t.status)??"",avatars:G,date:"May 28",class:"transition-transform duration-200 ease-out group-hover:shadow-lg border border-transparent hover:border-border-subtle rounded-xl cursor-pointer"},null,8,["doneCard","loading","title","progress","totalCard","status"])],8,Jt))),128)):(r(!0),a(w,{key:1},y(dt.value,t=>(r(),a("button",{key:`2-${t==null?void 0:t.lane_title}`,class:"group focus:outline-none border-border border focus-visible:ring-2 focus-visible:ring-primary/50 rounded-xl",type:"button",role:"button","aria-label":"Open lane details",onClick:v=>W(t)},[A(tt,{ai:!0,loading:N.value||(t==null?void 0:t.status)==="in_progress",title:t==null?void 0:t.lane_title,subtitle:"",progress:k.value?K(t==null?void 0:t.total_cards,t==null?void 0:t.status_distribution):t==null?void 0:t.progress,totalCard:t==null?void 0:t.total_cards,status:k.value?"":(t==null?void 0:t.status)??"",avatars:G,date:"May 28",class:"transition-transform duration-200 ease-out group-hover:shadow-lg border border-transparent hover:border-border-subtle rounded-xl cursor-pointer"},null,8,["loading","title","progress","totalCard","status"])],8,Ft))),128))]),_:1}))])])])]),s("div",Gt,[s("div",Wt,[s("div",qt,[e[3]||(e[3]=s("h3",{class:"text-lg font-semibold text-text-primary"},"Team workload",-1)),s("p",Kt,[e[2]||(e[2]=z(" Monitor the capacity of your team. ")),O.value>0?(r(),a("span",Qt,"("+l(O.value)+" member"+l(O.value!==1?"s":"")+")",1)):$("",!0)])]),s("div",Yt,[e[8]||(e[8]=s("div",{class:"flex items-center justify-between text-sm font-medium text-text-secondary mb-2"},[s("span",null,"Assignee"),s("span",null,"Work distribution")],-1)),u(n)?(r(),a(w,{key:0},y(3,t=>s("div",{key:t,class:"flex items-center gap-3 animate-pulse"},e[4]||(e[4]=[s("div",{class:"flex items-center gap-2 w-32 flex-shrink-0"},[s("div",{class:"w-8 h-8 rounded-full bg-bg-body"}),s("div",{class:"h-4 w-20 bg-bg-body rounded"})],-1),s("div",{class:"flex-1 h-6 bg-bg-body rounded"},null,-1)]))),64)):u(x)?(r(),a("div",Xt,[e[5]||(e[5]=s("p",{class:"text-sm text-red-500 mb-2"},"Failed to load team workload",-1)),s("button",{onClick:e[0]||(e[0]=()=>u(M)()),class:"text-xs text-accent hover:underline"}," Try again ")])):q.value.length===0?(r(),a("div",Zt,e[6]||(e[6]=[s("i",{class:"pi pi-users text-3xl text-text-secondary mb-2"},null,-1),s("p",{class:"text-sm text-text-secondary"},"No team members assigned yet",-1)]))):(r(!0),a(w,{key:3},y(q.value,t=>(r(),a("div",{key:t.id,class:"flex items-center gap-3"},[s("div",te,[t.avatarUrl?(r(),a("div",ee,[s("img",{src:t==null?void 0:t.avatarUrl,alt:t.name,class:"w-full h-full object-cover"},null,8,se)])):t.avatar?(r(),a("div",{key:1,class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0",style:U({backgroundColor:u(Z)({name:t==null?void 0:t.name})})},l(u(B)(t==null?void 0:t.name)),5)):(r(),a("div",oe,e[7]||(e[7]=[s("i",{class:"pi pi-user text-text-secondary"},null,-1)]))),s("span",{class:"text-sm text-text-primary truncate",title:t==null?void 0:t.name},l(t==null?void 0:t.name),9,re)]),s("div",ae,[s("div",{class:"h-6 bg-bg-body rounded overflow-hidden relative group cursor-help",title:`${t.totalTasks} task${t.totalTasks!==1?"s":""} â€¢ ${t.totalHours}h`},[s("div",{class:I(["h-full transition-all duration-300",u(g)?"bg-accent":"!bg-accent-hover/40"]),style:U({width:t.workload+"%"})},null,6),t.workload>0?(r(),a("span",{key:0,class:I(["absolute inset-0 flex items-center justify-start px-2 text-[11px] font-medium",u(g)?"text-white":"text-black"])},l(t.workload)+"% ",3)):$("",!0)],8,ne)])]))),128))])]),s("div",le,[e[10]||(e[10]=s("div",{class:"mb-4"},[s("h3",{class:"text-lg font-semibold text-text-primary"},"Recent activity"),s("p",{class:"text-sm text-text-secondary mt-1"},"Stay up to date with what's happening across the project.")],-1)),s("div",de,[e[9]||(e[9]=s("div",{class:"text-xs font-semibold text-text-secondary mb-3"},"Today",-1)),(r(!0),a(w,null,y((b=u(H))==null?void 0:b.activities,t=>{var v,E,_;return r(),a("div",{key:t.id,class:"flex gap-3 pb-4 border-b border-border last:border-0"},[s("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0",style:U({backgroundColor:u(Z)({email:(v=t==null?void 0:t.user)==null?void 0:v.email})})},l(u(B)((E=t==null?void 0:t.user)==null?void 0:E.name)),5),s("div",ie,[s("div",ue,[s("span",ce,l((_=t==null?void 0:t.user)==null?void 0:_.name),1),s("span",pe,l(at((t==null?void 0:t.message)||"")),1),s("a",ge,l(t==null?void 0:t.item),1),t.status?(r(),a("span",{key:0,class:I(["ml-2 px-2 py-0.5 rounded text-xs font-medium",it(t.status)])},l(t==null?void 0:t.status),3)):$("",!0)]),s("div",fe,l(t==null?void 0:t.time),1)])])}),128))])])])])}}}),he=st(xe,[["__scopeId","data-v-42e84645"]]);export{he as default};
