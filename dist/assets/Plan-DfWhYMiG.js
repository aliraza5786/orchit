const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CreateTaskModal-BUHUIaIC.js","assets/CreateTaskModal.vue_vue_type_script_setup_true_lang-DyzUkjSN.js","assets/index-4JW-ETzS.js","assets/index-CRJRR81M.css","assets/ConfirmDeleteModal-D8jt0OC-.js","assets/ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-ov0iyDOG.js","assets/SidePanel-BgmaW-kZ.js","assets/SidePanel-5-aOg4mI.css","assets/KanbanBoard-eCML5kv-.js","assets/lodash-CRk4idl7.js","assets/lodash-B_VDCJnj.css","assets/DropMenu.vue_vue_type_script_setup_true_lang-CqKH5eU6.js","assets/workspace-muT0PUXL.js","assets/KanbanBoard-DlFwUlEB.css"])))=>i.map(i=>d[i]);
import{J as _e,K as qe,L as le,n as y,r as w,m as H,M as ke,c as B,N as De,d as Se,O as pt,i as h,e as a,g as fe,y as K,F as ve,x as we,t as R,P as mt,o as c,H as Ge,Q as Vt,b as ae,w as G,h as q,_ as vt,B as ue,f as J,R as Ze,j as te,S as je,A as Ve,T as $t,a as Je,U as ft,V as Tt,W as gt,X as Lt,Y as bt,Z as Bt,G as nt,C as Qe,$ as Et,a0 as Mt,a1 as Pt,a2 as Ut,a3 as Fe,a4 as He,p as At,q as Ot,a5 as qt,a6 as It,a7 as ot,a8 as Nt}from"./index-4JW-ETzS.js";import{u as We}from"./useTheme-RckKLIKa.js";import{_ as Ft}from"./BaseTextAreaField.vue_vue_type_script_setup_true_lang-Dp8llvQC.js";import{l as Ht,K as Rt,D as jt}from"./lodash-CRk4idl7.js";import{_ as zt}from"./SearchBar.vue_vue_type_script_setup_true_lang-DGIWLYzy.js";import{_ as Qt}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-ov0iyDOG.js";import{u as Kt}from"./workspace-muT0PUXL.js";import{K as Gt}from"./KanbanTicket-DWPU5BUA.js";import{F as Zt}from"./fuse-Ch1WBRTM.js";import"./DropMenu.vue_vue_type_script_setup_true_lang-CqKH5eU6.js";const Jt="data:image/svg+xml,%3csvg%20width='60'%20height='46'%20viewBox='0%200%2060%2046'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20opacity='0.4'%3e%3cpath%20d='M59.7443%2034.8967L50.5682%2025.7206C50.4457%2025.5984%2050.2897%2025.5152%2050.1199%2025.4816C49.9501%2025.4479%2049.7742%2025.4653%2049.6143%2025.5315C49.4544%2025.5976%2049.3176%2025.7097%2049.2213%2025.8535C49.125%2025.9973%2049.0734%2026.1664%2049.073%2026.3394V30.517H25.9775V40.5114H49.0755V44.689C49.0759%2044.8621%2049.1275%2045.0312%2049.2238%2045.175C49.3201%2045.3187%2049.4569%2045.4308%2049.6168%2045.497C49.7767%2045.5632%2049.9527%2045.5805%2050.1224%2045.5468C50.2922%2045.5132%2050.4482%2045.43%2050.5708%2045.3078L59.7468%2036.1318C59.9095%2035.9672%2060.0005%2035.7451%2060.0001%2035.5137C59.9996%2035.2823%2059.9076%2035.0605%2059.7443%2034.8967Z'%20fill='%23C6DBA9'/%3e%3cpath%20d='M32.3149%2030.5293C30.664%2031.5967%2028.7394%2032.1633%2026.7734%2032.1609V40.5237H34.7295C39.2829%2038.5638%2042.9649%2035.0102%2045.0851%2030.5293H32.3149Z'%20fill='url(%23paint0_linear_250_16424)'/%3e%3cpath%20d='M46.2209%2020.2832C46.2317%2015.0884%2044.2448%2010.0884%2040.6714%206.3179C37.0981%202.54738%2032.2119%200.295026%2027.024%200.0269855C21.8362%20-0.241055%2016.7439%201.49574%2012.801%204.87791C8.85809%208.26009%206.36647%2013.0287%205.84178%2018.1969L2.46233%2017.8913C2.31055%2017.8782%202.15829%2017.9103%202.02467%2017.9835C1.89106%2018.0566%201.78205%2018.1677%201.71134%2018.3026C1.64063%2018.4376%201.61138%2018.5904%201.62726%2018.7419C1.64313%2018.8934%201.70343%2019.0368%201.80058%2019.1542L9.51927%2028.406C9.79205%2028.7344%2010.277%2028.7773%2010.378%2028.5045L19.6298%2020.7833C20.3876%2020.3413%2020.1173%2019.4825%2019.4328%2019.4194L15.8008%2019.091C16.0297%2017.1283%2016.8213%2015.2735%2018.0802%2013.7503C19.3391%2012.2271%2021.0115%2011.1004%2022.8961%2010.5059C24.7806%209.9114%2026.7969%209.8745%2028.7019%2010.3996C30.6069%2010.9248%2032.3195%2011.9896%2033.6332%2013.4657C34.947%2014.9419%2035.8059%2016.7664%2036.1065%2018.7195C36.4071%2020.6726%2036.1365%2022.6709%2035.3274%2024.4738C34.5183%2026.2766%2033.2051%2027.8071%2031.5462%2028.8807C29.8872%2029.9544%2027.9531%2030.5254%2025.977%2030.5251H25.9283V40.5094C31.2249%2040.4031%2036.7093%2038.2263%2040.4202%2034.4455C44.1311%2030.6648%2046.2134%2025.5808%2046.2209%2020.2832Z'%20fill='%23D7A39E'/%3e%3cpath%20d='M25.9773%2030.5293H0V40.5237H25.9773V30.5293Z'%20fill='url(%23paint1_linear_250_16424)'/%3e%3c/g%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_250_16424'%20x1='6.53714'%20y1='35.5252'%20x2='47.0198'%20y2='35.5252'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%236C798F'/%3e%3cstop%20offset='1'%20stop-color='%236C798F'%20stop-opacity='0.1'/%3e%3c/linearGradient%3e%3clinearGradient%20id='paint1_linear_250_16424'%20x1='0'%20y1='36'%20x2='26'%20y2='36'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23E8D4D3'%20stop-opacity='0'/%3e%3cstop%20offset='1'%20stop-color='%23E2A39F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",Wt=(i,n={})=>qe({queryKey:["sprint-list"],queryFn:({signal:C})=>le({url:`sprints/${i}`,method:"GET",signal:C}),...n}),Xt=(i,n={})=>qe({queryKey:["sprint-cards",i],queryFn:({signal:C})=>le({url:`sprints/${y(i)}/backlog`,method:"GET",signal:C}),...n}),Yt=(i,n={})=>qe({queryKey:["sprint-kanban",i],queryFn:({signal:C})=>le({url:`workspace/cards/sprintgrouped?sprint_id=${y(i)}&variable_id=68b6c96e0a95eef7d14e6981`,method:"GET",signal:C}),...n}),ea=(i,n={})=>_e({key:["sprint-complete"]},{mutationFn:C=>le({url:`sprints/${y(i)}/complete`,method:"POST",data:C.payload}),...n}),ta=(i,n={})=>qe({queryKey:["sprint-detail",i],queryFn:({signal:C})=>le({url:`sprints/detail/${y(i)}?include_cards=true`,method:"GET",signal:C}),...n}),Ke=(i,n={})=>qe({queryKey:["backlog-list",i],queryFn:({signal:C})=>le({url:`sprints/workspace/${y(i)}/cards?include_sprint_cards=false`,method:"GET",signal:C}),...n}),aa=(i={})=>_e({key:["add-sprint"]},{mutationFn:n=>le({url:"/sprints",method:"POST",data:n.payload}),...i}),yt=(i={})=>_e({key:["move-card-to-sprint"]},{mutationFn:n=>le({url:`/sprints/${n.id}/cards`,method:"POST",data:n.payload}),...i}),it=(i={})=>_e({key:["add-sprint"]},{mutationFn:n=>le({url:`/sprints/${n.id}`,method:"PUT",data:n.payload}),...i}),sa=(i={})=>_e({key:["start-sprint"]},{mutationFn:n=>le({url:`/sprints/${n.id}/start`,method:"POST",data:n.payload}),...i}),la=(i={})=>_e({key:["delete-sprint"]},{mutationFn:n=>le({url:`/sprints/${n}`,method:"DELETE"}),...i}),ra=(i={})=>_e({key:["remove-card-from-sprint"]},{mutationFn:n=>le({url:`sprints/${y(n.sprintId)}/cards/remove `,method:"POST",data:{card_ids:[n.cardId]}}),...i}),xt="jira-like:";function dt(i="id"){return`${i}_${Math.random().toString(36).slice(2,9)}`}function ut(i,n){try{localStorage.setItem(xt+i,JSON.stringify(n))}catch{}}function ct(i,n){try{const C=localStorage.getItem(xt+i);return C?JSON.parse(C):n}catch{return n}}function na(i){switch(i){case"Highest":return"rounded-md bg-red-50 px-2 py-0.5 text-xs text-red-700";case"High":return"rounded-md bg-orange-50 px-2 py-0.5 text-xs text-orange-700";case"Medium":return"rounded-md bg-amber-50 px-2 py-0.5 text-xs text-amber-700";case"Low":return"rounded-md bg-gray-100 px-2 py-0.5 text-xs text-gray-600"}}function oa(){const i=w(ct("backlog",[])),n=w(ct("sprints",[]));if(n.value.length===0)n.value.push({id:dt("sprint"),name:"Sprint 1",goal:"",start:"",end:"",started:!1,tickets:[]});else if(n.value.length>1){for(let t=1;t<n.value.length;t++)i.value.push(...n.value[t].tickets);n.value=[n.value[0]]}const C=w(n.value[0].id);H([i,n],()=>{ut("backlog",i.value),ut("sprints",n.value)},{deep:!0});const $=w([]),T=ke({}),p=B(()=>i.value.length>0&&$.value.length===i.value.length),m=t=>{var s;const e=n.value.find(r=>r.id===t);return!!e&&e.tickets.length>0&&(((s=T[t])==null?void 0:s.length)||0)===e.tickets.length};function D(t,e,s){const r=e.target.checked;if(t==="backlog")$.value=r?i.value.map(x=>x.id):[];else if(s){const x=n.value.find(b=>b.id===s);T[s]=r&&x?x.tickets.map(b=>b.id):[]}}function k(t,e,s,r){const x=s.target.checked,b=t==="backlog"?$.value:T[r]||(T[r]=[]);if(x&&!b.includes(e)&&b.push(e),!x){const O=b.indexOf(e);O>=0&&b.splice(O,1)}}function E(){return n.value.find(t=>t.id===C.value)||n.value[0]}function j(){const e=[...i.value,...n.value.flatMap(r=>r.tickets)].map(r=>Number(String(r.key).replace(/[^0-9]/g,""))).filter(r=>!Number.isNaN(r));return`PRJ-${e.length?Math.max(...e)+1:1}`}const{mutate:V}=yt({onSuccess:()=>{De.success("Cards moved to sprint successfully")},onError:t=>{De.error("Failed to move cards: "+(t.message||"Unknown error"))}});function A(){var r,x;const t=E();if(!t||!$.value.length)return;const e=[],s=[];for(const b of i.value)($.value.includes(b.id)?s:e).push(b);i.value=e,t.tickets.push(...s),$.value=[],s.length>0&&V({id:t.id,payload:{card_ids:s.map(b=>b.id),priority:((x=(r=s[0])==null?void 0:r.priority)==null?void 0:x.toLowerCase())||"medium",story_points:s.reduce((b,O)=>b+(O.storyPoints||0),0)}})}function U(t){const e=n.value.find(b=>b.id===t);if(!e)return;const s=T[t]||[],r=[],x=[];for(const b of e.tickets)(s.includes(b.id)?x:r).push(b);e.tickets=r,i.value.push(...x),T[t]=[]}function F(t,e){if(t==="backlog")i.value=i.value.filter(s=>!$.value.includes(s.id)),$.value=[];else if(e){const s=T[e]||[],r=n.value.find(x=>x.id===e);if(!r)return;r.tickets=r.tickets.filter(x=>!s.includes(x.id)),T[e]=[]}}function Q(t,e){const s={id:dt("T"),key:j(),createdAt:new Date().toISOString(),...e};if(t==="backlog")i.value.push(s);else{const r=E();r==null||r.tickets.push(s)}}function M(t){const e=E();e&&(e.name=t.name??e.name,e.goal=t.goal??e.goal,e.start=t.start??e.start,e.end=t.end??e.end)}function L(){const t=E();t&&(t.started=!t.started)}function o(t){return t.tickets.reduce((e,s)=>e+(s.storyPoints||0),0)}return{backlog:i,sprints:n,activeSprintId:C,selectedBacklogIds:$,selectedSprintIds:T,allBacklogChecked:p,allSprintChecked:m,toggleAll:D,toggleOne:k,getActiveSprint:E,createTicket:Q,saveSprintMeta:M,toggleStartSprint:L,sprintPoints:o,moveSelectedToSprint:A,moveSelectedToBacklog:U,deleteSelected:F,priorityClass:na}}const ia={class:"h-full min-h-0"},da={key:0,class:"empty-state flex flex-col justify-center items-center h-full"},ua={key:1,class:"overflow-y-auto h-[calc(100%-50px)] tickets-scroll"},ca={class:"flex flex-col flex-1 gap-[4px] min-w-0 me-1"},pa=["onDragstart","onClick"],ma=["checked","onChange"],va={class:"flex items-center text-[14px] font-sans font-medium capitalize text-text-secondary flex-1 min-w-0"},fa={class:"truncate"},ga={class:"flex-shrink-0"},ba={key:0,class:"flex justify-center text-gray-500 items-center text-[11px] aspect-square w-[24px] h-[24px] bg-bg-body rounded-full border-border-input border-2"},ya={key:1,class:"w-6 h-6 rounded-full"},xa=["src"],ha={key:2,class:"text-[11px] aspect-square w-24px flex justify-center items-center h-[24px] bg-accent/30 text-accent border-accent border rounded-full"},ka=Se({__name:"BacklogTable",props:{searchQuery:{type:String,default:""},checkedAll:{type:Boolean,default:!1}},emits:["ticket-dragged-to-sprint","open-ticket","ticket-moved-to-backlog","open-create-ticket"],setup(i,{emit:n}){const{theme:C}=We(),$=n,T=i,{workspaceId:p}=pt(),{data:m,isPending:D}=Ke(p),k=w([]),E=w(!1),j=w([]),V=w([]);H(m,t=>{t!=null&&t.cards&&(k.value=t.cards.map(e=>{var O,d,_,oe;const s=((O=e.card)==null?void 0:O.variables)??{},r=((d=e.card)==null?void 0:d._id)??e.card_id,x=String(s["card-status"]??"").trim(),b=String(s.priority??"").trim();return{id:r,key:s["card-code"]||(r==null?void 0:r.slice(-6))||"PRJ-?",summary:s["card-title"]||"(untitled)",type:"Story",status:x,assignee:((_=e.card)==null?void 0:_.assigned_to)??"Unassigned",storyPoints:Number(e.story_points??0)||0,priority:U(b),createdAt:((oe=e.card)==null?void 0:oe.created_at)??new Date().toISOString(),description:s["card-description"]||""}}))},{immediate:!0}),H(k,t=>{const e=new Set(t.map(s=>s.id));V.value=V.value.filter(s=>e.has(s))});const A=B(()=>{if(console.log(T.searchQuery,"this is query"),!T.searchQuery)return k.value;const t=T.searchQuery.toLowerCase();return k.value.filter(e=>{var r;const s=typeof e.assignee=="string"?e.assignee:((r=e.assignee)==null?void 0:r.u_full_name)||"";return e.key.toLowerCase().includes(t)||e.summary.toLowerCase().includes(t)||s.toLowerCase().includes(t)})});function U(t){const e=String(t??"").toLowerCase();return["highest","blocker","critical"].includes(e)?"Highest":["high","major"].includes(e)?"High":["medium","normal"].includes(e)?"Medium":"Low"}function F(t,e,s){var O;const r=V.value.includes(e.id)?[...V.value]:[e.id],x=r.map(d=>k.value.find(_=>_.id===d)).filter(Boolean);j.value=r;const b=JSON.stringify({id:e.id,ids:r,from:s,tickets:x});(O=t.dataTransfer)==null||O.setData("text/plain",b),t.dataTransfer&&(t.dataTransfer.effectAllowed="move")}function Q(t){var e;E.value=!1,((e=t.dataTransfer)==null?void 0:e.dropEffect)!=="none"&&j.value.length&&(k.value=k.value.filter(s=>!j.value.includes(s.id)),V.value=V.value.filter(s=>!j.value.includes(s))),j.value=[]}function M(t){var e;t.preventDefault(),E.value=!1;try{const s=(e=t.dataTransfer)==null?void 0:e.getData("text/plain");if(!s)return;const r=JSON.parse(s);if(r.from!=="sprint")return;const b=(r.tickets&&r.tickets.length?r.tickets:r.ticket?[r.ticket]:[]).filter(Boolean).filter(d=>!k.value.some(_=>_.id===d.id));b.length&&k.value.push(...b);const O=r.ids&&r.ids.length?r.ids:r.id?[r.id]:[];O.length&&$("ticket-moved-to-backlog",O,r.sprintId)}catch(s){console.error("Drop error:",s)}}function L(t,e){e?V.value.includes(t)||V.value.push(t):V.value=V.value.filter(s=>s!==t)}function o(t,e){const s=e.target.checked;L(t,s)}return H(()=>T.checkedAll,t=>{t?(V.value=k.value.map(e=>e.id),console.log(V.value)):V.value=[]}),(t,e)=>(c(),h("section",ia,[a("div",{class:K(["rounded-lg flex flex-col h-full",E.value?"ring-2 ring-blue-400":""]),onDragover:e[3]||(e[3]=fe(()=>{},["prevent"])),onDragenter:e[4]||(e[4]=s=>E.value=!0),onDragleave:e[5]||(e[5]=s=>E.value=!1),onDrop:e[6]||(e[6]=s=>M(s))},[!y(D)&&A.value.length===0?(c(),h("div",da,[e[7]||(e[7]=a("img",{src:Jt,class:"mb-4",alt:"backlog-plan"},null,-1)),e[8]||(e[8]=a("h6",{class:"text-sm text-text-primary font-semibold mb-1"}," Get started in the backlog ",-1)),e[9]||(e[9]=a("p",{class:"text-sm text-text-primary/90 mb-4"}," Plan and start a sprint to see issues here. ",-1)),a("button",{onClick:e[0]||(e[0]=s=>t.$emit("open-create-ticket")),class:"relative cursor-pointer inline-flex items-center justify-center font-medium py-1.5 px-3 text-sm rounded-md focus:outline-none transition text-xs px-3 py-1.5 h-[34px] bg-accent text-white hover:bg-accent-hover border-border-input border"}," Create Ticket ")])):(c(),h("div",ua,[a("div",ca,[(c(!0),h(ve,null,we(A.value,s=>{var r,x;return c(),h("div",{key:s.id,draggable:"true",class:K(["flex items-center  gap-3 p-[8px] cursor-pointer transition-colors rounded-[8px]",V.value.includes(s.id)?"border-2 border-[#5a2d7f]":"border border-border-input",y(C)==="dark"?"bg-bg-body hover:bg-bg-surface":"bg-bg-charcoal hover:bg-bg-body"]),onDragstart:b=>F(b,s,"backlog"),onDragend:e[2]||(e[2]=b=>Q(b)),onClick:b=>t.$emit("open-ticket",s)},[a("input",{type:"checkbox",class:"custom-checkbox bg-bg-body border border-border-input flex-shrink-0",checked:V.value.includes(s.id),onClick:e[1]||(e[1]=fe(()=>{},["stop"])),onChange:b=>o(s.id,b)},null,40,ma),a("div",va,[a("span",fa,R(s.summary),1)]),a("div",ga,[(s==null?void 0:s.assignee)==="Unassigned"?(c(),h("span",ba,"UA")):(r=s==null?void 0:s.assignee)!=null&&r.u_profile_image?(c(),h("div",ya,[a("img",{src:s.assignee.u_profile_image,alt:""},null,8,xa)])):(c(),h("span",ha,R(y(mt)((x=s==null?void 0:s.assignee)==null?void 0:x.u_full_name)),1))])],42,pa)}),128))])]))],34)]))}}),_a=Ge(ka,[["__scopeId","data-v-a347c9e7"]]),Sa="data:image/svg+xml,%3csvg%20width='60'%20height='60'%20viewBox='0%200%2060%2060'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20opacity='0.4'%3e%3cpath%20d='M9.375%2030C11.6402%2030%2013.4766%2028.1637%2013.4766%2025.8984C13.4766%2023.6332%2011.6402%2021.7969%209.375%2021.7969C7.10977%2021.7969%205.27344%2023.6332%205.27344%2025.8984C5.27344%2028.1637%207.10977%2030%209.375%2030Z'%20fill='%23AE2A19'/%3e%3cpath%20d='M26.25%2024.375C28.5152%2024.375%2030.3516%2022.5387%2030.3516%2020.2734C30.3516%2018.0082%2028.5152%2016.1719%2026.25%2016.1719C23.9848%2016.1719%2022.1484%2018.0082%2022.1484%2020.2734C22.1484%2022.5387%2023.9848%2024.375%2026.25%2024.375Z'%20fill='%23BF63F3'/%3e%3cpath%20d='M15.3931%2035.8594H11.0159V33.0938C9.93587%2033.3387%208.81469%2033.3387%207.73465%2033.0938V35.8594H1.87528C1.55115%2035.8601%201.2345%2035.9568%200.965283%2036.1373C0.696064%2036.3178%200.486343%2036.574%200.362583%2036.8736C0.238824%2037.1731%200.206573%2037.5027%200.269899%2037.8205C0.333226%2038.1384%200.489292%2038.4304%200.718404%2038.6597L7.05872%2045L0.718404%2051.3403C0.489292%2051.5696%200.333226%2051.8616%200.269899%2052.1795C0.206573%2052.4973%200.238824%2052.8269%200.362583%2053.1264C0.486343%2053.426%200.696064%2053.6822%200.965283%2053.8627C1.2345%2054.0432%201.55115%2054.1399%201.87528%2054.1406H15.3931L21.7503%2045L15.3931%2035.8594Z'%20fill='%2382B536'/%3e%3cpath%20d='M34.4562%2035.8594H27.8937V27.4688C26.8137%2027.7138%2025.6925%2027.7138%2024.6125%2027.4688V35.8594H19.3896L25.7487%2045L19.3896%2054.1406H34.4562L40.8143%2045L34.4562%2035.8594Z'%20fill='%2382B536'/%3e%3cpath%20d='M43.8281%2019.6875H55.3125C55.7475%2019.6873%2056.1647%2019.5143%2056.4723%2019.2067C56.7799%2018.8991%2056.9529%2018.4819%2056.9531%2018.0469V9.375C56.9529%208.93996%2056.7799%208.5228%2056.4723%208.21518C56.1647%207.90755%2055.7475%207.73462%2055.3125%207.73438H43.8281V7.5C43.8281%207.06488%2043.6553%206.64758%2043.3476%206.3399C43.0399%206.03223%2042.6226%205.85938%2042.1875%205.85938C41.7524%205.85938%2041.3351%206.03223%2041.0274%206.3399C40.7197%206.64758%2040.5469%207.06488%2040.5469%207.5V32.5781H43.8281V19.6875Z'%20fill='%23FCA700'/%3e%3cpath%20d='M59.2843%2043.8403L51.7843%2036.3403C51.6322%2036.1878%2051.4514%2036.0668%2051.2524%2035.9842C51.0534%2035.9017%2050.8401%2035.8593%2050.6246%2035.8594H38.4521L44.8121%2045L38.4531%2054.1406H50.6246C50.8401%2054.1407%2051.0534%2054.0983%2051.2524%2054.0158C51.4514%2053.9332%2051.6322%2053.8122%2051.7843%2053.6597L59.2843%2046.1597C59.4368%2046.0075%2059.5577%2045.8267%2059.6402%2045.6277C59.7228%2045.4287%2059.7652%2045.2154%2059.7652%2045C59.7652%2044.7846%2059.7228%2044.5713%2059.6402%2044.3723C59.5577%2044.1733%2059.4368%2043.9925%2059.2843%2043.8403Z'%20fill='%2382B536'/%3e%3c/g%3e%3c/svg%3e",Ca={class:"h-full min-h-0"},wa={key:0,class:"overflow-y-auto h-[calc(100%-50px)] tickets-scroll"},Da={class:"flex flex-col flex-1 gap-[4px] min-w-0 me-1"},Va=["onDragstart","onClick"],$a=["checked","onChange"],Ta={class:"flex items-center text-[14px] font-sans font-medium capitalize text-text-secondary flex-1 min-w-0"},La={class:"truncate"},Ba={class:"flex-shrink-0"},Ea={key:0,class:"flex justify-center text-gray-500 items-center text-[11px] aspect-square w-[24px] h-[24px] bg-bg-body rounded-full border-border-input border-2"},Ma={key:1,class:"w-6 h-6 rounded-full"},Pa=["src"],Ua={key:2,class:"text-[11px] aspect-square w-[24px] flex justify-center items-center h-[24px] bg-accent/30 text-accent border-accent border rounded-full"},Aa={key:1,class:"empty-state flex flex-col justify-center items-center border-dashed border-3 p-2 border-border h-[calc(100%-50px)] min-h-0"},Oa=Se({__name:"SprintCard",props:{sprint:{},sprintId:{},searchQuery:{},checkedSprintAll:{}},emits:["edit-sprint","toggle-start","open-ticket","move-selected-to-backlog","delete-selected-sprint","refresh"],setup(i,{emit:n}){const{theme:C}=We(),$=i,T=n,p=w([]),m=w([]);H(()=>$.sprint.tickets,o=>{p.value=[...o||[]];const t=new Set(p.value.map(e=>e.id));m.value=m.value.filter(e=>t.has(e))},{immediate:!0,deep:!0});const D=B(()=>{var t;const o=((t=$.searchQuery)==null?void 0:t.toLowerCase())||"";return o?p.value.filter(e=>{var r;const s=((r=e.assignee)==null?void 0:r.u_full_name)??"";return e.key.toLowerCase().includes(o)||e.summary.toLowerCase().includes(o)||s.toLowerCase().includes(o)}):p.value}),k=w(!1),E=w([]),{mutate:j}=yt({onSuccess:()=>{De.success("Card moved to sprint successfully"),T("refresh")},onError:o=>{De.error("Failed to move card: "+(o.message||"Unknown error"))}});function V(o,t,e,s){var O;const r=m.value.includes(t.id)?[...m.value]:[t.id],x=r.map(d=>p.value.find(_=>_.id===d)).filter(Boolean);E.value=r;const b=JSON.stringify({id:t.id,ids:r,from:e,sprintId:s,ticket:t,tickets:x});(O=o.dataTransfer)==null||O.setData("text/plain",b),o.dataTransfer&&(o.dataTransfer.effectAllowed="move")}function A(o){var t;k.value=!1,((t=o.dataTransfer)==null?void 0:t.dropEffect)!=="none"&&E.value.length&&(p.value=p.value.filter(e=>!E.value.includes(e.id)),m.value=m.value.filter(e=>!E.value.includes(e))),E.value=[]}function U(){k.value=!0}function F(){k.value=!1}function Q(o){var t;o.preventDefault(),k.value=!1;try{const e=(t=o.dataTransfer)==null?void 0:t.getData("text/plain");if(!e)return;const s=JSON.parse(e);if(s.from!=="backlog")return;const x=(s.tickets&&s.tickets.length?s.tickets:s.ticket?[s.ticket]:[]).filter(Boolean).filter(b=>!p.value.some(O=>O.id===b.id));if(!x.length)return;p.value.push(...x),x.forEach(b=>{j({id:$.sprintId,payload:{card_ids:[b.id],priority:(b.priority||"Medium").toLowerCase(),story_points:b.storyPoints||0}})})}catch(e){console.error("Drop error:",e)}}function M(o,t){t?m.value.includes(o)||m.value.push(o):m.value=m.value.filter(e=>e!==o)}function L(o,t){const e=t.target.checked;M(o,e)}return H(()=>$.checkedSprintAll,o=>{o?(m.value=D.value.map(t=>t.id),console.log(D.value)):m.value=[]}),(o,t)=>(c(),h("div",Ca,[a("div",{class:K([k.value?"ring-2 ring-blue-400 rounded-lg":"","h-full box-border"]),onDragover:t[2]||(t[2]=fe(()=>{},["prevent"])),onDragenter:U,onDragleave:F,onDrop:Q},[D.value.length>0?(c(),h("div",wa,[a("div",Da,[(c(!0),h(ve,null,we(D.value,e=>{var s,r;return c(),h("div",{key:e.id,draggable:"true",class:K(["flex items-center  gap-3 p-[8px] cursor-pointer transition-colors rounded-[8px]",m.value.includes(e.id)?"border-2 border-[#5a2d7f]":"border border-border-input",y(C)==="dark"?"bg-bg-body hover:bg-bg-surface":"bg-bg-charcoal hover:bg-bg-body"]),onDragstart:x=>V(x,e,"sprint",o.sprint.id),onDragend:t[1]||(t[1]=x=>A(x)),onClick:x=>o.$emit("open-ticket",e)},[a("input",{type:"checkbox",class:K(["custom-checkbox border border-border-input flex-shrink-0",y(C)==="dark"?"bg-bg-charcoal":"bg-bg-body "]),checked:m.value.includes(e.id),onClick:t[0]||(t[0]=fe(()=>{},["stop"])),onChange:x=>L(e.id,x)},null,42,$a),a("div",Ta,[a("span",La,R(e.summary),1)]),a("div",Ba,[(e==null?void 0:e.assignee)=="Unassigned"?(c(),h("span",Ea,"UA")):(s=e.assignee)!=null&&s.u_profile_image?(c(),h("div",Ma,[a("img",{src:e.assignee.u_profile_image,alt:""},null,8,Pa)])):(c(),h("span",Ua,R(y(mt)(((r=e.assignee)==null?void 0:r.u_full_name)??"")),1))])],42,Va)}),128))])])):(c(),h("div",Aa,t[3]||(t[3]=[Vt('<img src="'+Sa+'" class="mb-4" alt="backlog-plan" data-v-b799e3bb><h6 class="text-sm text-text-primary font-semibold mb-1 text-center" data-v-b799e3bb> Plan your sprint </h6><p class="text-sm text-text-primary/90 mb-3 max-w-120 text-center" data-v-b799e3bb> Drag work items from the <span class="font-bold" data-v-b799e3bb>Backlog</span> section or create new ones to plan the work for this sprint. Select <span class="font-bold" data-v-b799e3bb>Start sprint</span> when you&#39;re ready. </p>',3)])))],34)]))}}),qa=Ge(Oa,[["__scopeId","data-v-b799e3bb"]]),Ia={class:"px-6 gap-4"},Na={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},Fa=Se({__name:"SprintModal",props:{modelValue:{type:Boolean,default:!1},sprint:{},creatingSprint:{type:Boolean}},emits:["update:modelValue","save","close"],setup(i,{emit:n}){const C=n,$=i,T=B({get:()=>$.modelValue,set:A=>C("update:modelValue",A)}),p=ke({name:"",description:""}),m=ke({name:!1}),D=B(()=>m.name&&!String(p.name||"").trim()?"Name is required":""),k=B(()=>!!String(p.name||"").trim()&&!D.value);function E(){T.value=!1,C("close")}function j(){m.name=!0,k.value&&C("save",{name:String(p.name||"").trim(),description:String(p.description||"").trim()})}function V(){m.name=!1}return H(()=>$.sprint,A=>{if(!A){p.name="";return}p.name=A.name??(A==null?void 0:A.title)??"",p.description=A.description??"",V()},{immediate:!0}),(A,U)=>(c(),ae(Ze,{modelValue:T.value,"onUpdate:modelValue":U[3]||(U[3]=F=>T.value=F),modalClass:"!py-0",size:"md"},{default:G(()=>[U[6]||(U[6]=a("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[a("h2",{class:"text-xl font-semibold"},"Add New Sprint")],-1)),a("div",Ia,[q(vt,{class:"rounded-1",modelValue:p.name,"onUpdate:modelValue":U[0]||(U[0]=F=>p.name=F),label:"Name",placeholder:"Sprint 1",error:!!D.value,message:D.value,onBlur:U[1]||(U[1]=F=>m.name=!0)},null,8,["modelValue","error","message"]),q(Ft,{modelValue:p.description,"onUpdate:modelValue":U[2]||(U[2]=F=>p.description=F),label:"Description",placeholder:"Sprint description...",type:"textarea",rows:4,class:"mt-4"},null,8,["modelValue"]),U[4]||(U[4]=a("div",null,null,-1))]),a("div",Na,[q(ue,{variant:"secondary",onClick:E},{default:G(()=>U[5]||(U[5]=[J("Cancel")])),_:1,__:[5]}),q(ue,{variant:"primary",disabled:!k.value,onClick:j},{default:G(()=>[J(R(A.creatingSprint?"Saving...":"Save"),1)]),_:1},8,["disabled"])])]),_:1,__:[6]},8,["modelValue"]))}}),Ha="/assets/filter-MwNDfWa5.svg",Ra={class:"px-6 grid grid-cols-2 gap-4"},ja={class:"flex gap-1 flex-col"},za={key:0,class:"text-xs text-red-500"},Qa={class:"flex gap-1 flex-col"},Ka={key:0,class:"text-xs text-red-500"},Ga={class:"flex flex-col col-span-2"},Za={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},Ja=Se({__name:"StartSprintModal",props:{modelValue:{type:Boolean,default:!1},sprint:{},creatingSprint:{type:Boolean}},emits:["update:modelValue","save","close"],setup(i,{emit:n}){const C=n,$=i,T=B({get:()=>$.modelValue,set:M=>C("update:modelValue",M)}),p=ke({goal:"",start:"",end:""});H(()=>$.sprint,M=>{M&&(p.goal=M.goal??"",p.start=M.start??"",p.end=M.end??"",F())},{immediate:!0});const m=ke({start:!1,end:!1}),D=B(()=>!p.start&&m.start?"Start date is required":""),k=B(()=>{if(!p.end&&m.end)return"End date is required";if(p.start&&p.end){const M=Q(p.start),L=Q(p.end);if(Number.isFinite(M)&&Number.isFinite(L)&&L<M)return"End date cannot be before start date"}return""}),E=B(()=>!D.value&&!k.value);function j(M){p.start=M||"",m.start=!0}function V(M){p.end=M||"",m.end=!0}function A(){T.value=!1,C("close")}function U(){m.start=!0,m.end=!0,E.value&&C("save",{goal:p.goal??"",start:p.start||"",end:p.end||""})}function F(){m.start=!1,m.end=!1}function Q(M){return M?new Date(`${M}T00:00:00`).getTime():NaN}return(M,L)=>(c(),ae(Ze,{modelValue:T.value,"onUpdate:modelValue":L[1]||(L[1]=o=>T.value=o),modalClass:"!py-0",size:"md"},{default:G(()=>[L[6]||(L[6]=a("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[a("h2",{class:"text-xl font-semibold"},"Start Sprint"),a("p",{class:"text-sm text-text-secondary mt-1"},[J(" Update sprint name, goal, and dates, then click "),a("span",{class:"font-medium"},"Start"),J(". ")])],-1)),a("div",Ra,[a("div",ja,[L[2]||(L[2]=a("label",{class:"text-sm"},"Start date",-1)),a("div",{class:K(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",D.value?"border-red-500":""])},[q(je,{placeholder:"Set start date",class:"w-full","model-value":p.start,"emit-as":"ymd","onUpdate:modelValue":j},null,8,["model-value"])],2),D.value?(c(),h("p",za,R(D.value),1)):te("",!0)]),a("div",Qa,[L[3]||(L[3]=a("label",{class:"text-sm"},"End date",-1)),a("div",{class:K(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",k.value?"border-red-500":""])},[q(je,{placeholder:"Set end date",class:"w-full","model-value":p.end,"emit-as":"ymd","onUpdate:modelValue":V},null,8,["model-value"])],2),k.value?(c(),h("p",Ka,R(k.value),1)):te("",!0)]),a("div",Ga,[L[4]||(L[4]=a("label",{class:"text-sm"},"Goal (optional)",-1)),Ve(a("textarea",{"onUpdate:modelValue":L[0]||(L[0]=o=>p.goal=o),class:"w-full rounded-lg border border-border px-3 py-2 bg-bg-input",rows:"2",placeholder:"Ship onboarding flow"},null,512),[[$t,p.goal]])])]),a("div",Za,[q(ue,{variant:"secondary",onClick:A},{default:G(()=>L[5]||(L[5]=[J("Cancel")])),_:1,__:[5]}),q(ue,{variant:"primary",disabled:!E.value,onClick:U},{default:G(()=>[J(R(M.creatingSprint?"Starting...":"Start"),1)]),_:1},8,["disabled"])])]),_:1,__:[6]},8,["modelValue"]))}}),Wa={class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},Xa={class:"text-sm text-text-secondary mt-1"},Ya={class:"flex items-center gap-2 mt-4 w-full"},es={class:"flex items-center gap-2 flex-1"},ts={class:"px-6 min-h-[400px]"},as={key:0},ss={key:0,class:"flex items-center justify-center py-12"},ls={key:1,class:"text-center py-12 text-text-secondary"},rs={key:2,class:"grid grid-cols-2 gap-3"},ns=["onClick"],os={class:"flex items-center gap-3"},is={class:"w-10 h-10 rounded-lg bg-bg-input flex items-center justify-center group-hover:bg-primary/10 transition-colors"},ds={class:"font-medium"},us={key:1},cs={key:0,class:"flex items-center justify-center py-12"},ps={key:1,class:"text-center py-12 text-text-secondary"},ms={key:2,class:"grid grid-cols-2 gap-3"},vs=["onClick"],fs={class:"flex items-center gap-3"},gs={class:"w-10 h-10 rounded-lg bg-bg-input flex items-center justify-center group-hover:bg-primary/10 transition-colors"},bs={class:"font-medium"},ys={key:2},xs={class:"grid grid-cols-2 gap-4"},hs={key:0,class:"flex flex-col"},ks={class:"flex gap-1 flex-col"},_s={key:0,class:"text-xs text-red-500"},Ss={class:"flex gap-1 flex-col"},Cs={key:0,class:"text-xs text-red-500"},ws={class:"mt-4"},Ds={key:0,class:"text-xs text-red-500 mt-1 px-1"},Vs={class:"flex justify-between gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},$s={key:1},Ts={class:"flex gap-2"},Ls=Se({__name:"CreateBacklogTicketWithModuleSelection",props:{modelValue:{type:Boolean,default:!1},listId:{},selectedVariable:{}},emits:["update:modelValue","created"],setup(i,{emit:n}){const C=n,$=i,T=Je(),{workspaceId:p}=ft(),m=w(1),D=w(null),k=w(null),{data:E,isLoading:j}=Tt(p.value),V=B(()=>{var u;return((u=E.value)==null?void 0:u.modules)||[]}),{data:A,isFetching:U,refetch:F}=gt({workspace_module_id:D,workspace_id:p},{enabled:B(()=>!!D.value)});H(()=>D.value,()=>{F()});const Q=B(()=>A.value||[]),{data:M}=Lt(p.value),{data:L}=bt(p.value,D,{enabled:B(()=>!!D.value)}),{mutate:o,isPending:t}=Bt({onSuccess:()=>{re(),T.invalidateQueries({queryKey:["sheet-list"]}),T.invalidateQueries({queryKey:["backlog-list"]}),e.value=!1}}),e=B({get:()=>$.modelValue,set:u=>C("update:modelValue",u)}),s=B(()=>{switch(m.value){case 1:return"Select a module to create the ticket in";case 2:return"Select a sheet within the module";case 3:return"Provide the ticket details below and click Add Ticket";default:return""}}),r=B(()=>((L==null?void 0:L.value)??[]).filter(u=>{var v;return((v=u==null?void 0:u.type)==null?void 0:v.title)==="Select"})),x=u=>u.map(v=>({_id:v,title:v})),b=B(()=>((M==null?void 0:M.value)??[]).map(u=>{var v;return{_id:u._id,title:((v=u==null?void 0:u.variables)==null?void 0:v["lane-title"])??String(u._id)}})),O=u=>u.slug,d=ke({title:"",description:"",startDate:null,endDate:null,lane_id:null,variables:{}});H(r,u=>{for(const v of u){const f=O(v);f in d.variables||(d.variables[f]=null)}},{immediate:!0});const _=ke({title:!1,description:!1,startDate:!1,endDate:!1,lane:!1}),oe=B(()=>!!d.title.trim()&&!!d.lane_id&&!!d.startDate&&!!d.endDate&&!ie.value&&!Y.value&&!ce.value&&!ye.value&&!S.value);function $e(u){d.startDate=u,_.startDate=!0}function ge(u){d.endDate=u,_.endDate=!0}function Z(u){d.lane_id=u,_.lane=!0}function Ce(u){D.value=u._id,m.value=2}function se(u){k.value=u._id,m.value=3}function W(){m.value>1&&m.value--}function Te(){e.value=!1,re()}function re(){m.value=1,D.value=null,k.value=null,d.title="",d.description="",d.startDate=null,d.endDate=null,d.lane_id=null,d.variables={},_.title=!1,_.description=!1,_.startDate=!1,_.endDate=!1,_.lane=!1}const be=B(()=>{var u;return(u=L==null?void 0:L.value)==null?void 0:u.find(v=>(v==null?void 0:v._id)==$.selectedVariable)}),ie=B(()=>_.title&&!d.title.trim()?"Title is required":""),Y=B(()=>_.startDate?d.startDate?"":"Start date is required":""),ce=B(()=>_.endDate?d.endDate?d.startDate&&d.endDate&&d.endDate<d.startDate?"End date cannot be before start date":"":"End date is required":""),ye=B(()=>_.lane?d.lane_id?"":"Lane is required":""),S=B(()=>_.description&&!d.description.trim()?"Description is required":"");function P(){var v;if(_.title=!0,_.lane=!0,_.description=!0,_.startDate=!0,_.endDate=!0,!oe.value||t.value)return;const u={sheet_list_id:$.listId,workspace_id:p.value,sheet_id:k.value,workspace_lane_id:d.lane_id,variables:{...d.variables,[`${(v=be.value)==null?void 0:v.slug}`]:$.listId,"card-title":d.title.trim(),"card-description":d.description.trim(),"start-date":d.startDate,"end-date":d.endDate},createdAt:new Date().toISOString()};o(u)}return H(()=>d.title,u=>{u!=null&&u.trim()&&_.title&&(_.title=!1)}),H(()=>d.lane_id,u=>{u&&_.lane&&(_.lane=!1)}),H(()=>d.startDate,u=>{u&&_.startDate&&(_.startDate=!1)}),H(()=>d.endDate,u=>{u&&_.endDate&&(_.endDate=!1)}),H(()=>d.description,u=>{u!=null&&u.trim()&&_.description&&(_.description=!1)}),(u,v)=>(c(),ae(Ze,{modelValue:e.value,"onUpdate:modelValue":v[4]||(v[4]=f=>e.value=f),modalClass:"!py-0",size:"lg"},{default:G(()=>[a("div",Wa,[v[5]||(v[5]=a("h2",{class:"text-xl font-semibold"},"Create Backlog Ticket",-1)),a("p",Xa,R(s.value),1),a("div",Ya,[(c(),h(ve,null,we(3,f=>a("div",{key:f,class:"flex items-center flex-1"},[a("div",es,[a("div",{class:K(["h-1 flex-1 rounded-full transition-colors",m.value>=f?"bg-primary":"bg-border"])},null,2)])])),64))])]),a("div",ts,[m.value===1?(c(),h("div",as,[v[7]||(v[7]=a("h3",{class:"text-lg font-medium mb-4"},"Select Module",-1)),y(j)?(c(),h("div",ss,v[6]||(v[6]=[a("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)]))):!V.value||V.value.length===0?(c(),h("div",ls," No modules available ")):(c(),h("div",rs,[(c(!0),h(ve,null,we(V.value,f=>{var ee,ne,I,xe,de;return c(),h("button",{key:f._id,onClick:Le=>Ce(f),class:K(["p-4 border rounded-lg hover:border-primary transition-all text-left group",D.value===f._id?"border-primary bg-primary/5":"border-border"])},[a("div",os,[a("div",is,[a("i",{class:K([`${(ne=(ee=f==null?void 0:f.variables)==null?void 0:ee["module-icon"])==null?void 0:ne.prefix} ${(xe=(I=f==null?void 0:f.variables)==null?void 0:I["module-icon"])==null?void 0:xe.iconName}`,"text-lg"])},null,2)]),a("div",null,[a("p",ds,R(((de=f.variables)==null?void 0:de["module-title"])||"Untitled"),1)])])],10,ns)}),128))]))])):m.value===2?(c(),h("div",us,[v[9]||(v[9]=a("h3",{class:"text-lg font-medium mb-4"},"Select Sheet",-1)),y(U)?(c(),h("div",cs,v[8]||(v[8]=[a("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)]))):!Q.value||Q.value.length===0?(c(),h("div",ps," No sheets available for this module ")):(c(),h("div",ms,[(c(!0),h(ve,null,we(Q.value,f=>{var ee,ne;return c(),h("button",{key:f._id,onClick:I=>se(f),class:K(["p-4 border rounded-lg hover:border-primary transition-all text-left group",k.value===f._id?"border-primary bg-primary/5":"border-border"])},[a("div",fs,[a("div",gs,[a("i",{class:K(`${(ee=f==null?void 0:f.variables["sheet-icon"])==null?void 0:ee.prefix} ${(ne=f==null?void 0:f.variables["sheet-icon"])==null?void 0:ne.iconName} text-lg`)},null,2)]),a("div",null,[a("p",bs,R((f==null?void 0:f.variables["sheet-title"])||"Untitled Sheet"),1)])])],10,vs)}),128))]))])):m.value===3?(c(),h("div",ys,[v[12]||(v[12]=a("h3",{class:"text-lg font-medium mb-4"},"Ticket Details",-1)),a("div",xs,[q(vt,{modelValue:d.title,"onUpdate:modelValue":v[0]||(v[0]=f=>d.title=f),label:"Ticket Title",placeholder:"e.g., Implement real-time notifications",error:!!ie.value,message:ie.value,onBlur:v[1]||(v[1]=f=>_.title=!0)},null,8,["modelValue","error","message"]),b.value.length>0?(c(),h("div",hs,[q(nt,{size:"md",label:"Lane",options:b.value,placeholder:"Select lane",allowCustom:!1,"model-value":d.lane_id,"onUpdate:modelValue":Z,error:!!ye.value,message:ye.value},null,8,["options","model-value","error","message"])])):te("",!0),(c(!0),h(ve,null,we(r.value,f=>Ve((c(),ae(nt,{size:"md",key:O(f),modelValue:d.variables[f.slug],"onUpdate:modelValue":ee=>d.variables[f.slug]=ee,options:x(f.data),label:f.title,placeholder:"Select value",allowCustom:!0},null,8,["modelValue","onUpdate:modelValue","options","label"])),[[Qe,(f==null?void 0:f._id)!=u.selectedVariable]])),128)),a("div",ks,[v[10]||(v[10]=a("label",{class:"text-sm"},"Start date",-1)),a("div",{class:K(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",Y.value?"border-red-500":""])},[q(je,{placeholder:"Set start date",class:"w-full","model-value":d.startDate,"emit-as":"ymd","onUpdate:modelValue":$e},null,8,["model-value"])],2),Y.value?(c(),h("p",_s,R(Y.value),1)):te("",!0)]),a("div",Ss,[v[11]||(v[11]=a("label",{class:"text-sm"},"End date",-1)),a("div",{class:K(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",ce.value?"border-red-500":""])},[q(je,{placeholder:"Set end date",class:"w-full","model-value":d.endDate,"emit-as":"ymd","onUpdate:modelValue":ge},null,8,["model-value"])],2),ce.value?(c(),h("p",Cs,R(ce.value),1)):te("",!0)])]),a("div",ws,[q(Et,{label:"Description",placeholder:"What needs to be done, acceptance criteria, links…",modelValue:d.description,"onUpdate:modelValue":v[2]||(v[2]=f=>d.description=f),onBlur:v[3]||(v[3]=f=>_.description=!0)},null,8,["modelValue"]),S.value?(c(),h("p",Ds,R(S.value),1)):te("",!0)])])):te("",!0)]),a("div",Vs,[m.value>1?(c(),ae(ue,{key:0,variant:"secondary",onClick:W},{default:G(()=>v[13]||(v[13]=[J("Back")])),_:1,__:[13]})):(c(),h("div",$s)),a("div",Ts,[q(ue,{variant:"secondary",onClick:Te},{default:G(()=>v[14]||(v[14]=[J("Cancel")])),_:1,__:[14]}),m.value===3?(c(),ae(ue,{key:0,variant:"primary",disabled:!oe.value||y(t),onClick:P},{default:G(()=>[J(R(y(t)?"Adding…":"Add Ticket"),1)]),_:1},8,["disabled"])):te("",!0)])])]),_:1},8,["modelValue"]))}}),Bs={class:"flex gap-2 flex-auto overflow-y-auto"},Es={class:"flex-auto bg-gradient-to-b from-bg-card/95 to-bg-card/90 backdrop-blur rounded-2xl shadow-[0_10px_40px_-10px_rgba(0,0,0,.5)] flex-grow h-full bg-bg-card border border-border overflow-x-auto flex"},Ms={class:"flex overflow-x-auto gap-3 p-4"},Ps={key:0,class:"mx-auto text-text-secondary/80 m-2 w-[90%] h-full justify-center flex items-center border border-dashed border-border"},Us=Se({__name:"ActiveSprint",props:{sptint_id:{},searchQuery:{}},setup(i){const n=i,C=Fe(()=>He(()=>import("./CreateTaskModal-BUHUIaIC.js"),__vite__mapDeps([0,1,2,3]))),$=Fe(()=>He(()=>import("./ConfirmDeleteModal-D8jt0OC-.js"),__vite__mapDeps([4,5,2,3]))),T=Fe(()=>He(()=>import("./SidePanel-BgmaW-kZ.js"),__vite__mapDeps([6,2,3,7]))),p=Fe(()=>He(()=>import("./KanbanBoard-eCML5kv-.js"),__vite__mapDeps([8,9,2,3,5,10,11,12,13]))),m=At(),{workspaceId:D,moduleId:k}=ft(),{data:E}=gt({workspace_id:D,workspace_module_id:k}),j=B(()=>{var S;return E.value?(S=E.value[0])==null?void 0:S._id:""}),V=w(j),{data:A}=bt(D.value,k.value,V),U=Je(),{mutate:F,isPending:Q}=Mt({onSuccess:()=>{U.invalidateQueries({queryKey:["sheet-list"]}),Z.value="",se.value=!1,ge.value=!1,se.value=!1}}),M=S=>{F({workspace_id:D.value,module_id:k.value,variable_id:o.value,value:S})},L=B(()=>{var S;return A.value?(S=A.value[0])==null?void 0:S._id:""}),o=w(L),t=Kt(),e=B(()=>n.sptint_id),{data:s,isPending:r}=Yt(e),x=w(!1),b=w(),O=S=>{b.value=S},d=Pt(),_=Ut();function oe(S){S.type=="column"?d.mutate({payload:{workspace_id:D.value,workspace_module_id:k.value,variable_id:o.value,moved_value:S.meta.id,new_index:S.meta.newIndex}}):_.mutate({payload:{workspace_id:D.value,card_id:S.meta.moved._id,group_value:S.meta.fromColumnId,group_variable_id:o.value,new_index:S.meta.newIndex,sheet_id:V.value}})}const $e=S=>{};H(E,S=>{var P;(S==null?void 0:S.length)>0&&(V.value=(P=S[0])==null?void 0:P._id)});const ge=w(!1),Z=w(""),Ce=S=>{F({workspace_id:m.params.id,module_id:m.params.module_id,new_value:S.title,value:S.oldTitle,variable_id:o.value})},se=w(!1),W=w(),Te=()=>{F({value:W.value.title,workspace_id:D.value,module_id:k.value,newValue:W.value.title,variable_id:o.value,is_trash:!0})},re=S=>{se.value=!0,W.value=S},be=S=>{x.value=!0,W.value=S},ie=B(()=>n.searchQuery),Y=w("");H(ie,Ht.debounce(S=>{Y.value=S},200));const ce=B(()=>{const S=s.value.flatMap(P=>P.cards.map(u=>({...u,columnId:P.title})));return new Zt(S,{keys:["card-title","card-description","card-key"],threshold:.3})}),ye=B(()=>{if(!ie.value)return s.value;const S=ce.value.search(ie.value).map(P=>P.item);return s.value.map(P=>({...P,cards:S.filter(u=>u.columnId===P.title)}))});return(S,P)=>{var u,v,f,ee,ne;return c(),h("div",Bs,[a("div",Es,[Ve(q(Rt,null,null,512),[[Qe,y(r)]]),Ve(a("div",Ms,[q(y(p),{onOnPlus:be,"onDelete:column":P[0]||(P[0]=I=>re(I)),"onUpdate:column":P[1]||(P[1]=I=>Ce(I)),onReorder:oe,onAddColumn:M,"onSelect:ticket":O,board:ye.value,onOnBoardUpdate:$e,variable_id:o.value,sheet_id:V.value},{"column-footer":G(I=>{var xe,de,Le,Ie,Ne;return[(de=(xe=y(t))==null?void 0:xe.transitions)!=null&&de.all_allowed&&!((Ne=(Ie=(Le=y(t))==null?void 0:Le.transitions)==null?void 0:Ie.all_allowed)!=null&&Ne.includes(I.column.title))&&y(t).transitions.currentColumn!=I.column.title?(c(),h("div",Ps," Disbale ( you can't drop here )")):te("",!0)]}),ticket:G(({ticket:I})=>[q(Gt,{selectedVar:o.value,onSelect:()=>{O(I)},ticket:I},null,8,["selectedVar","onSelect","ticket"])]),_:1},8,["board","variable_id","sheet_id"])],512),[[Qe,!y(r)]])]),q(y($),{onClick:P[2]||(P[2]=fe(()=>{},["stop"])),modelValue:se.value,"onUpdate:modelValue":P[3]||(P[3]=I=>se.value=I),title:"Delete List",itemLabel:"list",itemName:(u=W.value)==null?void 0:u.title,requireMatchText:(v=W.value)==null?void 0:v.title,confirmText:"Delete workspace",cancelText:"Cancel",size:"md",loading:y(Q),onConfirm:Te,onCancel:P[4]||(P[4]=()=>{se.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),x.value?(c(),ae(y(C),{selectedVariable:o.value,listId:(f=W.value)==null?void 0:f.title,sheet_id:V.value,key:"createTaskModalKey",modelValue:x.value,"onUpdate:modelValue":P[5]||(P[5]=I=>x.value=I),onSubmit:P[6]||(P[6]=()=>{})},null,8,["selectedVariable","listId","sheet_id","modelValue"])):te("",!0),(ee=b.value)!=null&&ee._id?(c(),ae(y(T),{key:1,details:b.value,onClose:P[7]||(P[7]=()=>{O({variables:{}})}),showPanel:!!((ne=b.value)!=null&&ne._id)},null,8,["details","showPanel"])):te("",!0)])}}}),As={class:"flex-auto flex-grow h-full min-h-0 bg-bg-card rounded-lg border border-border overflow-x-auto flex-col flex"},Os={class:"header px-4 py-3 border-b border-border flex items-center justify-between gap-1 box-border"},qs={class:"flex gap-3 items-center"},Is={class:"relative inline-block"},Ns={key:1,class:"p-4 w-full min-w-0 box-border h-full min-h-0"},Fs={class:"flex items-center justify-between"},Hs={class:"text-sm font-semibold flex gap-2 items-center"},Rs={class:"flex items-center gap-2"},js={class:"h-8 w-22 flex items-center justify-center gap-2 rounded-md border cursor-pointer aspect-square text-sm border-border hover:bg-bg-body"},zs=["src"],Qs={key:0,class:"w-full h-full min-h-[250px] flex justify-center items-center"},Ks={class:"flex items-center justify-between"},Gs={class:"text-sm font-semibold flex gap-2 items-center mt-1"},Zs={key:0,class:"w-full h-full min-h-[250px] flex justify-center items-center"},Re=400,Js=Se({__name:"Plan",setup(i){const{theme:n}=We(),C=w(!1),$=w(""),T=w(!1),p=w(!1),m=w(!1),D=()=>{C.value=!1},{workspaceId:k}=pt(),E=w(!1),{moveSelectedToSprint:j,moveSelectedToBacklog:V,deleteSelected:A,saveSprintMeta:U,toggleStartSprint:F}=oa(),{data:Q}=Ke(k),{mutate:M,isPending:L}=la({onSuccess:()=>{de.invalidateQueries({queryKey:["sprint-list"]}),t.value=!1}}),o=w(null),t=w(!1),e=()=>{var g;M((g=o.value)==null?void 0:g._id)},{mutate:s,isPending:r}=it({onSuccess:g=>{U({name:g.title}),x({id:Z.value}),W.value=!1}}),{mutate:x,isPending:b}=sa({onSuccess:()=>{se()}}),O=g=>{console.log("helo",o.value,g),s({id:Z.value,payload:{goal:g.goal,start_date:g.start,end_date:g.end}})},{data:d,refetch:_}=Wt(k.value),{refetch:oe,isPending:$e}=Ke(k),ge=B(()=>{var g,l;return(l=(g=d==null?void 0:d.value)==null?void 0:g.sprints[0])==null?void 0:l._id}),Z=w(ge.value);H(()=>ge.value,g=>{Z.value=g}),H(()=>Z.value,g=>{var l;o.value=((l=d.value)==null?void 0:l.sprints.find(X=>X._id===g))||null});const{data:Ce,refetch:se}=ta(ge),W=w(!1),Te=()=>{W.value=!0},{data:re,isPending:be,refetch:ie}=Xt(Z);H(()=>be.value,g=>{console.log(g,be.value,">>>> laoding state changes")});const Y=B(()=>{var X,pe;const g=(X=re==null?void 0:re.value)==null?void 0:X.backlog_items;if(!g)return null;const l=(((pe=re==null?void 0:re.value)==null?void 0:pe.backlog_items)||[]).map(z=>{var Me,Pe,Ue,Ae,Oe;const me=((Me=z==null?void 0:z.card)==null?void 0:Me.variables)||{},he=((Pe=z==null?void 0:z.card)==null?void 0:Pe._id)||z.card_id;return{id:he,key:me["card-code"]||(he==null?void 0:he.slice(-6))||"PRJ-?",summary:me["card-title"]||"(untitled)",type:"Story",status:ce(String(me["card-status"]||"").trim()),assignee:((Ae=(Ue=z==null?void 0:z.card)==null?void 0:Ue.assigned_to)==null?void 0:Ae.name)||"Unassigned",storyPoints:Number(z.story_points||0),priority:ye(String(me.priority||"").trim()),createdAt:((Oe=z==null?void 0:z.card)==null?void 0:Oe.created_at)||new Date().toISOString(),description:me["card-description"]||""}});return{id:g._id,name:g.title||"Sprint 1",title:g.title,goal:"",start:"",end:"",started:!1,tickets:l}});function ce(g){const l=g.toLowerCase();return l.includes("progress")?"In Progress":l.includes("done")||l.includes("complete")?"Done":"Todo"}function ye(g){const l=g.toLowerCase();return l==="highest"||l==="blocker"||l==="critical"?"Highest":l==="high"||l==="major"?"High":l==="medium"||l==="normal"?"Medium":"Low"}const{mutate:S}=ra({onSuccess:()=>{De.success("Card removed from sprint successfully"),P()},onError:g=>{De.error("Failed to remove card from sprint"),console.error("Failed to remove card from sprint:",g)}});function P(){ie(),_(),oe(),se()}function u(g,l){const X=Array.isArray(g)?g:[g],pe=l||Z.value;!pe||!X.length||X.forEach(z=>{S({sprintId:pe,cardId:z})})}const v=w(!1),f=w(null);function ee(){E.value=!0,f.value=null}function ne(g){f.value=g,C.value=!0,v.value=!0}const I=w(!1);function xe(){I.value=!0}const de=Je(),{mutate:Le,isPending:Ie}=aa({onSuccess:g=>{U({name:g.title}),de.invalidateQueries({queryKey:["sprint-list"]}),I.value=!1}}),{mutate:Ne,isPending:ht}=it({onSuccess:g=>{U({name:g.title}),de.invalidateQueries({queryKey:["sprint-list"]}),I.value=!1}});function kt(g){var l;o.value?Ne({id:(l=o.value)==null?void 0:l._id,payload:{workspace_id:k.value,title:g.name,description:g.description}}):Le({payload:{workspace_id:k.value,title:g.name,description:g.description}})}function _t(){o.value=null,console.log(">>> felo"),I.value=!0}function Xe(g){o.value=g,I.value=!0}function Ye(g){o.value=g,t.value=!0}const{mutate:St,isPending:Ct}=ea(Z,{onSuccess:()=>{se()}}),wt=()=>{St({})},Be=w(null),Ee=w(0);let ze=!1;Ot(()=>{if(!Be.value)return;const g=Be.value.offsetWidth;Ee.value=g/3});function Dt(){ze=!0,document.addEventListener("mousemove",et),document.addEventListener("mouseup",tt)}function et(g){if(!ze||!Be.value)return;const l=Be.value.getBoundingClientRect(),X=g.clientX-l.left;X<Re?Ee.value=Re:X>l.width-Re?Ee.value=l.width-Re:Ee.value=X}function tt(){ze=!1,document.removeEventListener("mousemove",et),document.removeEventListener("mouseup",tt)}return(g,l)=>{var X,pe,z,me,he,Me,Pe,Ue,Ae,Oe,at,st,lt,rt;return c(),h(ve,null,[a("div",As,[a("div",Os,[q(jt,{modelValue:Z.value,"onUpdate:modelValue":l[1]||(l[1]=N=>Z.value=N),options:(X=y(d))==null?void 0:X.sprints,variant:"secondary",onEditOption:Xe,onDeleteOption:Ye},{more:G(()=>[a("div",{onClick:l[0]||(l[0]=N=>_t()),class:"capitalize border-t border-border px-4 py-2 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-1 overflow-hidden overflow-ellipsis text-nowrap"},l[19]||(l[19]=[a("i",{class:"fa-solid fa-plus"},null,-1),J(" Add new ")]))]),_:1},8,["modelValue","options"]),a("div",qs,[q(zt,{placeholder:"Search in sprint",onOnChange:l[2]||(l[2]=N=>{$.value=N})}),((pe=y(Ce))==null?void 0:pe.status)=="active"?(c(),ae(ue,{key:0,size:"sm",onClick:wt,variant:(y(n)==="dark","primary"),class:"border-border-input border"},{default:G(()=>[J(R(y(Ct)?"Ending...":"End"),1)]),_:1},8,["variant"])):(c(),ae(ue,{key:1,size:"sm",variant:(y(n)==="dark","primary"),class:"border-border-input border",onClick:Te,disabled:!Y.value||Y.value.tickets.length==0},{default:G(()=>l[20]||(l[20]=[J("Start Sprint")])),_:1,__:[20]},8,["variant","disabled"])),a("div",Is,[a("div",{onClick:l[7]||(l[7]=N=>m.value=!1)},[a("button",{onClick:l[3]||(l[3]=fe(N=>m.value=!m.value,["stop"])),class:"flex items-center justify-center border border-border-input rounded-[8px] w-[36px] h-[36px] text-primary hover:bg-bg-body"},l[21]||(l[21]=[a("i",{class:"fa-solid fa-ellipsis-vertical text-md cursor-pointer"},null,-1)])),q(qt,{name:"fade"},{default:G(()=>[m.value?(c(),h("ul",{key:0,class:"absolute right-0 mt-2 w-44 border border-border-input rounded-[8px] bg-bg-dropdown shadow-xl py-3 z-50",onClick:l[6]||(l[6]=fe(()=>{},["stop"]))},[a("li",{class:"px-4 py-2 text-[14px] font-manrope font-medium text-text-secondary hover:bg-bg-body cursor-pointer",onClick:l[4]||(l[4]=N=>Xe(o.value))}," Edit Sprint "),a("li",{class:"px-4 py-2 text-[14px] font-manrope font-medium text-red-600 hover:bg-bg-body cursor-pointer",onClick:l[5]||(l[5]=N=>Ye(o.value))}," Delete Sprint ")])):te("",!0)]),_:1})])]),l[22]||(l[22]=a("button",{class:"flex items-center font-normal justify-center border border-border-input rounded-[8px] w-[36px] h-[36px] text-primary hover:bg-bg-body"},[a("i",{class:"fa-sharp fa-thin fa-arrows-up-down-left-right"})],-1))])]),((z=y(Ce))==null?void 0:z.status)=="active"?(c(),ae(Us,{key:0,sptint_id:Z.value,searchQuery:$.value},null,8,["sptint_id","searchQuery"])):(c(),h("div",Ns,[a("div",{class:"flex gap-2 h-full max-h-screen min-h-0 box-border overflow-x-auto group",ref_key:"containerRef",ref:Be},[a("section",{class:K(["space-y-4 p-4 rounded-md relative group overflow-hidden box-border h-full min-h-0 min-w-[400px]",y(n)==="dark"?"bg-bg-surface":"bg-bg-surface/30"]),style:It({width:Ee.value+"px"})},[a("div",Fs,[a("h2",Hs,[Ve(a("input",{type:"checkbox",class:"custom-checkbox bg-bg-body border border-border-input flex-shrink-0","onUpdate:modelValue":l[8]||(l[8]=N=>T.value=N)},null,512),[[ot,T.value]]),J(" Backlog ("+R((he=(me=y(Q))==null?void 0:me.cards)==null?void 0:he.length)+" "+R(((Pe=(Me=y(Q))==null?void 0:Me.cards)==null?void 0:Pe.length)>1?"Tasks":"Task")+") ",1)]),a("div",Rs,[a("button",js,[a("img",{src:y(Ha),alt:"icon",class:"w-[16px]"},null,8,zs),l[23]||(l[23]=J(" Filters "))]),a("button",{class:"w-8 h-8 rounded-md border cursor-pointer aspect-square text-sm border-border hover:bg-bg-body",onClick:ee},l[24]||(l[24]=[a("i",{class:"text-text-primary fa-regular fa-plus"},null,-1)]))])]),y($e)?(c(),h("div",Qs,l[25]||(l[25]=[a("div",{role:"status","aria-label":"Loading",class:"h-10 w-10 rounded-full border-4 border-neutral-700 border-t-transparent animate-spin"},null,-1)]))):(c(),ae(_a,{key:1,checkedAll:T.value,searchQuery:$.value,onMoveSelectedToSprint:y(j),onDeleteSelectedBacklog:l[9]||(l[9]=N=>y(A)("backlog")),onOpenTicket:ne,onTicketMovedToBacklog:u,onOpenCreateTicket:ee},null,8,["checkedAll","searchQuery","onMoveSelectedToSprint"]))],6),a("div",{class:"h-full w-[3px] relative z-10 opacity-0 group-hover:opacity-100 bg-red hover:bg-accent cursor-col-resize transition",onMousedown:Dt},null,32),a("section",{class:K(["space-y-6 p-4 rounded-md relative group ovrflow-hidden flex-1 h-full min-h-0 box-border min-w-[400px]",y(n)==="dark"?"bg-bg-surface":"bg-bg-surface/30"])},[a("div",Ks,[a("h2",Gs,[Ve(a("input",{type:"checkbox",class:"custom-checkbox bg-bg-body border border-border-input flex-shrink-0","onUpdate:modelValue":l[10]||(l[10]=N=>p.value=N)},null,512),[[ot,p.value]]),J(" Sprint ("+R((Ae=(Ue=Y.value)==null?void 0:Ue.tickets)==null?void 0:Ae.length)+" "+R(((at=(Oe=Y.value)==null?void 0:Oe.tickets)==null?void 0:at.length)>1?"Tasks":"Task")+") ",1)])]),y(be)?(c(),h("div",Zs,l[26]||(l[26]=[a("div",{role:"status","aria-label":"Loading",class:"h-10 w-10 rounded-full border-4 border-neutral-700 border-t-transparent animate-spin"},null,-1)]))):(c(),h(ve,{key:1},[Y.value?(c(),ae(qa,{key:0,searchQuery:$.value,sprintId:Z.value,checkedSprintAll:p.value,sprint:Y.value,onOpenTicket:ne,onEditSprint:xe,onToggleStart:y(F),onMoveSelectedToBacklog:y(V),onDeleteSelectedSprint:l[11]||(l[11]=N=>y(A)("sprint",N)),onRefresh:P},null,8,["searchQuery","sprintId","checkedSprintAll","sprint","onToggleStart","onMoveSelectedToBacklog"])):te("",!0)],64))],2)],512)]))]),q(Qt,{onClick:l[12]||(l[12]=fe(()=>{},["stop"])),modelValue:t.value,"onUpdate:modelValue":l[13]||(l[13]=N=>t.value=N),title:"Delete Sprint",itemLabel:"Sprint",itemName:(st=o.value)==null?void 0:st.title,requireMatchText:(lt=o.value)==null?void 0:lt.title,confirmText:"Delete Ticket",cancelText:"Cancel",size:"md",loading:y(L),onConfirm:e,onCancel:l[14]||(l[14]=()=>{o.value=null,t.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),q(Fa,{modelValue:I.value,"onUpdate:modelValue":l[15]||(l[15]=N=>I.value=N),onSave:kt,sprint:o.value,creatingSprint:o.value?y(ht):y(Ie)},null,8,["modelValue","sprint","creatingSprint"]),q(Ja,{sprint:o.value,modelValue:W.value,"onUpdate:modelValue":l[16]||(l[16]=N=>W.value=N),onSave:O,creatingSprint:y(b)||y(r)},null,8,["sprint","modelValue","creatingSprint"]),q(Nt,{modelValue:C.value,"onUpdate:modelValue":l[17]||(l[17]=N=>C.value=N),cardId:(rt=f.value)==null?void 0:rt.id,onClose:D},null,8,["modelValue","cardId"]),q(Ls,{modelValue:E.value,"onUpdate:modelValue":l[18]||(l[18]=N=>E.value=N)},null,8,["modelValue"])],64)}}}),ol=Ge(Js,[["__scopeId","data-v-37b3a223"]]);export{ol as default};
