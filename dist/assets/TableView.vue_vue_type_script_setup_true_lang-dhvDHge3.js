import{d as me,Q as fe,r as i,a0 as ge,c as _,a2 as we,O as z,x as O,D as ye,m as d,g as t,f as G,n as m,G as f,E as y,l as $,k as B,i as he,A as xe,o as l,ah as R,t as Q,y as ke,P as _e,T as Ce,b4 as Ve,al as Me,ac as Ee}from"./index-Bau3eFG3.js";import{_ as ze}from"./CreateTaskModal.vue_vue_type_script_setup_true_lang-4b_mPd1E.js";const $e={class:"kanban-table space-y-4 h-[85vh] mt-4 overflow-y-auto overflow-x-auto ps-4 mb-5"},Be={class:"w-full table-fixed border-collapse rounded-[6px] shadow-sm bg-bg-body/20 text-sm border border-border/60"},Re={class:"bg-bg-surface border-b border-border sticky top-[-1px] z-10"},Ie={class:"text-text-secondary"},De=["onMousedown"],Le={class:"w-10 p-2 text-center relative"},Se={class:"relative inline-block"},Te={key:0,class:"column-menu absolute w-[200px] -right-1 bg-bg-dropdown border border-border rounded shadow z-50"},Ae=["checked","onChange"],Ne={class:"bg-bg-surface/20"},Pe=["colspan"],Ue=["onClick"],We=["colspan"],Xe=["onMouseenter"],je={class:"w-8 group text-center align-middle border-r border-border/40 relative"},Fe={class:"flex justify-center items-center h-full w-full relative"},Oe=["onClick"],Ge={key:0,class:"absolute left-6 top-6 bg-bg-dropdown border border-border rounded shadow-md z-50 min-w-[120px] text-left overflow-hidden row-action-menu"},Qe=["onClick"],qe=["colspan"],He=["onUpdate:modelValue","onBlur"],Je=["colspan"],Ze=me({__name:"TableView",props:{columns:{},rows:{},isPending:{type:Boolean},canCreate:{type:Boolean,default:!0},canCreateVariable:{type:Boolean,default:!0},canDelete:{type:Boolean,default:!1}},emits:["update:rows","create","toggleVisibility","addVar","delete","scroll"],setup(q,{emit:H}){const{workspaceId:I,moduleId:J}=fe(),D=xe(),C=i(!1),K=i();function Y(){D.path.includes("/workspace/plan")?C.value=!0:P(u==null?void 0:u.length)}const{data:L}=ge({workspace_id:I.value,workspace_module_id:J.value}),Z=i(""),ee=_(()=>{var e;return L.value?(e=L.value[0])==null?void 0:e._id:""}),S=i(ee),se=_(()=>{var e;return T.value?(e=T.value[0])==null?void 0:e._id:""}),oe=i(se),{data:T}=we(I,Z,S),v=q,p=H,u=z(v.rows||[]),te=e=>{p("scroll",e)};O(()=>v.rows,e=>{e&&u.splice(0,u.length,...e)});const a=z({id:null,field:""}),g=i(null),A=i(null),N=_(()=>u.some(e=>a.id===e.id&&!e[a.field])),ne=(e,s)=>{a.id=e.id,a.field=s,Me(()=>{var r;return(r=A.value)==null?void 0:r.focus()})},re=()=>{a.id=null,a.field=""},le=e=>{var s;if(!((s=e[a.field])!=null&&s.trim())){const r=u.findIndex(o=>o.id===e.id);r!==-1&&u.splice(r,1)}re(),p("update:rows",u.slice()),p("create",e)},P=e=>{var r;const s={id:Date.now()};v.columns.forEach(o=>s[o.key]=""),u.splice(e,0,s),ne(s,((r=v.columns[0])==null?void 0:r.key)||""),g.value=null,p("update:rows",u.slice())};function ae(e,s){if(!(!e||!s))return s.includes(".")?s.split(".").reduce((r,o)=>r==null?r:r[o],e):e[s]}function de(e,s){return s!=null&&s.accessor?s.accessor(e):ae(e,s.key)}const ue=e=>{var r;const s=de(e.row,e.column);return(r=e.column)!=null&&r.render?e.column.render({row:e==null?void 0:e.row,column:e==null?void 0:e.column,value:s,index:e==null?void 0:e.index}):Ee("span",String(s??""))},c=z({});O(()=>v.columns,e=>{e.forEach((s,r)=>{r==0?c[s.key]=250:c[s.key]||(c[s.key]=150)})},{immediate:!0});let V=null,U=0,W=0;const ie=(e,s)=>{V=s,U=e.clientX,W=c[s],document.addEventListener("mousemove",X),document.addEventListener("mouseup",j)},X=e=>{if(!V)return;const s=e.clientX-U,r=Math.max(80,W+s);c[V]=r},j=()=>{V=null,document.removeEventListener("mousemove",X),document.removeEventListener("mouseup",j)},h=i(v.columns.filter(e=>e.visible??!0).map(e=>e.key)),x=_(()=>v.columns.filter(e=>h.value.includes(e.key)&&e.label.toLowerCase()!=="process")),M=i(!1),w=i(null),ce=e=>{w.value===e?w.value=null:w.value=e},F=e=>{e.target.closest(".column-menu")||(M.value=!1),!e.target.closest(".row-action-btn")&&!e.target.closest(".row-action-menu")&&(w.value=null)};document.addEventListener("click",F),ye(()=>{document.removeEventListener("click",F)});const be=e=>{const s=h.value.indexOf(e);s===-1?(p("toggleVisibility",e,!0),h.value.push(e)):(p("toggleVisibility",e,!1),h.value.splice(s,1))},ve=_(()=>1+x.value.length+1);return(e,s)=>{var r;return l(),d("div",{class:"",onScroll:te},[t("div",$e,[t("table",Be,[t("thead",Re,[t("tr",Ie,[s[8]||(s[8]=t("th",{class:"w-8 p-0 sticky left-0 z-20 bg-bg-surface"},null,-1)),(l(!0),d(f,null,y(x.value,o=>(l(),d("th",{key:o==null?void 0:o.key,class:"relative font-bold p-2 uppercase text-left text-[11px] tracking-wide border-r border-border/40 select-none whitespace-nowrap min-w-[200px]",style:R({width:c[o.key]?c[o.key]+"px":"100%"})},[t("span",null,Q(o==null?void 0:o.label),1),t("div",{class:"absolute right-0 top-0 h-full w-2 cursor-col-resize z-30 hover:bg-accent/20 active:bg-accent/40 transition",onMousedown:b=>ie(b,o.key)},null,40,De)],4))),128)),t("th",Le,[t("div",Se,[t("button",{onClick:s[0]||(s[0]=$(o=>M.value=!M.value,["stop"])),class:"p-1 rounded hover:bg-bg-surface/50 cursor-pointer"},s[6]||(s[6]=[t("i",{class:"fa-regular fa-columns-3"},null,-1)])),M.value?(l(),d("div",Te,[(l(!0),d(f,null,y(v.columns.filter(o=>o.label.toLowerCase()!=="process"),o=>(l(),d("div",{key:"toggle-"+o.key,class:"flex items-center space-x-2 px-3 py-1.5 capitalize font-medium cursor-pointer hover:bg-bg-dropdown-menu-hover text-[12px] text-text-primary gap-2"},[t("input",{type:"checkbox",checked:h.value.includes(o.key),onChange:b=>be(o.key),class:"h-4 w-4 mt-0.5 rounded border-border accent-accent cursor-pointer flex-shrink-0"},null,40,Ae),t("span",null,Q(o.label),1)]))),128)),e.canCreateVariable?(l(),d("div",{key:0,onClick:s[1]||(s[1]=o=>p("addVar")),class:"sticky bottom-0 bg-bg-dropdown shadow-md mt-2 shadow-border capitalize border-t border-border px-4 py-2 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-1 overflow-hidden overflow-ellipsis text-nowrap"},s[7]||(s[7]=[t("i",{class:"fa-solid fa-plus"},null,-1),B(" Add new ")]))):m("",!0)])):m("",!0)])])])]),t("tbody",Ne,[e.isPending?(l(),d(f,{key:0},y(5,o=>t("tr",{key:"sk-"+o,class:"border-b border-border animate-pulse"},[s[10]||(s[10]=t("td",null,[t("div",{class:"w-4 h-4 bg-bg-surface rounded"})],-1)),(l(!0),d(f,null,y(e.columns,(b,E)=>(l(),d("td",{key:b.key,class:"border-r border-border h-8",style:R({width:c[b.key]+"px"}),colspan:E===x.value.length-1?2:1},s[9]||(s[9]=[t("div",{class:"w-full h-4 bg-bg-surface rounded"},null,-1)]),12,Pe))),128))])),64)):(l(!0),d(f,{key:1},y(u,(o,b)=>{var E;return l(),d(f,{key:o==null?void 0:o.id},[g.value===b&&!N.value?(l(),d("tr",{key:0,class:"relative bg-bg-surface/20 transition-all cursor-pointer border border-accent",onMouseleave:s[2]||(s[2]=n=>g.value=null)},[t("td",{class:"!p-0 w-8",onClick:n=>P(b)},s[11]||(s[11]=[t("span",{class:"absolute left-[-20px] top-[-14px] bg-bg-surface border border-border w-6 h-6 text-sm rounded-md flex justify-center items-center shadow-sm hover:bg-bg-surface pb-[0.5px]"},"+",-1)]),8,Ue),t("td",{class:"!p-0",colspan:(E=e.columns)==null?void 0:E.length},null,8,We)],32)):m("",!0),t("tr",{onMouseenter:n=>g.value=b,class:"border-b border-border hover:bg-bg-surface/40 transition-colors"},[t("td",je,[t("div",Fe,[t("div",{class:"h-6 w-5 flex items-center justify-center rounded hover:bg-bg-dropdown-menu-hover cursor-pointer text-text-secondary row-action-btn",onClick:$(n=>ce(o._id||o.id),["stop"])},s[12]||(s[12]=[t("i",{class:"fa-solid fa-ellipsis-vertical text-xs"},null,-1)]),8,Oe),w.value===(o._id||o.id)?(l(),d("div",Ge,[e.canDelete?(l(),d("div",{key:0,onClick:$(()=>{p("delete",o),w.value=null},["stop"]),class:"px-3 py-2 text-xs text-red-500 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-2"},s[13]||(s[13]=[t("i",{class:"fa-solid fa-trash"},null,-1),B(" Delete ")]),8,Qe)):m("",!0)])):m("",!0)])]),(l(!0),d(f,null,y(x.value,(n,pe)=>(l(),d("td",{key:n==null?void 0:n.key,class:"border-r border-border overflow-visible relative h-8",style:R({width:c[n.key]+"px"}),colspan:pe===x.value.length-1?2:1},[(a==null?void 0:a.id)===(o==null?void 0:o.id)&&(a==null?void 0:a.field)===(n==null?void 0:n.key)?ke((l(),d("input",{key:0,"onUpdate:modelValue":k=>o[n==null?void 0:n.key]=k,onBlur:k=>le(o),class:"min-w-[200px] w-full p-1 border border-accent/60 rounded-sm focus:outline-none focus:ring-1 focus:ring-accent bg-bg-body text-[12px] h-8",ref_for:!0,ref:k=>k&&(a==null?void 0:a.id)===(o==null?void 0:o.id)&&(a==null?void 0:a.field)===(n==null?void 0:n.key)&&(A.value=k)},null,40,He)),[[Ce,o[n==null?void 0:n.key]]]):_e(e.$slots,n.key,{key:2,row:o,column:n,index:`r-${o._id}`},()=>[(l(),G(Ve(ue),{row:o,column:n,index:o._id},null,8,["row","column","index"]))])],12,qe))),128))],40,Xe)],64)}),128)),!N.value&&e.canCreate?(l(),d("tr",{key:2,onClick:Y,class:"bg-bg-surface border-t border-border cursor-pointer transition hover:bg-bg-body",onMouseenter:s[3]||(s[3]=o=>g.value=u==null?void 0:u.length),onMouseleave:s[4]||(s[4]=o=>g.value=null)},[t("td",{colspan:ve.value,class:"text-text-secondary h-8 px-3"},s[14]||(s[14]=[t("span",{class:"inline-flex w-5 h-5 border border-border-input rounded-full justify-center items-center text-secondary hover:bg-bg-surface/50 transition pb-0.5"}," + ",-1),B(" Add New Row ")]),8,Je)],32)):m("",!0)])])]),C.value&&he(D).path.includes("/plan")?(l(),G(ze,{key:0,modelValue:C.value,"onUpdate:modelValue":s[5]||(s[5]=o=>C.value=o),selectedVariable:oe.value,listId:(r=K.value)==null?void 0:r.title,sheet_id:S.value},null,8,["modelValue","selectedVariable","listId","sheet_id"])):m("",!0)],32)}}});export{Ze as _};
