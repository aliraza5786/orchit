const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CreateTaskModal-CdreadMb.js","assets/CreateTaskModal.vue_vue_type_script_setup_true_lang-Cq3FoN8L.js","assets/index-C-iqr35C.js","assets/index-U_lIj89R.css","assets/ConfirmDeleteModal-S1OH6ECx.js","assets/ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-C2nKiBOG.js","assets/SidePanel-jJvMe-xA.js","assets/SidePanel-M_FgJti0.css","assets/KanbanBoard-BZzOqsCN.js","assets/lodash-DOMkl3MI.js","assets/lodash-B_VDCJnj.css","assets/DropMenu.vue_vue_type_script_setup_true_lang-DCGTTLZL.js","assets/workspace-B0s5Am41.js","assets/KanbanBoard-DlFwUlEB.css"])))=>i.map(i=>d[i]);
import{J as xe,K as Pe,L as te,n as b,r as T,m as Q,M as ke,c as V,N as Ce,d as _e,O as Ye,i as S,e as t,h as q,g as we,y as G,b as Z,T as et,w as A,t as F,P as tt,o as f,Q as gt,R as bt,f as J,_ as at,B as oe,S as je,j as W,U as Ie,A as He,V as yt,a as Ke,W as st,X as kt,Y as lt,Z as xt,$ as nt,a0 as _t,F as Se,x as Ae,G as Ze,C as Ne,a1 as ht,a2 as St,a3 as Ct,a4 as wt,a5 as qe,a6 as Fe,p as Dt,a7 as Vt}from"./index-C-iqr35C.js";import{_ as ze}from"./SearchBar.vue_vue_type_script_setup_true_lang-DJZiKjRU.js";import{l as Tt,F as $t,K as Lt,D as Mt}from"./lodash-DOMkl3MI.js";import{_ as Bt}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-C2nKiBOG.js";import{u as Et}from"./workspace-B0s5Am41.js";import{K as Pt}from"./KanbanTicket-DAnOdFGi.js";import"./DropMenu.vue_vue_type_script_setup_true_lang-DCGTTLZL.js";const Ot="data:image/svg+xml,%3csvg%20width='60'%20height='46'%20viewBox='0%200%2060%2046'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20opacity='0.4'%3e%3cpath%20d='M59.7443%2034.8967L50.5682%2025.7206C50.4457%2025.5984%2050.2897%2025.5152%2050.1199%2025.4816C49.9501%2025.4479%2049.7742%2025.4653%2049.6143%2025.5315C49.4544%2025.5976%2049.3176%2025.7097%2049.2213%2025.8535C49.125%2025.9973%2049.0734%2026.1664%2049.073%2026.3394V30.517H25.9775V40.5114H49.0755V44.689C49.0759%2044.8621%2049.1275%2045.0312%2049.2238%2045.175C49.3201%2045.3187%2049.4569%2045.4308%2049.6168%2045.497C49.7767%2045.5632%2049.9527%2045.5805%2050.1224%2045.5468C50.2922%2045.5132%2050.4482%2045.43%2050.5708%2045.3078L59.7468%2036.1318C59.9095%2035.9672%2060.0005%2035.7451%2060.0001%2035.5137C59.9996%2035.2823%2059.9076%2035.0605%2059.7443%2034.8967Z'%20fill='%23C6DBA9'/%3e%3cpath%20d='M32.3149%2030.5293C30.664%2031.5967%2028.7394%2032.1633%2026.7734%2032.1609V40.5237H34.7295C39.2829%2038.5638%2042.9649%2035.0102%2045.0851%2030.5293H32.3149Z'%20fill='url(%23paint0_linear_250_16424)'/%3e%3cpath%20d='M46.2209%2020.2832C46.2317%2015.0884%2044.2448%2010.0884%2040.6714%206.3179C37.0981%202.54738%2032.2119%200.295026%2027.024%200.0269855C21.8362%20-0.241055%2016.7439%201.49574%2012.801%204.87791C8.85809%208.26009%206.36647%2013.0287%205.84178%2018.1969L2.46233%2017.8913C2.31055%2017.8782%202.15829%2017.9103%202.02467%2017.9835C1.89106%2018.0566%201.78205%2018.1677%201.71134%2018.3026C1.64063%2018.4376%201.61138%2018.5904%201.62726%2018.7419C1.64313%2018.8934%201.70343%2019.0368%201.80058%2019.1542L9.51927%2028.406C9.79205%2028.7344%2010.277%2028.7773%2010.378%2028.5045L19.6298%2020.7833C20.3876%2020.3413%2020.1173%2019.4825%2019.4328%2019.4194L15.8008%2019.091C16.0297%2017.1283%2016.8213%2015.2735%2018.0802%2013.7503C19.3391%2012.2271%2021.0115%2011.1004%2022.8961%2010.5059C24.7806%209.9114%2026.7969%209.8745%2028.7019%2010.3996C30.6069%2010.9248%2032.3195%2011.9896%2033.6332%2013.4657C34.947%2014.9419%2035.8059%2016.7664%2036.1065%2018.7195C36.4071%2020.6726%2036.1365%2022.6709%2035.3274%2024.4738C34.5183%2026.2766%2033.2051%2027.8071%2031.5462%2028.8807C29.8872%2029.9544%2027.9531%2030.5254%2025.977%2030.5251H25.9283V40.5094C31.2249%2040.4031%2036.7093%2038.2263%2040.4202%2034.4455C44.1311%2030.6648%2046.2134%2025.5808%2046.2209%2020.2832Z'%20fill='%23D7A39E'/%3e%3cpath%20d='M25.9773%2030.5293H0V40.5237H25.9773V30.5293Z'%20fill='url(%23paint1_linear_250_16424)'/%3e%3c/g%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_250_16424'%20x1='6.53714'%20y1='35.5252'%20x2='47.0198'%20y2='35.5252'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%236C798F'/%3e%3cstop%20offset='1'%20stop-color='%236C798F'%20stop-opacity='0.1'/%3e%3c/linearGradient%3e%3clinearGradient%20id='paint1_linear_250_16424'%20x1='0'%20y1='36'%20x2='26'%20y2='36'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23E8D4D3'%20stop-opacity='0'/%3e%3cstop%20offset='1'%20stop-color='%23E2A39F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",rt="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='20'%20height='20'%20rx='3.33333'%20fill='%2329BF7F'/%3e%3cpath%20d='M6.43164%2014.3018L9.29004%2012.167L9.29102%2012.166C9.47176%2012.0328%209.69053%2011.9609%209.91504%2011.9609C10.0834%2011.9609%2010.2482%2012.0017%2010.3965%2012.0781L10.5391%2012.166L10.54%2012.167L13.373%2014.291V5.91699H6.43164V14.3018ZM14.4316%2014.3789C14.4277%2014.5672%2014.3725%2014.7506%2014.2725%2014.9102C14.1723%2015.0699%2014.0303%2015.1996%2013.8623%2015.2852C13.6944%2015.3706%2013.5064%2015.4094%2013.3184%2015.3965C13.1304%2015.3835%2012.9495%2015.3196%2012.7949%2015.2119L12.79%2015.208L9.91504%2013.0518L7.01465%2015.209C6.83427%2015.3432%206.61546%2015.4161%206.39062%2015.417H6.38965C6.2298%2015.4164%206.07171%2015.38%205.92773%2015.3105V15.3096C5.75087%2015.2261%205.60123%2015.0946%205.49609%2014.9297C5.3907%2014.7642%205.33364%2014.5721%205.33301%2014.376V5.87402C5.3338%205.7361%205.36234%205.59971%205.41602%205.47266C5.46971%205.3456%205.54812%205.23049%205.64648%205.13379C5.74485%205.0371%205.86131%204.96069%205.98926%204.90918C6.1165%204.85797%206.2525%204.83272%206.38965%204.83398V4.83301H13.3906C13.6661%204.83457%2013.9302%204.94494%2014.125%205.13965C14.3198%205.33446%2014.4301%205.59852%2014.4316%205.87402V14.3789Z'%20fill='white'%20stroke='white'%20stroke-width='0.333333'/%3e%3c/svg%3e",Ut=(i,n={})=>Pe({queryKey:["sprint-list"],queryFn:({signal:C})=>te({url:`sprints/${i}`,method:"GET",signal:C}),...n}),At=(i,n={})=>Pe({queryKey:["sprint-cards",i],queryFn:({signal:C})=>te({url:`sprints/${b(i)}/backlog`,method:"GET",signal:C}),...n}),qt=(i,n={})=>Pe({queryKey:["sprint-kanban",i],queryFn:({signal:C})=>te({url:`workspace/cards/sprintgrouped?sprint_id=${b(i)}&variable_id=68b6c96e0a95eef7d14e6981`,method:"GET",signal:C}),...n}),Ft=(i,n={})=>xe({key:["sprint-complete"]},{mutationFn:C=>te({url:`sprints/${b(i)}/complete`,method:"POST",data:C.payload}),...n}),It=(i,n={})=>Pe({queryKey:["sprint-detail",i],queryFn:({signal:C})=>te({url:`sprints/detail/${b(i)}?include_cards=true`,method:"GET",signal:C}),...n}),Re=(i,n={})=>Pe({queryKey:["backlog-list",i],queryFn:({signal:C})=>te({url:`sprints/workspace/${b(i)}/cards?include_sprint_cards=false`,method:"GET",signal:C}),...n}),Ht=(i={})=>xe({key:["add-sprint"]},{mutationFn:n=>te({url:"/sprints",method:"POST",data:n.payload}),...i}),ot=(i={})=>xe({key:["move-card-to-sprint"]},{mutationFn:n=>te({url:`/sprints/${n.id}/cards`,method:"POST",data:n.payload}),...i}),Ge=(i={})=>xe({key:["add-sprint"]},{mutationFn:n=>te({url:`/sprints/${n.id}`,method:"PUT",data:n.payload}),...i}),Nt=(i={})=>xe({key:["start-sprint"]},{mutationFn:n=>te({url:`/sprints/${n.id}/start`,method:"POST",data:n.payload}),...i}),Rt=(i={})=>xe({key:["delete-sprint"]},{mutationFn:n=>te({url:`/sprints/${n}`,method:"DELETE"}),...i}),jt=(i={})=>xe({key:["remove-card-from-sprint"]},{mutationFn:n=>te({url:`sprints/${b(n.sprintId)}/cards/remove `,method:"POST",data:{card_ids:[n.cardId]}}),...i}),it="jira-like:";function Je(i="id"){return`${i}_${Math.random().toString(36).slice(2,9)}`}function We(i,n){try{localStorage.setItem(it+i,JSON.stringify(n))}catch{}}function Xe(i,n){try{const C=localStorage.getItem(it+i);return C?JSON.parse(C):n}catch{return n}}function dt(i){switch(i){case"Highest":return"rounded-md bg-red-50 px-2 py-0.5 text-xs text-red-700";case"High":return"rounded-md bg-orange-50 px-2 py-0.5 text-xs text-orange-700";case"Medium":return"rounded-md bg-amber-50 px-2 py-0.5 text-xs text-amber-700";case"Low":return"rounded-md bg-gray-100 px-2 py-0.5 text-xs text-gray-600"}}function ut(){const i=T(Xe("backlog",[])),n=T(Xe("sprints",[]));if(n.value.length===0)n.value.push({id:Je("sprint"),name:"Sprint 1",goal:"",start:"",end:"",started:!1,tickets:[]});else if(n.value.length>1){for(let e=1;e<n.value.length;e++)i.value.push(...n.value[e].tickets);n.value=[n.value[0]]}const C=T(n.value[0].id);Q([i,n],()=>{We("backlog",i.value),We("sprints",n.value)},{deep:!0});const O=T([]),$=ke({}),k=V(()=>i.value.length>0&&O.value.length===i.value.length),_=e=>{var o;const r=n.value.find(s=>s.id===e);return!!r&&r.tickets.length>0&&(((o=$[e])==null?void 0:o.length)||0)===r.tickets.length};function w(e,r,o){const s=r.target.checked;if(e==="backlog")O.value=s?i.value.map(l=>l.id):[];else if(o){const l=n.value.find(g=>g.id===o);$[o]=s&&l?l.tickets.map(g=>g.id):[]}}function E(e,r,o,s){const l=o.target.checked,g=e==="backlog"?O.value:$[s]||($[s]=[]);if(l&&!g.includes(r)&&g.push(r),!l){const N=g.indexOf(r);N>=0&&g.splice(N,1)}}function B(){return n.value.find(e=>e.id===C.value)||n.value[0]}function K(){const r=[...i.value,...n.value.flatMap(s=>s.tickets)].map(s=>Number(String(s.key).replace(/[^0-9]/g,""))).filter(s=>!Number.isNaN(s));return`PRJ-${r.length?Math.max(...r)+1:1}`}const{mutate:H}=ot({onSuccess:()=>{Ce.success("Cards moved to sprint successfully")},onError:e=>{Ce.error("Failed to move cards: "+(e.message||"Unknown error"))}});function U(){var s,l;const e=B();if(!e||!O.value.length)return;const r=[],o=[];for(const g of i.value)(O.value.includes(g.id)?o:r).push(g);i.value=r,e.tickets.push(...o),O.value=[],o.length>0&&H({id:e.id,payload:{card_ids:o.map(g=>g.id),priority:((l=(s=o[0])==null?void 0:s.priority)==null?void 0:l.toLowerCase())||"medium",story_points:o.reduce((g,N)=>g+(N.storyPoints||0),0)}})}function P(e){const r=n.value.find(g=>g.id===e);if(!r)return;const o=$[e]||[],s=[],l=[];for(const g of r.tickets)(o.includes(g.id)?l:s).push(g);r.tickets=s,i.value.push(...l),$[e]=[]}function L(e,r){if(e==="backlog")i.value=i.value.filter(o=>!O.value.includes(o.id)),O.value=[];else if(r){const o=$[r]||[],s=n.value.find(l=>l.id===r);if(!s)return;s.tickets=s.tickets.filter(l=>!o.includes(l.id)),$[r]=[]}}function I(e,r){const o={id:Je("T"),key:K(),createdAt:new Date().toISOString(),...r};if(e==="backlog")i.value.push(o);else{const s=B();s==null||s.tickets.push(o)}}function D(e){const r=B();r&&(r.name=e.name??r.name,r.goal=e.goal??r.goal,r.start=e.start??r.start,r.end=e.end??r.end)}function u(){const e=B();e&&(e.started=!e.started)}function a(e){return e.tickets.reduce((r,o)=>r+(o.storyPoints||0),0)}return{backlog:i,sprints:n,activeSprintId:C,selectedBacklogIds:O,selectedSprintIds:$,allBacklogChecked:k,allSprintChecked:_,toggleAll:w,toggleOne:E,getActiveSprint:B,createTicket:I,saveSprintMeta:D,toggleStartSprint:u,sprintPoints:a,moveSelectedToSprint:U,moveSelectedToBacklog:P,deleteSelected:L,priorityClass:dt}}const Kt={class:"space-y-3 flex flex-col overflow-y-auto"},zt={class:"mb-2"},Qt={key:0,class:"empty-state flex flex-col justify-center items-center h-full"},Zt={class:"flex items-center gap-2 text-text-secondary float-start"},Gt={class:"inline-block rounded-full px-2 py-0.5 text-xs"},Jt={class:"truncate"},Wt={key:0,class:"float-end flex justify-center text-gray-500 items-center text-xs aspect-square max-w-6 min-h-6 bg-gray-500/10 rounded-full"},Xt={key:1,class:"float-end w-6 h-6 rounded-full"},Yt=["src"],ea={key:2,class:"float-end text-xs aspect-square max-w-6 flex justify-center items-center min-h-6 bg-accent/30 text-accent border-accent border rounded-full"},ta=["onDragstart"],aa=_e({__name:"BacklogTable",props:{sorters:{}},emits:["ticket-dragged-to-sprint","open-ticket","ticket-moved-to-backlog"],setup(i,{emit:n}){const C=n,{workspaceId:O}=Ye(),{data:$,isPending:k}=Re(O),_=T([]),w=T(!1),E=T(null),B=T("");Q($,u=>{u!=null&&u.cards&&(_.value=u.cards.map(a=>{var l,g,N,p;const e=((l=a.card)==null?void 0:l.variables)??{},r=((g=a.card)==null?void 0:g._id)??a.card_id,o=String(e["card-status"]??"").trim(),s=String(e.priority??"").trim();return{id:r,key:e["card-code"]||(r==null?void 0:r.slice(-6))||"PRJ-?",summary:e["card-title"]||"(untitled)",type:"Story",status:o,assignee:((N=a.card)==null?void 0:N.assigned_to)??"Unassigned",storyPoints:Number(a.story_points??0)||0,priority:U(s),createdAt:((p=a.card)==null?void 0:p.created_at)??new Date().toISOString(),description:e["card-description"]||""}}))},{immediate:!0});const K=V(()=>{if(!B.value)return _.value;const u=B.value.toLowerCase();return _.value.filter(a=>{var e,r;return a.key.toLowerCase().includes(u)||a.summary.toLowerCase().includes(u)||(typeof a.assignee=="string"?a.assignee.toLowerCase().includes(u):(r=(e=a.assignee)==null?void 0:e.u_full_name)==null?void 0:r.toLowerCase().includes(u))})});function H(u){const a=u.toLowerCase();return a.includes("done")||a.includes("complete")?"bg-green-500/10 text-green-500":a.includes("progress")?"bg-gray-amber/10 text-amber-500":"bg-gray-500/10 text-gray-500"}function U(u){const a=String(u??"").toLowerCase();return["highest","blocker","critical"].includes(a)?"Highest":["high","major"].includes(a)?"High":["medium","normal"].includes(a)?"Medium":"Low"}function P(u,a,e){var o;E.value=a.id;const r=JSON.stringify({id:a.id,from:e,ticket:a});(o=u.dataTransfer)==null||o.setData("text/plain",r),u.dataTransfer&&(u.dataTransfer.effectAllowed="move")}function L(u){var a;w.value=!1,((a=u.dataTransfer)==null?void 0:a.dropEffect)!=="none"&&E.value&&(_.value=_.value.filter(e=>e.id!==E.value)),E.value=null}function I(u){var a;u.preventDefault(),w.value=!1;try{const e=(a=u.dataTransfer)==null?void 0:a.getData("text/plain");if(!e)return;const r=JSON.parse(e);if(r.from!=="sprint"||_.value.some(o=>o.id===r.id))return;_.value.push(r.ticket),C("ticket-moved-to-backlog",r.id,r.sprintId)}catch(e){console.error("Drop error:",e)}}const D=V(()=>[{key:"summary",label:"Summary",sortable:!1},{key:"status",label:"Status",width:120,sortable:!1},{key:"assignee",label:"",width:120,sortable:!1}]);return(u,a)=>(f(),S("section",Kt,[t("div",zt,[q(ze,{type:"text",onOnChange:a[0]||(a[0]=e=>B.value=e),placeholder:"Search tickets...",class:"w-[250px]"})]),t("div",{class:G(["rounded-lg border h-[300px] border-border flex flex-col",w.value?"ring-2 ring-blue-400":""]),onDragover:a[5]||(a[5]=we(()=>{},["prevent"])),onDragenter:a[6]||(a[6]=e=>w.value=!0),onDragleave:a[7]||(a[7]=e=>w.value=!1),onDrop:a[8]||(a[8]=e=>I(e))},[!b(k)&&K.value.length===0?(f(),S("div",Qt,a[9]||(a[9]=[t("img",{src:Ot,class:"mb-4",alt:"backlog-plan"},null,-1),t("h6",{class:"text-sm text-text-primary font-semibold mb-1"},"Get started in the backlog",-1),t("p",{class:"text-sm text-text-primary/90 mb-3"},"Plan and start a sprint to see issues here.",-1)]))):(f(),Z(et,{key:1,showHeader:!1,pagination:!1,class:"flex-grow h-full",rowDraggable:!0,onRowDragstart:a[2]||(a[2]=({row:e,$event:r})=>P(r,e,"backlog")),onRowDragend:a[3]||(a[3]=({$event:e})=>L(e)),columns:D.value,rows:K.value,"page-size":20,hover:!0,itemKey:e=>e.id,sorters:u.sorters,onRowClick:a[4]||(a[4]=({row:e})=>u.$emit("open-ticket",e))},{summary:A(({row:e})=>[t("div",Zt,[a[10]||(a[10]=t("img",{src:rt,alt:""},null,-1)),t("span",Gt,F(e.key),1),t("span",Jt,F(e.summary),1)])]),status:A(({row:e})=>[t("span",{class:G([H(e.status),"px-2 py-1 rounded-md"])},F(e.status),3)]),assignee:A(({row:e})=>[(e==null?void 0:e.assignee)==="Unassigned"?(f(),S("span",Wt,"UA")):e!=null&&e.assignee.u_profile_image?(f(),S("div",Xt,[t("img",{src:e.assignee.u_profile_image,alt:""},null,8,Yt)])):(f(),S("span",ea,F(b(tt)(e==null?void 0:e.assignee.u_full_name)),1))]),drag:A(({row:e})=>[t("button",{class:"cursor-grab",title:"Drag to Sprint",draggable:"",onClick:a[1]||(a[1]=we(()=>{},["stop"])),onDragstart:r=>P(r,e,"backlog"),onDragend:L},"↕",40,ta)]),_:1},8,["columns","rows","itemKey","sorters"]))],34)]))}}),sa="data:image/svg+xml,%3csvg%20width='60'%20height='60'%20viewBox='0%200%2060%2060'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20opacity='0.4'%3e%3cpath%20d='M9.375%2030C11.6402%2030%2013.4766%2028.1637%2013.4766%2025.8984C13.4766%2023.6332%2011.6402%2021.7969%209.375%2021.7969C7.10977%2021.7969%205.27344%2023.6332%205.27344%2025.8984C5.27344%2028.1637%207.10977%2030%209.375%2030Z'%20fill='%23AE2A19'/%3e%3cpath%20d='M26.25%2024.375C28.5152%2024.375%2030.3516%2022.5387%2030.3516%2020.2734C30.3516%2018.0082%2028.5152%2016.1719%2026.25%2016.1719C23.9848%2016.1719%2022.1484%2018.0082%2022.1484%2020.2734C22.1484%2022.5387%2023.9848%2024.375%2026.25%2024.375Z'%20fill='%23BF63F3'/%3e%3cpath%20d='M15.3931%2035.8594H11.0159V33.0938C9.93587%2033.3387%208.81469%2033.3387%207.73465%2033.0938V35.8594H1.87528C1.55115%2035.8601%201.2345%2035.9568%200.965283%2036.1373C0.696064%2036.3178%200.486343%2036.574%200.362583%2036.8736C0.238824%2037.1731%200.206573%2037.5027%200.269899%2037.8205C0.333226%2038.1384%200.489292%2038.4304%200.718404%2038.6597L7.05872%2045L0.718404%2051.3403C0.489292%2051.5696%200.333226%2051.8616%200.269899%2052.1795C0.206573%2052.4973%200.238824%2052.8269%200.362583%2053.1264C0.486343%2053.426%200.696064%2053.6822%200.965283%2053.8627C1.2345%2054.0432%201.55115%2054.1399%201.87528%2054.1406H15.3931L21.7503%2045L15.3931%2035.8594Z'%20fill='%2382B536'/%3e%3cpath%20d='M34.4562%2035.8594H27.8937V27.4688C26.8137%2027.7138%2025.6925%2027.7138%2024.6125%2027.4688V35.8594H19.3896L25.7487%2045L19.3896%2054.1406H34.4562L40.8143%2045L34.4562%2035.8594Z'%20fill='%2382B536'/%3e%3cpath%20d='M43.8281%2019.6875H55.3125C55.7475%2019.6873%2056.1647%2019.5143%2056.4723%2019.2067C56.7799%2018.8991%2056.9529%2018.4819%2056.9531%2018.0469V9.375C56.9529%208.93996%2056.7799%208.5228%2056.4723%208.21518C56.1647%207.90755%2055.7475%207.73462%2055.3125%207.73438H43.8281V7.5C43.8281%207.06488%2043.6553%206.64758%2043.3476%206.3399C43.0399%206.03223%2042.6226%205.85938%2042.1875%205.85938C41.7524%205.85938%2041.3351%206.03223%2041.0274%206.3399C40.7197%206.64758%2040.5469%207.06488%2040.5469%207.5V32.5781H43.8281V19.6875Z'%20fill='%23FCA700'/%3e%3cpath%20d='M59.2843%2043.8403L51.7843%2036.3403C51.6322%2036.1878%2051.4514%2036.0668%2051.2524%2035.9842C51.0534%2035.9017%2050.8401%2035.8593%2050.6246%2035.8594H38.4521L44.8121%2045L38.4531%2054.1406H50.6246C50.8401%2054.1407%2051.0534%2054.0983%2051.2524%2054.0158C51.4514%2053.9332%2051.6322%2053.8122%2051.7843%2053.6597L59.2843%2046.1597C59.4368%2046.0075%2059.5577%2045.8267%2059.6402%2045.6277C59.7228%2045.4287%2059.7652%2045.2154%2059.7652%2045C59.7652%2044.7846%2059.7228%2044.5713%2059.6402%2044.3723C59.5577%2044.1733%2059.4368%2043.9925%2059.2843%2043.8403Z'%20fill='%2382B536'/%3e%3c/g%3e%3c/svg%3e",la={class:"rounded-lg flex flex-col"},na={class:"mb-2"},ra=["checked"],oa=["checked","onChange"],ia={class:"flex items-center gap-2 text-text-secondary float-start"},da={class:"inline-block rounded-full px-2 py-0.5 text-xs"},ua={class:"truncate"},ca={key:0,class:"float-end flex justify-center text-gray-500 items-center text-xs aspect-square max-w-6 min-h-6 bg-gray-500/10 rounded-full"},pa={key:1,class:"w-6 h-6 rounded-full"},ma=["src"],fa={key:2,class:"text-xs aspect-square max-w-6 flex justify-center items-center min-h-6 bg-accent/30 text-accent border-accent border rounded-full"},va=["onDragstart"],ga={key:1,class:"empty-state flex flex-col h-full justify-center items-center border-dashed border border-border"},ba=_e({__name:"SprintCard",props:{sprint:{},sprintId:{}},emits:["edit-sprint","toggle-start","open-ticket","move-selected-to-backlog","delete-selected-sprint","refresh"],setup(i,{emit:n}){const C=i,O=n,$=ut(),{selectedSprintIds:k,allSprintChecked:_,toggleAll:w,toggleOne:E}=$,B=T([]);Q(()=>C.sprint.tickets,o=>{B.value=[...o||[]]},{immediate:!0,deep:!0});const K=T(""),H=V(()=>{if(!K.value)return B.value;const o=K.value.toLowerCase();return B.value.filter(s=>{var l;return s.key.toLowerCase().includes(o)||s.summary.toLowerCase().includes(o)||(((l=s.assignee)==null?void 0:l.u_full_name)??"").toLowerCase().includes(o)})}),U=T(!1),P=T(null),{mutate:L}=ot({onSuccess:()=>{Ce.success("Card moved to sprint successfully"),O("refresh")},onError:o=>{Ce.error("Failed to move card: "+(o.message||"Unknown error"))}});function I(o,s,l,g){var p;P.value=s.id;const N=JSON.stringify({id:s.id,from:l,sprintId:g,ticket:s});(p=o.dataTransfer)==null||p.setData("text/plain",N),o.dataTransfer&&(o.dataTransfer.effectAllowed="move")}function D(o){var s;U.value=!1,((s=o.dataTransfer)==null?void 0:s.dropEffect)!=="none"&&P.value&&(B.value=B.value.filter(l=>l.id!==P.value)),P.value=null}function u(){U.value=!0}function a(){U.value=!1}function e(o){var s;o.preventDefault(),U.value=!1;try{const l=(s=o.dataTransfer)==null?void 0:s.getData("text/plain");if(!l)return;const g=JSON.parse(l);if(g.from!=="backlog"||B.value.some(N=>N.id===g.id))return;B.value.push(g.ticket),L({id:C.sprintId,payload:{card_ids:[g.ticket.id],priority:g.ticket.priority.toLowerCase(),story_points:g.ticket.storyPoints||0}})}catch(l){console.error("Drop error:",l)}}const r=[{key:"summary",label:"Summary",sortable:!0},{key:"status",label:"Status",width:120,sortable:!0},{key:"assignee",label:"Assignee",width:120,sortable:!0}];return(o,s)=>(f(),S("div",la,[t("div",na,[q(ze,{type:"text",onOnChange:s[0]||(s[0]=l=>K.value=l),placeholder:"Search tickets...",class:"w-[250px]"})]),t("div",{class:G(["h-[300px]",U.value?"ring-2 ring-blue-400 rounded-lg":""]),onDragover:s[6]||(s[6]=we(()=>{},["prevent"])),onDragenter:u,onDragleave:a,onDrop:e},[H.value.length>0?(f(),Z(et,{key:0,showHeader:!1,pagination:!1,"row-draggable":!0,class:"h-full",columns:r,rows:H.value,"page-size":100,hover:!0,"item-key":l=>l.id,onRowDragstart:s[3]||(s[3]=({row:l,$event:g})=>I(g,l,"sprint",o.sprint.id)),onRowDragend:s[4]||(s[4]=({$event:l})=>D(l)),onRowClick:s[5]||(s[5]=({row:l})=>o.$emit("open-ticket",l))},{"select-header":A(()=>[t("input",{type:"checkbox",checked:b(_)(o.sprint.id),onChange:s[1]||(s[1]=l=>b(w)("sprint",l,o.sprint.id))},null,40,ra)]),select:A(({row:l})=>[t("input",{type:"checkbox",checked:(b(k)[o.sprint.id]||[]).includes(l.id),onChange:g=>b(E)("sprint",l.id,g,o.sprint.id)},null,40,oa)]),summary:A(({row:l})=>[t("div",ia,[s[7]||(s[7]=t("img",{src:rt,alt:""},null,-1)),t("span",da,F(l.key),1),t("span",ua,F(l.summary),1)])]),status:A(({row:l})=>[t("span",{class:G([b(gt)(l.status),"px-2 py-1 rounded-md"])},F(l.status),3)]),assignee:A(({row:l})=>[(l==null?void 0:l.assignee)=="Unassigned"?(f(),S("span",ca,"UA")):l.assignee.u_profile_image?(f(),S("div",pa,[t("img",{src:l.assignee.u_profile_image,alt:""},null,8,ma)])):(f(),S("span",fa,F(b(tt)(l.assignee.u_full_name??"")),1))]),priority:A(({row:l})=>[t("span",{class:G(b(dt)(l.priority))},F(l.priority),3)]),drag:A(({row:l})=>[t("button",{class:"cursor-grab",title:"Drag to Backlog",draggable:"",onClick:s[2]||(s[2]=we(()=>{},["stop"])),onDragstart:g=>I(g,l,"sprint",o.sprint.id),onDragend:D},"↕",40,va)]),_:1},8,["rows","item-key"])):(f(),S("div",ga,s[8]||(s[8]=[bt('<img src="'+sa+'" class="mb-4" alt="backlog-plan"><h6 class="text-sm text-text-primary font-semibold mb-1 text-center">Plan your sprint</h6><p class="text-sm text-text-primary/90 mb-3 max-w-120 text-center"> Drag work items from the <span class="font-bold">Backlog</span> section or create new ones to plan the work for this sprint. Select <span class="font-bold">Start sprint</span> when you&#39;re ready. </p>',3)])))],34)]))}}),ya={class:"px-6 gap-4"},ka={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},xa=_e({__name:"SprintModal",props:{modelValue:{type:Boolean,default:!1},sprint:{},creatingSprint:{type:Boolean}},emits:["update:modelValue","save","close"],setup(i,{emit:n}){const C=n,O=i,$=V({get:()=>O.modelValue,set:U=>C("update:modelValue",U)}),k=ke({name:""}),_=ke({name:!1}),w=V(()=>_.name&&!String(k.name||"").trim()?"Name is required":""),E=V(()=>!!String(k.name||"").trim()&&!w.value);function B(){$.value=!1,C("close")}function K(){_.name=!0,E.value&&C("save",{name:String(k.name||"").trim()})}function H(){_.name=!1}return Q(()=>O.sprint,U=>{if(!U){k.name="";return}k.name=U.name??(U==null?void 0:U.title)??"",H()},{immediate:!0}),(U,P)=>(f(),Z(je,{modelValue:$.value,"onUpdate:modelValue":P[2]||(P[2]=L=>$.value=L),modalClass:"!py-0",size:"md"},{default:A(()=>[P[5]||(P[5]=t("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[t("h2",{class:"text-xl font-semibold"},"Add Sprint"),t("p",{class:"text-sm text-text-secondary mt-1"},[J(" Add sprint name and then click "),t("span",{class:"font-medium"},"Save"),J(". ")])],-1)),t("div",ya,[q(at,{modelValue:k.name,"onUpdate:modelValue":P[0]||(P[0]=L=>k.name=L),label:"Name",placeholder:"Sprint 1",error:!!w.value,message:w.value,onBlur:P[1]||(P[1]=L=>_.name=!0)},null,8,["modelValue","error","message"]),P[3]||(P[3]=t("div",null,null,-1))]),t("div",ka,[q(oe,{variant:"secondary",onClick:B},{default:A(()=>P[4]||(P[4]=[J("Cancel")])),_:1,__:[4]}),q(oe,{variant:"primary",disabled:!E.value,onClick:K},{default:A(()=>[J(F(U.creatingSprint?"Saving...":"Save"),1)]),_:1},8,["disabled"])])]),_:1,__:[5]},8,["modelValue"]))}}),_a={class:"px-6 grid grid-cols-2 gap-4"},ha={class:"flex gap-1 flex-col"},Sa={key:0,class:"text-xs text-red-500"},Ca={class:"flex gap-1 flex-col"},wa={key:0,class:"text-xs text-red-500"},Da={class:"flex flex-col col-span-2"},Va={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},Ta=_e({__name:"StartSprintModal",props:{modelValue:{type:Boolean,default:!1},sprint:{},creatingSprint:{type:Boolean}},emits:["update:modelValue","save","close"],setup(i,{emit:n}){const C=n,O=i,$=V({get:()=>O.modelValue,set:D=>C("update:modelValue",D)}),k=ke({goal:"",start:"",end:""});Q(()=>O.sprint,D=>{D&&(k.goal=D.goal??"",k.start=D.start??"",k.end=D.end??"",L())},{immediate:!0});const _=ke({start:!1,end:!1}),w=V(()=>!k.start&&_.start?"Start date is required":""),E=V(()=>{if(!k.end&&_.end)return"End date is required";if(k.start&&k.end){const D=I(k.start),u=I(k.end);if(Number.isFinite(D)&&Number.isFinite(u)&&u<D)return"End date cannot be before start date"}return""}),B=V(()=>!w.value&&!E.value);function K(D){k.start=D||"",_.start=!0}function H(D){k.end=D||"",_.end=!0}function U(){$.value=!1,C("close")}function P(){_.start=!0,_.end=!0,B.value&&C("save",{goal:k.goal??"",start:k.start||"",end:k.end||""})}function L(){_.start=!1,_.end=!1}function I(D){return D?new Date(`${D}T00:00:00`).getTime():NaN}return(D,u)=>(f(),Z(je,{modelValue:$.value,"onUpdate:modelValue":u[1]||(u[1]=a=>$.value=a),modalClass:"!py-0",size:"md"},{default:A(()=>[u[6]||(u[6]=t("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[t("h2",{class:"text-xl font-semibold"},"Start Sprint"),t("p",{class:"text-sm text-text-secondary mt-1"},[J(" Update sprint name, goal, and dates, then click "),t("span",{class:"font-medium"},"Start"),J(". ")])],-1)),t("div",_a,[t("div",ha,[u[2]||(u[2]=t("label",{class:"text-sm"},"Start date",-1)),t("div",{class:G(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",w.value?"border-red-500":""])},[q(Ie,{placeholder:"Set start date",class:"w-full","model-value":k.start,"emit-as":"ymd","onUpdate:modelValue":K},null,8,["model-value"])],2),w.value?(f(),S("p",Sa,F(w.value),1)):W("",!0)]),t("div",Ca,[u[3]||(u[3]=t("label",{class:"text-sm"},"End date",-1)),t("div",{class:G(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",E.value?"border-red-500":""])},[q(Ie,{placeholder:"Set end date",class:"w-full","model-value":k.end,"emit-as":"ymd","onUpdate:modelValue":H},null,8,["model-value"])],2),E.value?(f(),S("p",wa,F(E.value),1)):W("",!0)]),t("div",Da,[u[4]||(u[4]=t("label",{class:"text-sm"},"Goal (optional)",-1)),He(t("textarea",{"onUpdate:modelValue":u[0]||(u[0]=a=>k.goal=a),class:"w-full rounded-lg border border-border px-3 py-2 bg-bg-input",rows:"2",placeholder:"Ship onboarding flow"},null,512),[[yt,k.goal]])])]),t("div",Va,[q(oe,{variant:"secondary",onClick:U},{default:A(()=>u[5]||(u[5]=[J("Cancel")])),_:1,__:[5]}),q(oe,{variant:"primary",disabled:!B.value,onClick:P},{default:A(()=>[J(F(D.creatingSprint?"Starting...":"Start"),1)]),_:1},8,["disabled"])])]),_:1,__:[6]},8,["modelValue"]))}}),$a={class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},La={class:"text-sm text-text-secondary mt-1"},Ma={class:"flex items-center gap-2 mt-4 w-full"},Ba={class:"flex items-center gap-2 flex-1"},Ea={class:"px-6 min-h-[400px]"},Pa={key:0},Oa={key:0,class:"flex items-center justify-center py-12"},Ua={key:1,class:"text-center py-12 text-text-secondary"},Aa={key:2,class:"grid grid-cols-2 gap-3"},qa=["onClick"],Fa={class:"flex items-center gap-3"},Ia={class:"w-10 h-10 rounded-lg bg-bg-input flex items-center justify-center group-hover:bg-primary/10 transition-colors"},Ha={class:"font-medium"},Na={key:1},Ra={key:0,class:"flex items-center justify-center py-12"},ja={key:1,class:"text-center py-12 text-text-secondary"},Ka={key:2,class:"grid grid-cols-2 gap-3"},za=["onClick"],Qa={class:"flex items-center gap-3"},Za={class:"w-10 h-10 rounded-lg bg-bg-input flex items-center justify-center group-hover:bg-primary/10 transition-colors"},Ga={class:"font-medium"},Ja={key:2},Wa={class:"grid grid-cols-2 gap-4"},Xa={key:0,class:"flex flex-col"},Ya={class:"flex gap-1 flex-col"},es={key:0,class:"text-xs text-red-500"},ts={class:"flex gap-1 flex-col"},as={key:0,class:"text-xs text-red-500"},ss={class:"mt-4"},ls={key:0,class:"text-xs text-red-500 mt-1 px-1"},ns={class:"flex justify-between gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},rs={key:1},os={class:"flex gap-2"},is=_e({__name:"CreateBacklogTicketWithModuleSelection",props:{modelValue:{type:Boolean,default:!1},listId:{},selectedVariable:{}},emits:["update:modelValue","created"],setup(i,{emit:n}){const C=n,O=i,$=Ke(),{workspaceId:k}=st(),_=T(1),w=T(null),E=T(null),{data:B,isLoading:K}=kt(k.value),H=V(()=>{var d;return((d=B.value)==null?void 0:d.modules)||[]}),{data:U,isFetching:P,refetch:L}=lt({workspace_module_id:w,workspace_id:k},{enabled:V(()=>!!w.value)});Q(()=>w.value,()=>{L()});const I=V(()=>U.value||[]),{data:D}=xt(k.value),{data:u}=nt(k.value,w,{enabled:V(()=>!!w.value)}),{mutate:a,isPending:e}=_t({onSuccess:()=>{he(),$.invalidateQueries({queryKey:["sheet-list"]}),$.invalidateQueries({queryKey:["backlog-list"]}),r.value=!1}}),r=V({get:()=>O.modelValue,set:d=>C("update:modelValue",d)}),o=V(()=>{switch(_.value){case 1:return"Select a module to create the ticket in";case 2:return"Select a sheet within the module";case 3:return"Provide the ticket details below and click Add Ticket";default:return""}}),s=V(()=>((u==null?void 0:u.value)??[]).filter(d=>{var v;return((v=d==null?void 0:d.type)==null?void 0:v.title)==="Select"})),l=d=>d.map(v=>({_id:v,title:v})),g=V(()=>((D==null?void 0:D.value)??[]).map(d=>{var v;return{_id:d._id,title:((v=d==null?void 0:d.variables)==null?void 0:v["lane-title"])??String(d._id)}})),N=d=>d.slug,p=ke({title:"",description:"",startDate:null,endDate:null,lane_id:null,variables:{}});Q(s,d=>{for(const v of d){const c=N(v);c in p.variables||(p.variables[c]=null)}},{immediate:!0});const x=ke({title:!1,description:!1,startDate:!1,endDate:!1,lane:!1}),ie=V(()=>!!p.title.trim()&&!!p.lane_id&&!!p.startDate&&!!p.endDate&&!ne.value&&!re.value&&!ue.value&&!fe.value&&!h.value);function me(d){p.startDate=d,x.startDate=!0}function de(d){p.endDate=d,x.endDate=!0}function De(d){p.lane_id=d,x.lane=!0}function se(d){w.value=d._id,_.value=2}function X(d){E.value=d._id,_.value=3}function ae(){_.value>1&&_.value--}function le(){r.value=!1,he()}function he(){_.value=1,w.value=null,E.value=null,p.title="",p.description="",p.startDate=null,p.endDate=null,p.lane_id=null,p.variables={},x.title=!1,x.description=!1,x.startDate=!1,x.endDate=!1,x.lane=!1}const Ve=V(()=>{var d;return(d=u==null?void 0:u.value)==null?void 0:d.find(v=>(v==null?void 0:v._id)==O.selectedVariable)}),ne=V(()=>x.title&&!p.title.trim()?"Title is required":""),re=V(()=>x.startDate?p.startDate?"":"Start date is required":""),ue=V(()=>x.endDate?p.endDate?p.startDate&&p.endDate&&p.endDate<p.startDate?"End date cannot be before start date":"":"End date is required":""),fe=V(()=>x.lane?p.lane_id?"":"Lane is required":""),h=V(()=>x.description&&!p.description.trim()?"Description is required":"");function M(){var v;if(x.title=!0,x.lane=!0,x.description=!0,x.startDate=!0,x.endDate=!0,!ie.value||e.value)return;const d={sheet_list_id:O.listId,workspace_id:k.value,sheet_id:E.value,workspace_lane_id:p.lane_id,variables:{...p.variables,[`${(v=Ve.value)==null?void 0:v.slug}`]:O.listId,"card-title":p.title.trim(),"card-description":p.description.trim(),"start-date":p.startDate,"end-date":p.endDate},createdAt:new Date().toISOString()};a(d)}return Q(()=>p.title,d=>{d!=null&&d.trim()&&x.title&&(x.title=!1)}),Q(()=>p.lane_id,d=>{d&&x.lane&&(x.lane=!1)}),Q(()=>p.startDate,d=>{d&&x.startDate&&(x.startDate=!1)}),Q(()=>p.endDate,d=>{d&&x.endDate&&(x.endDate=!1)}),Q(()=>p.description,d=>{d!=null&&d.trim()&&x.description&&(x.description=!1)}),(d,v)=>(f(),Z(je,{modelValue:r.value,"onUpdate:modelValue":v[4]||(v[4]=c=>r.value=c),modalClass:"!py-0",size:"lg"},{default:A(()=>[t("div",$a,[v[5]||(v[5]=t("h2",{class:"text-xl font-semibold"},"Create Backlog Ticket",-1)),t("p",La,F(o.value),1),t("div",Ma,[(f(),S(Se,null,Ae(3,c=>t("div",{key:c,class:"flex items-center flex-1"},[t("div",Ba,[t("div",{class:G(["h-1 flex-1 rounded-full transition-colors",_.value>=c?"bg-primary":"bg-border"])},null,2)])])),64))])]),t("div",Ea,[_.value===1?(f(),S("div",Pa,[v[7]||(v[7]=t("h3",{class:"text-lg font-medium mb-4"},"Select Module",-1)),b(K)?(f(),S("div",Oa,v[6]||(v[6]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)]))):!H.value||H.value.length===0?(f(),S("div",Ua," No modules available ")):(f(),S("div",Aa,[(f(!0),S(Se,null,Ae(H.value,c=>{var Y,ee,j,ve,ge;return f(),S("button",{key:c._id,onClick:Te=>se(c),class:G(["p-4 border rounded-lg hover:border-primary transition-all text-left group",w.value===c._id?"border-primary bg-primary/5":"border-border"])},[t("div",Fa,[t("div",Ia,[t("i",{class:G([`${(ee=(Y=c==null?void 0:c.variables)==null?void 0:Y["module-icon"])==null?void 0:ee.prefix} ${(ve=(j=c==null?void 0:c.variables)==null?void 0:j["module-icon"])==null?void 0:ve.iconName}`,"text-lg"])},null,2)]),t("div",null,[t("p",Ha,F(((ge=c.variables)==null?void 0:ge["module-title"])||"Untitled"),1)])])],10,qa)}),128))]))])):_.value===2?(f(),S("div",Na,[v[9]||(v[9]=t("h3",{class:"text-lg font-medium mb-4"},"Select Sheet",-1)),b(P)?(f(),S("div",Ra,v[8]||(v[8]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)]))):!I.value||I.value.length===0?(f(),S("div",ja," No sheets available for this module ")):(f(),S("div",Ka,[(f(!0),S(Se,null,Ae(I.value,c=>{var Y,ee;return f(),S("button",{key:c._id,onClick:j=>X(c),class:G(["p-4 border rounded-lg hover:border-primary transition-all text-left group",E.value===c._id?"border-primary bg-primary/5":"border-border"])},[t("div",Qa,[t("div",Za,[t("i",{class:G(`${(Y=c==null?void 0:c.variables["sheet-icon"])==null?void 0:Y.prefix} ${(ee=c==null?void 0:c.variables["sheet-icon"])==null?void 0:ee.iconName} text-lg`)},null,2)]),t("div",null,[t("p",Ga,F((c==null?void 0:c.variables["sheet-title"])||"Untitled Sheet"),1)])])],10,za)}),128))]))])):_.value===3?(f(),S("div",Ja,[v[12]||(v[12]=t("h3",{class:"text-lg font-medium mb-4"},"Ticket Details",-1)),t("div",Wa,[q(at,{modelValue:p.title,"onUpdate:modelValue":v[0]||(v[0]=c=>p.title=c),label:"Ticket Title",placeholder:"e.g., Implement real-time notifications",error:!!ne.value,message:ne.value,onBlur:v[1]||(v[1]=c=>x.title=!0)},null,8,["modelValue","error","message"]),g.value.length>0?(f(),S("div",Xa,[q(Ze,{size:"md",label:"Lane",options:g.value,placeholder:"Select lane",allowCustom:!1,"model-value":p.lane_id,"onUpdate:modelValue":De,error:!!fe.value,message:fe.value},null,8,["options","model-value","error","message"])])):W("",!0),(f(!0),S(Se,null,Ae(s.value,c=>He((f(),Z(Ze,{size:"md",key:N(c),modelValue:p.variables[c.slug],"onUpdate:modelValue":Y=>p.variables[c.slug]=Y,options:l(c.data),label:c.title,placeholder:"Select value",allowCustom:!0},null,8,["modelValue","onUpdate:modelValue","options","label"])),[[Ne,(c==null?void 0:c._id)!=d.selectedVariable]])),128)),t("div",Ya,[v[10]||(v[10]=t("label",{class:"text-sm"},"Start date",-1)),t("div",{class:G(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",re.value?"border-red-500":""])},[q(Ie,{placeholder:"Set start date",class:"w-full","model-value":p.startDate,"emit-as":"ymd","onUpdate:modelValue":me},null,8,["model-value"])],2),re.value?(f(),S("p",es,F(re.value),1)):W("",!0)]),t("div",ts,[v[11]||(v[11]=t("label",{class:"text-sm"},"End date",-1)),t("div",{class:G(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",ue.value?"border-red-500":""])},[q(Ie,{placeholder:"Set end date",class:"w-full","model-value":p.endDate,"emit-as":"ymd","onUpdate:modelValue":de},null,8,["model-value"])],2),ue.value?(f(),S("p",as,F(ue.value),1)):W("",!0)])]),t("div",ss,[q(ht,{label:"Description",placeholder:"What needs to be done, acceptance criteria, links…",modelValue:p.description,"onUpdate:modelValue":v[2]||(v[2]=c=>p.description=c),onBlur:v[3]||(v[3]=c=>x.description=!0)},null,8,["modelValue"]),h.value?(f(),S("p",ls,F(h.value),1)):W("",!0)])])):W("",!0)]),t("div",ns,[_.value>1?(f(),Z(oe,{key:0,variant:"secondary",onClick:ae},{default:A(()=>v[13]||(v[13]=[J("Back")])),_:1,__:[13]})):(f(),S("div",rs)),t("div",os,[q(oe,{variant:"secondary",onClick:le},{default:A(()=>v[14]||(v[14]=[J("Cancel")])),_:1,__:[14]}),_.value===3?(f(),Z(oe,{key:0,variant:"primary",disabled:!ie.value||b(e),onClick:M},{default:A(()=>[J(F(b(e)?"Adding…":"Add Ticket"),1)]),_:1},8,["disabled"])):W("",!0)])])]),_:1},8,["modelValue"]))}}),ds={class:"flex gap-2 flex-auto overflow-y-auto"},us={class:"flex-auto bg-gradient-to-b from-bg-card/95 to-bg-card/90 backdrop-blur rounded-2xl shadow-[0_10px_40px_-10px_rgba(0,0,0,.5)] flex-grow h-full bg-bg-card border border-border overflow-x-auto flex"},cs={class:"flex overflow-x-auto gap-3 p-4"},ps={key:0,class:"mx-auto text-text-secondary/80 m-2 w-[90%] h-full justify-center flex items-center border border-dashed border-border"},ms=_e({__name:"ActiveSprint",props:{sptint_id:{},searchQuery:{}},setup(i){const n=i,C=qe(()=>Fe(()=>import("./CreateTaskModal-CdreadMb.js"),__vite__mapDeps([0,1,2,3]))),O=qe(()=>Fe(()=>import("./ConfirmDeleteModal-S1OH6ECx.js"),__vite__mapDeps([4,5,2,3]))),$=qe(()=>Fe(()=>import("./SidePanel-jJvMe-xA.js"),__vite__mapDeps([6,2,3,7]))),k=qe(()=>Fe(()=>import("./KanbanBoard-BZzOqsCN.js"),__vite__mapDeps([8,9,2,3,5,10,11,12,13]))),_=Dt(),{workspaceId:w,moduleId:E}=st(),{data:B}=nt(w.value,E.value),K=Ke(),{mutate:H,isPending:U}=St({onSuccess:()=>{K.invalidateQueries({queryKey:["sheet-list"]}),De.value="",X.value=!1,de.value=!1,X.value=!1}}),P=h=>{H({workspace_id:w.value,module_id:E.value,variable_id:a.value,value:h})},{data:L}=lt({workspace_id:w,workspace_module_id:E}),I=V(()=>{var h;return L.value?(h=L.value[0])==null?void 0:h._id:""}),D=T(I),u=V(()=>{var h;return B.value?(h=B.value[0])==null?void 0:h._id:""}),a=T(u),e=Et(),r=V(()=>n.sptint_id),{data:o,isPending:s}=qt(r),l=T(!1),g=T(),N=h=>{g.value=h},p=Ct(),x=wt();function ie(h){h.type=="column"?p.mutate({payload:{workspace_id:w.value,workspace_module_id:E.value,variable_id:a.value,moved_value:h.meta.id,new_index:h.meta.newIndex}}):x.mutate({payload:{workspace_id:w.value,card_id:h.meta.moved._id,group_value:h.meta.fromColumnId,group_variable_id:a.value,new_index:h.meta.newIndex,sheet_id:D.value}})}const me=h=>{};Q(L,h=>{var M;(h==null?void 0:h.length)>0&&(D.value=(M=h[0])==null?void 0:M._id)});const de=T(!1),De=T(""),se=h=>{H({workspace_id:_.params.id,module_id:_.params.module_id,new_value:h.title,value:h.oldTitle,variable_id:a.value})},X=T(!1),ae=T(),le=()=>{H({value:ae.value.title,workspace_id:w.value,module_id:E.value,newValue:ae.value.title,variable_id:a.value,is_trash:!0})},he=h=>{X.value=!0,ae.value=h},Ve=h=>{l.value=!0,ae.value=h},ne=V(()=>n.searchQuery),re=T("");Q(ne,Tt.debounce(h=>{re.value=h},200));const ue=V(()=>{const h=o.value.flatMap(M=>M.cards.map(d=>({...d,columnId:M.title})));return new $t(h,{keys:["card-title","card-description","card-key"],threshold:.3})}),fe=V(()=>{if(!ne.value)return o.value;const h=ue.value.search(ne.value).map(M=>M.item);return o.value.map(M=>({...M,cards:h.filter(d=>d.columnId===M.title)}))});return(h,M)=>{var d,v,c,Y,ee;return f(),S("div",ds,[t("div",us,[He(q(Lt,null,null,512),[[Ne,b(s)]]),He(t("div",cs,[q(b(k),{onOnPlus:Ve,"onDelete:column":M[0]||(M[0]=j=>he(j)),"onUpdate:column":M[1]||(M[1]=j=>se(j)),onReorder:ie,onAddColumn:P,"onSelect:ticket":N,board:fe.value,onOnBoardUpdate:me,variable_id:a.value,sheet_id:D.value},{"column-footer":A(j=>{var ve,ge,Te,Oe,Ue;return[(ge=(ve=b(e))==null?void 0:ve.transitions)!=null&&ge.all_allowed&&!((Ue=(Oe=(Te=b(e))==null?void 0:Te.transitions)==null?void 0:Oe.all_allowed)!=null&&Ue.includes(j.column.title))&&b(e).transitions.currentColumn!=j.column.title?(f(),S("div",ps," Disbale ( you can't drop here )")):W("",!0)]}),ticket:A(({ticket:j})=>[q(Pt,{selectedVar:a.value,onSelect:()=>{N(j)},ticket:j},null,8,["selectedVar","onSelect","ticket"])]),_:1},8,["board","variable_id","sheet_id"])],512),[[Ne,!b(s)]])]),q(b(O),{onClick:M[2]||(M[2]=we(()=>{},["stop"])),modelValue:X.value,"onUpdate:modelValue":M[3]||(M[3]=j=>X.value=j),title:"Delete List",itemLabel:"list",itemName:(d=ae.value)==null?void 0:d.title,requireMatchText:(v=ae.value)==null?void 0:v.title,confirmText:"Delete workspace",cancelText:"Cancel",size:"md",loading:b(U),onConfirm:le,onCancel:M[4]||(M[4]=()=>{X.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),l.value?(f(),Z(b(C),{selectedVariable:a.value,listId:(c=ae.value)==null?void 0:c.title,sheet_id:D.value,key:"createTaskModalKey",modelValue:l.value,"onUpdate:modelValue":M[5]||(M[5]=j=>l.value=j),onSubmit:M[6]||(M[6]=()=>{})},null,8,["selectedVariable","listId","sheet_id","modelValue"])):W("",!0),(Y=g.value)!=null&&Y._id?(f(),Z(b($),{key:1,details:g.value,onClose:M[7]||(M[7]=()=>{N({variables:{}})}),showPanel:!!((ee=g.value)!=null&&ee._id)},null,8,["details","showPanel"])):W("",!0)])}}}),fs={class:"flex-auto flex-grow h-full bg-bg-card rounded-lg border border-border overflow-x-auto flex-col flex"},vs={class:"header px-4 py-3 border-b border-border flex items-center justify-between gap-1"},gs={class:"flex gap-3 items-center"},bs={key:1,class:"space-y-6 p-4 w-full flex-auto overflow-y-auto"},ys={class:"flex flex-col gap-6"},ks={class:"space-y-4 bg-bg-surface/30 p-4 rounded-md"},xs={class:"flex items-center justify-between"},_s={class:"text-sm font-semibold"},hs={key:0,class:"w-full h-full min-h-[250px] flex justify-center items-center"},Ss={class:"space-y-4 bg-bg-surface/30 p-4 rounded-md"},Cs={class:"flex items-center justify-between"},ws={class:"text-sm font-semibold"},Ds={key:0,class:"w-full h-full min-h-[250px] flex justify-center items-center"},Ps=_e({__name:"Plan",setup(i){const n=T(!1),C=T(""),O=()=>{n.value=!1},{workspaceId:$}=Ye(),k=T(!1),{moveSelectedToSprint:_,moveSelectedToBacklog:w,deleteSelected:E,saveSprintMeta:B,toggleStartSprint:K}=ut(),{data:H}=Re($),{mutate:U,isPending:P}=Rt({onSuccess:()=>{ee.invalidateQueries({queryKey:["sprint-list"]}),I.value=!1}}),L=T(null),I=T(!1),D=()=>{var y;U((y=L.value)==null?void 0:y._id)},{mutate:u,isPending:a}=Ge({onSuccess:y=>{B({name:y.title}),e({id:x.value}),de.value=!1}}),{mutate:e,isPending:r}=Nt({onSuccess:()=>{me()}}),o=y=>{console.log("helo",L.value,y),u({id:x.value,payload:{goal:y.goal,start_date:y.start,end_date:y.end}})},{data:s,refetch:l}=Ut($.value),{refetch:g,isPending:N}=Re($),p=V(()=>{var y,m;return(m=(y=s==null?void 0:s.value)==null?void 0:y.sprints[0])==null?void 0:m._id}),x=T(p.value);Q(()=>p.value,y=>{x.value=y});const{data:ie,refetch:me}=It(p),de=T(!1),De=()=>{de.value=!0},{data:se,isPending:X,refetch:ae}=At(x);Q(()=>X.value,y=>{console.log(y,X.value,">>>> laoding state changes")});const le=V(()=>{var be,ce;const y=(be=se==null?void 0:se.value)==null?void 0:be.backlog_items;if(!y)return null;const m=(((ce=se==null?void 0:se.value)==null?void 0:ce.backlog_items)||[]).map(R=>{var $e,Le,Me,Be,Ee;const pe=(($e=R==null?void 0:R.card)==null?void 0:$e.variables)||{},ye=((Le=R==null?void 0:R.card)==null?void 0:Le._id)||R.card_id;return{id:ye,key:pe["card-code"]||(ye==null?void 0:ye.slice(-6))||"PRJ-?",summary:pe["card-title"]||"(untitled)",type:"Story",status:he(String(pe["card-status"]||"").trim()),assignee:((Be=(Me=R==null?void 0:R.card)==null?void 0:Me.assigned_to)==null?void 0:Be.name)||"Unassigned",storyPoints:Number(R.story_points||0),priority:Ve(String(pe.priority||"").trim()),createdAt:((Ee=R==null?void 0:R.card)==null?void 0:Ee.created_at)||new Date().toISOString(),description:pe["card-description"]||""}});return{id:y._id,name:y.title||"Sprint 1",title:y.title,goal:"",start:"",end:"",started:!1,tickets:m}});function he(y){const m=y.toLowerCase();return m.includes("progress")?"In Progress":m.includes("done")||m.includes("complete")?"Done":"Todo"}function Ve(y){const m=y.toLowerCase();return m==="highest"||m==="blocker"||m==="critical"?"Highest":m==="high"||m==="major"?"High":m==="medium"||m==="normal"?"Medium":"Low"}const{mutate:ne}=jt({onSuccess:()=>{Ce.success("Card removed from sprint successfully"),re()},onError:y=>{Ce.error("Failed to remove card from sprint"),console.error("Failed to remove card from sprint:",y)}});function re(){ae(),l(),g(),me()}function ue(y){console.log(">>> moving back to backlog"),x&&ne({sprintId:x,cardId:y})}const fe={createdAt:(y,m,be)=>{const ce=new Date(y.createdAt).getTime(),R=new Date(m.createdAt).getTime();return be==="asc"?ce-R:R-ce}},h=T(!1),M=T(null);function d(){k.value=!0,M.value=null}function v(y){M.value=y,n.value=!0,h.value=!0}const c=T(!1);function Y(){c.value=!0}const ee=Ke(),{mutate:j,isPending:ve}=Ht({onSuccess:y=>{B({name:y.title}),ee.invalidateQueries({queryKey:["sprint-list"]}),c.value=!1}}),{mutate:ge,isPending:Te}=Ge({onSuccess:y=>{B({name:y.title}),ee.invalidateQueries({queryKey:["sprint-list"]}),c.value=!1}});function Oe(y){var m;L.value?ge({id:(m=L.value)==null?void 0:m._id,payload:{workspace_id:$.value,title:y.name}}):j({payload:{workspace_id:$.value,title:y.name}})}function Ue(){L.value=null,console.log(">>> felo"),c.value=!0}function ct(y){L.value=y,c.value=!0}function pt(y){L.value=y,I.value=!0}const{mutate:mt,isPending:ft}=Ft(x,{onSuccess:()=>{me()}}),vt=()=>{mt({})};return(y,m)=>{var be,ce,R,pe,ye,$e,Le,Me,Be,Ee,Qe;return f(),S(Se,null,[t("div",fs,[t("div",vs,[q(Mt,{prefix:"View By",modelValue:x.value,"onUpdate:modelValue":m[1]||(m[1]=z=>x.value=z),options:(be=b(s))==null?void 0:be.sprints,variant:"secondary",onEditOption:ct,onDeleteOption:pt},{more:A(()=>[t("div",{onClick:m[0]||(m[0]=z=>Ue()),class:"capitalize border-t border-border px-4 py-2 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-1 overflow-hidden overflow-ellipsis text-nowrap"},m[12]||(m[12]=[t("i",{class:"fa-solid fa-plus"},null,-1),J(" Add new ")]))]),_:1},8,["modelValue","options"]),t("div",gs,[((ce=b(ie))==null?void 0:ce.status)=="active"?(f(),Z(ze,{key:0,placeholder:"Search in Orchit AI space",onOnChange:m[2]||(m[2]=z=>{C.value=z})})):W("",!0),((R=b(ie))==null?void 0:R.status)=="active"?(f(),Z(oe,{key:1,size:"sm",onClick:vt},{default:A(()=>[J(F(b(ft)?"Ending...":"End"),1)]),_:1})):(f(),Z(oe,{key:2,size:"sm",onClick:De,disabled:!le.value||le.value.tickets.length==0},{default:A(()=>m[13]||(m[13]=[J("Start Sprint")])),_:1,__:[13]},8,["disabled"]))])]),((pe=b(ie))==null?void 0:pe.status)=="active"?(f(),Z(ms,{key:0,sptint_id:x.value,searchQuery:C.value},null,8,["sptint_id","searchQuery"])):(f(),S("div",bs,[t("div",ys,[t("section",ks,[t("div",xs,[t("h2",_s,"Sprint ("+F(($e=(ye=le.value)==null?void 0:ye.tickets)==null?void 0:$e.length)+" Taks)",1)]),b(X)?(f(),S("div",hs,m[14]||(m[14]=[t("div",{role:"status","aria-label":"Loading",class:"h-10 w-10 rounded-full border-4 border-neutral-700 border-t-transparent animate-spin"},null,-1)]))):(f(),S(Se,{key:1},[le.value?(f(),Z(ba,{key:0,sprintId:x.value,sprint:le.value,onOpenTicket:v,onEditSprint:Y,onToggleStart:b(K),onMoveSelectedToBacklog:b(w),onDeleteSelectedSprint:m[3]||(m[3]=z=>b(E)("sprint",z)),onRefresh:re},null,8,["sprintId","sprint","onToggleStart","onMoveSelectedToBacklog"])):W("",!0)],64))]),t("section",Ss,[t("div",Cs,[t("h2",ws,"Backlog ("+F((Me=(Le=b(H))==null?void 0:Le.cards)==null?void 0:Me.length)+" Tasks)",1),t("div",{class:"flex items-center gap-2"},[t("button",{class:"w-8 h-8 rounded-md border cursor-pointer aspect-square text-sm border-border hover:bg-bg-surface/80",onClick:d},m[15]||(m[15]=[t("i",{class:"text-text-primary fa-regular fa-plus"},null,-1)]))])]),b(N)?(f(),S("div",Ds,m[16]||(m[16]=[t("div",{role:"status","aria-label":"Loading",class:"h-10 w-10 rounded-full border-4 border-neutral-700 border-t-transparent animate-spin"},null,-1)]))):(f(),Z(aa,{key:1,sorters:fe,onMoveSelectedToSprint:b(_),onDeleteSelectedBacklog:m[4]||(m[4]=z=>b(E)("backlog")),onOpenTicket:v,onTicketMovedToBacklog:ue},null,8,["onMoveSelectedToSprint"]))])])]))]),q(Bt,{onClick:m[5]||(m[5]=we(()=>{},["stop"])),modelValue:I.value,"onUpdate:modelValue":m[6]||(m[6]=z=>I.value=z),title:"Delete Sprint",itemLabel:"Sprint",itemName:(Be=L.value)==null?void 0:Be.title,requireMatchText:(Ee=L.value)==null?void 0:Ee.title,confirmText:"Delete Ticket",cancelText:"Cancel",size:"md",loading:b(P),onConfirm:D,onCancel:m[7]||(m[7]=()=>{L.value=null,I.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),q(xa,{modelValue:c.value,"onUpdate:modelValue":m[8]||(m[8]=z=>c.value=z),onSave:Oe,sprint:L.value,creatingSprint:L.value?b(Te):b(ve)},null,8,["modelValue","sprint","creatingSprint"]),q(Ta,{sprint:L.value,modelValue:de.value,"onUpdate:modelValue":m[9]||(m[9]=z=>de.value=z),onSave:o,creatingSprint:b(r)||b(a)},null,8,["sprint","modelValue","creatingSprint"]),q(Vt,{modelValue:n.value,"onUpdate:modelValue":m[10]||(m[10]=z=>n.value=z),cardId:(Qe=M.value)==null?void 0:Qe.id,onClose:O},null,8,["modelValue","cardId"]),q(is,{modelValue:k.value,"onUpdate:modelValue":m[11]||(m[11]=z=>k.value=z)},null,8,["modelValue"])],64)}}});export{Ps as default};
