import{d as X,r as d,p as Y,c as I,u as P,q as Z,v as ee,b as te,w as S,o as v,e as r,s as b,f as p,t as y,g as B,h as oe,i as _,j as A,x as se,y as F,n as f,F as ne,B as ae,l as le}from"./index-DKO9vpWs.js";import{_ as re}from"./AuthLayout.vue_vue_type_script_setup_true_lang-BnADCcIC.js";import{v as ue,a as ie}from"./auth-DYfvFjXU.js";import"./favicon-BAFXWHLW.js";const ce={class:"max-w-[496px] md:mx-auto w-full"},de={class:"mb-12 space-y-2"},fe={class:"font-bold"},me={class:"flex justify-center gap-4 pb-4"},ve=["value","onKeydown","onPaste","onInput"],pe={key:0,class:"text-red-500 text-sm text-center mt-2"},ye={class:"text-sm font-medium text-text-secondary text-center"},ge=["aria-disabled"],we={key:1,class:"text-green-600 text-sm text-center mt-2"},xe={key:2,class:"text-red-500 text-sm text-center mt-2"},i=5,M=45,Te=X({name:"OtpVerify",__name:"OtpVerification",setup(be){const D=d(Array.from({length:i},()=>null)),O=le(),L=Y(),g=d(L.params.email||""),u=d(Array.from({length:i},()=>"")),n=d(""),w=d("");let m;function N(t,e){D.value[e]=t instanceof HTMLInputElement?t:null}function c(t){var e;(e=D.value[t])==null||e.focus()}const $=I(()=>u.value.every(t=>t.length===1)),{mutateAsync:E,isPending:h}=P({mutationFn:ue});async function j(){var t,e,o;if(n.value="",!$.value){n.value="Please enter the complete 5-digit code.";return}try{const s=u.value.join(""),a=await E({u_email:g.value,otp:s});localStorage.setItem("token",(t=a==null?void 0:a.data)==null?void 0:t.token),O.push("/create-profile")}catch(s){n.value=((o=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:o.message)||"Invalid code, please try again."}}function z(t,e){const{key:o}=e;/^[0-9]$/.test(o)?(u.value[t]=o,n.value&&(n.value=""),e.preventDefault(),t<i-1&&c(t+1)):o==="Backspace"?u.value[t]?(u.value[t]="",n.value&&(n.value="")):t>0&&c(t-1):o==="ArrowLeft"&&t>0?c(t-1):o==="ArrowRight"&&t<i-1&&c(t+1)}function R(t,e=0){const o=t.replace(/\D/g,"").slice(0,i-e);if(!o)return;for(let a=0;a<o.length;a++)u.value[e+a]=o[a];const s=Math.min(e+o.length,i-1);c(s),n.value&&(n.value="")}function K(t,e){var o;R(((o=e.clipboardData)==null?void 0:o.getData("text"))??"",t)}function q(t,e){const o=e.target,s=(o.value||"").replace(/\D/g,"");s.length<=1?(u.value[t]=s,s&&t<i-1&&c(t+1)):R(s,t),o.value=u.value[t]??"",n.value&&(n.value="")}function W(t){const e=t.target;setTimeout(()=>e.select(),0)}const l=d(M);let x;function k(){x&&(clearInterval(x),x=void 0)}function V(){k(),l.value=M,x=window.setInterval(()=>{l.value>0&&(l.value-=1),l.value===0&&k()},1e3)}const G=I(()=>{const t=Math.floor(l.value/60).toString().padStart(2,"0"),e=(l.value%60).toString().padStart(2,"0");return`${t}:${e}`}),{mutateAsync:H,isPending:C,error:T,reset:U}=P({mutationFn:ie}),J=I(()=>T!=null&&T.value?"1":"");async function Q(){var t,e;if(n.value="",U(),!g.value){n.value="Email not found. Please login again.";return}try{await H({u_email:g.value}),w.value="A new code has been sent to your email.",m&&clearTimeout(m),m=window.setTimeout(()=>w.value="",4e3),V()}catch(o){n.value=((e=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to resend code."}}return Z(()=>{setTimeout(()=>c(0),0),V()}),ee(()=>{k(),m&&clearTimeout(m)}),(t,e)=>(v(),te(re,null,{form:S(()=>[r("div",ce,[r("div",de,[e[0]||(b(-1,!0),(e[0]=r("h2",{class:"text-[32px] font-medium text-center text-text-primary"},[e[4]||(e[4]=p("Enter Verification Code"))])).cacheIndex=0,b(1),e[0]),e[1]||(b(-1,!0),(e[1]=r("p",{class:"text-base sm:text-nowrap font-medium text-text-secondary text-center"},[e[5]||(e[5]=p(" We sent a five-digit code to your email ")),r("span",fe,"("+y(g.value)+")",1),e[6]||(e[6]=p(". "))])).cacheIndex=1,b(1),e[1])]),r("form",{onSubmit:e[3]||(e[3]=B(()=>{},["prevent"])),class:"space-y-4 w-full"},[r("div",me,[(v(),_(ne,null,se(i,(o,s)=>r("input",{key:s,ref_for:!0,ref:a=>N(a,s),type:"text",inputmode:"numeric",pattern:"[0-9]*",maxlength:"1",autocomplete:"one-time-code",enterkeyhint:"done",class:F(["w-full aspect-square text-5xl p-1 md:p-2 font-bold text-center border rounded-lg focus:outline-none",["border-border",n.value?"border-red-500":"",f(h)?"opacity-60 pointer-events-none":""]]),value:u.value[s],onKeydown:a=>z(s,a),onPaste:B(a=>K(s,a),["prevent"]),onInput:a=>q(s,a),onFocus:W},null,42,ve)),64))]),oe(ae,{disabled:f(h),size:"lg",block:!0,onClick:j},{default:S(()=>[p(y(f(h)?"Verifying...":"Verify"),1)]),_:1},8,["disabled"]),n.value?(v(),_("p",pe,y(n.value),1)):A("",!0),r("p",ye,[e[7]||(e[7]=p(" Didn't receive an email? Try checking your junk folder. ")),r("span",{class:F(["text-text-primary font-bold underline",l.value>0?"opacity-50 cursor-not-allowed":"cursor-pointer"]),role:"button","aria-disabled":l.value>0||f(C),onClick:e[2]||(e[2]=o=>l.value===0&&!f(C)&&Q())},y(l.value>0?`Resend in ${G.value}`:f(C)?"Resending...":"Resend code"),11,ge)]),w.value?(v(),_("p",we,y(w.value),1)):A("",!0),J.value?(v(),_("p",xe,"Failed to resend OTP. Please try again.")):A("",!0)],32)])]),_:1}))}});export{Te as default};
