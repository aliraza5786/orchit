const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/KanbanSkeleton-DLaAqHMu.js","assets/index-DhNbIl3H.js","assets/index-Bue5ORhs.css","assets/KanbanSkeleton-BjQaxKe3.css","assets/BaseTextField-Dsnc_bwH.js","assets/ConfirmDeleteModal-BCW9wa-u.js","assets/ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-C6TmFxc6.js","assets/BaseEmailChip-DTvYFREg.js","assets/BaseEmailChip.vue_vue_type_script_setup_true_lang-C_yt_odh.js","assets/Dropdown-YXvFEq6Q.js","assets/index-BGzfaoRu.js","assets/Dropdown-P9l2osTz.css","assets/DetailPanel-DPKb7kd3.js","assets/usePeople-DyhT_89i.js","assets/usePackages-B4bUxx5O.js","assets/permissionUtils-fD2X1oS-.js","assets/sidePanelStore-DqfE_MEz.js","assets/DetailPanel-DWsKKgcb.css","assets/SearchBar-CuuA9ra5.js","assets/SearchBar.vue_vue_type_script_setup_true_lang-9yS2v3G6.js","assets/KanbanBoard-DMbIWBaC.js","assets/vuedraggable.umd-DzC_NUHQ.js","assets/_commonjsHelpers-_d1bhYXs.js","assets/DropMenu.vue_vue_type_script_setup_true_lang-9x9GdMvn.js","assets/KanbanBoard-IqVBNhxM.css","assets/KanbanCard-Tu2gTXRD.js","assets/KanbanCard.vue_vue_type_script_setup_true_lang-C3tKf9xT.js"])))=>i.map(i=>d[i]);
import{a_ as Oe,q as G,d as Te,X as Ne,r as d,P as Re,c as V,x as $,z as Be,Q as Fe,bf as Ue,k as x,g as n,j as v,f as ee,H as Qe,m as l,I as $e,l as te,w as S,i as I,D as q,F as qe,o as f,af as c,h as M,t as O,W as se,E as m}from"./index-DhNbIl3H.js";import{e as Me,f as We,b as ze,R as Ke,g as je}from"./usePeople-DyhT_89i.js";import{F as Je}from"./fuse-Ch1WBRTM.js";import{l as He}from"./lodash-CQYOKM_D.js";import{u as Ye}from"./sidePanelStore-DqfE_MEz.js";import"./_commonjsHelpers-_d1bhYXs.js";const Xe="https://backend.orchit.ai/api/v1/",Ze=localStorage.getItem("token"),Ge=Oe("people",{state:()=>({peopleData:[],isFetchingPeople:!1}),getters:{},actions:{async fetchPeopleList(W,T,N){var D,C;this.isFetchingPeople=!0;try{const r=await G.get(`${Xe}workspace/teams/${W}/people-grouped`,{params:{groupBy:T},headers:{Authorization:`Bearer ${Ze}`},signal:N});r.status===200?(this.peopleData=(D=r==null?void 0:r.data)==null?void 0:D.data,this.isFetchingPeople=!1):(console.error(((C=r==null?void 0:r.data)==null?void 0:C.message)||"Failed to fetch people list"),this.isFetchingPeople=!1)}catch(r){if(this.isFetchingPeople=!1,G.isCancel(r))return;console.error(r)}}}}),et={class:"flex-auto flex-grow h-full bg-bg-card rounded-[6px] border border-border overflow-x-auto flex-col flex"},tt={class:"overflow-x-auto shrink-0 border-b border-border"},st={class:"header px-4 py-3 flex items-center justify-between gap-2"},at={class:"flex gap-3 items-center"},ot={key:1,class:"flex p-4 overflow-x-auto gap-3 custom_scroll_bar h-full"},lt=["onClick","disabled"],it={key:1,class:"p-4 space-y-2 bg-bg-surface m-4 rounded-md"},rt={class:"text-sm text-text-primary"},nt={class:"flex items-center mt-3 gap-3"},dt=["disabled"],_t=Te({__name:"People",setup(W){const T=c(()=>m(()=>import("./KanbanSkeleton-DLaAqHMu.js"),__vite__mapDeps([0,1,2,3]))),N=c(()=>m(()=>import("./BaseTextField-Dsnc_bwH.js"),__vite__mapDeps([4,1,2]))),D=c(()=>m(()=>import("./ConfirmDeleteModal-BCW9wa-u.js"),__vite__mapDeps([5,6,1,2]))),C=c(()=>m(()=>import("./index-DhNbIl3H.js").then(e=>e.dq),__vite__mapDeps([1,2]))),r=c(()=>m(()=>import("./BaseEmailChip-DTvYFREg.js"),__vite__mapDeps([7,8,1,2]))),ae=c(()=>m(()=>import("./Dropdown-YXvFEq6Q.js"),__vite__mapDeps([9,1,2,10,11]))),oe=c(()=>m(()=>import("./DetailPanel-DPKb7kd3.js"),__vite__mapDeps([12,1,2,13,14,15,16,17]))),le=c(()=>m(()=>import("./SearchBar-CuuA9ra5.js"),__vite__mapDeps([18,19,1,2]))),ie=c(()=>m(()=>import("./KanbanBoard-DMbIWBaC.js"),__vite__mapDeps([20,21,22,1,2,23,10,24]))),re=c(()=>m(()=>import("./KanbanCard-Tu2gTXRD.js"),__vite__mapDeps([25,26,1,2,13]))),{canCreateVariable:k,canInviteUser:R}=Ne(),z=Ye(),B=Ge(),ne=[{title:"Role",_id:"role"},{title:"Team",_id:"team"},{title:"Status",_id:"status"}],A=d("team"),y=d(!1),b=d(),{workspaceId:_}=Re(),o=d([]),F=d(!1),K=V(()=>B.isFetchingPeople),U=V(()=>B.peopleData),{mutate:de,isPending:ue}=Me({onSuccess:e=>{o.value=[...o.value||[],e],E.value="",P.value=!1}});$(()=>U.value,e=>{e&&(o.value=JSON.parse(JSON.stringify(e)))},{immediate:!0});const pe=new AbortController,h=async()=>{B.fetchPeopleList(_.value,A.value,pe.signal)};$(()=>A.value,(e,t)=>{e!==t&&h()}),Be(()=>{h(),o.value=U.value?JSON.parse(JSON.stringify(U.value)):[]});const ce=d("kanban"),me=d(),j=e=>{z.selectCard(e),F.value=!1},ve=e=>{},P=d(!1),E=d("");function J(){P.value=!P.value}function fe(){const e=E.value.trim();if(!e){se.error("Column name is required.");return}H(e)}const H=e=>{const t={workspace_id:_.value,title:e,max_num_people:1};de({payload:t})},g=Fe(),_e=Ue({onSuccess:()=>{g.invalidateQueries({queryKey:["people-lists"]})}}),ge=e=>{const t={workspace_id:_.value,title:e==null?void 0:e.title,max_num_people:1};_e.mutate({id:e._id,payload:t})},{mutate:xe,isPending:Ce}=We({onSuccess:e=>{y.value=!1,o.value=o.value.filter(t=>{var a;return t._id!==((a=e.deletedRole)==null?void 0:a._id)})}}),ye=()=>{var e;xe({id:(e=b.value)==null?void 0:e.columnId})},be=e=>{y.value=!0,b.value=e},{mutate:he,isPending:we}=ze({onMutate:async e=>{await g.cancelQueries({queryKey:["people-lists"]});const t=g.getQueryData(["people-lists"]),{id:a,payload:i}=e??{};if(!a||!i)return{previous:t};const u=o.value.findIndex(Ie=>Ie._id===a);if(u===-1)return{previous:t};const s=o.value[u],p={_id:`temp-${Date.now()}`,name:i.name,email:i.email,role_id:i.role_id},Q=[...s.cards??[],p],w={...s,cards:Q};return o.value=[...o.value.slice(0,u),w,...o.value.slice(u+1)],g.setQueryData(["people-lists"],o.value),{previous:t}},onError:(e,t,a)=>{a!=null&&a.previous&&(o.value=a.previous,g.setQueryData(["people-lists"],a.previous)),se.error("Failed to add seat. Please try again.")},onSuccess:(e,t)=>{const{id:a}=t,i=o.value.findIndex(w=>w._id===a);if(i===-1)return;const u=o.value[i],p=[...(u.cards??[]).filter(w=>!String(w._id).startsWith("temp-")),e.assigned_seat],Q={...u,cards:p};o.value=[...o.value.slice(0,i),Q,...o.value.slice(i+1)],g.setQueryData(["people-lists"],o.value),g.invalidateQueries({queryKey:["workspaceRoles"]})}}),Y=e=>{b.value=e;const t={name:e!=null&&e.email?De(e==null?void 0:e.email[0]):"",email:e!=null&&e.email?e==null?void 0:e.email[0]:"",role_id:e==null?void 0:e._id,workspace_id:_==null?void 0:_.value,additional_seats:1};he({id:e._id,payload:t})};function De(e){const a=(e.split("@")[0]||"").split("+")[0].split(/[^a-zA-Z]+/).filter(Boolean);return a.length?a.map(i=>i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()).join(" "):e}const X=e=>{R.value&&(window.dispatchEvent(new CustomEvent("close-all-showADDNEW")),e.showADDNEW=!e.showADDNEW)},ke=e=>{Y(e)},Ae=e=>{me.value=e,z.selectCard(e),F.value=!0},Pe=Ke(),Ee=je();function Le(e){e.type=="column"?Pe.mutate({id:_.value,payload:{role_id:e.meta._id,new_sort_order:e.meta.newIndex}}):Ee.mutate({id:e.meta.toColumnId,payload:{team_member_id:e.meta.moved._id,new_sort_order:e.meta.newIndex}})}const L=d(""),Ve=d("");$(L,He.debounce(e=>{Ve.value=e},200));const Se=V(()=>{const e=o.value.flatMap(t=>t.cards.map(a=>({...a,columnId:t.title})));return new Je(e,{keys:["title","name"],threshold:.3})}),Z=V(()=>{if(!L.value)return o.value;const e=Se.value.search(L.value).map(t=>t.item);return o.value.map(t=>({...t,cards:e.filter(a=>a.columnId===t.title)})).filter(t=>t.cards.length>0)});return(e,t)=>{var a,i,u;return f(),x(qe,null,[n("div",et,[n("div",tt,[n("div",st,[v(l(ae),{actions:!1,prefix:"View By",modelValue:A.value,"onUpdate:modelValue":t[0]||(t[0]=s=>A.value=s),options:ne,variant:"secondary",customClasses:"fixed w-[135px]"},null,8,["modelValue"]),n("div",at,[v(l(le),{class:"max-w-[250px]",onOnChange:t[1]||(t[1]=s=>{L.value=s}),placeholder:"Search in Orchit AI space"})])])]),K.value?(f(),ee(l(T),{key:0})):Qe((f(),x("div",ot,[((a=Z.value)==null?void 0:a.length)>0?(f(),ee(l(ie),{key:0,plusIcon:!1,onOnPlus:t[4]||(t[4]=s=>Y(s)),"onDelete:column":t[5]||(t[5]=s=>be(s)),"onUpdate:column":t[6]||(t[6]=s=>ge(s)),onReorder:Le,onAddColumn:H,"onSelect:ticket":j,board:Z.value,onOnBoardUpdate:ve,variable_id:"",sheet_id:"selected_sheet_id"},{ticket:S(({ticket:s})=>[v(l(re),{onClick:p=>Ae(s),ticket:s,onDeleted:t[2]||(t[2]=p=>h()),",":"",onAssigned:h,onUnAssigned:h},null,8,["onClick","ticket"])]),"column-footer":S(({column:s})=>[s.showADDNEW?s.showADDNEW?(f(),x("div",it,[n("p",rt,O(s.title)+" "+O(s.cards.length+1),1),v(l(r),{maxEmails:1,placeholder:"team member email",modelValue:s.email,"onUpdate:modelValue":p=>s.email=p},null,8,["modelValue","onUpdate:modelValue"]),t[15]||(t[15]=n("p",{class:"text-sm text-text-secondary"},"You can assign user later",-1)),v(l(C),{size:"md",onClick:p=>ke(s)},{default:S(()=>[M(O(l(we)?"Adding...":"Add Seat"),1)]),_:2},1032,["onClick"]),n("i",{class:"fa-solid fa-close cursor-pointer ml-2",onClick:t[3]||(t[3]=p=>X(""))})])):te("",!0):(f(),x("div",{key:0,onClick:p=>X(s),disabled:!l(R),class:q([l(R)?"cursor-pointer":"cursor-not-allowed","flex py-3 px-3 justify-center text-sm text-text-primary items-center gap-3 border border-text-primary border-dashed mb-4 mx-4 rounded-md"])},t[14]||(t[14]=[n("i",{class:"fa-solid fa-plus"},null,-1),M(" Add Seat ")]),10,lt))]),_:1},8,["board"])):te("",!0),n("div",{class:"min-w-[270px] sm:min-w-[328px]",onClick:t[9]||(t[9]=I(()=>{},["stop"]))},[P.value?(f(),x("form",{key:0,onSubmit:t[8]||(t[8]=I(()=>{},["prevent"])),class:"bg-bg-body rounded-lg p-4"},[v(l(N),{autofocus:!0,modelValue:E.value,"onUpdate:modelValue":t[7]||(t[7]=s=>E.value=s),placeholder:"Add New list"},null,8,["modelValue"]),t[16]||(t[16]=n("p",{class:"text-xs mt-1.5"},"You can add details while editing",-1)),n("div",nt,[v(l(C),{disabled:!l(k),class:q([l(k)?"cursor-pointer":"cursor-not-allowed","px-3 py-1 bg-accent text-white rounded"]),onClick:fe,type:"submit",variant:"primary"},{default:S(()=>[M(O(l(ue)?"Adding...":"Add Team"),1)]),_:1},8,["disabled","class"]),n("i",{class:"fa-solid fa-close cursor-pointer",onClick:J})])],32)):(f(),x("button",{key:1,class:q(["text-sm text-text-primary py-2.5 font-medium flex items-center justify-center w-full gap-2 bg-bg-body rounded-lg",l(k)?"cursor-pointer":"cursor-not-allowed"]),onClick:I(J,["stop"]),disabled:!l(k)}," + Add Team ",10,dt))])],512)),[[$e,ce.value=="kanban"&&!K.value]])]),v(l(D),{onClick:t[10]||(t[10]=I(()=>{},["stop"])),modelValue:y.value,"onUpdate:modelValue":t[11]||(t[11]=s=>y.value=s),title:"Delete List",itemLabel:"list",itemName:(i=b.value)==null?void 0:i.title,requireMatchText:(u=b.value)==null?void 0:u.title,confirmText:"Delete List",cancelText:"Cancel",size:"md",loading:l(Ce),onConfirm:ye,onCancel:t[12]||(t[12]=()=>{y.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),v(l(oe),{onClose:t[13]||(t[13]=s=>j(null)),showPanel:F.value},null,8,["showPanel"])],64)}}});export{_t as default};
