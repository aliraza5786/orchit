import{D as j}from"./vuedraggable.umd-C5Sv9XgU.js";import{d as z,W as O,u as F,r as h,x as U,c as Q,m as y,o as b,F as W,g as I,h as P,P as C,n as $,f as G,y as H,ai as K,l as S,t as R,T as J,i as d,w,al as X,N as q,ag as Y}from"./index-DXI5uxQE.js";import{_ as Z}from"./DropMenu.vue_vue_type_script_setup_true_lang-DvGpS9sz.js";import{u as ee}from"./index-mryiNDAP.js";import"./_commonjsHelpers-_d1bhYXs.js";const oe={class:"flex items-center justify-between w-full p-4 border-b border-border cursor-grab"},te={class:"flex items-center gap-2 flex-auto max-w-4/5"},ne=["onKeydown"],le=["onKeydown"],se={class:"text-xs bg-muted bg-bg-card aspect-square flex justify-center items-center text-muted-foreground p-1 min-w-6 rounded-full"},ae=z({__name:"KanbanColumn",props:{column:{},variable_id:{},sheet_id:{},canDragList:{type:Boolean},plusIcon:{type:Boolean},index:{},totalColumns:{}},emits:["update:column","delete:column","onPlus","reorder","select:ticket","move:column"],setup(V,{emit:L}){const{canDeleteVariable:_,canEditVariable:g}=O(),o=V,c=L,D=F(),v=()=>{var e,t;D.setTransition({...(e=o==null?void 0:o.column)==null?void 0:e.transitions,currentColumn:(t=o.column)==null?void 0:t.title})},m=()=>{D.setTransition({})},u=h(!1),f=h(o.column.title),x=h(null);U(()=>o.column.title,e=>{f.value=e});function k(){!g.value||!s()||(u.value=!0,X(()=>{x.value&&(x.value.focus(),x.value.select())}))}function T(){const e=(f.value??"").trim()||"Untitled";e!==o.column.title?c("update:column",{...o.column,title:e,oldTitle:o.column.title}):f.value=o.column.title,u.value=!1}function B(){f.value=o.column.title,u.value=!1}const p=h([...o.column.cards??[]]);U(()=>o.column.cards,e=>{p.value=[...e??[]]});const M={backlog:"bg-column-backlog",todo:"bg-column-todo",progress:"bg-column-progress",done:"bg-column-done"},n=Q(()=>{const e=String(o.column._id);return M[e]??"bg-muted/30"});function l(e){var r,E,N,A;const t=e.moved??e.added;t&&c("reorder",{moved:t.element,fromColumnId:((N=(E=(r=e.from)==null?void 0:r.__draggable_component__)==null?void 0:E.$props)==null?void 0:N.listOwnerId)??((A=o.column)==null?void 0:A.title),toColumnId:o.column._id,oldIndex:t.oldIndex??null,newIndex:t.newIndex??null})}function i(){if(!g.value&&!_.value)return[];const e=[];return g.value&&(o.index!==void 0&&o.index>0&&e.push({label:"Move left side",action:()=>{c("move:column",{direction:"left",column:o.column})}}),o.index!==void 0&&o.totalColumns!==void 0&&o.index<o.totalColumns-1&&e.push({label:"Move right side",action:()=>{c("move:column",{direction:"right",column:o.column})}})),_.value&&e.push({label:"Delete",danger:!0,action:()=>a()}),e}function s(){var t;const e=(t=o==null?void 0:o.column)==null?void 0:t.title.trim().toLowerCase();if(e)switch(e){case"admin":return!1;default:return!0}}const a=()=>{var e;c("delete:column",{title:o.column.title,columnId:(e=o.column)==null?void 0:e._id})};return window.addEventListener("close-all-showADDNEW",()=>{o.column.showADDNEW=!1}),(e,t)=>(b(),y("div",{class:W(["flex bg-bg-body flex-col min-h-[565px] h-full w-full rounded-lg transition-all duration-200",n.value])},[I("div",oe,[I("div",te,[u.value?H((b(),y("input",{key:1,autofocus:"",ref_key:"titleInputRef",ref:x,"onUpdate:modelValue":t[0]||(t[0]=r=>f.value=r),class:"font-semibold inline text-foreground px-1 py-0.5 rounded bg-transparent border border-border focus:outline-none focus:ring-1 focus:ring-border",onKeydown:[K(S(T,["prevent"]),["enter"]),K(S(B,["prevent"]),["esc"])],onBlur:T,onMousedown:t[1]||(t[1]=S(()=>{},["stop"]))},null,40,le)),[[J,f.value]]):(b(),y("button",{key:0,class:"font-semibold overflow-ellipsis line-clamp-1 text-nowrap text-foreground px-1 py-0.5 rounded hover:bg-bg-card focus:outline-none focus:ring-1 focus:ring-border cursor-text",onClick:k,onKeydown:K(S(k,["prevent"]),["enter"]),title:"Click to rename"},R(f.value),41,ne)),I("span",se,R(p.value.length),1)]),e.plusIcon?(b(),y("i",{key:0,class:"cursor-pointer fa-solid fa-plus",onClick:t[2]||(t[2]=r=>c("onPlus",e.column))})):$("",!0),s()&&(d(g)||d(_))?(b(),G(Z,{key:1,items:i()},{trigger:w(()=>t[4]||(t[4]=[I("i",{class:"fa-solid fa-ellipsis cursor-pointer"},null,-1)])),_:1},8,["items"])):$("",!0)]),P(d(j),{disabled:!e.canDragList,modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=r=>p.value=r),"item-key":"_id",class:"flex-1 p-4 space-y-3 overflow-y-auto",group:{name:"tickets",pull:!0,put:!0},animation:180,"ghost-class":"kanban-ghost","chosen-class":"kanban-chosen",onStart:v,onEnd:m,"drag-class":"kanban-dragging",onChange:l},{item:w(({element:r})=>[I("div",null,[C(e.$slots,"ticket",{ticket:r},void 0,!0)])]),footer:w(()=>[p.value.length?$("",!0):C(e.$slots,"emptyState",{key:0,column:e.column},void 0,!0)]),_:3},8,["disabled","modelValue"]),C(e.$slots,"footer",{column:e.column},void 0,!0)],2))}}),ie=q(ae,[["__scopeId","data-v-7446b03a"]]),ue=z({__name:"KanbanBoard",props:{board:{},onBoardUpdate:{},variable_id:{},sheet_id:{},plusIcon:{type:Boolean,default:!0}},emits:["update:board","select:ticket","update:column","delete:column","onPlus","reorder","scroll"],setup(V,{emit:L}){const{canCreateCard:_,canEditCard:g}=O(),o=ee("(max-width: 650px)"),c=h(g.value);Y(()=>{c.value=g.value});const D=()=>{console.log(">>> strating"),c.value=!1},v=V,m=L,u=h(B(v.board));U(()=>v.board,n=>{u.value=B(n)});function f(n){const l=n.oldIndex,i=n.newIndex,s=u.value.columns[i],a=s!=null&&s.title?s==null?void 0:s.title:"",e=s==null?void 0:s._id;a!=null&&k("column",{id:a,oldIndex:l,newIndex:i,_id:e}),c.value=!0}function x(n){console.log(n),k("ticket",n)}function k(n,l){var s;const i=u.value;m("update:board",i),m("reorder",{type:n,board:i,meta:l}),(s=v.onBoardUpdate)==null||s.call(v,i)}function T({direction:n,column:l}){const i=[...u.value.columns],s=i.findIndex(e=>e.title.toLowerCase()===l.title.toLowerCase());if(s===-1)return;let a=s;if(n==="left"&&s>0?a=s-1:n==="right"&&s<i.length-1&&(a=s+1),a!==s){const[e]=i.splice(s,1);i.splice(a,0,e),u.value.columns=i;const t=i[a],r=t!=null&&t.title?t==null?void 0:t.title:"",E=t==null?void 0:t._id;r!=null&&k("column",{id:r,oldIndex:s,newIndex:a,_id:E})}}function B(n){return{columns:((n==null?void 0:n.length)??0)>0?n.map(l=>({_id:l._id,title:l.title,transitions:l.transitions,cards:l.cards??[]})):[]}}let p=null;const M=n=>{clearTimeout(p),p=setTimeout(()=>{const l=n.target;m("scroll",{scrollLeft:l.scrollLeft,scrollWidth:l.scrollWidth,clientWidth:l.clientWidth})},50)};return(n,l)=>(b(),y("div",{class:"h-full flex gap-3",ref:"kanbanScroll",onScroll:M},[P(d(j),{modelValue:u.value.columns,"onUpdate:modelValue":l[4]||(l[4]=i=>u.value.columns=i),"item-key":"_id",group:"columns",animation:180,"ghost-class":"kanban-ghost","chosen-class":"kanban-chosen","drag-class":"kanban-dragging","force-fallback":!0,disabled:d(o),class:W(["flex gap-3",{"overflow-x-auto snap-x snap-mandatory w-full pb-4 mobile-scroll-visible":d(o),"min-w-max":!d(o)}]),direction:"horizontal",onEnd:f,onStart:D},{item:w(({element:i,index:s})=>[(b(),y("div",{class:W(["rounded-lg bg-bg-surface h-full",{"snap-center min-w-[270px] max-w-[270px]":d(o),"min-w-[320px] max-w-[320px]":!d(o)}]),key:i._id},[P(ie,{plusIcon:n.plusIcon&&d(_),canDragList:!d(o)&&c.value,onOnPlus:l[0]||(l[0]=a=>m("onPlus",a)),sheet_id:n.sheet_id,variable_id:n.variable_id,"onUpdate:column":l[1]||(l[1]=a=>m("update:column",a)),index:s,totalColumns:u.value.columns.length,"onSelect:ticket":l[2]||(l[2]=a=>m("select:ticket",a)),"onDelete:column":l[3]||(l[3]=a=>m("delete:column",a)),column:i,onReorder:x,"onMove:column":T},{emptyState:w(({column:a})=>[C(n.$slots,"emptyState",{column:a},void 0,!0)]),ticket:w(({ticket:a})=>[C(n.$slots,"ticket",{ticket:a},void 0,!0)]),footer:w(({column:a})=>[C(n.$slots,"column-footer",{column:a},void 0,!0)]),_:2},1032,["plusIcon","canDragList","sheet_id","variable_id","index","totalColumns","column"])],2))]),_:3},8,["modelValue","disabled","class"])],544))}}),pe=q(ue,[["__scopeId","data-v-fdaea610"]]);export{pe as default};
