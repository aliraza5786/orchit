import{d as G,c as W,r as b,v as ae,e as le,o as r,w as S,h as s,l as d,m as $,C as ie,ac as oe,j as f,N as ne,F as J,y as re,z as de,a9 as j,p as c,b3 as R,t as m,O as X,i as V,k as v,B as Z,W as ue,U as ce,V as me,bx as pe,L as fe,g as ge}from"./index-kby-6k01.js";import{_ as ve}from"./DropMenu.vue_vue_type_script_setup_true_lang-S66lIDvr.js";import{l as be,m as ye,n as ke,o as we}from"./usePeople-DuDsRIEO.js";import{_ as xe}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-ByxTVZYq.js";const he={class:"px-6 pb-2"},Ce={class:"relative mb-4"},_e=["onKeydown"],Se={key:0,class:"mt-3"},Ve={class:"divide-y divide-border rounded-xl border border-border bg-bg-card"},$e=["onClick"],Ae={class:"flex items-center gap-3 min-w-0"},Te=["src"],Ue={class:"min-w-0"},Me={class:"truncate font-medium leading-tight capitalize"},De={class:"truncate text-xs text-text-secondary leading-tight"},Ne={key:1,class:"mt-3 flex items-center gap-2"},je={class:"inline-flex items-center gap-2 rounded-full px-3 py-2 bg-bg-muted text-text-secondary"},qe={class:"flex items-center justify-between gap-3 p-6 mt-3 pb-2 border-t border-border bg-bg-body"},ze={class:"flex gap-2 justify-between w-full"},Be=G({__name:"AssignmentModal",props:{modelValue:{type:Boolean,default:!1},members:{default:()=>[]},directory:{default:()=>[]},placeholder:{default:"Search people by name or email"},isSubmitting:{}},emits:["update:modelValue","submit","copy-link"],setup(A,{emit:T}){const x=A,h=T,u=W({get:()=>x.modelValue,set:i=>h("update:modelValue",i)}),l=b(""),n=b(""),U=b(""),y=W(()=>{const i=l.value.trim().toLowerCase();return x.directory.filter(o=>{var e;return((e=o.name)==null?void 0:e.toLowerCase().includes(i))||o.email.toLowerCase().includes(i)})}),M=i=>{n.value=i.email,l.value=""},p=()=>{n.value=""},k=()=>{l.value&&(n.value=l.value.trim(),l.value="")},C=i=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i),D=()=>{if(!n.value||!C(n.value)){U.value="Please select a valid email.";return}h("submit",{invite:{email:n.value}})},N=()=>{p(),l.value="",u.value=!1};return ae(()=>{u.value&&(l.value="")}),(i,o)=>(r(),le(ue,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=e=>u.value=e),size:"md"},{default:S(()=>[o[3]||(o[3]=s("div",{class:"sticky top-0 z-10 flex items-start gap-2 px-6 pb-4 mb-4 border-b border-border bg-bg-body"},[s("h2",{class:"text-xl font-semibold"},"Add team member")],-1)),s("div",he,[s("div",Ce,[ie(s("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>l.value=e),type:"text",placeholder:"Search or add email",class:"w-full h-11 rounded-xl border border-border bg-bg-input px-3 text-sm outline-none focus:ring-2 focus:ring-primary/40",onKeydown:oe(f(k,["prevent"]),["enter"])},null,40,_e),[[ne,l.value]])]),y.value.length?(r(),d("div",Se,[s("ul",Ve,[(r(!0),d(J,null,re(y.value,e=>(r(),d("li",{key:e.id||e.email,class:de(["flex items-center justify-between gap-3 px-3 py-3 cursor-pointer hover:bg-bg-muted",{"bg-bg-muted":n.value===e.email}]),onClick:q=>M(e)},[s("div",Ae,[e!=null&&e.profile_image?(r(),d("img",{key:0,class:"h-9 w-9 rounded-full aspect-square",src:e==null?void 0:e.profile_image,alt:"avatar"},null,8,Te)):(r(),d("div",{key:1,class:"h-9 w-9 bg-white capitalize rounded-full flex items-center justify-center text-xs font-semibold",style:j({backgroundColor:c(R)({email:e.email})})},m(c(X)(e.name||e.email)),5)),s("div",Ue,[s("div",Me,m(e.name||e.email),1),s("div",De,m(e.email),1)])])],10,$e))),128))])])):$("",!0),n.value?(r(),d("div",Ne,[s("span",je,[V(m(n.value)+" ",1),s("button",{onClick:p,class:"ml-2 text-sm text-red-500"},"✕")])])):$("",!0)]),s("div",qe,[s("div",ze,[v(Z,{variant:"secondary",onClick:N},{default:S(()=>o[2]||(o[2]=[V("Cancel")])),_:1,__:[2]}),v(Z,{variant:"primary",disabled:!!(!n.value||i.isSubmitting),onClick:D},{default:S(()=>[V(m(i.isSubmitting?"Assigning…":"Assign"),1)]),_:1},8,["disabled"])])])]),_:1,__:[3]},8,["modelValue"]))}}),Ie={class:"flex justify-between gap-2 items-start w-full"},Pe={class:"flex items-center gap-2 w-[90%]"},Ee=["src"],Ke={key:0,class:"fa-solid fa-user text-white"},Le={class:"max-w-[70%]"},Fe={class:"text-sm font-medium mb-1 text-card-foreground leading-tight w-full"},Qe={class:"text-text-secondary text-xs overflow-hidden overflow-ellipsis"},He={key:0,class:"group-hover:flex justify-center items-center hidden w-6 h-6 bg-bg-surface/40 rounded-md"},Je=G({__name:"KanbanCard",props:{ticket:{}},setup(A){const{canInviteUser:T,canEditUser:x,canDeleteUser:h}=ce(),u=b(!1),l=A,{workspaceId:n}=me(),{data:U}=pe(),{data:y}=be(n.value,U),M=b([]),p=b(!1),k=fe();function C(){return[T.value?{label:"Assign User",danger:!0,action:()=>{u.value=!0},icon:{prefix:"fa-regular",iconName:"fa-user-plus"}}:null,l.ticket.name&&x.value?{label:"UnAssign User",danger:!0,action:()=>{se()},icon:{prefix:"fa-regular",iconName:"fa-user-minus"}}:null,h.value?{label:"Delete Seat",danger:!0,action:()=>{p.value=!0},icon:{prefix:"fa-regular",iconName:"fa-trash"}}:null].filter(Boolean)}const D=()=>{},{mutate:N,isPending:i}=ye({onSuccess:()=>{k.invalidateQueries({queryKey:["people-lists"]})}}),o=()=>{N({id:l.ticket._id})},{mutate:e,isPending:q}=ke({onSuccess:()=>{u.value=!1,k.invalidateQueries({queryKey:["people-lists"]})}});function Y(a){const _=(a.split("@")[0]||"").split("+")[0].split(/[^a-zA-Z]+/).filter(Boolean);return _.length?_.map(w=>w.charAt(0).toUpperCase()+w.slice(1).toLowerCase()).join(" "):a}const{mutate:ee}=we({onSuccess:()=>{u.value=!1,k.invalidateQueries({queryKey:["people-lists"]})}});function te(a){e({id:l.ticket._id,payload:{name:Y(a.email),email:a.email}})}function se(){ee({id:l.ticket._id})}return(a,t)=>{var w,z,B,I,P,E,K,L,F,Q,H,O;const _=ge("AssigmentDropdown");return r(),d(J,null,[s("div",{onClick:t[2]||(t[2]=g=>a.$emit("click")),class:"group bg-bg-card rounded-lg p-4 shadow-sm cursor-grab hover:shadow-md transition-all duration-200 active:cursor-grabbing",style:j({borderColor:(z=(w=a.ticket)==null?void 0:w.lane)==null?void 0:z.variables["lane-color"]})},[s("div",Ie,[s("div",Pe,[(B=a.ticket)!=null&&B.avatar?(r(),d("img",{key:0,src:(I=a.ticket)==null?void 0:I.avatar,class:"min-w-10 w-10 h-10 rounded-full object-cover",alt:"avartar"},null,8,Ee)):(r(),d("div",{key:1,class:"w-10 min-w-10 overflow-hidden overflow-ellipsis aspect-square bg-bg-surface flex justify-center items-center rounded-full",style:j({backgroundColor:(P=a.ticket)!=null&&P.name?c(R)({email:(E=a.ticket)==null?void 0:E.email}):""})},[V(m(c(X)((K=a.ticket)==null?void 0:K.name))+" ",1),(L=a.ticket)!=null&&L.name?$("",!0):(r(),d("i",Ke))],4)),s("div",Le,[s("h3",Fe,m(((F=a.ticket)==null?void 0:F.name)??a.ticket.title??"Team Member "),1),s("p",Qe,m((Q=a.ticket)==null?void 0:Q.email),1)])]),C().length>0?(r(),d("div",He,[v(ve,{onClick:t[0]||(t[0]=f(()=>{},["stop"])),items:C()},{trigger:S(()=>t[11]||(t[11]=[s("i",{class:"cursor-pointer fa-solid fa-ellipsis"},null,-1)])),_:1},8,["items"])])):$("",!0)]),s("div",{onClick:t[1]||(t[1]=f(()=>{},["stop"]))},[v(_,{users:M.value,onAssign:D,assigneeId:a.ticket.assigned_to},null,8,["users","assigneeId"])])],4),s("div",{class:"no-drag-zone",draggable:"false",onMousedown:t[8]||(t[8]=f(()=>{},["stop"])),onTouchstart:t[9]||(t[9]=f(()=>{},["stop"])),onPointerdown:t[10]||(t[10]=f(()=>{},["stop"]))},[v(xe,{onClick:t[3]||(t[3]=f(()=>{},["stop"])),modelValue:p.value,"onUpdate:modelValue":t[4]||(t[4]=g=>p.value=g),title:"Delete Team seat",itemLabel:"Seat",itemName:a.ticket.title,requireMatchText:a.ticket.title,confirmText:"Delete Seat",cancelText:"Cancel",size:"md",loading:c(i),onConfirm:o,onCancel:t[5]||(t[5]=()=>{p.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),v(Be,{isSubmitting:c(q),modelValue:u.value,"onUpdate:modelValue":t[6]||(t[6]=g=>u.value=g),members:(H=c(y))==null?void 0:H.people,directory:(O=c(y))==null?void 0:O.people,onSubmit:t[7]||(t[7]=({invite:g})=>te(g))},null,8,["isSubmitting","modelValue","members","directory"])],32)],64)}}});export{Je as default};
