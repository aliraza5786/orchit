import{d as We,W as Ge,bj as Je,r as v,m as C,q as le,af as Xe,M as ne,c as g,bh as Ye,bk as Ze,bl as et,bm as tt,bn as st,bo as at,a as it,a5 as ot,ac as lt,b as nt,w as x,A as O,C as dt,e as s,h as m,a3 as B,i as l,a4 as de,g as re,V as W,t as r,bi as rt,aw as ct,j as D,G as ce,bp as ut,F as b,U as ue,y as vt,n as U,x as L,B as G,f as F,aa as ve,o,H as mt}from"./index-LNzwfNuY.js";const pt={class:"flex flex-col max-w-[380px] min-w-[380px] h-full overflow-y-auto bg-gradient-to-b from-bg-card/95 to-bg-card/90 backdrop-blur rounded-2xl shadow-[0_10px_40px_-10px_rgba(0,0,0,.5)] border border-orchit-white/5 overflow-hidden",role:"complementary","aria-label":"Details panel"},ht={class:"sticky top-0 z-10 bg-transparent border-b border-orchit-white/5 px-6 py-4 flex items-center justify-between"},ft={class:"py-5 px-6 flex flex-col gap-5 flex-grow"},gt={class:"capitalize"},xt=["onKeydown"],bt=["innerHTML"],_t={key:1,class:"opacity-60"},wt={key:"tab-details",class:"space-y-6"},yt={class:"grid grid-cols-2 gap-4 text-sm"},kt={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-4"},Ct={class:"mt-1 font-medium"},Dt={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-4"},St={class:"mt-1 font-medium"},Vt={class:"rounded-2xl border border-orchit-white/10 bg-orchit-white/5 p-4 grid grid-cols-1 sm:grid-cols-2 gap-4"},Et={class:"space-y-2"},Ut={class:"space-y-2"},It={class:"space-y-2"},Tt={class:"h-8 px-3 flex items-center gap-2 rounded-lg bg-bg-input border border-orchit-white/10"},Pt={class:"space-y-2"},Bt={key:0,class:"text-xs text-red-400 mt-1"},Lt={key:0,class:"space-y-2 sm:col-span-1"},Mt={class:"text-xs uppercase tracking-wider text-text-secondary"},jt={key:1},zt={class:"relative border-l border-orchit-white/10 pl-5 space-y-4 ml-1"},At={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-3 hover:bg-orchit-white/7 transition"},Ot={class:"font-semibold"},Ft={class:"font-semibold"},$t={key:"tab-comments",class:"space-y-4"},qt={class:"flex items-center gap-3 mb-2"},Ht={class:"h-8 w-8 rounded-full bg-accent/15 text-accent flex items-center justify-center text-xs font-semibold"},Kt={class:"flex-1"},Nt={class:"text-sm font-medium"},Rt={class:"text-xs text-text-secondary"},Qt={key:0,class:"flex items-center gap-2"},Wt=["onClick"],Gt=["onClick"],Jt={class:"flex items-center gap-2 justify-end"},Xt={key:0,class:"mt-3 grid grid-cols-2 gap-2"},Yt=["href"],Zt={class:"text-xs truncate"},es={class:"rounded-xl border border-orchit-white/10 bg-orchit-white/5 overflow-hidden"},ts={class:"flex items-center justify-between p-2 border-t border-orchit-white/10"},ss={key:"tab-attachments",class:"space-y-3"},as={class:"text-xs text-text-secondary"},is={class:"grid sm:grid-cols-2 gap-4"},os={class:"p-3"},ls={key:0,class:"rounded-lg overflow-hidden"},ns=["src"],ds={key:1,class:"rounded-lg overflow-hidden"},rs=["src"],cs={key:2,class:"h-40 rounded-lg bg-black/5 grid place-items-center"},us={class:"mt-3"},vs={class:"font-medium truncate"},ms={class:"text-xs text-text-secondary capitalize"},ps={class:"p-3 pt-0"},hs=["href"],fs=We({__name:"SidePanel",props:{pin:{type:Boolean,default:!1},showPanel:{type:Boolean,default:!0},details:{type:Object,default:()=>({})}},emits:["close","update:details","comment:post","priority:change"],setup(_,{emit:me}){var ae,ie;const{workspaceId:pe}=Ge(),n=_,he=me,{data:f,isPending:fe}=Je(n.details._id),I=v("details"),ge=[{label:"Details",value:"details"},{label:"Comments",value:"comments"},{label:"History",value:"history"},{label:"Attachment",value:"attachment"}],M=v(!1),w=v(n.details["card-title"]??"");C(()=>n.details["card-title"],t=>{w.value=t});const $=v(null);function xe(){M.value=!0,ve(()=>{var t,e;(t=$.value)==null||t.focus(),(e=$.value)==null||e.select()})}function J(){w.value.trim()||(w.value=n.details["card-title"]??""),y.mutate({card_id:n.details._id,variables:{"card-title":w.value.trim()}}),M.value=!1}const S=v(n.details["card-description"]);C(()=>n.details,()=>{S.value=n.details["card-description"]});const j=v(!1),q=v(null);function be(t){var u,a;const e=(u=t==null?void 0:t.querySelector)==null?void 0:u.call(t,".ProseMirror");if(!e)return;e.focus();const i=(a=window.getSelection)==null?void 0:a.call(window),d=document.createRange();d.selectNodeContents(e),d.collapse(!1),i==null||i.removeAllRanges(),i==null||i.addRange(d)}async function _e(){j.value=!0,await ve(),be(q.value||void 0)}function X(t){y.mutate({card_id:n.details._id,attachments:t??[],variables:{"card-description":S.value}}),j.value=!1}function Y(t){var i;if(!j.value)return;const e=t.target;(i=q.value)!=null&&i.contains(e)||X()}le(()=>document.addEventListener("mousedown",Y)),Xe(()=>document.removeEventListener("mousedown",Y));const Z=ne({posted_on:((ae=n.details)==null?void 0:ae.posted_on)??((ie=n.details)==null?void 0:ie.created_at)??new Date().toISOString()}),we=g({get:()=>new Date(Z.posted_on).toISOString().slice(0,10),set:t=>{Z.posted_on=new Date(t+"T00:00:00").toISOString()}}),{data:H}=Ye(pe.value),K=v(n.details.workspace_lane_id??"");C(()=>n.details.workspace_lane_id,t=>{K.value=t});const ye=g(()=>((H==null?void 0:H.value)??[]).map(t=>{var e;return{_id:t._id,title:((e=t==null?void 0:t.variables)==null?void 0:e["lane-title"])??String(t._id)}}));function ke(t){K.value=t,y.mutate({card_id:n.details._id,workspace_lane_id:t})}const p=v({startDate:n.details["start-date"],endDate:n.details["end-date"]}),Ce=g(()=>n.details["start-date"]),De=g(()=>n.details["end-date"]);C(Ce,t=>{p.value={...p.value,startDate:t}}),C(De,t=>{p.value={...p.value,endDate:t}});const N=g(()=>p!=null&&p.value.startDate&&p.value.endDate&&p.value.endDate<p.value.startDate?"End date cannot be before start date":""),Se=t=>y.mutate({card_id:n.details._id,variables:{"start-date":t}}),Ve=t=>y.mutate({card_id:n.details._id,variables:{"end-date":t}}),Ee=g(()=>n.details.assigned_to),Ue=t=>{var e;y.mutate({card_id:n.details._id,assigned_to:(e=t==null?void 0:t.user_info)==null?void 0:e._id})},c=v([]),Ie=g(()=>{var t;return(t=n.details)==null?void 0:t._id}),{data:ee}=Ze(Ie);C(()=>ee.value,()=>{var t;c.value=(t=ee.value)==null?void 0:t.comments});const{mutate:Te,isPending:Pe}=et({onSuccess:t=>{T.value="",P.value=[],c.value=[...c.value,t]}}),T=v(""),Be=t=>(t??"").split(" ").map(e=>e[0]).filter(Boolean).slice(0,2).join("").toUpperCase(),Le=t=>t?new Date(t).toLocaleString():"",{data:Me}=tt(),je=t=>{var e;return((e=t==null?void 0:t.created_by)==null?void 0:e._id)===Me.value},z=v(null),V=v(""),{mutate:ze,isPending:te}=st(),{mutate:Ae}=at();function Oe(t){z.value=t._id,V.value=t.comment_text??""}function R(){z.value=null,V.value="",M.value=!1}function Fe(t){const e=V.value.trim();if(!e)return;const i=c.value.findIndex(u=>u._id===t._id),d=i>-1?{...c.value[i]}:null;i>-1&&(c.value[i]={...c.value[i],comment_text:e}),ze({id:t._id,payload:{comment_text:e}},{onError:()=>{i>-1&&d&&(c.value[i]=d)},onSuccess:u=>{i>-1&&(c.value[i]=u??c.value[i]),R()}})}function $e(t){const e=c.value.findIndex(d=>d._id===t._id),i=e>-1?c.value[e]:null;e>-1&&c.value.splice(e,1),Ae({id:t._id},{onError:()=>{i&&c.value.splice(e,0,i)}})}const qe=g(()=>{var t;return(((t=n.details)==null?void 0:t.attachments)??[]).map(e=>{var i;return{_id:e._id??e.id??((i=crypto.randomUUID)==null?void 0:i.call(crypto))??Math.random(),name:e.name??e.filename??"file",url:e.url,kind:(e.type??e.kind??"").toLowerCase().includes("image")?"image":(e.type??e.kind??"").toLowerCase().includes("video")?"video":"file"}})}),Q=it(),y=ot({onSuccess:()=>{Q.invalidateQueries({queryKey:["get-sheets"]}),Q.invalidateQueries({queryKey:["sheet-list"]}),Q.invalidateQueries({queryKey:["roles"]})}}),P=v([]),{mutate:He}=lt({onSuccess:t=>{P.value=[t]}});function Ke(t){const e=t.target.files;Array.from(e).forEach(i=>{const d=new FormData;d.append("file",i),He(d)})}function Ne(){const t=T.value.trim();!t&&!P.value.length||Te({id:n.details._id,payload:{comment_text:t,attachments:P.value.map(e=>({name:e.data.name,url:e.data.url}))}})}const A=ne({}),se=()=>{var t;(t=f==null?void 0:f.value)!=null&&t.variables&&(f.value.variables??[]).forEach(i=>{var u,a;if(!i||i.type!=="Select")return;const d=Array.isArray(i.data)&&i.data.length?((u=i.data[0])==null?void 0:u.value)??((a=i.data[0])==null?void 0:a._id)??i.data[0]:void 0;A[i.slug]=i.value??A[i.slug]??d??null})};le(se),C(()=>f.value,se,{deep:!0});function Re(t,e){var d,u;A[e]=t,((u=(((d=f.value)==null?void 0:d.variables)??[]).find(a=>a.slug===e))==null?void 0:u.value)!==t&&y.mutate({card_id:n.details._id,variables:{[e]:t}})}return(t,e)=>(o(),nt(B,{name:"panel",appear:""},{default:x(()=>[O(s("div",pt,[s("div",ht,[e[7]||(e[7]=s("h5",{class:"text-[18px] font-semibold tracking-tight"},"Details",-1)),s("button",{class:"p-2 rounded-xl hover:bg-orchit-white/5 active:scale-[.98] cursor-pointer transition",onClick:e[0]||(e[0]=()=>he("close")),"aria-label":"Close details"},e[6]||(e[6]=[s("i",{class:"fa-solid fa-xmark text-xl"},null,-1)]))]),s("div",ft,[s("div",gt,[m(B,{name:"fade-scale",mode:"out-in"},{default:x(()=>[M.value?O((o(),l("input",{key:"title-edit",ref_key:"titleInput",ref:$,"onUpdate:modelValue":e[1]||(e[1]=i=>w.value=i),onBlur:J,onKeydown:[de(re(J,["prevent"]),["enter"]),de(re(R,["prevent"]),["esc"])],class:"w-full text-2xl font-semibold rounded-xl px-3 py-2 bg-orchit-white/5 border border-orchit-white/10 focus:outline-none focus:ring-2 focus:ring-accent/40 transition",type:"text","aria-label":"Edit title"},null,40,xt)),[[W,w.value]]):(o(),l("h1",{key:"title-view",class:"text-2xl font-semibold tracking-tight cursor-text rounded-lg px-2 py-1 hover:bg-orchit-white/5 transition",onClick:xe,"aria-label":"Card title"},r(w.value||"Untitled"),1))]),_:1})]),s("div",null,[e[8]||(e[8]=s("h3",{class:"mb-2 text-base font-semibold tracking-wide px-1"},"Description",-1)),m(B,{name:"fade-scale",mode:"out-in"},{default:x(()=>[j.value?(o(),l("div",{key:"desc-edit",ref_key:"descEditorWrap",ref:q,class:"rounded-xl overflow-hidden border border-orchit-white/10 shadow-sm"},[m(rt,{modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=i=>S.value=i),onFocusOut:X},null,8,["modelValue"])],512)):(o(),l("div",{key:"desc-view",class:"text-[15px] leading-6 text-text-secondary whitespace-pre-wrap cursor-text rounded-xl px-4 py-3 border border-orchit-white/10 bg-orchit-white/5 hover:border-orchit-white/20 transition",onClick:_e},[S.value?(o(),l("div",{key:0,innerHTML:S.value},null,8,bt)):(o(),l("span",_t,"Click to add a description…"))]))]),_:1})]),m(ct,{modelValue:I.value,"onUpdate:modelValue":e[3]||(e[3]=i=>I.value=i),options:ge,size:"md"},null,8,["modelValue"]),m(B,{name:"section",mode:"out-in"},{default:x(()=>{var i,d,u;return[I.value==="details"?(o(),l("section",wt,[s("div",yt,[s("div",kt,[e[9]||(e[9]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"Posted On",-1)),s("div",Ct,r(we.value),1)]),s("div",Dt,[e[10]||(e[10]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"ID",-1)),s("div",St,r(_.details["card-code"]),1)])]),s("div",Vt,[s("div",Et,[e[11]||(e[11]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"Lane",-1)),m(ce,{size:"sm",options:ye.value,placeholder:"Select lane",allowCustom:!1,"model-value":K.value,"onUpdate:modelValue":ke},null,8,["options","model-value"])]),s("div",Ut,[e[12]||(e[12]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"Assign",-1)),m(ut,{onAssign:Ue,assigneeId:Ee.value,seat:_.details.seat},null,8,["assigneeId","seat"])]),_.pin?D("",!0):(o(),l(b,{key:0},[s("div",It,[e[14]||(e[14]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"Start Date",-1)),s("div",Tt,[e[13]||(e[13]=s("i",{class:"fa-regular fa-calendar"},null,-1)),m(ue,{placeholder:"Set start date",class:"w-full","model-value":p.value.startDate,"emit-as":"ymd","onUpdate:modelValue":Se},null,8,["model-value"])])]),s("div",Pt,[e[16]||(e[16]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"Target End",-1)),s("div",{class:vt(["h-8 px-3 flex items-center gap-2 rounded-lg bg-bg-input border transition-colors",N.value?"border-red-500":"border-orchit-white/10"])},[e[15]||(e[15]=s("i",{class:"fa-regular fa-calendar"},null,-1)),m(ue,{placeholder:"Set end date",class:"w-full","model-value":p.value.endDate,"emit-as":"ymd","onUpdate:modelValue":Ve},null,8,["model-value"])],2),N.value?(o(),l("p",Bt,r(N.value),1)):D("",!0)])],64)),U(fe)?(o(),l(b,{key:1},[e[17]||(e[17]=s("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),e[18]||(e[18]=s("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),e[19]||(e[19]=s("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),e[20]||(e[20]=s("div",{class:"bg-bg-surface/40 w-full animate-pulse h-6 p-1"},null,-1))],64)):(i=U(f))!=null&&i.variables?(o(!0),l(b,{key:2},L((d=U(f))==null?void 0:d.variables,(a,E)=>(o(),l(b,{key:a.slug||`var-${E}`},[(a==null?void 0:a.type)==="Select"?(o(),l("div",Lt,[s("div",Mt,r(a.title),1),m(ce,{size:"sm",options:a==null?void 0:a.data.map(k=>({_id:k,title:k})),placeholder:"Select option",allowCustom:!1,"model-value":A[a.slug],"onUpdate:modelValue":k=>Re(k,a.slug)},null,8,["options","model-value","onUpdate:modelValue"])])):D("",!0)],64))),128)):D("",!0)])])):I.value==="history"?(o(),l("section",jt,[s("div",null,[e[23]||(e[23]=s("h3",{class:"text-sm font-semibold tracking-wide mb-3"},"History",-1)),s("ol",zt,[(o(!0),l(b,null,L(_.details.history,(a,E)=>(o(),l("li",{key:E,class:"group"},[e[22]||(e[22]=s("span",{class:"absolute -left-[5px] top-0 w-2 h-2 rounded-full bg-accent/70 ring-4 ring-accent/10"},null,-1)),s("div",At,[s("span",Ot,r(a.user.u_full_name),1),e[21]||(e[21]=s("span",{class:"text-text-secondary"}," changed ",-1)),s("span",Ft,r(a.field_name),1)])]))),128))])])])):I.value==="comments"?(o(),l("section",$t,[(o(!0),l(b,null,L(c.value??[],a=>{var E,k,oe;return o(),l("div",{key:a._id,class:"rounded-xl border border-orchit-white/10 bg-orchit-white/5 p-4 hover:bg-orchit-white/7 transition"},[s("div",qt,[s("div",Ht,r(Be((E=a.created_by)==null?void 0:E.u_full_name)),1),s("div",Kt,[s("div",Nt,r((k=a.created_by)==null?void 0:k.u_full_name),1),s("div",Rt,r(Le(a.created_at)),1)]),je(a)?(o(),l("div",Qt,[z.value!==a._id?(o(),l("button",{key:0,class:"text-xs text-accent hover:underline",onClick:h=>Oe(a)},"Edit",8,Wt)):D("",!0),s("button",{class:"text-xs text-red-400 hover:underline",onClick:h=>$e(a)},"Delete",8,Gt)])):D("",!0)]),m(B,{name:"fade",mode:"out-in"},{default:x(()=>[z.value!==a._id?(o(),l("p",{key:`c-view-${a._id}`,class:"text-[15px] leading-6"},r(a.comment_text),1)):(o(),l("div",{key:`c-edit-${a._id}`,class:"space-y-2"},[O(s("textarea",{"onUpdate:modelValue":e[4]||(e[4]=h=>V.value=h),rows:"3",class:"w-full p-3 rounded-lg bg-bg-input/80 border border-orchit-white/10 focus:ring-2 focus:ring-accent/40 outline-none"},null,512),[[W,V.value]]),s("div",Jt,[m(G,{variant:"secondary",size:"sm",onClick:R},{default:x(()=>e[24]||(e[24]=[F("Cancel")])),_:1,__:[24]}),m(G,{class:"btn",size:"sm",onClick:h=>Fe(a),disabled:!V.value.trim()||U(te)},{default:x(()=>[F(r(U(te)?"Saving…":"Save"),1)]),_:2},1032,["onClick","disabled"])])]))]),_:2},1024),(oe=a==null?void 0:a.attachments)!=null&&oe.length?(o(),l("div",Xt,[(o(!0),l(b,null,L(a.attachments,(h,Qe)=>(o(),l("a",{key:Qe,href:h.url,target:"_blank",class:"group flex items-center gap-2 rounded-lg border border-orchit-white/10 bg-orchit-white/5 px-2 py-1 hover:bg-orchit-white/10 transition"},[e[25]||(e[25]=s("i",{class:"fa-regular fa-file text-text-secondary group-hover:text-text-primary transition"},null,-1)),s("span",Zt,r(h==null?void 0:h.name),1)],8,Yt))),128))])):D("",!0)])}),128)),s("div",es,[O(s("textarea",{"onUpdate:modelValue":e[5]||(e[5]=a=>T.value=a),rows:"3",class:"w-full p-3 bg-transparent outline-none text-sm",placeholder:"Write a comment"},null,512),[[W,T.value]]),s("div",ts,[s("input",{type:"file",multiple:"",onChange:Ke,class:"text-xs text-text-secondary file:mr-3 file:px-3 file:py-1.5 file:rounded-md file:border file:border-orchit-white/10 file:bg-orchit-white/10 hover:file:bg-orchit-white/15 file:text-text-primary transition"},null,32),m(G,{variant:"primary",size:"sm",onClick:Ne,disabled:!T.value.trim()&&!P.value.length},{default:x(()=>[F(r(U(Pe)?"Posting…":"Post"),1)]),_:1},8,["disabled"])])])])):(o(),l("section",ss,[s("div",as," Files attached to this "+r(((u=_.details)==null?void 0:u.type)??"item")+". ",1),s("div",is,[(o(!0),l(b,null,L(qe.value,a=>(o(),l("div",{key:a._id,class:"rounded-2xl overflow-hidden border border-orchit-white/10 bg-orchit-white/5 hover:bg-orchit-white/8 transition group"},[s("div",os,[a.kind==="image"?(o(),l("div",ls,[s("img",{src:a.url,class:"w-full h-40 object-cover group-hover:scale-[1.02] transition"},null,8,ns)])):a.kind==="video"?(o(),l("div",ds,[s("video",{src:a.url,controls:"",class:"w-full h-40 object-cover"},null,8,rs)])):(o(),l("div",cs,e[26]||(e[26]=[s("i",{class:"fa-regular fa-file text-3xl text-text-secondary"},null,-1)]))),s("div",us,[s("div",vs,r(a.name),1),s("div",ms,r(a.kind),1)])]),s("div",ps,[s("a",{href:a.url,target:"_blank",rel:"noopener",class:"w-full inline-flex items-center justify-center gap-2 h-9 rounded-lg bg-accent text-orchit-white text-sm hover:opacity-90 transition"},e[27]||(e[27]=[s("i",{class:"fa-regular fa-arrow-up-right-from-square"},null,-1),F(" View ")]),8,hs)])]))),128))])]))]}),_:1})])],512),[[dt,_.showPanel]])]),_:1}))}}),xs=mt(fs,[["__scopeId","data-v-739613ee"]]);export{xs as default};
