import{d as H,a as J,W as Y,be as Z,bf as ee,X as te,c as r,M as B,m as ae,b as T,S as le,w as x,e as d,f as b,h as o,i as u,j as c,_ as se,G as E,F as de,x as re,A as ie,C as ne,y as U,U as z,t as k,bg as oe,B as I,n as q,o as i}from"./index-CGmi0vIW.js";const ue={class:"px-6 grid grid-cols-2 gap-4"},ce={key:0,class:"flex flex-col"},pe={key:1,class:"flex gap-1 flex-col"},me={key:0,class:"text-xs text-red-500"},fe={key:2,class:"flex gap-1 flex-col"},ve={key:0,class:"text-xs text-red-500"},be={class:"px-6 mt-2"},De={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},_e=H({__name:"CreateTaskModal",props:{modelValue:{type:Boolean,default:!1},sheet_id:{},listId:{},selectedVariable:{},pin:{},size:{default:"lg"}},emits:["update:modelValue","created"],setup(A,{emit:L}){const $=L,n=A,N=J(),{workspaceId:D,moduleId:O}=Y(),{mutate:M,isPending:g}=Z({onSuccess:()=>{w(),N.invalidateQueries({queryKey:["sheet-list"]}),m.value=!1}}),{data:_}=ee(D.value),{data:p}=te(D.value,O.value),m=r({get:()=>n.modelValue,set:t=>$("update:modelValue",t)}),y=r(()=>((p==null?void 0:p.value)??[]).filter(t=>{var a;return((a=t==null?void 0:t.type)==null?void 0:a.title)==="Select"})),P=t=>t.map(a=>({_id:a,title:a})),S=r(()=>((_==null?void 0:_.value)??[]).map(t=>{var a;return{_id:t._id,title:((a=t==null?void 0:t.variables)==null?void 0:a["lane-title"])??String(t._id)}})),h=t=>t.slug,e=B({title:"",description:"",startDate:null,endDate:null,lane_id:null,variables:{}});ae(y,t=>{for(const a of t){const l=h(a);l in e.variables||(e.variables[l]=null)}},{immediate:!0});const s=B({title:!1,description:!1,startDate:!1,endDate:!1,lane:!1}),V=r(()=>s.title&&!e.title.trim()?"Title is required":""),f=r(()=>s.startDate?e.startDate?"":"Start date is required":""),v=r(()=>s.endDate?e.endDate?e.startDate&&e.endDate&&e.endDate<e.startDate?"End date cannot be before start date":"":"End date is required":""),j=r(()=>s.lane&&(e.lane_id===null||e.lane_id===void 0||e.lane_id==="")?"Lane is required":""),C=r(()=>!V.value&&!f.value&&!v.value&&!j.value&&!!e.title.trim()&&(n.pin?!0:!!e.startDate&&!!e.endDate));function F(t){e.startDate=t,s.startDate=!0}function K(t){e.endDate=t,s.endDate=!0}function Q(t){e.lane_id=t,s.lane=!0}function R(){m.value=!1,w()}function w(){e.title="",e.description="",e.startDate=null,e.endDate=null,e.lane_id=null,e.variables={},s.title=!1,s.description=!1,s.startDate=!1,s.endDate=!1,s.lane=!1}const W=r(()=>p.value.find(t=>(t==null?void 0:t._id)==n.selectedVariable));function G(){var a;if(s.title=!0,n.pin||(s.startDate=!0,s.endDate=!0),!C.value||g.value)return;const t={sheet_list_id:n.listId,workspace_id:D.value,sheet_id:n.sheet_id,workspace_lane_id:e.lane_id,variables:{...e.variables,[`${(a=W.value)==null?void 0:a.slug}`]:n.listId,"card-title":e.title.trim(),"card-description":e.description.trim(),"start-date":e.startDate,"end-date":e.endDate},createdAt:new Date().toISOString()};M(t)}return(t,a)=>(i(),T(le,{modelValue:m.value,"onUpdate:modelValue":a[4]||(a[4]=l=>m.value=l),modalClass:"!py-0",size:t.size},{default:x(()=>[a[8]||(a[8]=d("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[d("h2",{class:"text-xl font-semibold"},"Create Ticket"),d("p",{class:"text-sm text-text-secondary mt-1"},[b(" Provide the details below and click "),d("span",{class:"font-medium"},"Add Ticket"),b(". ")])],-1)),d("div",ue,[o(se,{modelValue:e.title,"onUpdate:modelValue":a[0]||(a[0]=l=>e.title=l),label:"Ticket Title",placeholder:"e.g., Implement real-time notifications",error:!!V.value,message:V.value,onBlur:a[1]||(a[1]=l=>s.title=!0)},null,8,["modelValue","error","message"]),S.value.length>0?(i(),u("div",ce,[o(E,{size:"md",label:"Lane",options:S.value,placeholder:"Select lane",allowCustom:!1,"model-value":e.lane_id,"onUpdate:modelValue":Q},null,8,["options","model-value"])])):c("",!0),(i(!0),u(de,null,re(y.value,l=>ie((i(),T(E,{size:"md",key:h(l),modelValue:e.variables[l.slug],"onUpdate:modelValue":X=>e.variables[l.slug]=X,options:P(l.data),label:l.title,placeholder:"Select value",allowCustom:!0},null,8,["modelValue","onUpdate:modelValue","options","label"])),[[ne,(l==null?void 0:l._id)!=t.selectedVariable]])),128)),t.pin?c("",!0):(i(),u("div",pe,[a[5]||(a[5]=d("label",{class:"text-sm"},"Start date",-1)),d("div",{class:U(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",f.value?"border-red-500":""])},[o(z,{placeholder:"Set start date",class:"w-full","model-value":e.startDate,"emit-as":"ymd","onUpdate:modelValue":F},null,8,["model-value"])],2),f.value?(i(),u("p",me,k(f.value),1)):c("",!0)])),t.pin?c("",!0):(i(),u("div",fe,[a[6]||(a[6]=d("label",{class:"text-sm"},"End date",-1)),d("div",{class:U(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",v.value?"border-red-500":""])},[o(z,{placeholder:"Set end date",class:"w-full","model-value":e.endDate,"emit-as":"ymd","onUpdate:modelValue":K},null,8,["model-value"])],2),v.value?(i(),u("p",ve,k(v.value),1)):c("",!0)]))]),d("div",be,[o(oe,{label:"Description",placeholder:"What needs to be done, acceptance criteria, links…",onBlur:a[2]||(a[2]=l=>s.description=!0),modelValue:e.description,"onUpdate:modelValue":a[3]||(a[3]=l=>e.description=l)},null,8,["modelValue"])]),d("div",De,[o(I,{variant:"secondary",onClick:R},{default:x(()=>a[7]||(a[7]=[b("Cancel")])),_:1,__:[7]}),o(I,{variant:"primary",disabled:!C.value||q(g),onClick:G},{default:x(()=>[b(k(q(g)?"Adding…":"Add Ticket"),1)]),_:1},8,["disabled"])])]),_:1,__:[8]},8,["modelValue","size"]))}});export{_e as _};
