import{d as Z,c as O,r as b,v as ae,e as le,o as r,w as S,h as a,l as d,m as $,D as ie,ac as oe,j as f,P as ne,F as G,y as re,z as de,a8 as j,p as c,b2 as J,t as m,Q as R,i as V,k as v,B as X,X as ue,V as ce,W as me,bF as pe,N as fe,g as ge}from"./index-DKq_QMoF.js";import{_ as ve}from"./DropMenu.vue_vue_type_script_setup_true_lang-DRhy89co.js";import{l as be,m as ye,n as ke,o as we}from"./usePeople-CmbV8zN0.js";import{_ as xe}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-DQBlfvEi.js";const he={class:"px-6 pb-2"},_e={class:"relative mb-4"},Ce=["onKeydown"],Se={key:0,class:"mt-3"},Ve={class:"divide-y divide-border rounded-xl border border-border bg-bg-card"},$e=["onClick"],Ae={class:"flex items-center gap-3 min-w-0"},Te=["src"],De={class:"min-w-0"},Me={class:"truncate font-medium leading-tight capitalize"},Ue={class:"truncate text-xs text-text-secondary leading-tight"},Ne={key:1,class:"mt-3 flex items-center gap-2"},je={class:"inline-flex items-center gap-2 rounded-full px-3 py-2 bg-bg-muted text-text-secondary"},qe={class:"flex items-center justify-between gap-3 p-6 mt-3 pb-2 border-t border-border bg-bg-body"},ze={class:"flex gap-2 justify-between w-full"},Be=Z({__name:"AssignmentModal",props:{modelValue:{type:Boolean,default:!1},members:{default:()=>[]},directory:{default:()=>[]},placeholder:{default:"Search people by name or email"},isSubmitting:{}},emits:["update:modelValue","submit","copy-link"],setup(A,{emit:T}){const x=A,h=T,u=O({get:()=>x.modelValue,set:i=>h("update:modelValue",i)}),l=b(""),n=b(""),D=b(""),y=O(()=>{const i=l.value.trim().toLowerCase();return x.directory.filter(o=>{var t;return((t=o.name)==null?void 0:t.toLowerCase().includes(i))||o.email.toLowerCase().includes(i)})}),M=i=>{n.value=i.email,l.value=""},p=()=>{n.value=""},k=()=>{l.value&&(n.value=l.value.trim(),l.value="")},_=i=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i),U=()=>{if(!n.value||!_(n.value)){D.value="Please select a valid email.";return}h("submit",{invite:{email:n.value}})},N=()=>{p(),l.value="",u.value=!1};return ae(()=>{u.value&&(l.value="")}),(i,o)=>(r(),le(ue,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=t=>u.value=t),size:"md"},{default:S(()=>[o[3]||(o[3]=a("div",{class:"sticky top-0 z-10 flex items-start gap-2 px-6 pb-4 mb-4 border-b border-border bg-bg-body"},[a("h2",{class:"text-xl font-semibold"},"Add team member")],-1)),a("div",he,[a("div",_e,[ie(a("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>l.value=t),type:"text",placeholder:"Search or add email",class:"w-full h-11 rounded-xl border border-border bg-bg-input px-3 text-sm outline-none focus:ring-2 focus:ring-primary/40",onKeydown:oe(f(k,["prevent"]),["enter"])},null,40,Ce),[[ne,l.value]])]),y.value.length?(r(),d("div",Se,[a("ul",Ve,[(r(!0),d(G,null,re(y.value,t=>(r(),d("li",{key:t.id||t.email,class:de(["flex items-center justify-between gap-3 px-3 py-3 cursor-pointer hover:bg-bg-muted",{"bg-bg-muted":n.value===t.email}]),onClick:q=>M(t)},[a("div",Ae,[t!=null&&t.profile_image?(r(),d("img",{key:0,class:"h-9 w-9 rounded-full aspect-square",src:t==null?void 0:t.profile_image,alt:"avatar"},null,8,Te)):(r(),d("div",{key:1,class:"h-9 w-9 bg-white capitalize rounded-full flex items-center justify-center text-xs font-semibold",style:j({backgroundColor:c(J)({email:t.email})})},m(c(R)(t.name||t.email)),5)),a("div",De,[a("div",Me,m(t.name||t.email),1),a("div",Ue,m(t.email),1)])])],10,$e))),128))])])):$("",!0),n.value?(r(),d("div",Ne,[a("span",je,[V(m(n.value)+" ",1),a("button",{onClick:p,class:"ml-2 text-sm text-red-500"},"✕")])])):$("",!0)]),a("div",qe,[a("div",ze,[v(X,{variant:"secondary",onClick:N},{default:S(()=>o[2]||(o[2]=[V("Cancel")])),_:1,__:[2]}),v(X,{variant:"primary",disabled:!!(!n.value||i.isSubmitting),onClick:U},{default:S(()=>[V(m(i.isSubmitting?"Assigning…":"Assign"),1)]),_:1},8,["disabled"])])])]),_:1,__:[3]},8,["modelValue"]))}}),Ie={class:"flex justify-between gap-2 items-start w-full"},Pe={class:"flex items-center gap-2 w-[90%]"},Ee=["src"],Ke={key:0,class:"fa-solid fa-user text-white"},Le={class:"max-w-[70%]"},Fe={class:"text-sm font-medium mb-1 text-card-foreground leading-tight w-full"},Qe={class:"text-text-secondary text-xs overflow-hidden overflow-ellipsis"},He={key:0,class:"group-hover:flex justify-center items-center hidden w-6 h-6 bg-bg-surface/40 rounded-md"},Ge=Z({__name:"KanbanCard",props:{ticket:{}},setup(A){const{canInviteUser:T,canEditUser:x,canDeleteUser:h}=ce(),u=b(!1),l=A,{workspaceId:n}=me(),{data:D}=pe(),{data:y}=be(n.value,D),M=b([]),p=b(!1),k=fe();function _(){var s,e;return[T.value?{label:"Assign User",danger:!0,action:()=>{u.value=!0},icon:{prefix:"fa-regular",iconName:"fa-user-plus"}}:null,l.ticket.name&&x.value?{label:"UnAssign User",danger:!0,action:()=>{se()},icon:{prefix:"fa-regular",iconName:"fa-user-minus"}}:null,h.value&&((e=(s=l.ticket)==null?void 0:s.role_title)==null?void 0:e.toLowerCase())!=="admin"?{label:"Delete Seat",danger:!0,action:()=>{p.value=!0},icon:{prefix:"fa-regular",iconName:"fa-trash"}}:null].filter(Boolean)}const U=()=>{},{mutate:N,isPending:i}=ye({onSuccess:()=>{k.invalidateQueries({queryKey:["people-lists"]})}}),o=()=>{N({id:l.ticket._id})},{mutate:t,isPending:q}=ke({onSuccess:()=>{u.value=!1,k.invalidateQueries({queryKey:["people-lists"]})}});function Y(s){const C=(s.split("@")[0]||"").split("+")[0].split(/[^a-zA-Z]+/).filter(Boolean);return C.length?C.map(w=>w.charAt(0).toUpperCase()+w.slice(1).toLowerCase()).join(" "):s}const{mutate:ee}=we({onSuccess:()=>{u.value=!1,k.invalidateQueries({queryKey:["people-lists"]})}});function te(s){t({id:l.ticket._id,payload:{name:Y(s.email),email:s.email}})}function se(){ee({id:l.ticket._id})}return(s,e)=>{var w,z,B,I,P,E,K,L,F,Q,H,W;const C=ge("AssigmentDropdown");return r(),d(G,null,[a("div",{onClick:e[2]||(e[2]=g=>s.$emit("click")),class:"group bg-bg-card rounded-lg p-4 shadow-sm cursor-grab hover:shadow-md transition-all duration-200 active:cursor-grabbing",style:j({borderColor:(z=(w=s.ticket)==null?void 0:w.lane)==null?void 0:z.variables["lane-color"]})},[a("div",Ie,[a("div",Pe,[(B=s.ticket)!=null&&B.avatar?(r(),d("img",{key:0,src:(I=s.ticket)==null?void 0:I.avatar,class:"min-w-10 w-10 h-10 rounded-full object-cover",alt:"avartar"},null,8,Ee)):(r(),d("div",{key:1,class:"w-10 min-w-10 overflow-hidden overflow-ellipsis aspect-square bg-bg-surface flex justify-center items-center rounded-full",style:j({backgroundColor:(P=s.ticket)!=null&&P.name?c(J)({email:(E=s.ticket)==null?void 0:E.email}):""})},[V(m(c(R)((K=s.ticket)==null?void 0:K.name))+" ",1),(L=s.ticket)!=null&&L.name?$("",!0):(r(),d("i",Ke))],4)),a("div",Le,[a("h3",Fe,m(((F=s.ticket)==null?void 0:F.name)??s.ticket.title??"Team Member "),1),a("p",Qe,m((Q=s.ticket)==null?void 0:Q.email),1)])]),_().length>0?(r(),d("div",He,[v(ve,{onClick:e[0]||(e[0]=f(()=>{},["stop"])),items:_()},{trigger:S(()=>e[11]||(e[11]=[a("i",{class:"cursor-pointer fa-solid fa-ellipsis"},null,-1)])),_:1},8,["items"])])):$("",!0)]),a("div",{onClick:e[1]||(e[1]=f(()=>{},["stop"]))},[v(C,{users:M.value,onAssign:U,assigneeId:s.ticket.assigned_to},null,8,["users","assigneeId"])])],4),a("div",{class:"no-drag-zone",draggable:"false",onMousedown:e[8]||(e[8]=f(()=>{},["stop"])),onTouchstart:e[9]||(e[9]=f(()=>{},["stop"])),onPointerdown:e[10]||(e[10]=f(()=>{},["stop"]))},[v(xe,{onClick:e[3]||(e[3]=f(()=>{},["stop"])),modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=g=>p.value=g),title:"Delete Team seat",itemLabel:"Seat",itemName:s.ticket.title,requireMatchText:s.ticket.title,confirmText:"Delete Seat",cancelText:"Cancel",size:"md",loading:c(i),onConfirm:o,onCancel:e[5]||(e[5]=()=>{p.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),v(Be,{isSubmitting:c(q),modelValue:u.value,"onUpdate:modelValue":e[6]||(e[6]=g=>u.value=g),members:(H=c(y))==null?void 0:H.people,directory:(W=c(y))==null?void 0:W.people,onSubmit:e[7]||(e[7]=({invite:g})=>te(g))},null,8,["isSubmitting","modelValue","members","directory"])],32)],64)}}});export{Ge as default};
