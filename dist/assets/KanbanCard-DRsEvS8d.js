import{d as Z,c as O,r as k,v as ae,e as ie,o as r,w as A,h as a,l as d,m as T,D as le,ae as oe,j as v,P as ne,F as G,y as re,z as de,aa as z,p,b3 as J,t as f,Q as R,i as $,k as y,B as X,X as ue,V as ce,W as me,bF as pe,N as fe,g as ge}from"./index-3w28LvKY.js";import{_ as ve}from"./DropMenu.vue_vue_type_script_setup_true_lang-DlRUBVbF.js";import{l as be,m as ye,n as ke,o as we}from"./usePeople-9gUVzwJ9.js";import{_ as xe}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-gVFgjU9z.js";const he={class:"px-6 pb-2"},_e={class:"relative mb-4"},Ce=["onKeydown"],Se={key:0,class:"mt-3"},Ve={class:"divide-y divide-border rounded-xl border border-border bg-bg-card"},Ae=["onClick"],$e={class:"flex items-center gap-3 min-w-0"},Te=["src"],Ue={class:"min-w-0"},De={class:"truncate font-medium leading-tight capitalize"},Me={class:"truncate text-xs text-text-secondary leading-tight"},Ne={key:1,class:"mt-3 flex items-center gap-2"},je={class:"inline-flex items-center gap-2 rounded-full px-3 py-2 bg-bg-muted text-text-secondary"},qe={class:"flex items-center justify-between gap-3 p-6 mt-3 pb-2 border-t border-border bg-bg-body"},ze={class:"flex gap-2 justify-between w-full"},Be=Z({__name:"AssignmentModal",props:{modelValue:{type:Boolean,default:!1},members:{default:()=>[]},directory:{default:()=>[]},placeholder:{default:"Search people by name or email"},isSubmitting:{}},emits:["update:modelValue","submit","copy-link"],setup(U,{emit:D}){const C=U,S=D,u=O({get:()=>C.modelValue,set:l=>S("update:modelValue",l)}),i=k(""),n=k(""),M=k(""),w=O(()=>{const l=i.value.trim().toLowerCase();return C.directory.filter(o=>{var t;return((t=o.name)==null?void 0:t.toLowerCase().includes(l))||o.email.toLowerCase().includes(l)})}),N=l=>{n.value=l.email,i.value=""},g=()=>{n.value=""},x=()=>{i.value&&(n.value=i.value.trim(),i.value="")},V=l=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l),j=()=>{if(!n.value||!V(n.value)){M.value="Please select a valid email.";return}S("submit",{invite:{email:n.value}})},q=()=>{g(),i.value="",u.value=!1};return ae(()=>{u.value&&(i.value="")}),(l,o)=>(r(),ie(ue,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=t=>u.value=t),size:"md"},{default:A(()=>[o[3]||(o[3]=a("div",{class:"sticky top-0 z-10 flex items-start gap-2 px-6 pb-4 mb-4 border-b border-border bg-bg-body"},[a("h2",{class:"text-xl font-semibold"},"Add team member")],-1)),a("div",he,[a("div",_e,[le(a("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>i.value=t),type:"text",placeholder:"Search or add email",class:"w-full h-11 rounded-xl border border-border bg-bg-input px-3 text-sm outline-none focus:ring-2 focus:ring-primary/40",onKeydown:oe(v(x,["prevent"]),["enter"])},null,40,Ce),[[ne,i.value]])]),w.value.length?(r(),d("div",Se,[a("ul",Ve,[(r(!0),d(G,null,re(w.value,t=>(r(),d("li",{key:t.id||t.email,class:de(["flex items-center justify-between gap-3 px-3 py-3 cursor-pointer hover:bg-bg-muted",{"bg-bg-muted":n.value===t.email}]),onClick:B=>N(t)},[a("div",$e,[t!=null&&t.profile_image?(r(),d("img",{key:0,class:"h-9 w-9 rounded-full aspect-square",src:t==null?void 0:t.profile_image,alt:"avatar"},null,8,Te)):(r(),d("div",{key:1,class:"h-9 w-9 bg-white capitalize rounded-full flex items-center justify-center text-xs font-semibold",style:z({backgroundColor:p(J)({email:t.email})})},f(p(R)(t.name||t.email)),5)),a("div",Ue,[a("div",De,f(t.name||t.email),1),a("div",Me,f(t.email),1)])])],10,Ae))),128))])])):T("",!0),n.value?(r(),d("div",Ne,[a("span",je,[$(f(n.value)+" ",1),a("button",{onClick:g,class:"ml-2 text-sm text-red-500"},"✕")])])):T("",!0)]),a("div",qe,[a("div",ze,[y(X,{variant:"secondary",onClick:q},{default:A(()=>o[2]||(o[2]=[$("Cancel")])),_:1,__:[2]}),y(X,{variant:"primary",disabled:!!(!n.value||l.isSubmitting),onClick:j},{default:A(()=>[$(f(l.isSubmitting?"Assigning…":"Assign"),1)]),_:1},8,["disabled"])])])]),_:1,__:[3]},8,["modelValue"]))}}),Ie={class:"flex justify-between gap-2 items-start w-full"},Pe={class:"flex items-center gap-2 w-[90%]"},Ee=["src"],Ke={key:0,class:"fa-solid fa-user text-white"},Le={class:"max-w-[70%]"},Fe={class:"text-sm font-medium mb-1 text-card-foreground leading-tight w-full"},Qe={class:"text-text-secondary text-xs overflow-hidden overflow-ellipsis"},He={key:0,class:"group-hover:flex justify-center items-center hidden w-6 h-6 bg-bg-surface/40 rounded-md"},Ge=Z({__name:"KanbanCard",props:{ticket:{}},setup(U){const{canInviteUser:D,canEditUser:C,canDeleteUser:S}=ce(),u=k(!1),i=U,{workspaceId:n}=me(),{data:M}=pe(),{data:w}=be(n.value,M),N=k([]),g=k(!1),x=fe();function V(){var m,h,_;const s=((h=(m=i.ticket)==null?void 0:m.role_title)==null?void 0:h.toLowerCase())==="admin",e=!!((_=i.ticket)!=null&&_.name),c=[];return D.value&&!s&&c.push({label:"Assign User",danger:!0,action:()=>{u.value=!0},icon:{prefix:"fa-regular",iconName:"fa-user-plus"}}),e&&C.value&&!s&&c.push({label:"UnAssign User",danger:!0,action:se,icon:{prefix:"fa-regular",iconName:"fa-user-minus"}}),S.value&&!s&&c.push({label:"Delete Seat",danger:!0,action:()=>{g.value=!0},icon:{prefix:"fa-regular",iconName:"fa-trash"}}),c}const j=()=>{},{mutate:q,isPending:l}=ye({onSuccess:()=>{x.invalidateQueries({queryKey:["people-lists"]})}}),o=()=>{q({id:i.ticket._id})},{mutate:t,isPending:B}=ke({onSuccess:()=>{u.value=!1,x.invalidateQueries({queryKey:["people-lists"]})}});function Y(s){const c=(s.split("@")[0]||"").split("+")[0].split(/[^a-zA-Z]+/).filter(Boolean);return c.length?c.map(m=>m.charAt(0).toUpperCase()+m.slice(1).toLowerCase()).join(" "):s}const{mutate:ee}=we({onSuccess:()=>{u.value=!1,x.invalidateQueries({queryKey:["people-lists"]})}});function te(s){t({id:i.ticket._id,payload:{name:Y(s.email),email:s.email}})}function se(){ee({id:i.ticket._id})}return(s,e)=>{var m,h,_,I,P,E,K,L,F,Q,H,W;const c=ge("AssigmentDropdown");return r(),d(G,null,[a("div",{onClick:e[2]||(e[2]=b=>s.$emit("click")),class:"group bg-bg-card rounded-lg p-4 shadow-sm cursor-grab hover:shadow-md transition-all duration-200 active:cursor-grabbing",style:z({borderColor:(h=(m=s.ticket)==null?void 0:m.lane)==null?void 0:h.variables["lane-color"]})},[a("div",Ie,[a("div",Pe,[(_=s.ticket)!=null&&_.avatar?(r(),d("img",{key:0,src:(I=s.ticket)==null?void 0:I.avatar,class:"min-w-10 w-10 h-10 rounded-full object-cover",alt:"avartar"},null,8,Ee)):(r(),d("div",{key:1,class:"w-10 min-w-10 overflow-hidden overflow-ellipsis aspect-square bg-bg-surface flex justify-center items-center rounded-full",style:z({backgroundColor:(P=s.ticket)!=null&&P.name?p(J)({email:(E=s.ticket)==null?void 0:E.email}):""})},[$(f(p(R)((K=s.ticket)==null?void 0:K.name))+" ",1),(L=s.ticket)!=null&&L.name?T("",!0):(r(),d("i",Ke))],4)),a("div",Le,[a("h3",Fe,f(((F=s.ticket)==null?void 0:F.name)??s.ticket.title??"Team Member "),1),a("p",Qe,f((Q=s.ticket)==null?void 0:Q.email),1)])]),V().length>0?(r(),d("div",He,[y(ve,{onClick:e[0]||(e[0]=v(()=>{},["stop"])),items:V()},{trigger:A(()=>e[11]||(e[11]=[a("i",{class:"cursor-pointer fa-solid fa-ellipsis"},null,-1)])),_:1},8,["items"])])):T("",!0)]),a("div",{onClick:e[1]||(e[1]=v(()=>{},["stop"]))},[y(c,{users:N.value,onAssign:j,assigneeId:s.ticket.assigned_to},null,8,["users","assigneeId"])])],4),a("div",{class:"no-drag-zone",draggable:"false",onMousedown:e[8]||(e[8]=v(()=>{},["stop"])),onTouchstart:e[9]||(e[9]=v(()=>{},["stop"])),onPointerdown:e[10]||(e[10]=v(()=>{},["stop"]))},[y(xe,{onClick:e[3]||(e[3]=v(()=>{},["stop"])),modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=b=>g.value=b),title:"Delete Team seat",itemLabel:"Seat",itemName:s.ticket.title,requireMatchText:s.ticket.title,confirmText:"Delete Seat",cancelText:"Cancel",size:"md",loading:p(l),onConfirm:o,onCancel:e[5]||(e[5]=()=>{g.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),y(Be,{isSubmitting:p(B),modelValue:u.value,"onUpdate:modelValue":e[6]||(e[6]=b=>u.value=b),members:(H=p(w))==null?void 0:H.people,directory:(W=p(w))==null?void 0:W.people,onSubmit:e[7]||(e[7]=({invite:b})=>te(b))},null,8,["isSubmitting","modelValue","members","directory"])],32)],64)}}});export{Ge as default};
