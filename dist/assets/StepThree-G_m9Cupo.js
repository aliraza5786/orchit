import{_ as S}from"./whitePlus-Cs_P7rE9.js";import{d as P,u as U,r as b,O as q,c as F,C as G,m as i,o as l,g as a,t as p,G as y,E as w,n as v,k as r,h as m,w as u,B as x,_ as H}from"./index-DXI5uxQE.js";import{_ as O}from"./BaseTextAreaField.vue_vue_type_script_setup_true_lang-7ZV-vSYp.js";import{_ as J}from"./BaseEmailChip.vue_vue_type_script_setup_true_lang-Dxkn7peG.js";const K={class:"w-full"},Q={class:"text-sm md:text-base text-text-secondary text-left mt-3 sm:mt-5 mb-0"},X={class:"space-y-3 w-full pb-[60px]"},Y={class:"flex items-center justify-between mb-2"},Z={class:"flex gap-4 items-start text-2xl justify-between w-full"},ee={class:"flex flex-col text-text-primary text-lg font-semibold flex-1 min-w-0"},te={key:0,class:"text-xl mr-2"},se={class:"text-sm text-text-secondary break-words"},ae={class:"flex items-center gap-3 text-text-primary flex-shrink-0"},ne=["onClick","title","aria-label"],oe={key:0},ie={key:1,class:"text-base cursor-pointer"},le={class:"text-lg"},pe=["onClick"],me={class:"text-text-primary"},re={class:"text-sm font-medium text-text-secondary mb-2 flex justify-between items-center gap-2.5"},ce={class:"flex items-center gap-2"},de={class:"text-xs text-text-secondary"},ue={key:0,class:"text-sm text-text-secondary mb-3"},xe={class:"text-sm font-medium capitalize"},_e={class:"text-xs text-text-secondary"},fe=["onClick"],ye={key:1,class:"mt-2 space-y-2"},ve={class:"flex items-center justify-end gap-2"},ge={key:1,class:"bg-bg-surface mt-2 cursor-pointer rounded-xl p-6"},be={class:"flex gap-2 mt-6 justify-end"},je=P({__name:"StepThree",props:{ai:{type:Boolean}},setup(we,{expose:h}){const f=U(),_=b(!1),o=b({name:"",description:""}),c=q({roles:[]}),k=/^[^\s@]+@[^\s@]+\.[^\s@]+$/i,C=e=>k.test(e);function E(e){e.showInput=!0,e.capacityWarning=e.people.length>=e.max_num_people}function g(e){for(;e.people.length>e.max_num_people;)e.people.pop();e.capacityWarning=e.people.length>=e.max_num_people}function I(e,s){e.people.some(t=>t.email.toLowerCase()===s.toLowerCase())||e.people.push({name:s.split("@")[0],email:s})}function j(e,s){const[t]=e.people.splice(s,1),n=e.emailList.findIndex(d=>d.toLowerCase()===t.email.toLowerCase());n!==-1&&e.emailList.splice(n,1),e.capacityWarning=e.people.length>=e.max_num_people}function L(e,s){e.emailError=s.length?`Invalid: ${s.join(", ")}`:""}function V(e,s){s.forEach(t=>{C(t)&&(e.people.length<e.max_num_people?I(e,t):e.capacityWarning=!0)})}function W(e,s){const t=e.people.findIndex(n=>n.email.toLowerCase()===s.toLowerCase());t!==-1&&e.people.splice(t,1),e.capacityWarning=e.people.length>=e.max_num_people}function $(e){e.showInput=!1,e.capacityWarning=e.people.length>=e.max_num_people}function T(e){e.showInput=!1,e.emailError="",e.capacityWarning=e.people.length>=e.max_num_people}const A=F(()=>!o.value.name.trim()||!o.value.description.trim());function N(){if(!o.value.name.trim()||!o.value.description.trim())return;const e={id:`role-${Date.now()}`,title:o.value.name,description:o.value.description,people:[],showInput:!1,max_num_people:1,role_emoji:"",emailList:[],emailError:"",capacityWarning:!1};c.roles.push(e),o.value.name="",o.value.description="",_.value=!1}function R(){const e=f.workspace,s=e||{variables:{roles:[]}};s.variables.roles=c.roles,f.setWorkspace(s)}G(()=>{try{const e=f.workspace;if(e){const s=e;c.roles=(s.variables.roles||[]).map(t=>{var n;return{...t,showInput:t.showInput??!1,emailList:t.emailList??((n=t.people)==null?void 0:n.map(d=>d.email))??[],emailError:"",capacityWarning:!1,max_num_people:typeof t.max_num_people=="number"?t.max_num_people:1,role_emoji:t.role_emoji??""}})}}catch(e){console.error("Error parsing workspace from localStorage",e)}});function z(e){e.max_num_people>1&&(e.max_num_people--,g(e))}function D(e){e.max_num_people++,g(e)}function M(){R()}function B(e){const s=c.roles.findIndex(t=>t.id===e);s!==-1&&c.roles.splice(s,1)}return h({continueHandler:M}),(e,s)=>(l(),i(y,null,[a("div",K,[s[4]||(s[4]=a("h2",{class:"text-2xl md:text-4xl font-semibold text-text-primary text-left m-0"},"Team Resources",-1)),a("p",Q,p(e.ai?" AI-recommended team composition for your project":"Team composition for your project"),1)]),a("div",X,[(l(!0),i(y,null,w(c.roles,t=>(l(),i("div",{key:t.id,class:"bg-bg-surface rounded-xl p-6"},[a("div",Y,[a("div",Z,[a("div",ee,[a("span",null,[t!=null&&t.role_emoji?(l(),i("span",te,p(t.role_emoji),1)):v("",!0),r(" "+p(t.title),1)]),a("p",se,p(t.description),1)]),a("div",ae,[a("button",{onClick:n=>t.max_num_people===1?B(t.id):z(t),class:"w-8 cursor-pointer h-8 aspect-square rounded-full bg-bg-card flex items-center justify-center text-xl",title:t.max_num_people===1?"Remove team":"Decrease capacity","aria-label":t.max_num_people===1?"Remove team":"Decrease capacity"},[t.max_num_people>1?(l(),i("span",oe,"−")):(l(),i("span",ie,s[5]||(s[5]=[a("i",{class:"fa-regular fa-trash"},null,-1)])))],8,ne),a("span",le,p(t.max_num_people),1),a("button",{onClick:n=>D(t),class:"w-8 h-8 aspect-square cursor-pointer rounded-full bg-bg-card flex items-center justify-center text-xl",title:"Increase capacity","aria-label":"Increase capacity"},"+",8,pe)])])]),a("div",me,[a("p",re,[s[7]||(s[7]=r(" Team Members ")),a("span",ce,[a("span",de,p(t.people.length)+"/"+p(t.max_num_people),1),m(x,{size:"sm",variant:"secondary",onClick:n=>E(t),disabled:t.people.length>=t.max_num_people,title:"Add people by email"},{default:u(()=>s[6]||(s[6]=[r(" Add people ")])),_:2,__:[6]},1032,["onClick","disabled"])])]),t.people.length===0?(l(),i("div",ue," No team members assigned yet ")):v("",!0),(l(!0),i(y,null,w(t.people,(n,d)=>(l(),i("div",{key:d,class:"flex justify-between items-center mb-3"},[a("div",null,[a("p",xe,p(n.name),1),a("p",_e,p(n.email),1)]),a("button",{onClick:he=>j(t,d),class:"text-text-primary w-8 h-8 bg-bg-card rounded-md cursor-pointer"},"✕",8,fe)]))),128)),t.showInput?(l(),i("div",ye,[m(J,{modelValue:t.emailList,"onUpdate:modelValue":n=>t.emailList=n,error:!!t.emailError||t.capacityWarning,message:t.capacityWarning?`Reached role capacity (${t.max_num_people}).`:t.emailError||"Press Enter, comma, semicolon, or space to add. Invalid entries won’t be added.",showName:"",onInvalid:n=>L(t,n),onAdd:n=>V(t,n),onRemove:n=>W(t,n)},null,8,["modelValue","onUpdate:modelValue","error","message","onInvalid","onAdd","onRemove"]),a("div",ve,[m(x,{onClick:n=>$(t),variant:"primary"},{default:u(()=>s[8]||(s[8]=[r("Done")])),_:2,__:[8]},1032,["onClick"]),m(x,{onClick:n=>T(t),variant:"secondary"},{default:u(()=>s[9]||(s[9]=[r("Cancel")])),_:2,__:[9]},1032,["onClick"])])])):v("",!0)])]))),128)),_.value?(l(),i("div",ge,[s[13]||(s[13]=a("h1",{class:"text-lg text-text-primary font-semibold"},"Add New Team",-1)),s[14]||(s[14]=a("br",null,null,-1)),m(H,{label:"Team Name",modelValue:o.value.name,"onUpdate:modelValue":s[1]||(s[1]=t=>o.value.name=t),placeholder:"Enter Team Name",size:"lg"},null,8,["modelValue"]),m(O,{label:"Description",class:"mt-4",modelValue:o.value.description,"onUpdate:modelValue":s[2]||(s[2]=t=>o.value.description=t),placeholder:"Enter Description",size:"lg"},null,8,["modelValue"]),a("div",be,[m(x,{disabled:A.value,size:"md",variant:"primary",onClick:N},{default:u(()=>s[11]||(s[11]=[r(" Add Team ")])),_:1,__:[11]},8,["disabled"]),m(x,{size:"md",variant:"secondary",onClick:s[3]||(s[3]=t=>_.value=!1)},{default:u(()=>s[12]||(s[12]=[r("Cancel")])),_:1,__:[12]})])])):(l(),i("div",{key:0,class:"bg-bg-surface mt-2 cursor-pointer rounded-xl p-6 flex flex-col justify-center items-center",onClick:s[0]||(s[0]=t=>_.value=!0)},s[10]||(s[10]=[a("div",{class:"p-2.5 bg-accent w-8 h-8 rounded-full"},[a("img",{class:"w-3",src:S,alt:""})],-1),a("h3",{class:"font-medium text-text-primary capitalize text-sm mt-4"},"Add New Team",-1),a("p",{class:"text-[11px] text-text-secondary mt-1 text-start line-clamp-1"},"Create a custom resource type",-1)])))])],64))}});export{je as default};
