import{d as M,a as W,r as l,c as x,b as U,u as D,e as N,x as O,f as j,w as v,o as h,g as a,h as m,i as w,j as G,l as J,m as $,n as C,_ as k,y as Y,z as Z,k as d,t as S,B as z,p as H,q as K,v as Q}from"./index-CXKL2_To.js";import{_ as X,a as ee}from"./AuthLayout.vue_vue_type_script_setup_true_lang-CrSk79PI.js";import{r as te,s as se}from"./auth-DHMG2vUV.js";import{d as ae,l as re}from"./dark-logo-Mcb_sJlF.js";const oe={class:"max-w-[500px] md:mx-auto w-full md:pt-10"},le=["src"],ne={class:"flex items-start gap-2"},ue={key:0,class:"text-red-500 text-[12px]"},ie={key:1,class:"text-red-500 text-sm text-center mt-2"},me={class:"text-sm font-medium text-text-secondary text-center mt-8"},ge=M({__name:"Register",setup(de){const{isDark:E}=W(),f=Q(),p=l(""),u=l(""),c=l(""),n=l(""),g=l(!1),o={fName:l(!1),email:l(!1),password:l(!1),terms:l(!1)},P=x(()=>o.terms.value?g.value?"":"You must agree to the Terms & Privacy Policy":""),F=U(),V=D(),_=x(()=>o.fName.value?p.value.trim()?p.value.trim().length<2?"Full name must be at least 2 characters":"":"Full name is required":""),b=x(()=>o.email.value?u.value.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u.value)?"":"Invalid email format":"Email is required":""),y=x(()=>o.password.value?c.value?/^(?=.*[a-z])(?=.*[A-Z])(?=.*[\W_]).{8,}$/.test(c.value)?"":"Password must be at least 8 characters and include uppercase, lowercase, and a special character":"Password is required":""),I=x(()=>!_.value&&!b.value&&!y.value&&g.value),{mutate:R,isPending:B}=N({mutationFn:te,onSuccess:()=>{f.push(`/otp-verification/${u.value}`)},onError:r=>{var e,s;n.value=((s=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:s.message)||"Something went wrong"}}),{mutateAsync:A}=N({mutationFn:se});async function L(){var r,e;try{const s=await H(),t=await K.get("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${s.access_token}`}}),i=await A({u_email:t.data.email,u_social_id:t.data.sub,u_social_type:"google",u_full_name:t.data.name});T(i)}catch(s){(s==null?void 0:s.message)!=="Popup closed"&&(n.value=((e=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:e.message)||"Google Login failed. Please try again.")}}async function T(r){var s,t;localStorage.setItem("token",(s=r==null?void 0:r.data)==null?void 0:s.token),await F.bootstrap();const e=localStorage.getItem("post_auth_intent");if(e)try{const i=JSON.parse(e);localStorage.removeItem("post_auth_intent"),i.aiResponse&&V.setWorkspace(i.aiResponse),f.push(i.path||"/dashboard");return}catch(i){console.error("Failed to parse post_auth_intent",i),localStorage.removeItem("post_auth_intent")}if((t=r==null?void 0:r.data)!=null&&t.is_new_user){f.push("/create-profile");return}V.pricing?f.push("/dashboard?stripePayment=true"):f.push("/dashboard")}function q(){if(n.value="",o.fName.value=!0,o.email.value=!0,o.password.value=!0,o.terms.value=!0,!I.value){n.value="Please fill all required fields and accept the terms.";return}R({u_full_name:p.value,u_email:u.value,u_password:c.value,agree_to_terms:g.value})}return O([p,u,c],()=>{n.value&&(n.value="")}),(r,e)=>{const s=G("router-link");return h(),j(X,null,{form:v(()=>[a("div",oe,[m(s,{to:"/"},{default:v(()=>[a("img",{src:w(E)?w(ae):w(re),class:"w-[150px] d-block mx-auto",alt:"image"},null,8,le)]),_:1}),e[14]||(e[14]=a("div",{class:"mb-8 sm:mb-12 space-y-2 text-center"},[a("h2",{class:"text-[24px] md:text-[32px] font-medium text-text-primary"},"Welcome to Orchit AI"),a("p",{class:"text-base font-medium text-text-secondary"},"Create your free account")],-1)),a("form",{onSubmit:J(q,["prevent"]),class:"space-y-4 w-full"},[m(k,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),label:"Full Name",placeholder:"Full Name",size:"lg",error:!!_.value,message:_.value,onBlur:e[1]||(e[1]=t=>o.fName.value=!0)},null,8,["modelValue","error","message"]),m(k,{modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value=t),label:"Email",placeholder:"john@example.com",size:"lg",error:!!b.value,message:b.value,onBlur:e[3]||(e[3]=t=>o.email.value=!0)},null,8,["modelValue","error","message"]),m(k,{modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=t=>c.value=t),label:"Password",placeholder:"Password",size:"lg",type:"password",error:!!y.value,message:y.value,onBlur:e[5]||(e[5]=t=>o.password.value=!0)},null,8,["modelValue","error","message"]),a("div",ne,[Y(a("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>g.value=t),onBlur:e[7]||(e[7]=t=>o.terms.value=!0),type:"checkbox",class:"h-4 w-4 mt-0.5 rounded border-border accent-accent cursor-pointer flex-shrink-0"},null,544),[[Z,g.value]]),e[8]||(e[8]=a("p",{class:"text-left font-medium text-text-secondary text-sm"},[d(" By signing up, I agree to the "),a("span",{class:"text-text-primary font-bold text-sm"},"Privacy Policy"),d(" and "),a("span",{class:"text-text-primary font-bold text-sm"},"Terms of Service"),d(". ")],-1))]),P.value?(h(),$("p",ue,S(P.value),1)):C("",!0),m(z,{disabled:w(B),size:"lg",block:!0,type:"submit"},{default:v(()=>[d(S(w(B)?"Creating Account...":"Sign up"),1)]),_:1},8,["disabled"]),e[13]||(e[13]=a("div",{class:"flex items-center"},[a("div",{class:"flex-grow border-t border-border"}),a("span",{class:"mx-3 text-[12px] text-primary"},"OR"),a("div",{class:"flex-grow border-t border-border"})],-1)),m(z,{size:"lg",block:!0,appearance:"outlined",variant:"ghost",type:"button",onClick:L},{icon:v(()=>e[9]||(e[9]=[a("img",{src:ee,class:"w-5 h-5 mr-4"},null,-1)])),default:v(()=>[e[10]||(e[10]=d(" Continue with google "))]),_:1,__:[10]}),n.value?(h(),$("p",ie,S(n.value),1)):C("",!0),a("p",me,[e[12]||(e[12]=d(" Already have an account? ")),m(s,{to:"/login",class:"text-text-primary font-bold underline"},{default:v(()=>e[11]||(e[11]=[d("Sign in")])),_:1,__:[11]})])],32)])]),_:1})}}});export{ge as default};
