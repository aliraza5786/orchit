import{d as xe,X as we,P as ge,aV as _e,c as z,r as f,x as ye,z as he,aw as be,k as a,o,D as ke,g as d,ai as V,m as j,ae,t as w,S as re,h as Ce,H as Ie,f as Ee,R as Le,aj as le,l as Ue,i as H,F as Re,C as Be,az as ze,am as je}from"./index-DhNbIl3H.js";const Te={key:0,class:"flex gap-2 items-center truncate"},Ve=["src"],He={key:2,class:"w-6 h-6 bg-bg-body border border-border rounded-full flex justify-center items-center flex-shrink-0"},Me={class:"text-[11px] text-text-primary truncate"},Ae={key:1,class:"truncate text-text-secondary opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1.5 text-xs"},De={key:1,class:"relative w-full"},Ne={class:"max-h-60 overflow-y-auto py-1"},Se=["onMousedown"],$e={class:"flex items-center gap-3 min-w-0"},Oe=["src"],qe={key:2,class:"w-6 h-6 bg-bg-body border border-border rounded-full flex justify-center items-center flex-shrink-0"},Fe={class:"min-w-0"},Ke={class:"text-xs font-medium truncate"},Pe={class:"text-[10px] text-text-secondary truncate"},Xe={class:"text-xs font-medium text-text-secondary whitespace-nowrap ml-2"},Ye={key:0,class:"text-[10px] px-2 py-1 border rounded-full border-red-500 transition group-hover:bg-red-500 group-hover:text-white"},We={key:1,class:"text-red-500"},Ge={key:2,class:"text-[10px] px-2 py-1 border rounded-full border-accent group-hover:bg-accent transition group-hover:text-white"},Je={key:1,class:"px-4 py-3 text-center text-sm text-text-secondary"},et=xe({__name:"TableAssigneeCell",props:{assigneeId:{},disabled:{type:Boolean},seat:{},workspaceId:{},name:{},emptyText:{}},emits:["update:modelValue","assign","unassign"],setup(ie,{emit:de}){const u=ie,g=de,{canAssignCard:ue}=we(),{workspaceId:ce}=ge(),{data:M}=_e(z(()=>(u==null?void 0:u.workspaceId)??ce.value)),L=f(u.assigneeId??u.seat);ye(()=>[u.assigneeId,u.seat],()=>{L.value=u.assigneeId??u.seat},{deep:!0});const _=f(!1),U=f(!1),y=f(""),h=f(null),T=f(null),b=f(null),A=f({top:"0px",left:"0px",width:"100%"}),s=z(()=>{const e=L.value;if(!e)return null;const t=e._id||e.id||e;return(M.value||[]).find(i=>{var m,v;const c=i._id||i.id,l=((m=i.user)==null?void 0:m._id)||((v=i.user)==null?void 0:v.id);return c==t||l==t})||e}),D=z(()=>{const e=s.value,t=M.value||[];if(e&&(e._id||e.id)){const r=e._id||e.id,i=e,c=t.filter(l=>{var k,C,I,E;const m=l._id||l.id,v=((k=l.user)==null?void 0:k._id)||((C=l.user)==null?void 0:C.id),B=((I=e.user)==null?void 0:I._id)||((E=e.user)==null?void 0:E.id);return!(m==r||v&&v==(B||r))});return[i,...c]}return[...t]}),R=z(()=>{const e=y.value.trim().toLowerCase(),t=D.value;return e?t.filter(r=>(r.title||r.name||"").toLowerCase().includes(e)||(r.email||"").toLowerCase().includes(e)):t}),p=()=>{if(!h.value||!b.value)return;const e=h.value.getBoundingClientRect(),t=b.value.offsetHeight||200,i=window.innerHeight-e.bottom;let l=e.bottom+window.scrollY+6;i<t&&e.top>t&&(l=e.top+window.scrollY-t-5),A.value={top:`${l}px`,left:`${e.left+window.scrollX}px`,width:`${e.width}px`}},ve=async()=>{var t,r,i,c,l;if(u.disabled||!ue.value)return;_.value=!0,U.value=!0;const e=((t=s.value)==null?void 0:t.name)||((r=s.value)==null?void 0:r.title)||((i=s.value)==null?void 0:i.u_full_name);y.value=e||"",await je(),(c=h.value)==null||c.focus(),(l=h.value)==null||l.select(),p(),window.addEventListener("scroll",p,!0),window.addEventListener("resize",p)},x=()=>{_.value=!1,U.value=!1,y.value="",window.removeEventListener("scroll",p,!0),window.removeEventListener("resize",p)};function fe(e){const t=D.value.find(r=>r._id==e);t&&(L.value=t,g("assign",t),g("update:modelValue",e)),x()}function N(){L.value=null,g("unassign"),g("assign",{_id:null}),g("update:modelValue",null),x()}function S(e){if(e._id==null){N();return}if(s.value&&e._id===s.value._id){N();return}fe(e._id)}const pe=()=>{R.value.length>0?S(R.value[0]):x()},me=()=>{setTimeout(()=>{_.value&&x()},150)},$=e=>{T.value&&!T.value.contains(e.target)&&b.value&&!b.value.contains(e.target)&&_.value&&x()};return he(()=>{document.addEventListener("mousedown",$)}),be(()=>{document.removeEventListener("mousedown",$),window.removeEventListener("scroll",p,!0),window.removeEventListener("resize",p)}),(e,t)=>{var r,i,c,l,m,v,B,k,C,I,E,O,q,F,K,P,X,Y,W,G,J,Q,Z,ee,te,se;return o(),a("div",{class:"relative w-full h-full",ref_key:"containerRef",ref:T,onClick:t[3]||(t[3]=H(()=>{},["stop"]))},[_.value?(o(),a("div",De,[Ie(d("input",{ref_key:"inputRef",ref:h,"onUpdate:modelValue":t[0]||(t[0]=n=>y.value=n),onBlur:me,onKeydown:[le(pe,["enter"]),le(x,["esc"])],onInput:t[1]||(t[1]=n=>U.value=!0),class:"absolute left-0 top-1/2 h-8 -translate-y-1/2 min-w-[200px] w-full p-1 border border-accent/60 rounded-sm focus:outline-none focus:ring-1 focus:ring-accent bg-bg-body z-50 text-[12px]",placeholder:"Search people by name"},null,544),[[Le,y.value]]),(o(),Ee(ze,{to:"body"},[U.value?(o(),a("div",{key:0,ref_key:"dropdownRef",ref:b,class:"fixed z-[9999] bg-bg-dropdown border border-border rounded-md shadow-lg",style:V(A.value),onMousedown:t[2]||(t[2]=H(()=>{},["prevent"]))},[d("ul",Ne,[R.value.length>0?(o(!0),a(Re,{key:0},Be(R.value,n=>{var ne,oe;return o(),a("li",{key:n._id??"unassign",onMousedown:H(Qe=>S(n),["prevent"]),class:"px-3 py-2 cursor-pointer hover:bg-bg-dropdown-menu-hover text-[12px] text-text-primary flex items-center justify-between group"},[d("div",$e,[(ne=n==null?void 0:n.user)!=null&&ne.avatar?(o(),a("img",{key:0,src:n.user.avatar,class:"w-6 h-6 rounded-full object-cover flex-shrink-0",alt:""},null,8,Oe)):n.name&&n._id?(o(),a("div",{key:1,class:"w-6 h-6 border border-border rounded-full text-xs font-semibold flex items-center justify-center flex-shrink-0",style:V({backgroundColor:n!=null&&n.email?j(ae)({name:n.name,email:n.email,_id:n._id}):""})},w(j(re)(n.name)),5)):(o(),a("div",qe,t[6]||(t[6]=[d("i",{class:"fa-regular fa-user text-xs"},null,-1)]))),d("div",Fe,[d("div",Ke,w(n.name||n.title),1),d("div",Pe,w(n.role_title),1)])]),d("div",Xe,[n._id&&((oe=s.value)==null?void 0:oe._id)===n._id?(o(),a("span",Ye," Unassign ")):n._id==null?(o(),a("span",We)):(o(),a("span",Ge," Assign to "))])],40,Se)}),128)):(o(),a("div",Je," No match found "))])],36)):Ue("",!0)]))])):(o(),a("div",{key:0,onClick:ve,class:ke(["w-full h-full flex items-center px-3 py-1.5 cursor-pointer hover:bg-bg-surface-hover rounded-md truncate transition-all duration-200 min-h-[36px] group",{"opacity-50 cursor-not-allowed":e.disabled}])},[(i=(r=s.value)==null?void 0:r.user)!=null&&i.avatar||(c=s.value)!=null&&c._id||(l=e.seat)!=null&&l._id?(o(),a("div",Te,[(v=(m=s.value)==null?void 0:m.avatar)!=null&&v.src||(k=(B=s.value)==null?void 0:B.user)!=null&&k.avatar||(C=s.value)!=null&&C.u_profile_image?(o(),a("img",{key:0,src:((E=(I=s.value)==null?void 0:I.avatar)==null?void 0:E.src)??((O=s.value)==null?void 0:O.u_profile_image)??((F=(q=s.value)==null?void 0:q.user)==null?void 0:F.avatar),class:"w-5 h-5 object-cover rounded-full flex-shrink-0",alt:""},null,8,Ve)):(K=s.value)!=null&&K.u_full_name||(P=s.value)!=null&&P.name?(o(),a("div",{key:1,class:"w-5 h-5 aspect-square rounded-full text-[11px] bg-bg-surface text-text-primary flex items-center justify-center flex-shrink-0",style:V({backgroundColor:((X=s.value)==null?void 0:X.u_full_name)??((Y=s.value)==null?void 0:Y.title)?j(ae)({name:((W=s.value)==null?void 0:W.u_full_name)??((G=s.value)==null?void 0:G.title),_id:(J=s.value)==null?void 0:J._id}):""})},w(j(re)(((Q=s.value)==null?void 0:Q.u_full_name)??((Z=s.value)==null?void 0:Z.name))),5)):(o(),a("div",He,t[4]||(t[4]=[d("i",{class:"fa-regular fa-user text-xs"},null,-1)]))),d("span",Me,w((((ee=s.value)==null?void 0:ee.name)||((te=s.value)==null?void 0:te.title)||((se=s.value)==null?void 0:se.u_full_name))??"Unassigned"),1)])):(o(),a("span",Ae,[t[5]||(t[5]=d("i",{class:"fa-solid fa-plus text-[10px]"},null,-1)),Ce(" Add "+w(e.emptyText||"Assignee"),1)]))],2))],512)}}});export{et as default};
