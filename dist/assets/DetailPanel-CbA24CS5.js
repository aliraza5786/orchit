const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ProgressBar-IFuCOswk.js","assets/ProgressBar.vue_vue_type_script_setup_true_lang-RlXTVrOj.js","assets/index-5tb651H2.js","assets/index-vCZfuI0Y.css","assets/BaseSelectField-CwDbAaZ0.js","assets/AddCustomRoleModal-BdOdi6mI.js","assets/BaseTextAreaField.vue_vue_type_script_setup_true_lang-BhY0Icrw.js","assets/Loader-DLKUPXcI.js","assets/Loader-88TN_dqm.css","assets/usePeople-DZin0_ze.js","assets/permissionUtils-fD2X1oS-.js"])))=>i.map(i=>d[i]);
import{d as Me,Z as Qe,O as We,r as v,c as p,x,S as je,ae as $e,aq as Fe,m as i,o,g as l,f as de,n as _,h as M,ak as Ye,i as d,ag as He,k as ce,t as c,U as Ge,ah as U,y as ve,T as Ze,al as pe,l as O,G as w,E as P,F as me,z as Je,H as q,ao as Xe,Y as L,N as es}from"./index-5tb651H2.js";import{l as ss,m as ts,a as as,n as ls}from"./usePeople-DZin0_ze.js";import{a as os}from"./usePackages--A6C72Vt.js";import{f as is}from"./permissionUtils-fD2X1oS-.js";import{u as rs}from"./sidePanelStore-CxiV5xH3.js";const ns={class:"pt-[17px] pb-[18px] flex justify-between items-center border-b border-border px-5 sticky top-0 bg-bg-card z-1"},us={class:"py-4 px-5"},ds={class:"bg-bg-surface/50 p-2 rounded-lg flex gap-2 items-center"},cs=["src"],vs={key:0,class:"fa-solid fa-user text-white"},ps={class:"text-base font-medium text-text-primary cursor-pointer"},ms={class:"text-sm font-medium text-text-secondary cursor-pointer"},_s={class:"flex flex-col mt-2"},fs={class:"text-sm text-text-secondary mt-2"},xs={key:0},bs={class:"mb-2 capitalize"},ys=["onKeydown"],hs={class:"mt-5 pt-3 border-t border-border-input relstive"},ks={key:0,class:"w-full mt-4"},gs=["onClick"],ws={class:"text-sm font-medium text-text-primary"},Ps={key:0,class:"py-2 border-t border-border bg-bg-card"},Cs=["value"],Ds={class:"text-xs font-medium text-text-primary"},Es={class:"text-[11px] text-text-secondary leading-tight"},Vs={key:1,class:"mt-3"},Rs={key:0,class:"border border-border space-y-1 p-2.5 mt-1 rounded-lg"},Ts={class:"text-sm text-text-primary"},Is={key:2,class:"mt-3"},As={key:0,class:"border border-border space-y-1 p-2.5 mt-1 rounded-lg"},Ss={class:"text-sm text-text-primary"},Us=Me({__name:"DetailPanel",props:{showPanel:{type:Boolean,required:!0}},emits:["close","update:details","comment:post","priority:change"],setup(_e,{emit:Os}){var Y,H,G,Z;const fe=U(()=>q(()=>import("./ProgressBar-IFuCOswk.js"),__vite__mapDeps([0,1,2,3]))),xe=U(()=>q(()=>import("./index-5tb651H2.js").then(e=>e.du),__vite__mapDeps([2,3]))),Q=U(()=>q(()=>import("./BaseSelectField-CwDbAaZ0.js"),__vite__mapDeps([4,2,3]))),{canEditUser:C,isAdmin:be}=Qe(),ye=rs(),K=We({}),k=v("details"),a=p(()=>ye.selectedCardPeople),he=[{label:"Details",value:"details"},{label:"Tasks",value:"tasks"},{label:"History",value:"history"}],{data:ke}=ss(),{mutate:ge}=ts({onSuccess:()=>{y.invalidateQueries({queryKey:["people-lists"]})}}),we=_e,D=v(!1),f=v(((Y=a.value)==null?void 0:Y.title)??""),Pe=v(((H=a.value)==null?void 0:H._id)??"");x(()=>{var e;return(e=a.value)==null?void 0:e.title},e=>{var s;f.value=e,Pe.value=(s=a.value)==null?void 0:s._id});const Ce=v(((G=a.value)==null?void 0:G.description)??"");console.log("card details data",a.value),x(()=>a.value,()=>{var e;Ce.value=((e=a.value)==null?void 0:e.description)??""}),x(()=>a.value,()=>{var e;(e=a.value)!=null&&e.variable_values&&a.value.variable_values.forEach(s=>{K[s.module_variable_id]=s.value})},{immediate:!0,deep:!0});const N=v(null);function De(){D.value=!0,Xe(()=>{var e,s;(e=N.value)==null||e.focus(),(s=N.value)==null||s.select()})}function W(){var e;f.value.trim()||(f.value=((e=a.value)==null?void 0:e.title)??""),Re.mutate({card_id:a.value._id,variables:{"card-title":f.value.trim()}}),D.value=!1}function Ee(){var e;f.value=((e=a.value)==null?void 0:e.title)??"",D.value=!1}const j=v({startDate:"",endDate:""}),Ve=p(()=>a.value||null);x(Ve,e=>{j.value={...j.value,startDate:e}});const y=je(),Re=$e({onSuccess:()=>{y.invalidateQueries({queryKey:["get-sheets"]}),y.invalidateQueries({queryKey:["sheet-list"]}),y.invalidateQueries({queryKey:["roles"]})}}),Te=(e,s)=>{K[s]=e,ge({id:a.value._id,payload:{variable_values:[{module_variable_id:s,value:e}]}})};function Ie(e){var s,m,n;if((s=a.value)!=null&&s.variable_values)return(n=((m=a.value)==null?void 0:m.variable_values.filter(I=>I.module_variable_id==e))[0])==null?void 0:n.value}const h=p(()=>{var e;return(e=a.value)==null?void 0:e.workspace_id}),{data:Ae}=Fe(h,{enabled:p(()=>!!h.value)}),E=p(()=>{var e;return((e=Ae.value)==null?void 0:e.company_id)??null}),{data:z,isLoading:Se}=as({company_id:E,workspace_id:h},{enabled:p(()=>!!E.value&&!!h.value)}),b=v(((Z=a.value)==null?void 0:Z.workspace_access_role_id)??""),{mutate:$}=ls({onSuccess:()=>{console.log("Role assigned successfully!"),y.invalidateQueries({queryKey:["people-lists"]})},onError:e=>console.error(e)}),Ue=p(()=>{const e=(z.value||[]).map(s=>({_id:s._id,title:s.title}));return e.push({_id:"ADD_NEW_ROLE",title:"+ Add New Role",customClass:"text-accent font-medium sticky bottom-0  hover:bg-bg-dropdown-menu-hover transition-all duration-150 bg-bg-dropdown   border-t border-border w-full",isAction:!0}),e});x(b,e=>{var s;e!=="ADD_NEW_ROLE"&&$({id:(s=a.value)==null?void 0:s._id,workspace_access_role_id:e})}),x(()=>{var e;return(e=a.value)==null?void 0:e.workspace_access_role_id},e=>{b.value=e??""}),x(()=>{var e;return(e=a.value)==null?void 0:e._id},()=>{var e;b.value=((e=a.value)==null?void 0:e.workspace_access_role_id)??""},{immediate:!0});function Oe(){C||L.error("You have no permission to edit user details")}function qe(e){var s;if(!C){L.error("You have no permission to edit user details");return}if(e==="ADD_NEW_ROLE"){T.value=!0;return}b.value=e,$({id:(s=a.value)==null?void 0:s._id,workspace_access_role_id:e})}const r=p(()=>!z.value||!b.value?null:z.value.find(e=>e._id===b.value)),V=v({}),R=v([]),{mutate:Le}=os();function Ke(e){V.value[e]=!V.value[e]}x(r,e=>{if(!e)return;const s=[];e.permission_categories.forEach(m=>{m.permissions.forEach(n=>{n.enabled&&s.push(n._id)})}),R.value=s},{immediate:!0});function Ne(){var m;if(!((m=r.value)!=null&&m._id))return;const e=[];r.value.permission_categories.forEach(n=>{n.permissions.forEach(g=>e.push(g))});const s=is(e,R.value);Le({roleId:r.value._id,payload:{title:r.value.title,description:r.value.description,is_admin:r.value.is_admin,is_editor:r.value.is_editor,is_viewer:r.value.is_viewer,permission_ids:s.permission_ids,module_permissions:s.module_permissions,workspace_id:h.value}},{onSuccess:()=>{L.success("Permissions updated successfully"),y.invalidateQueries({queryKey:["workspace-roles"]})},onError:n=>{console.error("Failed to update permissions",n),L.error("Failed to update permissions")}})}const T=v(!1),ze=U(()=>q(()=>import("./AddCustomRoleModal-BdOdi6mI.js"),__vite__mapDeps([5,2,3,6,7,8,9,10]))),F=p(()=>{var e,s;return((s=(e=a.value)==null?void 0:e.assigned_cards_status_counts)==null?void 0:s.Done)??0}),B=p(()=>{var e;return((e=a.value)==null?void 0:e.assigned_cards_count)??0}),Be=p(()=>B.value?Math.round(F.value/B.value*100):0);return(e,s)=>{var m,n,g,I,J,X,ee,se,te,ae,le,oe,ie,re,ne,ue;return o(),i("div",{class:me(`max-w-[358px] bg-bg-card  rounded-lg overflow-y-auto overflow-x-hidden relative ${we.showPanel?"!translate-x-0 w-full h-full min-w-full sm:min-w-[380px] overflow-y-auto":"!translate-x-100 w-0 h-0"} transition-all`)},[l("div",ns,[s[6]||(s[6]=l("h5",{class:"text-[16px] font-medium"},"Profile",-1)),l("i",{class:"cursor-pointer text-text-primary fa-solid fa-close",onClick:s[0]||(s[0]=t=>e.$emit("close"))})]),l("div",us,[l("div",ds,[(m=a.value)!=null&&m.avatar?(o(),i("img",{key:0,src:(n=a.value)==null?void 0:n.avatar,class:"w-10 h-10 rounded-full",alt:"avartar"},null,8,cs)):(o(),i("div",{key:1,class:"min-w-10 max-h-10 aspect-square bg-bg-surface flex justify-center items-center rounded-full",style:Ye({backgroundColor:(g=a.value)!=null&&g.name?d(He)({email:(I=a.value)==null?void 0:I.email}):""})},[ce(c(d(Ge)((J=a.value)==null?void 0:J.name))+" ",1),(X=a.value)!=null&&X.name?_("",!0):(o(),i("i",vs))],4)),l("div",null,[l("h1",ps,c(((ee=a.value)==null?void 0:ee.name)??((se=a.value)==null?void 0:se.title)),1),l("p",ms,c((te=a.value)==null?void 0:te.email),1)])]),M(d(xe),{modelValue:k.value,"onUpdate:modelValue":s[1]||(s[1]=t=>k.value=t),class:"my-2",options:he},null,8,["modelValue"]),l("div",_s,[s[7]||(s[7]=l("h1",{class:"text-base font-medium text-text-primary cursor-pointer"}," Task Progress ",-1)),M(d(fe),{class:"mt-2",progress:Be.value,fillColor:"bg-accent ",indeterminate:!0},null,8,["progress"]),l("span",fs," Completed "+c(F.value)+" tasks out of "+c(B.value),1)]),k.value=="details"?(o(),i("section",xs,[l("div",bs,[D.value?ve((o(),i("input",{key:0,ref_key:"titleInput",ref:N,"onUpdate:modelValue":s[2]||(s[2]=t=>f.value=t),onBlur:W,onKeydown:[pe(O(W,["prevent"]),["enter"]),pe(O(Ee,["prevent"]),["esc"])],class:"border border-border rounded px-2 py-1 w-full text-xl font-medium",type:"text"},null,40,ys)),[[Ze,f.value]]):(o(),i("h1",{key:1,class:"text-xl font-medium text-text-primary cursor-pointer",onClick:De},c(f.value),1))]),l("div",null,[(o(!0),i(w,null,P(d(ke),(t,u)=>{var A;return o(),i("div",{key:u,class:"grid grid-cols-2 capitalize items-center gap-2 text-sm mt-4"},[ce(c(t==null?void 0:t.title)+" ",1),(o(),de(d(Q),{size:"sm","model-value":K[t._id],key:u,placeholder:` ${t.title}`,onClick:s[3]||(s[3]=O(()=>{},["stop"])),defaultValue:Ie(t==null?void 0:t._id),options:t==null?void 0:t.data.map(S=>({_id:S,title:S})),cardId:(A=a.value)==null?void 0:A._id,disabled:!d(C),"onUpdate:modelValue":S=>Te(S,t._id)},null,8,["model-value","placeholder","defaultValue","options","cardId","disabled","onUpdate:modelValue"]))])}),128))]),l("div",hs,[s[9]||(s[9]=l("div",{class:"flex items-center justify-between mb-1"},[l("span",{class:"text-base font-medium text-text-primary block"},"Select Role")],-1)),M(d(Q),{size:"sm","model-value":b.value,options:Ue.value,placeholder:"Select Role",onClick:O(Oe,["stop"]),"onUpdate:modelValue":qe,disabled:!d(C),loading:d(Se)||!E.value},null,8,["model-value","options","disabled","loading"]),r.value&&!r.value.is_admin&&d(be)?(o(),i("div",ks,[s[8]||(s[8]=l("h2",{class:"text-base font-medium text-text-primary mb-1"}," Permissions ",-1)),(o(!0),i(w,null,P((ae=r.value)==null?void 0:ae.permission_categories,t=>(o(),i("div",{key:t==null?void 0:t.category,class:"border border-border mb-2 rounded-lg overflow-hidden bg-bg-surface/30"},[l("button",{onClick:u=>Ke(t==null?void 0:t.category),class:"w-full px-3 py-2 flex justify-between items-center hover:bg-bg-surface transition"},[l("span",ws,c(t==null?void 0:t.category_title),1),l("i",{class:me(["fa-solid fa-chevron-down text-xs text-text-secondary transition-transform",V.value[t==null?void 0:t.category]?"rotate-180":""])},null,2)],8,gs),V.value[t==null?void 0:t.category]?(o(),i("div",Ps,[(o(!0),i(w,null,P(t==null?void 0:t.permissions,u=>(o(),i("div",{key:u._id,class:"flex items-start gap-2 px-3 py-2 hover:bg-bg-input"},[ve(l("input",{type:"checkbox","onUpdate:modelValue":s[4]||(s[4]=A=>R.value=A),value:u._id,onChange:Ne,class:"h-4 w-4 mt-0.5 rounded border-border accent-accent cursor-pointer flex-shrink-0"},null,40,Cs),[[Je,R.value]]),l("div",null,[l("p",Ds,c(u.title),1),l("p",Es,c(u.description),1)])]))),128))])):_("",!0)]))),128))])):_("",!0)])])):_("",!0),k.value=="tasks"?(o(),i("section",Vs,[s[11]||(s[11]=l("span",{class:"text-base text-text-primary"},"Worked On",-1)),((oe=(le=a.value)==null?void 0:le.assigned_cards)==null?void 0:oe.length)>0?(o(),i("ul",Rs,[(o(!0),i(w,null,P((ie=a.value)==null?void 0:ie.assigned_cards,(t,u)=>(o(),i("li",{class:"p-2",key:u},[l("h1",Ts,c(t==null?void 0:t.title),1),s[10]||(s[10]=l("p",{class:"text-xs text-text-secondary"}," Design Project . Olivia Updated on April 9, 2025 ",-1))]))),128))])):_("",!0)])):_("",!0),k.value=="history"?(o(),i("section",Is,[s[13]||(s[13]=l("span",{class:"text-base text-text-primary"},"history",-1)),((ne=(re=a.value)==null?void 0:re.assignment_history)==null?void 0:ne.length)>0?(o(),i("ul",As,[(o(!0),i(w,null,P((ue=a.value)==null?void 0:ue.assignment_history,(t,u)=>(o(),i("li",{class:"p-2",key:u},[l("h1",Ss,c(t==null?void 0:t.title),1),s[12]||(s[12]=l("p",{class:"text-xs text-text-secondary"}," Design Project . Olivia Updated on April 9, 2025 ",-1))]))),128))])):_("",!0)])):_("",!0)]),T.value?(o(),de(d(ze),{key:0,show:T.value,workspaceId:h.value,companyId:E.value,onClose:s[5]||(s[5]=t=>T.value=!1)},null,8,["show","workspaceId","companyId"])):_("",!0)],2)}}}),Bs=es(Us,[["__scopeId","data-v-0680d72f"]]);export{Bs as default};
