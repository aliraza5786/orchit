import{d as G,a as J,r as n,c as _,b as Y,u as Z,e as z,x as H,f as K,w as i,o as k,g as o,h as m,i as d,j as Q,l as X,m as R,n as T,_ as S,y as ee,z as te,k as p,t as P,B as A,p as ae,q as se,v as oe}from"./index-ChU9yURu.js";import{_ as re,a as le,d as ne,l as ue}from"./AuthLayout.vue_vue_type_script_setup_true_lang-B7JdSWiN.js";import{r as ie,s as me}from"./auth-ByemXiHj.js";import{d as de,l as pe}from"./dark-logo-Mcb_sJlF.js";const ce={class:"max-w-[500px] mx-auto w-full min-h-full py-5 flex flex-col justify-center"},fe=["src"],ge={class:"flex items-start gap-2"},ve={key:0,class:"text-red-500 text-[12px]"},xe=["src"],_e={key:1,class:"text-red-500 text-sm text-center mt-2"},we={class:"text-sm font-medium text-text-secondary text-center mt-8"},Pe=G({__name:"Register",setup(he){const{isDark:N}=J(),v=oe(),f=n(""),c=n(""),g=n(""),l=n(""),x=n(!1),r={fName:n(!1),email:n(!1),password:n(!1),terms:n(!1)},V=_(()=>r.terms.value?x.value?"":"You must agree to the Terms & Privacy Policy":""),E=Y(),I=Z(),w=_(()=>r.fName.value?f.value.trim()?f.value.trim().length<2?"Full name must be at least 2 characters":"":"Full name is required":""),h=_(()=>r.email.value?c.value.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.value)?"":"Invalid email format":"Email is required":""),b=_(()=>r.password.value?g.value?/^(?=.*[a-z])(?=.*[A-Z])(?=.*[\W_]).{8,}$/.test(g.value)?"":"Password must be at least 8 characters and include uppercase, lowercase, and a special character":"Password is required":""),F=_(()=>!w.value&&!h.value&&!b.value&&x.value),{mutate:U,isPending:C}=z({mutationFn:ie,onSuccess:()=>{v.push(`/otp-verification/${c.value}`)},onError:s=>{var e,t;l.value=((t=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:t.message)||"Something went wrong"}}),{mutateAsync:B}=z({mutationFn:me});async function L(){var s,e;try{const t=await ae(),a=await se.get("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${t.access_token}`}}),u=await B({u_email:a.data.email,u_social_id:a.data.sub,u_social_type:"google",u_full_name:a.data.name});$(u)}catch(t){(t==null?void 0:t.message)!=="Popup closed"&&(l.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"Google Login failed. Please try again.")}}async function W(){var s,e;try{AppleID.auth.init({clientId:"com.orchit.ai",scope:"name email",redirectURI:"https://www.orchit.ai/dashboard",usePopup:!0});const t=await AppleID.auth.signIn(),q=t.authorization.id_token.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),D=decodeURIComponent(atob(q).split("").map(function(O){return"%"+("00"+O.charCodeAt(0).toString(16)).slice(-2)}).join("")),y=JSON.parse(D),M=await B({u_email:y.email,u_social_id:y.sub,u_social_type:"apple",u_full_name:(s=t.user)!=null&&s.name?`${t.user.name.firstName} ${t.user.name.lastName}`:((e=y.email)==null?void 0:e.split("@")[0])||""});$(M)}catch(t){(t==null?void 0:t.error)!=="popup_closed_by_user"&&(l.value=(t==null?void 0:t.message)||"Apple Login failed. Please try again.")}}async function $(s){var t,a;localStorage.setItem("token",(t=s==null?void 0:s.data)==null?void 0:t.token),await E.bootstrap();const e=localStorage.getItem("post_auth_intent");if(e)try{const u=JSON.parse(e);localStorage.removeItem("post_auth_intent"),u.aiResponse&&I.setWorkspace(u.aiResponse),v.push(u.path||"/dashboard");return}catch(u){console.error("Failed to parse post_auth_intent",u),localStorage.removeItem("post_auth_intent")}if((a=s==null?void 0:s.data)!=null&&a.is_new_user){v.push("/create-profile");return}I.pricing?v.push("/dashboard?stripePayment=true"):v.push("/dashboard")}function j(){if(l.value="",r.fName.value=!0,r.email.value=!0,r.password.value=!0,r.terms.value=!0,!F.value){l.value="Please fill all required fields and accept the terms.";return}U({u_full_name:f.value,u_email:c.value,u_password:g.value,agree_to_terms:x.value})}return H([f,c,g],()=>{l.value&&(l.value="")}),(s,e)=>{const t=Q("router-link");return k(),K(re,null,{form:i(()=>[o("div",ce,[m(t,{to:"/"},{default:i(()=>[o("img",{src:d(N)?d(de):d(pe),class:"w-[130px] d-block mx-auto",alt:"image"},null,8,fe)]),_:1}),e[15]||(e[15]=o("div",{class:"mb-8 sm:mb-12 space-y-2 text-center"},[o("h2",{class:"text-[24px] md:text-[32px] font-medium text-text-primary"},"Welcome to Orchit AI"),o("p",{class:"text-base font-medium text-text-secondary"},"Create your free account")],-1)),o("form",{onSubmit:X(j,["prevent"]),class:"space-y-4 w-full"},[m(S,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=a=>f.value=a),label:"Full Name",placeholder:"Full Name",size:"lg",error:!!w.value,message:w.value,onBlur:e[1]||(e[1]=a=>r.fName.value=!0)},null,8,["modelValue","error","message"]),m(S,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=a=>c.value=a),label:"Email",placeholder:"john@example.com",size:"lg",error:!!h.value,message:h.value,onBlur:e[3]||(e[3]=a=>r.email.value=!0)},null,8,["modelValue","error","message"]),m(S,{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=a=>g.value=a),label:"Password",placeholder:"Password",size:"lg",type:"password",error:!!b.value,message:b.value,onBlur:e[5]||(e[5]=a=>r.password.value=!0)},null,8,["modelValue","error","message"]),o("div",ge,[ee(o("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>x.value=a),onBlur:e[7]||(e[7]=a=>r.terms.value=!0),type:"checkbox",class:"h-4 w-4 mt-0.5 rounded border-border accent-accent cursor-pointer flex-shrink-0"},null,544),[[te,x.value]]),e[8]||(e[8]=o("p",{class:"text-left font-medium text-text-secondary text-sm"},[p(" By signing up, I agree to the "),o("span",{class:"text-text-primary font-medium text-sm"},"Privacy Policy"),p(" and "),o("span",{class:"text-text-primary font-medium text-sm"},"Terms of Service"),p(". ")],-1))]),V.value?(k(),R("p",ve,P(V.value),1)):T("",!0),m(A,{disabled:d(C),size:"lg",block:!0,type:"submit"},{default:i(()=>[p(P(d(C)?"Creating Account...":"Sign up"),1)]),_:1},8,["disabled"]),e[14]||(e[14]=o("div",{class:"flex items-center"},[o("div",{class:"flex-grow border-t border-border"}),o("span",{class:"mx-3 text-[12px] text-primary"},"OR"),o("div",{class:"flex-grow border-t border-border"})],-1)),m(A,{size:"lg",block:!0,appearance:"outlined",variant:"ghost",type:"button",onClick:L},{icon:i(()=>e[9]||(e[9]=[o("img",{src:le,class:"w-5 h-5 mr-4"},null,-1)])),default:i(()=>[e[10]||(e[10]=p(" Continue with google "))]),_:1,__:[10]}),m(A,{size:"lg",block:!0,appearance:"outlined",variant:"ghost",type:"button",onClick:W},{icon:i(()=>[o("img",{src:d(N)?d(ne):d(ue),alt:"Apple icon",class:"w-[24px] mr-4"},null,8,xe)]),default:i(()=>[e[11]||(e[11]=p(" Continue with apple "))]),_:1,__:[11]}),l.value?(k(),R("p",_e,P(l.value),1)):T("",!0),o("p",we,[e[13]||(e[13]=p(" Already have an account? ")),m(t,{to:"/login",class:"text-text-primary font-bold underline"},{default:i(()=>e[12]||(e[12]=[p("Sign in")])),_:1,__:[12]})])],32)])]),_:1})}}});export{Pe as default};
