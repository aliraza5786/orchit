const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CreateTaskModal-CApcIRmq.js","assets/CreateTaskModal.vue_vue_type_script_setup_true_lang-BdjQVeUR.js","assets/index-D1HTj25s.js","assets/index-C3hlGBVH.css","assets/ConfirmDeleteModal-nQ068KBD.js","assets/ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-BrcenpPn.js","assets/SidePanel-CieKtPYK.js","assets/SidePanel-U7OOMI6M.css","assets/KanbanBoard-BEoRHiK2.js","assets/vuedraggable.umd-jgHA8wXs.js","assets/_commonjsHelpers-_d1bhYXs.js","assets/DropMenu.vue_vue_type_script_setup_true_lang-C-JhxsID.js","assets/KanbanBoard-Dffh696C.css"])))=>i.map(i=>d[i]);
import{R as ot,S as $t,p as v,T as Ve,c as V,r as b,n as j,K as nt,U as ft,d as rt,V as ll,W as bl,j as g,f as t,h as Te,z as J,F as xe,y as we,o as d,t as P,Q as al,J as Pt,O as xl,e as ce,w as ae,X as sl,i as U,_ as nl,I as Ut,g as de,B as We,k as F,Y as Ct,D as et,P as ol,N as rl,M as yl,Z as _l,$ as hl,a0 as kl,a1 as wl,a2 as Sl,E as Nt,a3 as Tl,a4 as Vl,a5 as El,u as Ll,a6 as Ml,a7 as Al,a8 as Bl,a9 as Il,aa as Fl,ab as Ol,ac as Ul,ad as He,ae as el,q as Nl,af as Pl,l as Xt,ag as Bt,A as It,ah as be,ai as ql,aj as dl,ak as zl,al as jl,v as Rl,am as Hl,an as ul,ao as Wl}from"./index-D1HTj25s.js";import{u as il}from"./useTheme-D0wyG1S6.js";import{_ as Kl}from"./BaseTextAreaField.vue_vue_type_script_setup_true_lang-DGkEUZs3.js";import{_ as Ql}from"./SearchBar.vue_vue_type_script_setup_true_lang-BwXpyEQ6.js";import{o as Ft,_ as Gl}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-BrcenpPn.js";import{D as Yt,K as Cl}from"./Dropdown-BpjPyuYP.js";import{_ as Jl,a as cl,b as Zl,k as Xl}from"./TableAssigneeCell.vue_vue_type_script_setup_true_lang-CVWA6QGy.js";import{K as Yl}from"./KanbanTicket-fqu9qiA-.js";import{F as pl}from"./fuse-Ch1WBRTM.js";import{l as ea}from"./lodash-CQYOKM_D.js";import"./DropMenu.vue_vue_type_script_setup_true_lang-C-JhxsID.js";import"./_commonjsHelpers-_d1bhYXs.js";const ta="data:image/svg+xml,%3csvg%20width='60'%20height='46'%20viewBox='0%200%2060%2046'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20opacity='0.4'%3e%3cpath%20d='M59.7443%2034.8967L50.5682%2025.7206C50.4457%2025.5984%2050.2897%2025.5152%2050.1199%2025.4816C49.9501%2025.4479%2049.7742%2025.4653%2049.6143%2025.5315C49.4544%2025.5976%2049.3176%2025.7097%2049.2213%2025.8535C49.125%2025.9973%2049.0734%2026.1664%2049.073%2026.3394V30.517H25.9775V40.5114H49.0755V44.689C49.0759%2044.8621%2049.1275%2045.0312%2049.2238%2045.175C49.3201%2045.3187%2049.4569%2045.4308%2049.6168%2045.497C49.7767%2045.5632%2049.9527%2045.5805%2050.1224%2045.5468C50.2922%2045.5132%2050.4482%2045.43%2050.5708%2045.3078L59.7468%2036.1318C59.9095%2035.9672%2060.0005%2035.7451%2060.0001%2035.5137C59.9996%2035.2823%2059.9076%2035.0605%2059.7443%2034.8967Z'%20fill='%23C6DBA9'/%3e%3cpath%20d='M32.3149%2030.5293C30.664%2031.5967%2028.7394%2032.1633%2026.7734%2032.1609V40.5237H34.7295C39.2829%2038.5638%2042.9649%2035.0102%2045.0851%2030.5293H32.3149Z'%20fill='url(%23paint0_linear_250_16424)'/%3e%3cpath%20d='M46.2209%2020.2832C46.2317%2015.0884%2044.2448%2010.0884%2040.6714%206.3179C37.0981%202.54738%2032.2119%200.295026%2027.024%200.0269855C21.8362%20-0.241055%2016.7439%201.49574%2012.801%204.87791C8.85809%208.26009%206.36647%2013.0287%205.84178%2018.1969L2.46233%2017.8913C2.31055%2017.8782%202.15829%2017.9103%202.02467%2017.9835C1.89106%2018.0566%201.78205%2018.1677%201.71134%2018.3026C1.64063%2018.4376%201.61138%2018.5904%201.62726%2018.7419C1.64313%2018.8934%201.70343%2019.0368%201.80058%2019.1542L9.51927%2028.406C9.79205%2028.7344%2010.277%2028.7773%2010.378%2028.5045L19.6298%2020.7833C20.3876%2020.3413%2020.1173%2019.4825%2019.4328%2019.4194L15.8008%2019.091C16.0297%2017.1283%2016.8213%2015.2735%2018.0802%2013.7503C19.3391%2012.2271%2021.0115%2011.1004%2022.8961%2010.5059C24.7806%209.9114%2026.7969%209.8745%2028.7019%2010.3996C30.6069%2010.9248%2032.3195%2011.9896%2033.6332%2013.4657C34.947%2014.9419%2035.8059%2016.7664%2036.1065%2018.7195C36.4071%2020.6726%2036.1365%2022.6709%2035.3274%2024.4738C34.5183%2026.2766%2033.2051%2027.8071%2031.5462%2028.8807C29.8872%2029.9544%2027.9531%2030.5254%2025.977%2030.5251H25.9283V40.5094C31.2249%2040.4031%2036.7093%2038.2263%2040.4202%2034.4455C44.1311%2030.6648%2046.2134%2025.5808%2046.2209%2020.2832Z'%20fill='%23D7A39E'/%3e%3cpath%20d='M25.9773%2030.5293H0V40.5237H25.9773V30.5293Z'%20fill='url(%23paint1_linear_250_16424)'/%3e%3c/g%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_250_16424'%20x1='6.53714'%20y1='35.5252'%20x2='47.0198'%20y2='35.5252'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%236C798F'/%3e%3cstop%20offset='1'%20stop-color='%236C798F'%20stop-opacity='0.1'/%3e%3c/linearGradient%3e%3clinearGradient%20id='paint1_linear_250_16424'%20x1='0'%20y1='36'%20x2='26'%20y2='36'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23E8D4D3'%20stop-opacity='0'/%3e%3cstop%20offset='1'%20stop-color='%23E2A39F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",la=(k,x,I={})=>$t({queryKey:V(()=>["sprint-list",v(k),v(x)]),queryFn:({signal:B})=>Ve({url:`sprints/${v(k)}`,method:"GET",signal:B,params:{sprintType:v(x)}}),...I}),aa=(k,x={})=>$t({queryKey:["sprint-cards",k],queryFn:({signal:I})=>Ve({url:`sprints/${v(k)}/backlog`,method:"GET",signal:I}),...x}),sa=(k,x,I={})=>$t({queryKey:["sprint-kanban",k,x],queryFn:({signal:B})=>Ve({url:"workspace/cards/sprintgrouped",method:"GET",signal:B,params:{sprint_id:v(k),variable_id:"68b6c96e0a95eef7d14e6981",sheet_id:v(x)}}),...I}),na=(k,x={})=>ot({key:["sprint-complete"]},{mutationFn:I=>Ve({url:`sprints/${v(k)}/complete`,method:"POST",data:I.payload}),...x}),oa=(k,x={})=>$t({queryKey:["sprint-detail",k],queryFn:({signal:I})=>Ve({url:`sprints/detail/${v(k)}?include_cards=true`,method:"GET",signal:I}),...x}),tl=(k,x,I=null,B={})=>$t({queryKey:["backlog-list",k,v(x),v(I)],queryFn:({signal:q})=>Ve({url:`sprints/workspace/${v(k)}/cards`,method:"GET",signal:q,params:{include_sprint_cards:!1,sprintType:v(x),module_id:v(I)}}),...B}),ra=(k={})=>ot({key:["add-sprint"]},{mutationFn:x=>Ve({url:"/sprints",method:"POST",data:x.payload}),...k}),$l=(k={})=>ot({key:["move-card-to-sprint"]},{mutationFn:x=>Ve({url:`/sprints/${x.id}/cards`,method:"POST",data:x.payload}),...k}),fl=(k={})=>ot({key:["add-sprint"]},{mutationFn:x=>Ve({url:`/sprints/${x.id}`,method:"PUT",data:x.payload}),...k}),ia=(k={})=>ot({key:["start-sprint"]},{mutationFn:x=>Ve({url:`/sprints/${x.id}/start`,method:"POST",data:x.payload}),...k}),da=(k={})=>ot({key:["delete-sprint"]},{mutationFn:x=>Ve({url:`/sprints/${x}`,method:"DELETE"}),...k}),ua=(k={})=>ot({key:["remove-card-from-sprint"]},{mutationFn:x=>Ve({url:`sprints/${v(x.sprintId)}/cards/remove `,method:"POST",data:{card_ids:[x.cardId]}}),...k}),Dl="jira-like:";function vl(k="id"){return`${k}_${Math.random().toString(36).slice(2,9)}`}function ml(k,x){try{localStorage.setItem(Dl+k,JSON.stringify(x))}catch{}}function gl(k,x){try{const I=localStorage.getItem(Dl+k);return I?JSON.parse(I):x}catch{return x}}function ca(k){switch(k){case"Highest":return"rounded-md bg-red-50 px-2 py-0.5 text-xs text-red-700";case"High":return"rounded-md bg-orange-50 px-2 py-0.5 text-xs text-orange-700";case"Medium":return"rounded-md bg-amber-50 px-2 py-0.5 text-xs text-amber-700";case"Low":return"rounded-md bg-gray-100 px-2 py-0.5 text-xs text-gray-600"}}function pa(){const k=b(gl("backlog",[])),x=b(gl("sprints",[]));if(x.value.length===0)x.value.push({id:vl("sprint"),name:"Sprint 1",goal:"",start:"",end:"",started:!1,tickets:[]});else if(x.value.length>1){for(let c=1;c<x.value.length;c++)k.value.push(...x.value[c].tickets);x.value=[x.value[0]]}const I=b(x.value[0].id);j([k,x],()=>{ml("backlog",k.value),ml("sprints",x.value)},{deep:!0});const B=b([]),q=nt({}),D=V(()=>k.value.length>0&&B.value.length===k.value.length),u=c=>{var o;const s=x.value.find(n=>n.id===c);return!!s&&s.tickets.length>0&&(((o=q[c])==null?void 0:o.length)||0)===s.tickets.length};function E(c,s,o){const n=s.target.checked;if(c==="backlog")B.value=n?k.value.map(m=>m.id):[];else if(o){const m=x.value.find(h=>h.id===o);q[o]=n&&m?m.tickets.map(h=>h.id):[]}}function H(c,s,o,n){const m=o.target.checked,h=c==="backlog"?B.value:q[n]||(q[n]=[]);if(m&&!h.includes(s)&&h.push(s),!m){const X=h.indexOf(s);X>=0&&h.splice(X,1)}}function W(){return x.value.find(c=>c.id===I.value)||x.value[0]}function N(){const s=[...k.value,...x.value.flatMap(n=>n.tickets)].map(n=>Number(String(n.key).replace(/[^0-9]/g,""))).filter(n=>!Number.isNaN(n));return`PRJ-${s.length?Math.max(...s)+1:1}`}const{mutate:z}=$l({onSuccess:()=>{ft.success("Cards moved to sprint successfully")},onError:c=>{ft.error("Failed to move cards: "+(c.message||"Unknown error"))}});function Q(){var n,m;const c=W();if(!c||!B.value.length)return;const s=[],o=[];for(const h of k.value)(B.value.includes(h.id)?o:s).push(h);k.value=s,c.tickets.push(...o),B.value=[],o.length>0&&z({id:c.id,payload:{card_ids:o.map(h=>h.id),priority:((m=(n=o[0])==null?void 0:n.priority)==null?void 0:m.toLowerCase())||"medium",story_points:o.reduce((h,X)=>h+(X.storyPoints||0),0)}})}function L(c){const s=x.value.find(h=>h.id===c);if(!s)return;const o=q[c]||[],n=[],m=[];for(const h of s.tickets)(o.includes(h.id)?m:n).push(h);s.tickets=n,k.value.push(...m),q[c]=[]}function O(c,s){if(c==="backlog")k.value=k.value.filter(o=>!B.value.includes(o.id)),B.value=[];else if(s){const o=q[s]||[],n=x.value.find(m=>m.id===s);if(!n)return;n.tickets=n.tickets.filter(m=>!o.includes(m.id)),q[s]=[]}}function K(c,s){const o={id:vl("T"),key:N(),createdAt:new Date().toISOString(),...s};if(c==="backlog")k.value.push(o);else{const n=W();n==null||n.tickets.push(o)}}function le(c){const s=W();s&&(s.name=c.name??s.name,s.goal=c.goal??s.goal,s.start=c.start??s.start,s.end=c.end??s.end)}function se(){const c=W();c&&(c.started=!c.started)}function M(c){return c.tickets.reduce((s,o)=>s+(o.storyPoints||0),0)}return{backlog:k,sprints:x,activeSprintId:I,selectedBacklogIds:B,selectedSprintIds:q,allBacklogChecked:D,allSprintChecked:u,toggleAll:E,toggleOne:H,getActiveSprint:W,createTicket:K,saveSprintMeta:le,toggleStartSprint:se,sprintPoints:M,moveSelectedToSprint:Q,moveSelectedToBacklog:L,deleteSelected:O,priorityClass:ca}}const fa={class:"h-full min-h-0"},va={key:0,class:"empty-state flex flex-col justify-center items-center h-full"},ma=["disabled"],ga={key:1,class:"overflow-y-auto h-[calc(100%-50px)] tickets-scroll"},ba={class:"flex flex-col flex-1 gap-[4px] min-w-0 me-1"},xa=["onDragstart","onClick"],ya=["checked","onChange"],_a={class:"flex items-center text-[14px] font-sans font-medium capitalize text-text-secondary flex-1 min-w-0"},ha={class:"truncate"},ka={class:"flex-shrink-0"},wa={key:0,class:"flex justify-center text-gray-500 items-center text-[11px] aspect-square w-[24px] h-[24px] bg-bg-body rounded-full border-border-input border-2"},Sa={key:1,class:"w-6 h-6 rounded-full"},Ca=["src"],$a={key:2,class:"text-[11px] aspect-square w-24px flex justify-center items-center h-[24px] bg-accent/30 text-accent border-accent border rounded-full"},Da=rt({__name:"BacklogTable",props:{searchQuery:{type:String,default:""},sprintType:{type:String,default:""},checkedAll:{type:Boolean,default:!1},moduleId:[String,Number,null]},emits:["ticket-dragged-to-sprint","open-ticket","ticket-moved-to-backlog","open-create-ticket"],setup(k,{emit:x}){const{theme:I}=il(),{canCreateCard:B}=ll(),q=x,D=k,{workspaceId:u}=bl(),E=b(D.moduleId??null),{data:H,isPending:W}=tl(u,D.sprintType,E),N=b([]),z=b(!1),Q=b([]),L=b([]);j(H,o=>{o!=null&&o.cards&&(N.value=o.cards.map(n=>{var T,ve,ye,Ee;const m=((T=n.card)==null?void 0:T.variables)??{},h=((ve=n.card)==null?void 0:ve._id)??n.card_id,X=String(m["card-status"]??"").trim(),_=String(m.priority??"").trim();return{id:h,key:m["card-code"]||(h==null?void 0:h.slice(-6))||"PRJ-?",summary:m["card-title"]||"(untitled)",type:"Story",status:X,assignee:((ye=n.card)==null?void 0:ye.assigned_to)??"Unassigned",storyPoints:Number(n.story_points??0)||0,priority:K(_),createdAt:((Ee=n.card)==null?void 0:Ee.created_at)??new Date().toISOString(),description:m["card-description"]||""}}))},{immediate:!0}),j(N,o=>{const n=new Set(o.map(m=>m.id));L.value=L.value.filter(m=>n.has(m))});const O=V(()=>{if(console.log(D.searchQuery,"this is query"),!D.searchQuery)return N.value;const o=D.searchQuery.toLowerCase();return N.value.filter(n=>{var h;const m=typeof n.assignee=="string"?n.assignee:((h=n.assignee)==null?void 0:h.u_full_name)||"";return n.key.toLowerCase().includes(o)||n.summary.toLowerCase().includes(o)||m.toLowerCase().includes(o)})});function K(o){const n=String(o??"").toLowerCase();return["highest","blocker","critical"].includes(n)?"Highest":["high","major"].includes(n)?"High":["medium","normal"].includes(n)?"Medium":"Low"}function le(o,n,m){var T;const h=L.value.includes(n.id)?[...L.value]:[n.id],X=h.map(ve=>N.value.find(ye=>ye.id===ve)).filter(Boolean);Q.value=h;const _=JSON.stringify({id:n.id,ids:h,from:m,tickets:X});(T=o.dataTransfer)==null||T.setData("text/plain",_),o.dataTransfer&&(o.dataTransfer.effectAllowed="move")}function se(o){var n;z.value=!1,((n=o.dataTransfer)==null?void 0:n.dropEffect)!=="none"&&Q.value.length&&(N.value=N.value.filter(m=>!Q.value.includes(m.id)),L.value=L.value.filter(m=>!Q.value.includes(m))),Q.value=[]}function M(o){var n;o.preventDefault(),z.value=!1;try{const m=(n=o.dataTransfer)==null?void 0:n.getData("text/plain");if(!m)return;const h=JSON.parse(m);if(h.from!=="sprint")return;const _=(h.tickets&&h.tickets.length?h.tickets:h.ticket?[h.ticket]:[]).filter(Boolean).filter(ve=>!N.value.some(ye=>ye.id===ve.id));_.length&&N.value.push(..._);const T=h.ids&&h.ids.length?h.ids:h.id?[h.id]:[];T.length&&q("ticket-moved-to-backlog",T,h.sprintId),console.log(h.sprintId,"sprintId ....")}catch(m){console.error("Drop error:",m)}}function c(o,n){n?L.value.includes(o)||L.value.push(o):L.value=L.value.filter(m=>m!==o)}function s(o,n){const m=n.target.checked;c(o,m)}return j(()=>D.checkedAll,o=>{o?(L.value=N.value.map(n=>n.id),console.log(L.value)):L.value=[]}),(o,n)=>(d(),g("section",fa,[t("div",{class:J(["rounded-lg flex flex-col h-full",z.value?"ring-2 ring-blue-400":""]),onDragover:n[3]||(n[3]=Te(()=>{},["prevent"])),onDragenter:n[4]||(n[4]=m=>z.value=!0),onDragleave:n[5]||(n[5]=m=>z.value=!1),onDrop:n[6]||(n[6]=m=>M(m))},[!v(W)&&O.value.length===0?(d(),g("div",va,[n[7]||(n[7]=t("img",{src:ta,class:"mb-4",alt:"backlog-plan"},null,-1)),n[8]||(n[8]=t("h6",{class:"text-sm text-text-primary font-semibold mb-1"}," Get started in the backlog ",-1)),n[9]||(n[9]=t("p",{class:"text-sm text-text-primary/90 mb-4"}," Plan and start a sprint to see issues here. ",-1)),t("button",{disabled:!v(B),onClick:n[0]||(n[0]=m=>o.$emit("open-create-ticket")),class:J(["relative inline-flex items-center justify-center font-medium py-1.5 px-3 text-sm rounded-md focus:outline-none transition text-xs px-3 py-1.5 h-[34px] bg-accent text-white hover:bg-accent-hover border-border-input border",v(B)?"cursor-pointer":"cursor-not-allowed"])}," Create Ticket ",10,ma)])):(d(),g("div",ga,[t("div",ba,[(d(!0),g(xe,null,we(O.value,m=>{var h,X;return d(),g("div",{key:m.id,draggable:"true",class:J(["flex items-center  gap-3 p-[8px] cursor-pointer transition-colors rounded-[8px]",L.value.includes(m.id)?"border-2 border-[#5a2d7f]":"border border-border-input",v(I)==="dark"?"bg-bg-body hover:bg-bg-surface":"bg-bg-charcoal hover:bg-bg-body"]),onDragstart:_=>le(_,m,"backlog"),onDragend:n[2]||(n[2]=_=>se(_)),onClick:_=>o.$emit("open-ticket",m)},[t("input",{type:"checkbox",class:"custom-checkbox bg-bg-body border border-border-input flex-shrink-0",checked:L.value.includes(m.id),onClick:n[1]||(n[1]=Te(()=>{},["stop"])),onChange:_=>s(m.id,_)},null,40,ya),t("div",_a,[t("span",ha,P(m.summary),1)]),t("div",ka,[(m==null?void 0:m.assignee)==="Unassigned"?(d(),g("span",wa,"UA")):(h=m==null?void 0:m.assignee)!=null&&h.u_profile_image?(d(),g("div",Sa,[t("img",{src:m.assignee.u_profile_image,alt:""},null,8,Ca)])):(d(),g("span",$a,P(v(al)((X=m==null?void 0:m.assignee)==null?void 0:X.u_full_name)),1))])],42,xa)}),128))])]))],34)]))}}),Ta=Pt(Da,[["__scopeId","data-v-8d08899e"]]),Va="data:image/svg+xml,%3csvg%20width='60'%20height='60'%20viewBox='0%200%2060%2060'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20opacity='0.4'%3e%3cpath%20d='M9.375%2030C11.6402%2030%2013.4766%2028.1637%2013.4766%2025.8984C13.4766%2023.6332%2011.6402%2021.7969%209.375%2021.7969C7.10977%2021.7969%205.27344%2023.6332%205.27344%2025.8984C5.27344%2028.1637%207.10977%2030%209.375%2030Z'%20fill='%23AE2A19'/%3e%3cpath%20d='M26.25%2024.375C28.5152%2024.375%2030.3516%2022.5387%2030.3516%2020.2734C30.3516%2018.0082%2028.5152%2016.1719%2026.25%2016.1719C23.9848%2016.1719%2022.1484%2018.0082%2022.1484%2020.2734C22.1484%2022.5387%2023.9848%2024.375%2026.25%2024.375Z'%20fill='%23BF63F3'/%3e%3cpath%20d='M15.3931%2035.8594H11.0159V33.0938C9.93587%2033.3387%208.81469%2033.3387%207.73465%2033.0938V35.8594H1.87528C1.55115%2035.8601%201.2345%2035.9568%200.965283%2036.1373C0.696064%2036.3178%200.486343%2036.574%200.362583%2036.8736C0.238824%2037.1731%200.206573%2037.5027%200.269899%2037.8205C0.333226%2038.1384%200.489292%2038.4304%200.718404%2038.6597L7.05872%2045L0.718404%2051.3403C0.489292%2051.5696%200.333226%2051.8616%200.269899%2052.1795C0.206573%2052.4973%200.238824%2052.8269%200.362583%2053.1264C0.486343%2053.426%200.696064%2053.6822%200.965283%2053.8627C1.2345%2054.0432%201.55115%2054.1399%201.87528%2054.1406H15.3931L21.7503%2045L15.3931%2035.8594Z'%20fill='%2382B536'/%3e%3cpath%20d='M34.4562%2035.8594H27.8937V27.4688C26.8137%2027.7138%2025.6925%2027.7138%2024.6125%2027.4688V35.8594H19.3896L25.7487%2045L19.3896%2054.1406H34.4562L40.8143%2045L34.4562%2035.8594Z'%20fill='%2382B536'/%3e%3cpath%20d='M43.8281%2019.6875H55.3125C55.7475%2019.6873%2056.1647%2019.5143%2056.4723%2019.2067C56.7799%2018.8991%2056.9529%2018.4819%2056.9531%2018.0469V9.375C56.9529%208.93996%2056.7799%208.5228%2056.4723%208.21518C56.1647%207.90755%2055.7475%207.73462%2055.3125%207.73438H43.8281V7.5C43.8281%207.06488%2043.6553%206.64758%2043.3476%206.3399C43.0399%206.03223%2042.6226%205.85938%2042.1875%205.85938C41.7524%205.85938%2041.3351%206.03223%2041.0274%206.3399C40.7197%206.64758%2040.5469%207.06488%2040.5469%207.5V32.5781H43.8281V19.6875Z'%20fill='%23FCA700'/%3e%3cpath%20d='M59.2843%2043.8403L51.7843%2036.3403C51.6322%2036.1878%2051.4514%2036.0668%2051.2524%2035.9842C51.0534%2035.9017%2050.8401%2035.8593%2050.6246%2035.8594H38.4521L44.8121%2045L38.4531%2054.1406H50.6246C50.8401%2054.1407%2051.0534%2054.0983%2051.2524%2054.0158C51.4514%2053.9332%2051.6322%2053.8122%2051.7843%2053.6597L59.2843%2046.1597C59.4368%2046.0075%2059.5577%2045.8267%2059.6402%2045.6277C59.7228%2045.4287%2059.7652%2045.2154%2059.7652%2045C59.7652%2044.7846%2059.7228%2044.5713%2059.6402%2044.3723C59.5577%2044.1733%2059.4368%2043.9925%2059.2843%2043.8403Z'%20fill='%2382B536'/%3e%3c/g%3e%3c/svg%3e",Ea={key:0,class:"overflow-y-auto h-[calc(100%-50px)] tickets-scroll"},La={class:"flex flex-col flex-1 gap-[4px] min-w-0 me-1"},Ma=["onDragstart","onClick"],Aa=["checked","onChange"],Ba={class:"flex items-center text-[14px] font-sans font-medium capitalize text-text-secondary flex-1 min-w-0"},Ia={class:"truncate"},Fa={class:"flex-shrink-0"},Oa={key:0,class:"flex justify-center text-gray-500 items-center text-[11px] aspect-square w-[24px] h-[24px] bg-bg-body rounded-full border-border-input border-2"},Ua={key:1,class:"w-6 h-6 rounded-full"},Na=["src"],Pa={key:2,class:"text-[11px] aspect-square w-[24px] flex justify-center items-center h-[24px] bg-accent/30 text-accent border-accent border rounded-full"},qa={key:1,class:"empty-state flex flex-col justify-center items-center border-dashed border-3 p-2 border-border h-[calc(100%-50px)] min-h-0"},za=rt({__name:"SprintCard",props:{sprint:{},sprintId:{},searchQuery:{},checkedSprintAll:{type:Boolean}},emits:["edit-sprint","toggle-start","open-ticket","move-selected-to-backlog","delete-selected-sprint","refresh"],setup(k,{emit:x}){const{theme:I}=il(),B=k,q=x,D=b([]),u=b([]);j(()=>B.sprint&&B.sprint.tickets,M=>{D.value=[...M||[]];const c=new Set(D.value.map(s=>s.id));u.value=u.value.filter(s=>c.has(s))},{immediate:!0,deep:!0});const E=V(()=>{var c;const M=((c=B.searchQuery)==null?void 0:c.toLowerCase())||"";return M?D.value.filter(s=>{var n;const o=((n=s.assignee)==null?void 0:n.u_full_name)??"";return s.key.toLowerCase().includes(M)||s.summary.toLowerCase().includes(M)||o.toLowerCase().includes(M)}):D.value}),H=b(!1),W=b([]),{mutate:N}=$l({onSuccess:()=>{ft.success("Card moved to sprint successfully"),q("refresh")},onError:M=>{ft.error("Failed to move card: "+(M.message||"Unknown error"))}});function z(M,c,s,o){var X;const n=u.value.includes(c.id)?[...u.value]:[c.id],m=n.map(_=>D.value.find(T=>T.id===_)).filter(Boolean);W.value=n;const h=JSON.stringify({id:c.id,ids:n,from:s,sprintId:o,ticket:c,tickets:m});(X=M.dataTransfer)==null||X.setData("text/plain",h),M.dataTransfer&&(M.dataTransfer.effectAllowed="move")}function Q(M){var c;H.value=!1,((c=M.dataTransfer)==null?void 0:c.dropEffect)!=="none"&&W.value.length&&(D.value=D.value.filter(s=>!W.value.includes(s.id)),u.value=u.value.filter(s=>!W.value.includes(s))),W.value=[]}function L(){H.value=!0}function O(){H.value=!1}function K(M){var c;M.preventDefault(),H.value=!1;try{const s=(c=M.dataTransfer)==null?void 0:c.getData("text/plain");if(!s)return;const o=JSON.parse(s);if(o.from!=="backlog")return;const m=(o.tickets&&o.tickets.length?o.tickets:o.ticket?[o.ticket]:[]).filter(Boolean).filter(h=>!D.value.some(X=>X.id===h.id));if(!m.length)return;D.value.push(...m),m.forEach(h=>{N({id:B.sprintId,payload:{card_ids:[h.id],priority:(h.priority||"Medium").toLowerCase(),story_points:h.storyPoints||0}})})}catch(s){console.error("Drop error:",s)}}function le(M,c){c?u.value.includes(M)||u.value.push(M):u.value=u.value.filter(s=>s!==M)}function se(M,c){const s=c.target.checked;le(M,s)}return j(()=>B.checkedSprintAll,M=>{M?(u.value=E.value.map(c=>c.id),console.log(E.value)):u.value=[]}),(M,c)=>(d(),g("div",{class:J(["h-full min-h-0 px-2",v(I)==="dark"?"bg-bg-surface":"bg-bg-surface/30"])},[t("div",{class:J([H.value?"ring-2 ring-blue-400 rounded-lg":"","h-full box-border mt-3"]),onDragover:c[2]||(c[2]=Te(()=>{},["prevent"])),onDragenter:L,onDragleave:O,onDrop:K},[E.value.length>0&&M.sprint?(d(),g("div",Ea,[t("div",La,[(d(!0),g(xe,null,we(E.value,s=>{var o,n;return d(),g("div",{key:s.id,draggable:"true",class:J(["flex items-center  gap-3 p-[8px] cursor-pointer transition-colors rounded-[8px]",u.value.includes(s.id)?"border-2 border-[#5a2d7f]":"border border-border-input",v(I)==="dark"?"bg-bg-body hover:bg-bg-surface":"bg-bg-charcoal hover:bg-bg-body"]),onDragstart:m=>z(m,s,"sprint",M.sprint.id),onDragend:c[1]||(c[1]=m=>Q(m)),onClick:m=>M.$emit("open-ticket",s)},[t("input",{type:"checkbox",class:J(["custom-checkbox border border-border-input flex-shrink-0",v(I)==="dark"?"bg-bg-charcoal":"bg-bg-body "]),checked:u.value.includes(s.id),onClick:c[0]||(c[0]=Te(()=>{},["stop"])),onChange:m=>se(s.id,m)},null,42,Aa),t("div",Ba,[t("span",Ia,P(s.summary),1)]),t("div",Fa,[(s==null?void 0:s.assignee)=="Unassigned"?(d(),g("span",Oa,"UA")):(o=s.assignee)!=null&&o.u_profile_image?(d(),g("div",Ua,[t("img",{src:s.assignee.u_profile_image,alt:""},null,8,Na)])):(d(),g("span",Pa,P(v(al)(((n=s.assignee)==null?void 0:n.u_full_name)??"")),1))])],42,Ma)}),128))])])):(d(),g("div",qa,c[3]||(c[3]=[xl('<img src="'+Va+'" class="mb-4" alt="backlog-plan" data-v-8dcd4e3b><h6 class="text-sm text-text-primary font-semibold mb-1 text-center" data-v-8dcd4e3b> Plan your sprint </h6><p class="text-sm text-text-primary/90 mb-3 max-w-120 text-center" data-v-8dcd4e3b> Drag work items from the <span class="font-bold" data-v-8dcd4e3b>Backlog</span> section or create new ones to plan the work for this sprint. Select <span class="font-bold" data-v-8dcd4e3b>Start sprint</span> when you&#39;re ready. </p>',3)])))],34)],2))}}),ja=Pt(za,[["__scopeId","data-v-8dcd4e3b"]]),Ra={class:"px-6 gap-4 bg-bg-input pt-5 pb-8"},Ha={class:"mt-3"},Wa={class:"flex justify-end gap-2 p-6 sticky bottom-0 bg-bg-input border-t border-border"},Ka=rt({__name:"SprintModal",props:{modelValue:{type:Boolean,default:!1},sprint:{},creatingSprint:{type:Boolean}},emits:["update:modelValue","save","close"],setup(k,{emit:x}){const I=x,B=k,q=V({get:()=>B.modelValue,set:L=>I("update:modelValue",L)}),D=nt({name:"",sprintType:"",description:""}),u=nt({name:!1,sprintType:!1,description:!1}),E=V(()=>u.name&&!String(D.name||"").trim()?"Name is required":""),H=V(()=>!!String(D.name||"").trim()&&!E.value);function W(){q.value=!1,I("close")}function N(){u.name=!0,H.value&&I("save",{name:String(D.name||"").trim(),value:String(D.sprintType||"").trim(),description:String(D.description||"").trim()})}function z(){u.name=!1,u.sprintType=!1,u.description=!1}j(()=>B.sprint,L=>{if(!L){D.name="";return}D.name=L.name??(L==null?void 0:L.title)??"",D.sprintType=L.sprintType??(L==null?void 0:L.sprintType)??"",D.description=L.description??"",z()},{immediate:!0});const Q=[{title:"Milestone",_id:"milestone",dot:"#2e9bda"},{title:"Sprint",_id:"sprint",dot:"#7d68c8"},{title:"Huddle",_id:"huddle",dot:"#eea832"}];return(L,O)=>(d(),ce(sl,{modelValue:q.value,"onUpdate:modelValue":O[5]||(O[5]=K=>q.value=K),modalClass:"!py-0",size:"md"},{default:ae(()=>[O[8]||(O[8]=t("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-input pb-4"},[t("h2",{class:"text-xl font-semibold"},"Add New Sprint")],-1)),t("div",Ra,[U(nl,{class:"rounded-1",modelValue:D.name,"onUpdate:modelValue":O[0]||(O[0]=K=>D.name=K),label:"Name",placeholder:"Sprint 1",error:!!E.value,message:E.value,onBlur:O[1]||(O[1]=K=>u.name=!0)},null,8,["modelValue","error","message"]),U(Ut,{class:"rounded-1 mt-3",modelValue:D.sprintType,"onUpdate:modelValue":O[2]||(O[2]=K=>D.sprintType=K),label:"Sprint Type",options:Q,error:!!E.value,message:E.value,onBlur:O[3]||(O[3]=K=>u.name=!0)},null,8,["modelValue","error","message"]),t("div",Ha,[U(Kl,{modelValue:D.description,"onUpdate:modelValue":O[4]||(O[4]=K=>D.description=K),label:"Description",placeholder:"Sprint description...",type:"textarea",rows:4},null,8,["modelValue"])]),O[6]||(O[6]=t("div",null,null,-1))]),t("div",Wa,[U(We,{variant:"secondary",onClick:W},{default:ae(()=>O[7]||(O[7]=[de("Cancel")])),_:1,__:[7]}),U(We,{variant:"primary",disabled:!H.value,onClick:N},{default:ae(()=>[de(P(L.creatingSprint?"Saving...":"Save"),1)]),_:1},8,["disabled"])])]),_:1,__:[8]},8,["modelValue"]))}}),Qa="/assets/filter-JX25xO5j.svg",Ga={class:"px-6 grid grid-cols-2 gap-4 bg-bg-input pt-5"},Ja={class:"flex flex-col col-span-2"},Za={class:"flex flex-col col-span-2"},Xa={class:"flex gap-1 flex-col col-span-2 sm:col-span-1"},Ya={key:0,class:"text-xs text-red-500"},es={class:"flex gap-1 flex-col col-span-2 sm:col-span-1"},ts={key:0,class:"text-xs text-red-500"},ls={class:"flex flex-col col-span-2"},as={class:"flex flex-col col-span-2"},ss={class:"bg-bg-body wfull px-4 py-3 rounded-lg text-xs text-text-secondary"},ns={class:"flex justify-end gap-2 p-6 sticky bottom-0 bg-bg-input"},os=rt({__name:"StartSprintModal",props:{modelValue:{type:Boolean,default:!1},sprint:{},creatingSprint:{type:Boolean}},emits:["update:modelValue","save","close"],setup(k,{emit:x}){const I=x,B=k,q=[{_id:1,title:"1 Week"},{_id:2,title:"2 Weeks"},{_id:3,title:"3 Weeks"},{_id:4,title:"4 Weeks"},{_id:5,title:"Custom"}],D=V({get:()=>B.modelValue,set:s=>I("update:modelValue",s)}),u=nt({goal:"",start:new Date().toISOString().slice(0,10),end:"",sprint_name:"",duration:null}),E=nt({start:!1,end:!1}),H=V(()=>!u.start&&E.start?"Start date is required":""),W=V(()=>{if(!u.end&&E.end)return"End date is required";if(u.start&&u.end){const s=le(u.start),o=le(u.end);if(Number.isFinite(s)&&Number.isFinite(o)&&o<s)return"End date cannot be before start date"}return""}),N=V(()=>!H.value&&!W.value);function z(s){u.start=s||"",E.start=!0}function Q(s){u.end=s||"",E.end=!0}function L(){D.value=!1,u.duration=null,I("close")}function O(){E.start=!0,E.end=!0,N.value&&(I("save",{title:u.sprint_name||"new sprint",duration:String(c.value)||null,start:u.start||"",end:u.end||"",goal:u.goal??""}),D.value=!1,I("close"))}function K(){E.start=!1,E.end=!1}function le(s){return s?new Date(`${s}T00:00:00`).getTime():NaN}const se=V(()=>u.duration===5);j(()=>u.duration,s=>{if(!s)return;const o=typeof s=="object"?s._id:s;if(o!==5&&u.start){const n=M(u.start,o*7);u.end=n}}),j(()=>u.start,s=>{s&&(u.duration&&u.duration!==5&&(u.end=M(u.start,u.duration*7)),u.end&&le(u.end)<le(u.start)&&(u.end=u.start))});function M(s,o){const n=new Date(s);return n.setDate(n.getDate()+o),n.toISOString().slice(0,10)}const c=V(()=>!u.start||!u.end?0:u.duration!==5?u.duration*7:(le(u.end)-le(u.start))/864e5);return j(()=>B.sprint,s=>{if(!s){u.start=new Date().toISOString().slice(0,10),u.end="",u.sprint_name="",u.goal="",K();return}u.goal=s.goal??"",u.start=s.start??new Date().toISOString().slice(0,10),u.end=s.end??"",u.sprint_name=s.title??"",K()},{immediate:!0}),(s,o)=>(d(),ce(sl,{modelValue:D.value,"onUpdate:modelValue":o[3]||(o[3]=n=>D.value=n),modalClass:"!py-0",size:"md"},{default:ae(()=>[t("div",{class:"sticky top-0 z-10 flex justify-between items-center py-6 px-6 border-b border-border bg-bg-input"},[o[5]||(o[5]=t("h2",{class:"text-xl font-semibold"},"Start Sprint",-1)),t("span",{onClick:L,class:"text-sm text-text-secondary cursor-pointer"},o[4]||(o[4]=[t("i",{class:"fa-solid fa-xmark text-text-primary text-[19px]"},null,-1)]))]),t("div",Ga,[t("div",Ja,[U(nl,{modelValue:u.sprint_name,"onUpdate:modelValue":o[0]||(o[0]=n=>u.sprint_name=n),label:"Sprint Name",placeholder:"Enter sprint name",size:"md",class:"rounded-1"},null,8,["modelValue"])]),t("div",Za,[U(Ut,{modelValue:u.duration,"onUpdate:modelValue":o[1]||(o[1]=n=>u.duration=n),options:q,label:"Duration",placeholder:"Select duration"},null,8,["modelValue"])]),t("div",Xa,[o[7]||(o[7]=t("label",{class:"text-sm font-medium"},"Start date",-1)),t("div",{class:J(["border relative flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",H.value?"border-red-500":""])},[U(Ct,{placeholder:"Set start date",class:"w-full z-1","model-value":u.start,"emit-as":"ymd","onUpdate:modelValue":z},null,8,["model-value"]),o[6]||(o[6]=t("i",{class:"fa-regular fa-calendar absolute right-2 top-3 z-0"},null,-1))],2),H.value?(d(),g("p",Ya,P(H.value),1)):F("",!0)]),t("div",es,[o[8]||(o[8]=t("label",{class:"text-sm font-medium"},"End date",-1)),t("div",{class:J(["border relative flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",W.value?"border-red-500":""])},[U(Ct,{placeholder:"Set end date",class:"w-full","model-value":u.end,"emit-as":"ymd",disabled:!se.value,"onUpdate:modelValue":Q,"min-date":u.start},null,8,["model-value","disabled","min-date"]),t("i",{class:J(["fa-regular fa-calendar absolute right-2 top-3 z-0",{"text-text-secondary/30 pointer-events-none":!se.value,"text-text-primary":se.value}])},null,2)],2),W.value?(d(),g("p",ts,P(W.value),1)):F("",!0)]),t("div",ls,[o[9]||(o[9]=t("label",{class:"text-sm font-medium pb-1"},"Goal (optional)",-1)),et(t("textarea",{"onUpdate:modelValue":o[2]||(o[2]=n=>u.goal=n),class:"w-full text-sm rounded-md border border-border px-3 py-2 bg-bg-input",rows:"2",placeholder:"Ship onboarding flow"},null,512),[[ol,u.goal]])]),t("div",as,[t("p",ss," Duration: "+P(u.start?c.value+" days":""),1)])]),t("div",ns,[U(We,{variant:"secondary",onClick:L},{default:ae(()=>o[10]||(o[10]=[de("Cancel")])),_:1,__:[10]}),U(We,{variant:"primary",disabled:!N.value,onClick:O},{default:ae(()=>[de(P(s.creatingSprint?"Starting...":"Start"),1)]),_:1},8,["disabled"])])]),_:1},8,["modelValue"]))}}),rs={class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},is={class:"text-sm text-text-secondary mt-1"},ds={class:"flex items-center gap-2 mt-4 w-full"},us={class:"flex items-center gap-2 flex-1"},cs={class:"px-6 min-h-[400px]"},ps={key:0},fs={key:0,class:"flex items-center justify-center py-12"},vs={key:1,class:"text-center py-12 text-text-secondary"},ms={key:2,class:"grid grid-cols-2 gap-3"},gs=["onClick"],bs={class:"flex items-center gap-3"},xs={class:"w-10 h-10 rounded-lg bg-bg-input flex items-center justify-center group-hover:bg-primary/10 transition-colors"},ys={class:"font-medium"},_s={key:1},hs={key:0,class:"flex items-center justify-center py-12"},ks={key:1,class:"text-center py-12 text-text-secondary"},ws={key:2,class:"grid grid-cols-2 gap-3"},Ss=["onClick"],Cs={class:"flex items-center gap-3"},$s={class:"w-10 h-10 rounded-lg bg-bg-input flex items-center justify-center group-hover:bg-primary/10 transition-colors"},Ds={class:"font-medium"},Ts={key:2},Vs={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Es={key:0,class:"flex flex-col"},Ls={class:"flex gap-1 flex-col"},Ms={key:0,class:"text-xs text-red-500"},As={class:"flex gap-1 flex-col"},Bs={key:0,class:"text-xs text-red-500"},Is={class:"flex flex-col gap-1"},Fs={class:"mt-2"},Os={class:"mt-4"},Us={key:0,class:"text-xs text-red-500 mt-1 px-1"},Ns={class:"flex justify-between gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},Ps={key:1},qs={class:"flex gap-2"},zs=rt({__name:"CreateBacklogTicketWithModuleSelection",props:{modelValue:{type:Boolean,default:!1},listId:{},selectedVariable:{}},emits:["update:modelValue","created"],setup(k,{emit:x}){const I=x,B=k,q=rl(),{workspaceId:D}=yl(),u=b(1),E=b(null),H=b(null),{data:W,isLoading:N}=_l(D.value),z=V(()=>{var C;return((C=W.value)==null?void 0:C.modules)||[]}),{data:Q,isFetching:L,refetch:O}=hl({workspace_module_id:E,workspace_id:D},{enabled:V(()=>!!E.value)});j(()=>E.value,()=>{O()});const K=V(()=>Q.value||[]),{data:le}=kl(D.value),{data:se}=wl(D.value,E,{enabled:V(()=>!!E.value)}),{mutate:M,isPending:c}=Sl({onSuccess:()=>{ne(),q.invalidateQueries({queryKey:["sheet-list"]}),q.invalidateQueries({queryKey:["backlog-list"]}),s.value=!1}}),s=V({get:()=>B.modelValue,set:C=>I("update:modelValue",C)}),o=V(()=>{switch(u.value){case 1:return"Select a module to create the ticket in";case 2:return"Select a sheet within the module";case 3:return"Provide the ticket details below and click Add Ticket";default:return""}}),n=V(()=>((se==null?void 0:se.value)??[]).filter(C=>{var y;return((y=C==null?void 0:C.type)==null?void 0:y.title)==="Select"})),m=C=>C.map(y=>({_id:y,title:y})),h=V(()=>((le==null?void 0:le.value)??[]).map(C=>{var y;return{_id:C._id,title:((y=C==null?void 0:C.variables)==null?void 0:y["lane-title"])??String(C._id)}})),X=C=>C.slug,_=nt({title:"",description:"",startDate:null,endDate:null,lane_id:null,assignee:null,variables:{}});j(n,C=>{for(const y of C){const $=X(y);$ in _.variables||(_.variables[$]=null)}},{immediate:!0});const T=nt({title:!1,description:!1,startDate:!1,endDate:!1,lane:!1}),ve=V(()=>!!_.title.trim()&&!!_.lane_id&&!!_.startDate&&!!_.endDate&&!Se.value&&!Oe.value&&!Ke.value&&!oe.value&&!Qe.value);function ye(C){_.startDate=C,T.startDate=!0}function Ee(C){_.endDate=C,T.endDate=!0}function it(C){_.lane_id=C,T.lane=!0}function tt(C){_.assignee=C}function dt(C){E.value=C._id,u.value=2}function lt(C){H.value=C._id,u.value=3}function Ae(){u.value>1&&u.value--}function at(){s.value=!1,ne()}function ne(){u.value=1,E.value=null,H.value=null,_.title="",_.description="",_.startDate=null,_.endDate=null,_.lane_id=null,_.assignee=null,_.variables={},T.title=!1,T.description=!1,T.startDate=!1,T.endDate=!1,T.lane=!1}const Be=V(()=>{var C;return(C=se==null?void 0:se.value)==null?void 0:C.find(y=>(y==null?void 0:y._id)==B.selectedVariable)}),Se=V(()=>T.title&&!_.title.trim()?"Title is required":""),Oe=V(()=>T.startDate?_.startDate?"":"Start date is required":""),Ke=V(()=>T.endDate?_.endDate?_.startDate&&_.endDate&&_.endDate<_.startDate?"End date cannot be before start date":"":"End date is required":""),oe=V(()=>T.lane?_.lane_id?"":"Lane is required":""),Qe=V(()=>T.description&&!_.description.trim()?"Description is required":""),pe=new Date().toISOString().split("T")[0];function ue(){var y,$;if(T.title=!0,T.lane=!0,T.description=!0,T.startDate=!0,T.endDate=!0,!ve.value||c.value)return;const C={sheet_list_id:B.listId,workspace_id:D.value,sheet_id:H.value,workspace_lane_id:_.lane_id,variables:{..._.variables,[`${(y=Be.value)==null?void 0:y.slug}`]:B.listId,"card-title":_.title.trim(),"card-description":_.description.trim(),"start-date":_.startDate,"end-date":_.endDate},seat_id:(($=_.assignee)==null?void 0:$._id)??null,createdAt:new Date().toISOString()};M(C)}return j(()=>_.title,C=>{C!=null&&C.trim()&&T.title&&(T.title=!1)}),j(()=>_.lane_id,C=>{C&&T.lane&&(T.lane=!1)}),j(()=>_.startDate,C=>{C&&T.startDate&&(T.startDate=!1)}),j(()=>_.endDate,C=>{C&&T.endDate&&(T.endDate=!1)}),j(()=>_.description,C=>{C!=null&&C.trim()&&T.description&&(T.description=!1)}),(C,y)=>(d(),ce(sl,{modelValue:s.value,"onUpdate:modelValue":y[5]||(y[5]=$=>s.value=$),modalClass:"!py-0",size:"lg"},{default:ae(()=>[t("div",rs,[y[6]||(y[6]=t("h2",{class:"text-xl font-semibold"},"Create Backlog Ticket",-1)),t("p",is,P(o.value),1),t("div",ds,[(d(),g(xe,null,we(3,$=>t("div",{key:$,class:"flex items-center flex-1"},[t("div",us,[t("div",{class:J(["h-1 flex-1 rounded-full transition-colors",u.value>=$?"bg-primary":"bg-border"])},null,2)])])),64))])]),t("div",cs,[u.value===1?(d(),g("div",ps,[y[8]||(y[8]=t("h3",{class:"text-lg font-medium mb-4"},"Select Module",-1)),v(N)?(d(),g("div",fs,y[7]||(y[7]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)]))):!z.value||z.value.length===0?(d(),g("div",vs," No modules available ")):(d(),g("div",ms,[(d(!0),g(xe,null,we(z.value,$=>{var fe,G,ie,Ue,Ne;return d(),g("button",{key:$._id,onClick:vt=>dt($),class:J(["p-4 border rounded-lg hover:border-primary transition-all text-left group",E.value===$._id?"border-primary bg-primary/5":"border-border"])},[t("div",bs,[t("div",xs,[t("i",{class:J([`${(G=(fe=$==null?void 0:$.variables)==null?void 0:fe["module-icon"])==null?void 0:G.prefix} ${(Ue=(ie=$==null?void 0:$.variables)==null?void 0:ie["module-icon"])==null?void 0:Ue.iconName}`,"text-lg"])},null,2)]),t("div",null,[t("p",ys,P(((Ne=$.variables)==null?void 0:Ne["module-title"])||"Untitled"),1)])])],10,gs)}),128))]))])):u.value===2?(d(),g("div",_s,[y[10]||(y[10]=t("h3",{class:"text-lg font-medium mb-4"},"Select Sheet",-1)),v(L)?(d(),g("div",hs,y[9]||(y[9]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)]))):!K.value||K.value.length===0?(d(),g("div",ks," No sheets available for this module ")):(d(),g("div",ws,[(d(!0),g(xe,null,we(K.value,$=>{var fe,G;return d(),g("button",{key:$._id,onClick:ie=>lt($),class:J(["p-4 border rounded-lg hover:border-primary transition-all text-left group",H.value===$._id?"border-primary bg-primary/5":"border-border"])},[t("div",Cs,[t("div",$s,[t("i",{class:J(`${(fe=$==null?void 0:$.variables["sheet-icon"])==null?void 0:fe.prefix} ${(G=$==null?void 0:$.variables["sheet-icon"])==null?void 0:G.iconName} text-lg`)},null,2)]),t("div",null,[t("p",Ds,P(($==null?void 0:$.variables["sheet-title"])||"Untitled Sheet"),1)])])],10,Ss)}),128))]))])):u.value===3?(d(),g("div",Ts,[y[14]||(y[14]=t("h3",{class:"text-lg font-medium mb-4"},"Ticket Details",-1)),t("div",Vs,[U(nl,{modelValue:_.title,"onUpdate:modelValue":y[0]||(y[0]=$=>_.title=$),label:"Ticket Title",placeholder:"e.g., Implement real-time notifications",error:!!Se.value,message:Se.value,onBlur:y[1]||(y[1]=$=>T.title=!0)},null,8,["modelValue","error","message"]),h.value.length>0?(d(),g("div",Es,[U(Ut,{size:"md",label:"Lane",options:h.value,placeholder:"Select lane",allowCustom:!1,"model-value":_.lane_id,"onUpdate:modelValue":it,error:!!oe.value,message:oe.value},null,8,["options","model-value","error","message"])])):F("",!0),(d(!0),g(xe,null,we(n.value,$=>et((d(),ce(Ut,{size:"md",key:X($),modelValue:_.variables[$.slug],"onUpdate:modelValue":fe=>_.variables[$.slug]=fe,options:m($.data),label:$.title,placeholder:"Select value",allowCustom:!0},null,8,["modelValue","onUpdate:modelValue","options","label"])),[[Nt,($==null?void 0:$._id)!=C.selectedVariable]])),128)),t("div",Ls,[y[11]||(y[11]=t("label",{class:"text-sm"},"Start date",-1)),t("div",{class:J(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",Oe.value?"border-red-500":""])},[U(Ct,{placeholder:"Set start date",class:"w-full","model-value":_.startDate,"emit-as":"ymd","onUpdate:modelValue":ye,"min-date":v(pe)},null,8,["model-value","min-date"])],2),Oe.value?(d(),g("p",Ms,P(Oe.value),1)):F("",!0)]),t("div",As,[y[12]||(y[12]=t("label",{class:"text-sm"},"End date",-1)),t("div",{class:J(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",Ke.value?"border-red-500":""])},[U(Ct,{placeholder:"Set end date",class:"w-full","model-value":_.endDate,"emit-as":"ymd","onUpdate:modelValue":Ee,"min-date":_.startDate||v(pe)},null,8,["model-value","min-date"])],2),Ke.value?(d(),g("p",Bs,P(Ke.value),1)):F("",!0)]),t("div",Is,[y[13]||(y[13]=t("label",{class:"text-sm"},"Assignee",-1)),t("div",Fs,[U(Tl,{name:!0,workspaceId:v(D),onAssign:tt,onUnassign:y[2]||(y[2]=$=>tt(null)),assigneeId:_.assignee,seat:null,disabled:!1,skipPermissionCheck:!0,class:"w-full"},null,8,["workspaceId","assigneeId"])])])]),t("div",Os,[U(Vl,{label:"Description",placeholder:"What needs to be done, acceptance criteria, links…",modelValue:_.description,"onUpdate:modelValue":y[3]||(y[3]=$=>_.description=$),onBlur:y[4]||(y[4]=$=>T.description=!0)},null,8,["modelValue"]),Qe.value?(d(),g("p",Us,P(Qe.value),1)):F("",!0)])])):F("",!0)]),t("div",Ns,[u.value>1?(d(),ce(We,{key:0,variant:"secondary",onClick:Ae},{default:ae(()=>y[15]||(y[15]=[de("Back")])),_:1,__:[15]})):(d(),g("div",Ps)),t("div",qs,[U(We,{variant:"secondary",onClick:at},{default:ae(()=>y[16]||(y[16]=[de("Cancel")])),_:1,__:[16]}),u.value===3?(d(),ce(We,{key:0,variant:"primary",disabled:!ve.value||v(c),onClick:ue},{default:ae(()=>[de(P(v(c)?"Adding…":"Add Ticket"),1)]),_:1},8,["disabled"])):F("",!0)])])]),_:1},8,["modelValue"]))}}),js={class:"flex-auto bg-gradient-to-b from-bg-card/95 to-bg-card/90 backdrop-blur rounded-[6px] shadow-[0_10px_40px_-10px_rgba(0,0,0,.5)] flex-grow h-full border border-border flex flex-col overflow-x-auto overflow-y-hidden scrollbar-visible pb-4"},Rs={class:"header px-4 py-3 flex items-center justify-between gap-1 w-[100%]"},Hs={class:"flex gap-4"},Ws={class:"flex gap-3 items-center"},Ks={class:"flex items-center gap-3 bg-bg-surface/50 h-[32px] px-2 rounded-md"},Qs={class:""},Gs={key:0,class:"flex-auto bg-gradient-to-b from-bg-card/95 to-bg-card/90 backdrop-blur shadow-[0_10px_40px_-10px_rgba(0,0,0,.5)] flex-grow h-full bg-bg-card border border-border overflow-x-auto flex scrollbar-visible"},Js={class:"flex overflow-x-auto gap-3 p-4 scrollbar-visible"},Zs={key:0,class:"mx-auto text-text-secondary/80 m-2 w-[90%] h-full justify-center flex items-center border border-dashed border-border"},Xs={class:"relative w-full h-full flex overflow-hidden"},Ys={key:0,class:"format-sidebar h-full py-4 px-4 w-[320px] border-l bg-bg-card overflow-hidden flex flex-col"},en={class:"flex items-center justify-between pb-3 mb-4 border-b"},tn={class:"format-content space-y-6"},ln={class:"format-group relative mb-3"},an={class:"text-xs text-secondary"},sn={key:0,class:"absolute z-50 mt-2 p-3 bg-bg-card rounded-lg shadow-lg border w-[240px]"},nn={class:"grid grid-cols-10 gap-1 mb-3"},on=["onClick"],rn={class:"flex items-center gap-2"},dn=["value"],un=["value"],cn={class:"format-group relative mb-3"},pn={class:"text-xs text-secondary"},fn={key:0,class:"absolute z-50 mt-2 p-3 bg-bg-card rounded-lg shadow-lg border w-[240px]"},vn={class:"grid grid-cols-10 gap-1 mb-3"},mn=["onClick"],gn={class:"flex items-center gap-2"},bn=["value"],xn=["value"],yn={class:"grid grid-cols-1 gap-3"},_n=["value"],hn={class:"mt-6 pt-4"},kn=["disabled"],wn={key:0,class:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},Sn={key:0,class:"fixed inset-0 bg-black/30 flex items-center justify-center"},Cn={class:"bg-white p-6 rounded-xl w-80"},$n={class:"flex justify-end gap-2 mt-4"},Dn=["disabled"],Tn={class:"flex items-center mt-3 gap-3"},Vn=rt({__name:"ActiveSprint",props:{sptint_id:{},searchQuery:{}},setup(k){const x=k,I=Bt(()=>It(()=>import("./CreateTaskModal-CApcIRmq.js"),__vite__mapDeps([0,1,2,3]))),B=Bt(()=>It(()=>import("./ConfirmDeleteModal-nQ068KBD.js"),__vite__mapDeps([4,5,2,3]))),q=Bt(()=>It(()=>import("./SidePanel-CieKtPYK.js"),__vite__mapDeps([6,2,3,7]))),D=Bt(()=>It(()=>import("./KanbanBoard-BEoRHiK2.js"),__vite__mapDeps([8,9,10,2,3,11,5,12]))),u=b(!1),E=b(""),H=b(null),W=b(null),N=b(null),z=b("");function Q(l){E.value="",u.value=!0,H.value=l}function L(){H.value&&H.value(E.value),u.value=!1}function O(){u.value=!1}const{mutate:K}=Sl({onSuccess:()=>{}});function le(){const l=ut.value.trim();l&&Be(l)}function se(){_e.value=!_e.value}const M=Nl(),c=b("kanban"),{workspaceId:s,moduleId:o}=yl(),n=b(""),m=b(!1),h=b(!0),{canEditSheet:X,canDeleteSheet:_,canCreateVariable:T,canCreateSheet:ve,canCreateCard:ye,canEditCard:Ee,canAssignCard:it}=ll(),{data:tt}=_l(s.value),dt=b(tt.value.modules||[]),lt=V(()=>(dt.value||[]).map(l=>{var e,r;return{_id:l._id,title:((e=l.variables)==null?void 0:e["module-title"])??"Untitled module",description:((r=l.variables)==null?void 0:r["module-description"])??"",icon:l.icon??null,status:l.status??null}})),Ae=rl(),{mutate:at,isPending:ne}=El({onSuccess:()=>{Ae.invalidateQueries({queryKey:["sheet-list"]}),ut.value="",Je.value=!1,_e.value=!1,Je.value=!1}}),Be=l=>{at({workspace_id:s.value,module_id:o.value,variable_id:pe.value,value:l})};j(lt,l=>{if(l.length&&!n.value){const e=l.find(r=>r.title==="Tasks")||l[0];n.value=e._id}},{immediate:!0});const{data:Se,refetch:Oe}=hl({workspace_id:s.value,workspace_module_id:V(()=>n.value)});j(n,l=>{l&&Oe()});const Ke=V(()=>{var l;return Se.value?(l=Se.value[0])==null?void 0:l._id:""}),oe=b(Ke),Qe=V(()=>{var l;return st.value?(l=st.value[0])==null?void 0:l._id:""}),pe=b(Qe),ue=Ll(),C=V(()=>x.sptint_id),{data:y,isPending:$}=sa(C,oe),fe=b(!1),G=b(),ie=l=>{G.value=l},Ue=Ml(),Ne=Al();function vt(l){l.type=="column"?Ue.mutate({payload:{workspace_id:s.value,workspace_module_id:o.value,variable_id:pe.value,moved_value:l.meta.id,new_index:l.meta.newIndex}}):Ne.mutate({payload:{workspace_id:s.value,card_id:l.meta.moved._id,group_value:l.meta.fromColumnId,group_variable_id:pe.value,new_index:l.meta.newIndex,sheet_id:oe.value}})}const Ge=l=>{},{mutate:qt}=Bl({onSuccess:()=>{Oe(),ct.value=!1}}),mt=V(()=>!Se.value||!Se.value.length?[]:Se.value.map(l=>{var e,r;return{_id:l._id,title:((e=l.variables)==null?void 0:e["sheet-title"])||"Untitled Sheet",description:((r=l.variables)==null?void 0:r["sheet-description"])||"",icon:l.icon||null,status:l.generation_status||null}}));j(mt,l=>{l.length>0&&!oe.value&&(oe.value=l[0]._id)},{immediate:!0}),j(mt,l=>{l.length>0?z.value=l[0].title:z.value=""},{immediate:!0}),j(Se,l=>{var e;(l==null?void 0:l.length)>0&&(oe.value=(e=l[0])==null?void 0:e._id)});const _e=b(!1),ut=b(""),zt=l=>{at({workspace_id:M.params.id,module_id:M.params.module_id,new_value:l.title,value:l.oldTitle,variable_id:pe.value})},Je=b(!1),Pe=b(),Dt=()=>{at({value:Pe.value.title,workspace_id:s.value,module_id:o.value,newValue:Pe.value.title,variable_id:pe.value,is_trash:!0})},jt=l=>{Je.value=!0,Pe.value=l},Rt=l=>{fe.value=!0,Pe.value=l},qe=V(()=>x.searchQuery),Tt=b("");j(qe,ea.debounce(l=>{Tt.value=l},200));const Vt=V(()=>{const l=y.value.flatMap(e=>e.cards.map(r=>({...r,columnId:e.title})));return new pl(l,{keys:["card-title","card-description"],threshold:.3})}),ze=V(()=>{var l;if(c.value==="kanban"){if(!qe.value)return y.value;const e=Vt.value.search(qe.value).map(r=>r.item);return y.value.map(r=>({...r,cards:e.filter(i=>i.columnId===r.title)}))}else{const e=(l=qe.value)==null?void 0:l.trim();if(!e){let i=[];return(y.value??[]).forEach(f=>{i=[...i,...f==null?void 0:f.cards]}),i}return new pl(Ht.value,{keys:["card-title","card-description"],threshold:.3}).search(e).map(i=>i.item)}}),Ht=V(()=>{let l=[];return(y.value??[]).forEach(e=>{l=[...l,...e==null?void 0:e.cards]}),l}),ct=b(!1);function Wt(l){bt.value=!0,gt.value=l}const gt=b();function Et(l){ct.value=!0,gt.value=l}const bt=b(!1),xt=()=>{gt.value={},bt.value=!bt.value},{data:st,isPending:Kt}=wl(s.value,n,oe),{mutate:Qt}=Il(),Gt=(l,e)=>{Qt({payload:{sheet_id:oe.value,workspace_id:s.value,variable_slug:l,is_visible:e}})},{data:yt}=kl(s),_t=V(()=>((yt==null?void 0:yt.value)??[]).map(l=>{var e;return{_id:l._id,title:((e=l==null?void 0:l.variables)==null?void 0:e["lane-title"])??String(l._id)}})),Lt=l=>l.map(e=>({_id:e.value??e,title:e.value??e})),Le=Fl({onSuccess:()=>{Ae.invalidateQueries({queryKey:["get-sheets"]}),Ae.invalidateQueries({queryKey:["sheet-list"]}),Ae.invalidateQueries({queryKey:["roles"]})}}),je=(l,e)=>{if(!y.value)return;const r=y.value.findIndex(i=>i.cards.some(f=>f._id===l));if(r!==-1){const i=y.value[r].cards.findIndex(f=>f._id===l);if(i!==-1){const f={...y.value[r].cards[i]};e(f),y.value[r].cards[i]=f,dl(y)}}};function ht(l,e){je(l,r=>{const i=_t.value.find(f=>f._id===e);i&&(r.lane=i)}),dl(y),Le.mutate({card_id:l,workspace_lane_id:e})}const Jt=(l,e)=>{je(l,r=>{r.seat=e}),Le.mutate({card_id:l,seat_id:e==null?void 0:e._id})},Mt=V(()=>{var l;return[{key:"card-title",label:"Title",render:({row:e,value:r})=>be("div",{class:"flex items-center gap-1 w-full"},[be("a",{onClick:()=>G.value=e,class:"text-[12px] underline text-blue-500 shrink-0 overflow-ellipsis cursor-pointer"},e["card-code"]),be("div",{class:"flex-1 min-w-0"},[be("input",{onFocusout:i=>{var f;kt(e==null?void 0:e._id,"card-title",(f=i==null?void 0:i.target)==null?void 0:f.value)},class:"text-[12px] w-full overflow-ellipsis capitalize p-1 w-full p-1 focus:border border-accent/60 rounded-sm focus:outline-none focus:ring-1 focus:ring-accent bg-transparent focus:bg-bg-body text-[12px] h-8",defaultValue:r,disabled:!Ee.value})])])},{key:"end-date",label:"Due Date",render:({row:e,value:r})=>{const i=b(r);return be(Ct,{class:" capitalize flex items-center gap-2 text-[12px]",placeholder:"Set start date",tableInputClass:!0,modelValue:i.value,disabled:!Ee.value,"onUpdate:modelValue":f=>Zt(e==null?void 0:e._id,f),emptyText:"Date"})}},{key:"lane",label:"Lane",render:({row:e})=>{var r;return be(cl,{options:_t.value??[],placeholder:"Select lane",modelValue:((r=e.lane)==null?void 0:r._id)||null,disabled:!Ee.value,"onUpdate:modelValue":i=>ht(e==null?void 0:e._id,i),displayField:"title",emptyText:"Lane"})}},{key:"created_by",label:"Owner",render:({value:e})=>be("div",{class:"capitalize flex items-center gap-2  px-3"},[be("div",{class:" rounded-full  "},[e!=null&&e.u_profile_image?be("img",{class:"w-6 h-6 rounded-full",src:e==null?void 0:e.u_profile_image}):be("div",{class:"w-5 h-5 rounded-full flex justify-center items-center text-[11px] ",style:`background:${e!=null&&e.u_full_name?ql({name:e.u_full_name,email:e.u_email}):""}`},al(e==null?void 0:e.u_full_name))]),be("span",{class:"text-[12px]"},e?e==null?void 0:e.u_full_name:"")])},{key:"seat",label:"Assignee",render:({row:e,value:r})=>be(Zl,{class:"capitalize flex items-center gap-2 ",onAssign:i=>Jt(e==null?void 0:e._id,i),assigneeId:r,seat:r,name:!0,disabled:!it.value,emptyText:"Assignee"})},...((l=st.value)==null?void 0:l.filter(e=>{var r;return((r=e==null?void 0:e.type)==null?void 0:r.title)==="Select"}).map(e=>({key:e==null?void 0:e.slug,label:e==null?void 0:e.slug,render:({row:r,value:i})=>{var Z;let f=i;if(Array.isArray(r==null?void 0:r.variables)){const A=r.variables.find(R=>R.slug===e.slug);A&&(f=A.value)}else f=((Z=r==null?void 0:r.variables)==null?void 0:Z[e.slug])??(r==null?void 0:r[e.slug])??i;return be("div",{class:"capitalize flex items-center gap-2"},[be(cl,{options:Lt(e.data??[]),modelValue:f,disabled:!Ee.value,emptyText:e.slug,"onUpdate:modelValue":A=>{kt(r==null?void 0:r._id,e.slug,A)},columnName:e.slug})])},visible:e==null?void 0:e.is_visible})))??[]]});function kt(l,e,r){je(l,i=>{if(e==="card-title"&&(i[e]=r),Array.isArray(i.variables)){const f=i.variables.find(Z=>Z.slug===e);f?f.value=r:i.variables.push({slug:e,value:r,type:"Select"})}else i.variables&&typeof i.variables=="object"?i.variables[e]=r:i[e]=r}),Le.mutate({card_id:l,variables:{[e]:r.trim()}})}function Ze(l){if(l["card-title"]){const e={sheet_list_id:"To Do",workspace_id:s.value,sheet_id:oe.value,variables:{"card-title":l["card-title"].trim()},createdAt:new Date().toISOString()};K(e)}}const Zt=(l,e)=>{const r=y.value.findIndex(i=>i.cards.some(f=>f._id===l));if(r!==-1){const i=y.value[r].cards.findIndex(f=>f._id===l);i!==-1&&(y.value[r].cards[i]["end-date"]=e)}Le.mutate({card_id:l,variables:{"start-date":e}})},Ie=b(null),Xe=b(!1),wt=["#FFFFFF","#F2F2F2","#D9D9D9","#BFBFBF","#A6A6A6","#808080","#404040","#000000","#FFE066","#FF9AA2","#8EE4AF","#00EAD3","#90DBF4","#4D96FF","#6C63FF","#C77DFF","#F7A1C4","#FFC300","#FF5733","#2ECC71","#00B894","#17A2B8","#0984E3","#3F51B5","#9C27B0","#E84393","#FF8C00","#E74C3C","#1E8449","#006D6F","#004C6D","#0057A8","#1A237E","#4A148C","#7D3C98"],Ce=b(!1);j(Xe,l=>{l&&(Ce.value=!1)}),j(Ce,l=>{l&&(Xe.value=!1)});const he=V(()=>{var l,e;return(e=(l=Ie.value)==null?void 0:l.nodeObj)!=null&&e.style?Ie.value.nodeObj.style:Y(me)});function $e(l,e,r){return l!==void 0?l:e!==void 0?e:r}function Ye(l,e){var A;if(!((A=Ie.value)!=null&&A.nodeObj))return;const r=Ie.value.nodeObj;r.style||(r.style={});const i=e.target,f=i.type==="number"?Number(i.value):i.value;switch(l){case"bg_color":r.style.background=f;break;case"color":r.style.color=f;break;case"font_size":r.style.fontSize=`${f}px`;break;case"font_weight":r.style.fontWeight=f;break;case"font_style":r.style.fontStyle=f;break;case"font_family":r.style.fontFamily=f;break;case"border_color":r.style.borderColor=f;break;case"border_width":r.style.borderWidth=`${f}px`;break;case"border_radius":r.style.borderRadius=`${f}px`;break;case"padding":r.style.padding=`${f}px`;break}const Z=document.getElementById(r.id);Z&&ge(r,Z)}const me={bg_color:"#ffffff",color:"#000000",font_size:14,font_weight:"normal",font_style:"normal",font_family:"Inter",border_color:"#cccccc",border_width:0,border_radius:0,padding:0},Fe=b(!1);async function At(){var e;const l=(e=Ie.value)==null?void 0:e.nodeObj;if(!(!l||Fe.value)){Fe.value=!0;try{const r=Pl(l);r._originalStyle||(r._originalStyle={});const i=r.style||{},f=r._originalStyle,Z={bg_color:$e(i.background,f.bg_color,me.bg_color),color:$e(i.color,f.color,me.color),font_size:$e(i.fontSize?parseInt(i.fontSize):void 0,f.font_size,me.font_size),font_weight:$e(i.fontWeight,f.font_weight,me.font_weight),font_style:$e(i.fontStyle,f.font_style,me.font_style),font_family:$e(i.fontFamily,f.font_family,me.font_family),border_color:$e(i.borderColor,f.border_color,me.border_color),border_width:$e(i.borderWidth?parseInt(i.borderWidth):void 0,f.border_width,me.border_width),border_radius:$e(i.borderRadius?parseInt(i.borderRadius):void 0,f.border_radius,me.border_radius),padding:$e(i.padding?parseInt(i.padding):void 0,f.padding,me.padding),hyperLink:E.value||r.hyperLink||""};r._originalStyle={...Z};const A=r.unique_name==="sheet"?{sheet_id:r.id,workspace_id:s.value,workspace_module_id:o.value,style:Z}:{card_id:r.id,seat_id:r.seat_id,style:Z};r.unique_name==="sheet"?await qt(A):await Le.mutateAsync(A)}finally{Fe.value=!1}}}const p=b([]);function a(l){const e={id:"root",topic:localStorage.getItem("currentName")??"",isRoot:!0,children:[],style:{},_originalStyle:{},unique_name:"root"};if(!Array.isArray(l))return e;const r={};return l.forEach(i=>{var R;const f=z.value,Z=((R=i.style)==null?void 0:R.hyperLink)||"";r[f]||(r[f]={id:i._id,topic:f,variables:i==null?void 0:i.variables,children:[],style:i==null?void 0:i.style,_originalStyle:(i==null?void 0:i.style)||{},unique_name:"sheet",hyperLink:Z||""},e.children.push(r[f]));const A={id:i==null?void 0:i._id,topic:i.title,children:[],style:Y(i==null?void 0:i.style),_originalStyle:i.style||{},unique_name:"List",hyperLink:Z||""};(i.cards||[]).forEach((ee,ke)=>{var De;const w=((De=ee.style)==null?void 0:De.hyperLink)||"",re={id:ee._id||`card-${ke}`,seat_id:ee.seat_id,topic:ee["card-title"],style:Y(ee.style),_originalStyle:ee.style||{},children:[],unique_name:"card",hyperLink:w||""};A.children.push(re),p.value=re}),r[f].children.push(A)}),e}const{mutateAsync:te}=Ol({onSuccess:()=>{Ae.invalidateQueries({queryKey:["sheets"]}),Ae.invalidateQueries({queryKey:["sheet-list"]}),close()}});Ul(()=>{c.value!=="mindmap"||!W.value||!y.value||zl(()=>{var f,Z;const l=a(y.value);N.value&&((Z=(f=N.value).destroy)==null||Z.call(f),N.value=null);const e=new Xl({el:W.value,theme:void 0,draggable:!0,contextMenu:!0,contextMenuOption:{Update:!0,extend:[{name:"Update Node",onclick:()=>{var R;h.value&&(h.value=!1);const A=(R=Ie.value)==null?void 0:R.nodeObj;A&&ie(A)}},{name:"Add Hyperlink",onclick:()=>{Q(async()=>{await At()})}}]}});N.value=e,e.init({nodeData:l}),e.bus.addListener("selectNode",A=>{A&&(Ie.value={nodeObj:A},h.value=!0)}),e.bus.addListener("renderNode",A=>{!(A!=null&&A.nodeObj)||!(A!=null&&A.element)||ge(A.nodeObj,A.element)});const r=new Set;e.bus.addListener("operation",async A=>{var ke,w,re;if(!A||A.name!=="insertSibling"&&A.name!=="addChild")return;const R=A.obj;if(!R||!R.id||r.has(R.id))return;r.add(R.id);let ee;if(A.name==="addChild"?ee=(ke=e.currentNode)==null?void 0:ke.nodeObj:ee=(re=(w=e.currentNode)==null?void 0:w.nodeObj)==null?void 0:re.parent,!(!ee||!("unique_name"in ee))&&ee.unique_name==="List")try{const De=Me({topic:R.topic??"New Card",id:R.id},ee);await K(De)}catch(De){console.error("Error creating card or refetching sheets:",De)}});const i=new Set;e.bus.addListener("operation",async A=>{var ke,w;if(!A)return;const R=A.obj;if(!(R!=null&&R.id))return;const ee=R.parent??((w=(ke=e.currentNode)==null?void 0:ke.nodeObj)==null?void 0:w.parent);if(!(!ee||!("unique_name"in ee))){if(A.name==="addChild"&&ee.unique_name==="root"&&!i.has(R.id)){i.add(R.id);try{await te({variables:{"sheet-title":R.topic??"New Sheet","sheet-description":"This is custom description"},is_ai_generated:!1,workspace_id:s.value,workspace_module_id:o.value})}catch(re){console.error("Error creating workspace sheet:",re)}return}if(ee.unique_name==="List")try{const re=Me({topic:R.topic??"New Card",id:R.id},ee);await K(re)}catch(re){console.error("Error creating card or refetching sheets:",re)}}})})});function ge(l,e){if(!l||!e||!l.style)return;const r=e.querySelector(".topic"),i=e.querySelector(".node")??e,f=l.style;f.background&&(i.style.background=f.background),f.color&&r&&(r.style.color=f.color),r&&(f.fontSize&&(r.style.fontSize=f.fontSize),f.fontFamily&&(r.style.fontFamily=f.fontFamily),f.fontWeight&&(r.style.fontWeight=f.fontWeight),f.fontStyle&&(r.style.fontStyle=f.fontStyle)),f.borderColor&&(i.style.borderColor=f.borderColor),f.borderWidth&&(i.style.borderWidth=f.borderWidth),f.borderRadius&&(i.style.borderRadius=f.borderRadius),f.padding&&(i.style.padding=f.padding)}function Y(l={}){return{background:l.bg_color,color:l.color,fontSize:l.font_size!=null?`${l.font_size}px`:void 0,fontWeight:l.font_weight,fontStyle:l.font_style,fontFamily:l.font_family,borderColor:l.border_color,borderWidth:l.border_width!=null?`${l.border_width}px`:void 0,borderRadius:l.border_radius!=null?`${l.border_radius}px`:void 0,padding:l.padding!=null?`${l.padding}px`:void 0,hyperLink:l.hyperLink||void 0}}function Me(l,e){const r=new Date,i=r.toISOString().split("T")[0],f=new Date(r.getTime()+3*24*60*60*1e3).toISOString().split("T")[0];return{sheet_list_id:(e==null?void 0:e.topic)||"In Progress",workspace_id:s.value,sheet_id:oe.value,workspace_lane_id:(l==null?void 0:l.workspace_lane_id)||null,variables:{"card-status":(e==null?void 0:e.topic)||"In Progress","card-type":null,priority:null,process:null,"card-title":l.topic||"New Card","card-description":"","start-date":i,"end-date":f},createdAt:new Date().toISOString()}}return(l,e)=>{var Z,A,R,ee,ke;const r=Xt("Button"),i=Xt("Searchbar"),f=Xt("BaseTextField");return d(),g("div",js,[t("div",Rs,[t("div",Hs,[U(r,{class:"lg:flex hidden cursor-pointer bg-gradient-to-tr from-accent to-accent-hover text-white items-center justify-center gap-1 px-2 rounded-md text-xs font-medium",onClick:e[0]||(e[0]=w=>l.$emit("go-back"))},{default:ae(()=>e[29]||(e[29]=[t("i",{class:"fa-solid fa-chevron-left text-xs"},null,-1),de(" Go Back")])),_:1,__:[29]}),U(r,{class:"flex sm:hidden cursor-pointer bg-gradient-to-tr from-accent to-accent-hover text-white items-center justify-center px-2 rounded-md text-xs font-medium",onClick:e[1]||(e[1]=w=>l.$emit("go-back"))},{default:ae(()=>e[30]||(e[30]=[t("i",{class:"fa-solid fa-chevron-left text-xs"},null,-1)])),_:1,__:[30]}),U(Yt,{modelValue:n.value,"onUpdate:modelValue":e[2]||(e[2]=w=>n.value=w),options:lt.value,variant:"secondary",customClasses:"fixed w-auto"},null,8,["modelValue","options"]),n.value?(d(),ce(Yt,{key:0,onEditOption:Wt,modelValue:oe.value,"onUpdate:modelValue":e[4]||(e[4]=w=>oe.value=w),canEdit:v(X),canDelete:v(_),onDeleteOption:Et,options:mt.value,variant:"secondary",customClasses:"fixed w-auto"},{more:ae(()=>[v(ve)?(d(),g("div",{key:0,onClick:e[3]||(e[3]=w=>xt()),class:"capitalize border-t border-border px-4 py-2 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-1 overflow-hidden overflow-ellipsis text-nowrap"},e[31]||(e[31]=[t("i",{class:"fa-solid fa-plus"},null,-1),de(" Add new ")]))):F("",!0)]),_:1},8,["modelValue","canEdit","canDelete","options"])):F("",!0)]),t("div",Ws,[n.value?(d(),ce(Yt,{key:0,actions:!1,modelValue:pe.value,"onUpdate:modelValue":e[6]||(e[6]=w=>pe.value=w),options:v(st),variant:"secondary",customClasses:"fixed w-auto"},{more:ae(()=>[v(T)?(d(),g("div",{key:0,onClick:e[5]||(e[5]=()=>{m.value=!0}),class:"sticky bottom-0 bg-bg-dropdown shadow-md shadow-border capitalize border-t border-border px-4 py-2 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-1 overflow-hidden overflow-ellipsis text-nowrap"},e[32]||(e[32]=[t("i",{class:"fa-solid fa-plus"},null,-1),de(" Add new ")]))):F("",!0)]),_:1},8,["modelValue","options"])):F("",!0),U(i,{onOnChange:e[7]||(e[7]=w=>{qe.value=w}),placeholder:"Search in Orchit AI space"}),t("div",Ks,[t("button",{class:J(["aspect-square cursor-pointer rounded-sm p-0 px-0.5",c.value==="kanban"?"text-accent bg-accent-text":" hover:bg-border/50 backdrop-blur-2xl  transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),title:"List view",onClick:e[8]||(e[8]=w=>c.value="kanban")},e[33]||(e[33]=[t("i",{class:"fa-solid fa-chart-kanban"},null,-1)]),2),t("button",{onClick:e[9]||(e[9]=w=>c.value="table"),class:J(["aspect-square cursor-pointer rounded-sm p-0 px-0.5",c.value==="table"?"text-accent bg-accent-text":"hover:bg-border/50 backdrop-blur-2xl transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),title:"Gallery view"},e[34]||(e[34]=[t("i",{class:"fa-solid fa-align-left"},null,-1)]),2),t("button",{onClick:e[10]||(e[10]=w=>c.value="mindmap"),class:J(["aspect-square cursor-pointer rounded-sm p-0 px-0.5",c.value==="mindmap"?"text-accent bg-accent-text":"hover:bg-border/50 backdrop-blur-2xl transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),title:"MindMap view"},e[35]||(e[35]=[t("i",{class:"fa-solid fa-chart-diagram"},null,-1)]),2)])])]),t("div",Qs,[c.value=="kanban"?(d(),g("div",Gs,[et(U(Cl,null,null,512),[[Nt,v($)]]),et(t("div",Js,[U(v(D),{onOnPlus:Rt,"onDelete:column":e[11]||(e[11]=w=>jt(w)),"onUpdate:column":e[12]||(e[12]=w=>zt(w)),onReorder:vt,onAddColumn:Be,"onSelect:ticket":ie,board:ze.value,onOnBoardUpdate:Ge,variable_id:pe.value,sheet_id:oe.value},{"column-footer":ae(w=>{var re,De,St,S,Re;return[(De=(re=v(ue))==null?void 0:re.transitions)!=null&&De.all_allowed&&!((Re=(S=(St=v(ue))==null?void 0:St.transitions)==null?void 0:S.all_allowed)!=null&&Re.includes(w.column.title))&&v(ue).transitions.currentColumn!=w.column.title?(d(),g("div",Zs," Disbale ( you can't drop here ) ")):F("",!0)]}),ticket:ae(({ticket:w})=>[U(Yl,{selectedVar:pe.value,onSelect:()=>{ie(w)},ticket:w},null,8,["selectedVar","onSelect","ticket"])]),_:1},8,["board","variable_id","sheet_id"])],512),[[Nt,!v($)]])])):F("",!0),c.value=="table"?(d(),ce(Jl,{key:1,onToggleVisibility:Gt,onAddVar:e[13]||(e[13]=()=>{m.value=!0}),isPending:v($)||v(Kt),columns:Mt.value,rows:ze.value,canCreate:v(ye),canCreateVariable:v(T),onCreate:Ze},null,8,["isPending","columns","rows","canCreate","canCreateVariable"])):F("",!0),c.value==="mindmap"?(d(),g(xe,{key:2},[t("div",Xs,[t("div",{ref_key:"mindMapRef",ref:W,class:"flex-1 h-full overflow-y-hidden rounded-md relative"},null,512),h.value?(d(),g("div",Ys,[t("div",en,[e[37]||(e[37]=t("h3",{class:"text-sm font-semibold text-secondary"},"Format Node",-1)),t("button",{onClick:e[14]||(e[14]=w=>h.value=!1),class:"text-gray-400 hover:text-gray-700"},e[36]||(e[36]=[t("i",{class:"fa-solid fa-times"},null,-1)]))]),t("div",tn,[t("div",null,[e[40]||(e[40]=t("h4",{class:"text-xs font-semibold text-secondary uppercase mb-3"}," Colors ",-1)),t("div",ln,[e[38]||(e[38]=t("label",{class:"block text-xs text-secondary mb-1"},"Background",-1)),t("div",{class:"flex items-center gap-2 cursor-pointer",onClick:e[15]||(e[15]=w=>Xe.value=!Xe.value)},[t("div",{class:"w-full h-7 rounded border",style:He({background:he.value.background})},null,4),t("span",an,P(he.value.background),1)]),Xe.value?(d(),g("div",sn,[t("div",nn,[(d(),g(xe,null,we(wt,w=>t("button",{key:w,class:"w-5 h-5 rounded border",style:He({background:w}),onClick:re=>{Ye("bg_color",{target:{value:w}}),Xe.value=!1}},null,12,on)),64))]),t("div",rn,[t("input",{type:"color",value:he.value.background,class:"w-8 h-8 cursor-pointer",onInput:e[16]||(e[16]=w=>Ye("bg_color",w))},null,40,dn),t("input",{type:"text",class:"flex-1 text-xs border rounded px-2 py-1",value:he.value.background,readonly:""},null,8,un)])])):F("",!0)]),t("div",cn,[e[39]||(e[39]=t("label",{class:"block text-xs text-secondary mb-1"},"Text",-1)),t("div",{class:"flex items-center gap-2 cursor-pointer",onClick:e[17]||(e[17]=w=>Ce.value=!Ce.value)},[t("div",{class:"w-full h-7 rounded border",style:He({background:he.value.color})},null,4),t("span",pn,P(he.value.color),1)]),Ce.value?(d(),g("div",fn,[t("div",vn,[(d(),g(xe,null,we(wt,w=>t("button",{key:w,class:"w-5 h-5 rounded border",style:He({background:w}),onClick:re=>{Ye("color",{target:{value:w}}),Ce.value=!1}},null,12,mn)),64))]),t("div",gn,[t("input",{type:"color",value:he.value.color,class:"w-8 h-8 cursor-pointer",onInput:e[18]||(e[18]=w=>Ye("color",w))},null,40,bn),t("input",{type:"text",class:"flex-1 text-xs border rounded px-2 py-1",value:he.value.color,readonly:""},null,8,xn)])])):F("",!0)])]),t("div",null,[t("div",yn,[t("div",null,[e[42]||(e[42]=t("label",{class:"block text-xs text-secondary mb-1"},"Weight",-1)),t("select",{class:"w-full h-8 border rounded px-2 text-sm",value:he.value.fontWeight,onChange:e[19]||(e[19]=w=>Ye("font_weight",w))},e[41]||(e[41]=[t("option",{value:"lighter"},"Light",-1),t("option",{value:"normal"},"Normal",-1),t("option",{value:"bold"},"Bold",-1),t("option",{value:"bolder"},"Extra Bold",-1)]),40,_n)])])])]),t("div",hn,[t("button",{class:"w-full cursor-pointer bg-gradient-to-tr from-accent to-accent-hover text-white flex items-center justify-center gap-2 px-4 py-2 rounded-md text-sm font-medium hover:shadow-md disabled:opacity-60",disabled:Fe.value,onClick:At},[Fe.value?(d(),g("span",wn)):F("",!0),t("span",null,P(Fe.value?"Updating...":"Update"),1)],8,kn)])])):F("",!0)]),u.value?(d(),g("div",Sn,[t("div",Cn,[e[43]||(e[43]=t("h3",{class:"text-lg font-semibold mb-4"},"Insert Web Link",-1)),et(t("input",{"onUpdate:modelValue":e[20]||(e[20]=w=>E.value=w),type:"text",placeholder:"Enter or paste a URL",class:"w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[ol,E.value]]),t("div",$n,[t("button",{onClick:O,class:"px-4 py-2 rounded-md bg-gray-200 hover:bg-gray-300"}," Cancel "),t("button",{disabled:!E.value,onClick:L,class:J(["px-4 py-2 rounded-md text-white",E.value?"bg-blue-500 hover:bg-blue-600":"bg-blue-300 cursor-not-allowed"])}," Insert ",10,Dn)])])])):F("",!0),_e.value?(d(),g("div",{key:1,class:"absolute top-40 left-70 bg-bg-body rounded-lg p-4 shadow-lg z-100 min-w-[328px] border",onClick:e[22]||(e[22]=Te(()=>{},["stop"]))},[U(f,{autofocus:!0,modelValue:ut.value,"onUpdate:modelValue":e[21]||(e[21]=w=>ut.value=w),placeholder:"Add New list",onKeyup:el(le,["enter"])},null,8,["modelValue"]),e[44]||(e[44]=t("p",{class:"text-xs mt-1.5"},"You can add details while editing",-1)),t("div",Tn,[U(r,{onClick:le,varaint:"primary",class:"px-3 py-1 bg-accent cursor-pointer text-white rounded"},{default:ae(()=>[de(P(v(ne)?"Adding...":"Add list"),1)]),_:1}),t("i",{class:"fa-solid fa-close cursor-pointer",onClick:se})])])):F("",!0)],64)):F("",!0),U(v(B),{onClick:e[23]||(e[23]=Te(()=>{},["stop"])),modelValue:Je.value,"onUpdate:modelValue":e[24]||(e[24]=w=>Je.value=w),title:"Delete List",itemLabel:"list",itemName:(Z=Pe.value)==null?void 0:Z.title,requireMatchText:(A=Pe.value)==null?void 0:A.title,confirmText:"Delete workspace",cancelText:"Cancel",size:"md",loading:v(ne),onConfirm:Dt,onCancel:e[25]||(e[25]=()=>{Je.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),fe.value?(d(),ce(v(I),{selectedVariable:pe.value,listId:(R=Pe.value)==null?void 0:R.title,sheet_id:oe.value,key:"createTaskModalKey",modelValue:fe.value,"onUpdate:modelValue":e[26]||(e[26]=w=>fe.value=w),onSubmit:e[27]||(e[27]=()=>{})},null,8,["selectedVariable","listId","sheet_id","modelValue"])):F("",!0),(ee=G.value)!=null&&ee._id?(d(),ce(v(q),{key:4,details:G.value,onClose:e[28]||(e[28]=()=>{ie({variables:{}})}),showPanel:!!((ke=G.value)!=null&&ke._id)},null,8,["details","showPanel"])):F("",!0)])])}}}),En=Pt(Vn,[["__scopeId","data-v-5d1748a3"]]),Ln={class:"flex-auto flex-grow h-full min-h-0 bg-bg-card rounded-[6px] border border-border overflow-x-auto flex-col flex"},Mn={key:1},An={key:1,class:"p-4 w-full min-w-0 box-border h-full min-h-0"},Bn={class:"flex items-center justify-between"},In={class:"text-sm font-semibold flex gap-2 items-center"},Fn={class:"flex items-center gap-2 relative",ref:"filterDropdownRef"},On={key:0,class:"flex items-center gap-2 overflow-x-auto no-scrollbar py-1"},Un=["onClick"],Nn={key:1,class:"relative flex items-center gap-3"},Pn={class:"relative flex-shrink-0"},qn={class:"flex items-center gap-2 truncate"},zn=["src"],jn={class:"truncate"},Rn={key:0,class:"absolute left-0 top-full mt-1 w-44 bg-white border border-gray-200 rounded-lg shadow-lg z-[9999]"},Hn={class:"flex flex-col"},Wn=["onClick"],Kn={class:"flex gap-2 overflow-x-auto no-scrollbar flex-1"},Qn=["onClick"],Gn={key:0,class:"w-full h-full min-h-[250px] flex justify-center items-center"},Jn={class:"flex justify-between gap-4 px-3"},Zn={class:"flex items-center gap-2 bg-transparent min-w-0"},Xn=["onClick"],Yn={class:"flex items-center lg:gap-2 max-w-full"},eo={class:"flex items-center lg:gap-2 max-w-full"},to={class:"truncate max-w-[160px]"},lo={key:1,class:"absolute left-0 mt-2 w-60 bg-white border border-gray-200 rounded-xl shadow-lg z-50 max-h-64 overflow-y-auto overflow-x-hidden"},ao={class:"relative flex-1"},so=["onClick"],no=["onBlur","onKeyup"],oo={class:"relative ml-2 flex gap-2"},ro=["onClick"],io=["onClick"],uo={class:"ms-2 flex gap-2 items-center"},co={class:"flex"},po={class:"gap-2 hidden lg:flex"},fo={key:0,class:"flex gap-2"},vo={key:0,class:"gap-2"},mo={class:"hidden lg:fxex bg-[#E6E1F5] text-accent px-3 py-1 rounded-2xl justify-center items-center"},go={key:0,class:"flex lg:hidden"},bo=["title"],xo=["disabled"],yo={class:"absolute z-50 top-10 mb-2 -translate-x-2/3 bg-card border border-accent text-accent text-xs px-2 py-1 rounded whitespace-nowrap"},_o={key:0,class:"fixed inset-0 z-50 flex items-center justify-center w-full"},ho={class:"relative bg-white rounded-lg p-4 mx-3 w-full max-w-md lg:max-w-2xl xl:max-w-3xl"},ko={class:"flex items-center gap-2"},wo={key:0,class:"w-full h-full min-h-[250px] flex justify-center items-center"},So={key:1,class:"flex-1 min-h-0"},Co={key:1,class:"bg-bg-card w-full p-6 flex flex-col items-center justify-center text-center gap-4 h-[100%] mt-3"},Ot=400,$o=rt({__name:"Plan",setup(k){const{theme:x}=il(),I=b(!1),B=b(""),q=b(!1),D=b(!1),{canCreateCard:u}=ll(),E=b(!1),H=b(null),W=b(!1),N=b(!1),z=V(()=>O.value.value),Q=b(null),L=[{label:"Milestone",value:"milestone",dot:"#2e9bda"},{label:"Sprint",value:"sprint",dot:"#7d68c8"},{label:"Huddle",value:"huddle",dot:"#eea832"}],O=b(L[0]),K=b(null),le=b(!1);Ft(K,()=>{le.value=!1});const se=()=>{I.value=!1},M=()=>{E.value=!0},c=b(!1),s=()=>{c.value=!c.value},{workspaceId:o}=bl(),n=b(!1),{moveSelectedToSprint:m,moveSelectedToBacklog:h,deleteSelected:X,saveSprintMeta:_,toggleStartSprint:T}=pa();function ve(p){Q.value=p}function ye(p){Q.value=p}function Ee(p){Q.value=p}const{data:it,refetch:tt}=tl(o,z,Q);j(Q,()=>{tt()});const{data:dt}=jl(o),lt=V(()=>{var p;return((p=dt.value)==null?void 0:p.modules.filter(a=>{var te;return((te=a==null?void 0:a.variables)==null?void 0:te["module-title"])!=="Pin"}))||[]});j(()=>z.value,(p,a)=>{p!==a&&tt()});const{mutate:Ae,isPending:at}=da({onSuccess:()=>{ct.invalidateQueries({queryKey:["sprint-list"]}),Be.value=!1}}),ne=b(null),Be=b(!1),Se=()=>{var p;Ae((p=ne.value)==null?void 0:p._id)},{mutate:Oe,isPending:Ke}=fl({onSuccess:p=>{_({name:p.title}),console.log(p,"this is testing data"),oe({id:G.value,payload:{title:p.title,start_date:p.start_date,end_date:p.end_date,goal:p.goal,duration:Number(p.duration_days)}}),Ne.value=!1}}),{mutate:oe,isPending:Qe}=ia({onSuccess:()=>{Ue()}}),pe=p=>{console.log("helo",ne.value,p),Oe({id:G.value,payload:{title:p.title,duration:p.duration,start_date:p.start,end_date:p.end,goal:p.goal}})},{data:ue,refetch:C}=la(o.value,z);j(()=>z.value,(p,a)=>{p!==a&&C()});const{refetch:y,isPending:$}=tl(o,z),fe=V(()=>{var p,a;return(a=(p=ue==null?void 0:ue.value)==null?void 0:p.sprints[0])==null?void 0:a._id}),G=b(fe.value);j(()=>fe.value,p=>{G.value=p}),j(()=>G.value,p=>{var a;ne.value=((a=ue.value)==null?void 0:a.sprints.find(te=>te._id===p))||null});const{data:ie,refetch:Ue}=oa(G),Ne=b(!1),vt=()=>{Ne.value=!0},{data:Ge,isPending:qt,refetch:mt}=aa(G);j(()=>G.value,()=>{Ue()});const _e=V(()=>{var te,ge;const p=(te=Ge==null?void 0:Ge.value)==null?void 0:te.backlog_items;if(!p)return null;const a=(((ge=Ge==null?void 0:Ge.value)==null?void 0:ge.backlog_items)||[]).map(Y=>{var e,r,i,f,Z;const Me=((e=Y==null?void 0:Y.card)==null?void 0:e.variables)||{},l=((r=Y==null?void 0:Y.card)==null?void 0:r._id)||Y.card_id;return{id:l,key:Me["card-code"]||(l==null?void 0:l.slice(-6))||"PRJ-?",summary:Me["card-title"]||"(untitled)",type:"Story",status:zt(String(Me["card-status"]||"").trim()),assignee:((f=(i=Y==null?void 0:Y.card)==null?void 0:i.assigned_to)==null?void 0:f.name)||"Unassigned",storyPoints:Number(Y.story_points||0),priority:Je(String(Me.priority||"").trim()),createdAt:((Z=Y==null?void 0:Y.card)==null?void 0:Z.created_at)||new Date().toISOString(),description:Me["card-description"]||""}});return{id:p._id,name:p.title||"Sprint 1",title:p.title,goal:"",start:"",end:"",started:!1,tickets:a}});function ut(p){G.value=p._id,Ce.value=!1}function zt(p){const a=p.toLowerCase();return a.includes("progress")?"In Progress":a.includes("done")||a.includes("complete")?"Done":"Todo"}function Je(p){const a=p.toLowerCase();return a==="highest"||a==="blocker"||a==="critical"?"Highest":a==="high"||a==="major"?"High":a==="medium"||a==="normal"?"Medium":"Low"}const{mutate:Pe}=ua({onSuccess:()=>{ft.success("Card removed from sprint successfully"),Dt()},onError:p=>{ft.error("Failed to remove card from sprint"),console.error("Failed to remove card from sprint:",p)}});function Dt(){mt(),C(),y(),Ue()}function jt(p,a){const te=Array.isArray(p)?p:[p],ge=a||G.value;!ge||!te.length||te.forEach(Y=>{Pe({sprintId:ge,cardId:Y})})}const Rt=b(!1),qe=b(null);function Tt(){n.value=!0,qe.value=null}function Vt(p){qe.value=p,I.value=!0,Rt.value=!0}const ze=b(!1);function Ht(){ze.value=!0}const ct=rl(),{mutate:Wt,isPending:gt}=ra({onSuccess:p=>{_({name:p.title}),ct.invalidateQueries({queryKey:["sprint-list"]}),ze.value=!1}}),{mutate:Et,isPending:bt}=fl({onSuccess:p=>{_({name:p.title}),ct.invalidateQueries({queryKey:["sprint-list"]}),ze.value=!1}}),xt=b("");function st(p){const a=xt.value.trim();if(!a||a===p.title){Ie();return}Et({id:p._id,payload:{workspace_id:o.value,title:a}}),Ze.value=null}function Kt(p){var a;ne.value?Et({id:(a=ne.value)==null?void 0:a._id,payload:{workspace_id:o.value,title:p.name,sprintType:p.value,description:p.description}}):Wt({payload:{workspace_id:o.value,title:p.name,sprintType:p.value,description:p.description}})}function Qt(){ne.value=null,ze.value=!0}function Gt(p){ne.value=p,Be.value=!0}const{mutate:yt,isPending:_t}=na(G,{onSuccess:()=>{Ue()}}),Lt=()=>{yt({})},Le=b(null),je=b(0);let ht=!1;Rl(()=>{if(!Le.value)return;const p=Le.value.offsetWidth;je.value=p/3});function Jt(){ht=!0,document.addEventListener("mousemove",Mt),document.addEventListener("mouseup",kt)}function Mt(p){if(!ht||!Le.value)return;const a=Le.value.getBoundingClientRect(),te=p.clientX-a.left;te<Ot?je.value=Ot:te>a.width-Ot?je.value=a.width-Ot:je.value=te}function kt(){ht=!1,document.removeEventListener("mousemove",Mt),document.removeEventListener("mouseup",kt)}const Ze=b(null);function Zt(p){Ze.value=p._id,p.tempTitle=p.title}function Ie(){var a;const p=(a=ue.value)==null?void 0:a.sprints.find(te=>te._id===Ze.value);p&&(p.tempTitle=p.title),Ze.value=null}Ft(H,()=>{N.value=!1});const Xe=p=>{O.value=p,W.value=!1};Ft(K,()=>{W.value=!1});const wt=b(null),Ce=b(!1);Ft(wt,()=>{Ce.value=!1});const he=b(!1),$e=()=>{he.value=!0},Ye=()=>{he.value=!1},me=b("all"),Fe=b(!1),At=V(()=>{var a,te,ge;if(me.value==="all")return"All Milestones";const p=(te=(a=dt.value)==null?void 0:a.modules)==null?void 0:te.find(Y=>Y._id===me.value);return((ge=p==null?void 0:p.variables)==null?void 0:ge["module-title"])||"Select Module"});return(p,a)=>{var te,ge,Y,Me,l,e,r,i,f,Z,A,R,ee,ke,w,re,De,St;return d(),g("div",Ln,[E.value?(d(),ce(En,{key:0,sptint_id:G.value,searchQuery:B.value,onGoBack:a[0]||(a[0]=S=>E.value=!1)},null,8,["sptint_id","searchQuery"])):F("",!0),E.value?F("",!0):(d(),g("div",Mn,[v(Qe)?(d(),ce(Cl,{key:0})):(d(),g("div",An,[t("div",{class:"flex gap-2 h-full max-h-screen min-h-0 box-border overflow-x-auto group",ref_key:"containerRef",ref:Le},[t("section",{class:J(["space-y-4 p-4 rounded-md relative group box-border h-full min-h-0 min-w-[400px]",v(x)==="dark"?"bg-bg-surface":"bg-bg-surface/30"]),style:He({width:je.value+"px"})},[t("div",Bn,[t("h2",In,[et(t("input",{type:"checkbox",class:"custom-checkbox bg-bg-body border border-border-input flex-shrink-0","onUpdate:modelValue":a[1]||(a[1]=S=>q.value=S)},null,512),[[Hl,q.value]]),de(" Tickets ("+P((ge=(te=v(it))==null?void 0:te.cards)==null?void 0:ge.length)+" "+P(((Me=(Y=v(it))==null?void 0:Y.cards)==null?void 0:Me.length)>1?"Tasks":"Task")+") ",1)]),t("div",Fn,[v(u)?(d(),g("button",{key:0,class:"w-7 h-7 rounded cursor-pointer text-sm hover:bg-bg-body flex items-center justify-center",onClick:Tt},a[23]||(a[23]=[t("i",{class:"text-text-primary fa-regular fa-plus"},null,-1)]))):F("",!0)],512)]),t("div",null,[z.value==="milestone"?(d(),g("div",On,[t("button",{onClick:a[2]||(a[2]=S=>ve("all")),class:J(["flex-shrink-0 px-4 py-1 rounded-2xl text-sm font-medium transition-colors whitespace-nowrap",Q.value==="all"?"bg-accent text-white border-none":"bg-transparent text-accent border border-accent"])}," All Modules ",2),(d(!0),g(xe,null,we(lt.value,S=>(d(),g("button",{key:S._id,onClick:Re=>ve(S._id),class:J(["flex-shrink-0 px-4 py-1 rounded-2xl text-sm font-medium transition-colors whitespace-nowrap cursor-pointer",Q.value===S._id?"bg-accent text-white border-none":"bg-transparent text-accent border border-accent"])},P(S.variables["module-title"]),11,Un))),128))])):z.value==="huddle"||z.value==="sprint"?(d(),g("div",Nn,[t("div",Pn,[t("button",{class:"h-8 min-w-[160px] flex items-center justify-between px-2 rounded-md border text-sm border-border hover:bg-bg-body",onClick:a[3]||(a[3]=S=>Fe.value=!Fe.value)},[t("span",qn,[t("img",{src:v(Qa),alt:"filter",class:"w-4 h-4"},null,8,zn),t("span",jn,P(At.value||"All Milestones"),1)]),a[24]||(a[24]=t("i",{class:"fas fa-chevron-down text-xs ml-2"},null,-1))]),Fe.value?(d(),g("div",Rn,[t("ul",Hn,[t("li",{class:"px-3 py-2 cursor-pointer hover:bg-gray-100",onClick:a[4]||(a[4]=S=>ye("all"))}," All Milestones "),(d(!0),g(xe,null,we(lt.value,S=>(d(),g("li",{key:S._id,class:"px-3 py-2 cursor-pointer hover:bg-gray-100",onClick:Re=>ye(S._id)},P(S.variables["module-title"]),9,Wn))),128))])])):F("",!0)]),t("div",Kn,[(d(!0),g(xe,null,we((l=v(ue))==null?void 0:l.sprints,S=>(d(),g("button",{key:S._id,onClick:Re=>Ee(S._id),class:J(["flex-shrink-0 px-4 py-1 rounded-2xl text-sm font-medium whitespace-nowrap transition-colors",Q.value===S._id?"bg-accent text-white border-none":"bg-transparent text-accent border border-accent"])},P(S.title),11,Qn))),128))])])):F("",!0)]),v($)?(d(),g("div",Gn,a[25]||(a[25]=[t("div",{role:"status","aria-label":"Loading",class:"h-10 w-10 rounded-full border-4 border-neutral-700 border-t-transparent animate-spin"},null,-1)]))):(d(),ce(Ta,{key:1,checkedAll:q.value,"sprint-type":z.value,searchQuery:B.value,"module-id":Q.value,onMoveSelectedToSprint:v(m),onDeleteSelectedBacklog:a[5]||(a[5]=S=>v(X)("backlog")),onOpenTicket:Vt,onTicketMovedToBacklog:jt,onOpenCreateTicket:Tt},null,8,["checkedAll","sprint-type","searchQuery","module-id","onMoveSelectedToSprint"]))],6),t("div",{class:"h-full w-[3px] relative z-10 opacity-0 group-hover:opacity-100 bg-red hover:bg-accent cursor-col-resize transition",onMousedown:Jt},null,32),t("section",{class:J(["rounded-md relative group pt-2 flex flex-col flex-1 h-full min-h-0 box-border min-w-[400px] border border-border-input overflow-x-hidden",v(x)==="dark"?"bg-bg-surface":"bg-bg-surface/30"])},[t("div",Jn,[t("div",Zn,[t("div",{ref_key:"elipseWrapperSprint",ref:H,class:"relative inline-block"},[t("button",{onClick:a[6]||(a[6]=Te(S=>N.value=!N.value,["stop"])),class:"flex items-center gap-2 lg:px-3 sm:px:2 py-1.5 text-sm font-medium bg-transparent rounded-lg",style:He({border:"1px solid "+O.value.dot})},[t("span",{class:"w-2 h-2 rounded-full hidden lg:flex",style:He({backgroundColor:O.value.dot})},null,4),de(" "+P(O.value.label)+" ",1),a[26]||(a[26]=t("i",{class:"fas fa-chevron-down text-xs"},null,-1))],4),U(ul,{name:"fade"},{default:ae(()=>[N.value?(d(),g("ul",{key:0,onClick:a[7]||(a[7]=Te(()=>{},["stop"])),class:"absolute left-0 mt-2 w-44 bg-bg-dropdown border border-border rounded-xl shadow-lg z-50"},[(d(),g(xe,null,we(L,S=>t("li",{key:S.value,onClick:Re=>(Xe(S),N.value=!N.value),class:"flex items-center gap-3 px-4 py-2 text-sm cursor-pointer"},[t("span",{class:"w-2 h-2 rounded-full",style:He({backgroundColor:S.dot})},null,4),de(" "+P(S.label),1)],8,Xn)),64))])):F("",!0)]),_:1})],512),t("div",Yn,[t("div",eo,[t("div",{ref_key:"sprintDropdownWrapperRef",ref:wt,class:"relative min-w-0"},[(e=v(ue))!=null&&e.sprints.length?(d(),g("button",{key:0,onClick:a[8]||(a[8]=S=>Ce.value=!Ce.value),class:J(["flex items-center gap-3 lg:px-6 px-1 py-1.5 rounded-lg text-sm font-medium transition-all",G.value?"text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"]),style:He(G.value?{backgroundColor:O.value.dot}:{})},[t("span",to,P((f=(i=(r=v(ue))==null?void 0:r.sprints)==null?void 0:i.find(S=>S._id===G.value))==null?void 0:f.title),1),a[27]||(a[27]=t("i",{class:"fas fa-chevron-down text-xs"},null,-1))],6)):F("",!0),Ce.value?(d(),g("div",lo,[(d(!0),g(xe,null,we((Z=v(ue))==null?void 0:Z.sprints,S=>{var Re;return d(),g("div",{key:S._id,class:"relative px-4 py-2 flex items-center justify-between text-sm cursor-pointer transition-colors hover:bg-gray-100"},[t("div",ao,[Ze.value!==S._id?(d(),g("button",{key:0,class:"text-left truncate w-full",onClick:pt=>ut(S)},P(S.title),9,so)):et((d(),g("input",{key:1,ref_for:!0,ref:"editingInputRef","onUpdate:modelValue":a[9]||(a[9]=pt=>xt.value=pt),class:"w-full px-1 py-1 text-sm rounded outline-none bg-white border border-[#7d68c8]",placeholder:"Enter new name",onClick:a[10]||(a[10]=Te(()=>{},["stop"])),onBlur:pt=>st(S),onKeyup:[el(pt=>st(S),["enter"]),el(Ie,["esc"])]},null,40,no)),[[ol,xt.value]])]),t("div",oo,[t("button",{class:"ml-2 text-xs text-gray-400 hover:text-accent",onClick:Te(pt=>Zt(S),["stop"])},a[28]||(a[28]=[t("i",{class:"fas fa-pen"},null,-1)]),8,ro),((Re=v(ue))==null?void 0:Re.sprints.length)>1&&Ze.value!==S._id?(d(),g("button",{key:0,onClick:Te(pt=>Gt(S),["stop"]),class:"w-4 h-4 rounded-full flex items-center justify-center text-gray-400 hover:text-red-500"},a[29]||(a[29]=[t("i",{class:"fas fa-times text-xs"},null,-1)]),8,io)):F("",!0)])])}),128))])):F("",!0)],512)])]),t("button",{onClick:a[11]||(a[11]=S=>Qt()),class:"w-7 h-7 lg:flex sm:hidden items-center justify-center rounded-full bg-accent border text-white transition-colors shrink-0"},a[30]||(a[30]=[t("i",{class:"fa-solid fa-plus text-xs"},null,-1)]))]),t("div",uo,[t("div",co,[t("button",{class:"flex items-center justify-center w-7 h-7 rounded-full bg-accent",onClick:$e},a[31]||(a[31]=[t("i",{class:"fa-solid fa-magnifying-glass text-white text-xs"},null,-1)])),((A=v(ie))==null?void 0:A.status)==="active"?(d(),g("button",{key:0,class:"flex lg:hidden cursor-pointer bg-gradient-to-tr from-accent to-accent-hover text-white items-center justify-center rounded-full ms-2 w-7 h-7 text-sm font-medium",onClick:M},a[32]||(a[32]=[t("i",{class:"fa-regular fa-eye text-sm"},null,-1)]))):F("",!0)]),t("div",po,[((R=v(ie))==null?void 0:R.status)==="active"?(d(),g("div",fo,[U(We,{size:"sm",onClick:Lt,variant:(v(x)==="dark","primary"),class:"border-border-input border"},{default:ae(()=>[de(P(v(_t)?"Ending...":"End"),1)]),_:1},8,["variant"]),t("button",{class:"cursor-pointer bg-gradient-to-tr from-accent to-accent-hover text-white flex items-center justify-center gap-1 px-2 py-1 rounded-md text-sm font-medium",onClick:M},a[33]||(a[33]=[t("i",{class:"fa-regular fa-eye text-sm"},null,-1),de(" Preview ")]))])):(d(),ce(We,{key:1,size:"sm",variant:(v(x)==="dark","primary"),class:"border-border-input border",onClick:vt,disabled:!_e.value||_e.value.tickets.length===0||v(ie).status==="completed"},{default:ae(()=>a[34]||(a[34]=[de(" Start Sprint ")])),_:1,__:[34]},8,["variant","disabled"]))]),_e.value&&_e.value.tickets.length?(d(),g("div",vo,[t("span",mo,P((ee=v(ie))==null?void 0:ee.status),1),((ke=v(ie))==null?void 0:ke.status)==="active"?(d(),g("div",go,[t("button",{onClick:Lt,class:"w-7 h-7 flex items-center justify-center rounded-full bg-accent",title:v(_t)?"Ending...":"End Sprint"},a[35]||(a[35]=[t("i",{class:"fa-solid fa-flag-checkered text-white"},null,-1)]),8,bo)])):(d(),g("button",{key:1,onClick:vt,disabled:!_e.value||_e.value.tickets.length===0,class:"w-7 h-7 flex items-center justify-center rounded-full text-white bg-accent disabled:opacity-50 disabled:cursor-not-allowed lg:hidden",title:"Start Sprint"},a[36]||(a[36]=[t("i",{class:"fa-solid fa-play text-sm"},null,-1)]),8,xo))])):F("",!0),((w=v(ie))==null?void 0:w.status)==="active"?(d(),g("div",{key:1,class:"relative inline-flex",onMouseenter:a[12]||(a[12]=S=>c.value=!0),onMouseleave:a[13]||(a[13]=S=>c.value=!1),onClick:s},[a[37]||(a[37]=t("span",{class:"flex lg:hidden bg-emerald-500 text-white w-7 h-7 rounded-full justify-center items-center cursor-pointer"},[t("i",{class:"fa-solid fa-check"})],-1)),et(t("div",yo," Sprint is active ",512),[[Nt,c.value]])],32)):F("",!0)]),U(ul,{name:"fade"},{default:ae(()=>[he.value?(d(),g("div",_o,[t("div",{class:"absolute inset-0 bg-black/10 backdrop-blur-sm",onClick:Ye}),t("div",ho,[t("div",ko,[U(Ql,{placeholder:"Search in sprint",modelValue:B.value,"onUpdate:modelValue":a[14]||(a[14]=S=>B.value=S),class:"flex-1"},null,8,["modelValue"]),t("button",{onClick:Ye,class:"p-2 rounded hover:bg-gray-100 text-accent"},a[38]||(a[38]=[t("i",{class:"fa-solid fa-xmark"},null,-1)]))])])])):F("",!0)]),_:1})]),v(qt)?(d(),g("div",wo,a[39]||(a[39]=[t("div",{role:"status","aria-label":"Loading",class:"h-10 w-10 rounded-full border-4 border-neutral-700 border-t-transparent animate-spin"},null,-1)]))):(d(),g("div",So,[_e.value&&v(ie).status==="planning"||v(ie).status==="active"?(d(),ce(ja,{key:0,searchQuery:B.value,sprintId:G.value,checkedSprintAll:D.value,sprint:_e.value,onOpenTicket:Vt,onEditSprint:Ht,onToggleStart:v(T),onMoveSelectedToBacklog:v(h),onDeleteSelectedSprint:a[15]||(a[15]=S=>v(X)("sprint",S)),onRefresh:Dt},null,8,["searchQuery","sprintId","checkedSprintAll","sprint","onToggleStart","onMoveSelectedToBacklog"])):F("",!0),v(ie).status==="completed"?(d(),g("div",Co,a[40]||(a[40]=[xl(`<div class="w-20 h-20 flex justify-center items-center text-white rounded-full text-3xl" data-v-9769a961><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 117.72 117.72" aria-hidden="true" data-v-9769a961><path fill="#42ba96" d="M58.86,0c9.13,0,17.77,2.08,25.49,5.79c-3.16,2.5-6.09,4.9-8.82,7.21c-5.2-1.89-10.81-2.92-16.66-2.92\r
                  c-13.47,0-25.67,5.46-34.49,14.29c-8.83,8.83-14.29,21.02-14.29,34.49c0,13.47,5.46,25.66,14.29,34.49\r
                  c8.83,8.83,21.02,14.29,34.49,14.29s25.67-5.46,34.49-14.29c8.83-8.83,14.29-21.02,14.29-34.49\r
                  c0-3.2-0.31-6.34-0.9-9.37c2.53-3.3,5.12-6.59,7.77-9.85c2.08,6.02,3.21,12.49,3.21,19.22\r
                  c0,16.25-6.59,30.97-17.24,41.62c-10.65,10.65-25.37,17.24-41.62,17.24c-16.25,0-30.97-6.59-41.62-17.24\r
                  C6.59,89.83,0,75.11,0,58.86c0-16.25,6.59-30.97,17.24-41.62S42.61,0,58.86,0z\r
                  M31.44,49.19L45.8,49l1.07,0.28c2.9,1.67,5.63,3.58,8.18,5.74c1.84,1.56,3.6,3.26,5.27,5.1\r
                  c5.15-8.29,10.64-15.9,16.44-22.9c6.35-7.67,13.09-14.63,20.17-20.98l1.4-0.54H114l-3.16,3.51\r
                  C101.13,30,92.32,41.15,84.36,52.65C76.4,64.16,69.28,76.04,62.95,88.27l-1.97,3.8l-1.81-3.87\r
                  c-3.34-7.17-7.34-13.75-12.11-19.63c-4.77-5.88-10.32-11.1-16.79-15.54L31.44,49.19z" data-v-9769a961></path></svg></div><h4 class="text-lg font-semibold text-accent" data-v-9769a961> Sprint Completed </h4><p class="text-sm text-muted max-w-md" data-v-9769a961> This sprint has been successfully completed. To continue planning work, create a new sprint by clicking the plus button and start organizing upcoming tasks. </p>`,3)]))):F("",!0)]))],2)],512)]))])),U(Gl,{onClick:a[16]||(a[16]=Te(()=>{},["stop"])),modelValue:Be.value,"onUpdate:modelValue":a[17]||(a[17]=S=>Be.value=S),title:"Delete Sprint",itemLabel:"Sprint",itemName:(re=ne.value)==null?void 0:re.title,requireMatchText:(De=ne.value)==null?void 0:De.title,confirmText:"Delete Sprint",cancelText:"Cancel",size:"md",loading:v(at),onConfirm:Se,onCancel:a[18]||(a[18]=()=>{ne.value=null,Be.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),U(Ka,{modelValue:ze.value,"onUpdate:modelValue":a[19]||(a[19]=S=>ze.value=S),onSave:Kt,sprint:ne.value,creatingSprint:ne.value?v(bt):v(gt)},null,8,["modelValue","sprint","creatingSprint"]),U(os,{sprint:ne.value,modelValue:Ne.value,"onUpdate:modelValue":a[20]||(a[20]=S=>Ne.value=S),onSave:pe,creatingSprint:v(Qe)||v(Ke)},null,8,["sprint","modelValue","creatingSprint"]),U(Wl,{modelValue:I.value,"onUpdate:modelValue":a[21]||(a[21]=S=>I.value=S),cardId:(St=qe.value)==null?void 0:St.id,onClose:se},null,8,["modelValue","cardId"]),U(zs,{modelValue:n.value,"onUpdate:modelValue":a[22]||(a[22]=S=>n.value=S)},null,8,["modelValue"])])}}}),No=Pt($o,[["__scopeId","data-v-9769a961"]]);export{No as default};
