import{d as H,u as J,a as K,b as Q,r as h,c as u,e as B,f as X,w as l,o as E,g as a,h as n,i as d,j as Y,s as _,k as p,l as Z,m as ee,n as te,_ as V,t as C,B as k,p as se,q as oe,v as ae}from"./index-Dq_jrCvi.js";import{_ as re,a as le,b as ne,l as ie}from"./AuthLayout.vue_vue_type_script_setup_true_lang-CUH_n4aL.js";import{l as ue,s as pe}from"./auth-CXCR6Mln.js";import{d as me,l as de}from"./dark-logo-Mcb_sJlF.js";const ce={class:"max-w-[500px] py-5 mx-auto w-full text-text-primary bg-bg-body min-h-full flex flex-col justify-center"},ge=["src"],fe={class:"text-end mt-1"},ve=["src"],_e={key:0,class:"text-red-500 text-sm text-center mt-2"},ke=H({name:"LoginPage",__name:"Login",props:{isDark:{type:Boolean}},setup(we){const S=J(),{isDark:I}=K(),N=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,U=Q(),c=h(""),g=h(""),r=h(""),m={email:!1,password:!1},w=u(()=>m.email?c.value.trim()?N.test(c.value)?"":"Invalid email":"Email is required":""),$=u(()=>!!w.value),x=u(()=>m.password?g.value?g.value.length<6?"Password must be at least 6 characters":"":"Password is required":""),z=u(()=>!!x.value),D=u(()=>!w.value&&!x.value),v=ae(),{mutateAsync:R,isPending:A}=B({mutationFn:ue}),{mutateAsync:L}=B({mutationFn:pe}),F=u(()=>A.value),T=u(()=>A.value?"Signing In...":"Sign in");function P(){r.value&&(r.value="")}async function M(){var s,e;try{const t=await se(),o=await oe.get("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${t.access_token}`}}),f=await L({u_email:o.data.email,u_social_id:o.data.sub,u_social_type:"google",u_full_name:o.data.name});b(f)}catch(t){(t==null?void 0:t.message)!=="Popup closed"&&(r.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"Google Login failed. Please try again.")}}async function j(){var s,e;try{AppleID.auth.init({clientId:"com.orchit.ai",scope:"name email",redirectURI:window.location.origin+"/login",usePopup:!0});const t=await AppleID.auth.signIn(),i=t.authorization.id_token.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),W=decodeURIComponent(atob(i).split("").map(function(G){return"%"+("00"+G.charCodeAt(0).toString(16)).slice(-2)}).join("")),y=JSON.parse(W),q=await L({u_email:y.email,u_social_id:y.sub,u_social_type:"apple",u_full_name:(s=t.user)!=null&&s.name?`${t.user.name.firstName} ${t.user.name.lastName}`:((e=y.email)==null?void 0:e.split("@")[0])||""});b(q)}catch(t){(t==null?void 0:t.error)!=="popup_closed_by_user"&&(r.value=(t==null?void 0:t.message)||"Apple Login failed. Please try again.")}}async function b(s){var t,o,f;localStorage.setItem("token",(t=s==null?void 0:s.data)==null?void 0:t.token),await U.bootstrap();const e=localStorage.getItem("post_auth_intent");if(e)try{const i=JSON.parse(e);localStorage.removeItem("post_auth_intent"),i.aiResponse&&S.setWorkspace(i.aiResponse),v.push(i.path||"/dashboard");return}catch(i){console.error("Failed to parse post_auth_intent",i),localStorage.removeItem("post_auth_intent")}if(console.log((o=s==null?void 0:s.data)==null?void 0:o.isNewUser,"new user"),(f=s==null?void 0:s.data)!=null&&f.isNewUser){v.push("/create-profile");return}S.pricing?v.push("/dashboard?stripePayment=true"):v.push("/dashboard")}async function O(){var s,e;if(r.value="",m.email=!0,m.password=!0,!D.value){r.value="Please fill all fields correctly.";return}try{const t=await R({u_email:c.value,u_password:g.value});b(t)}catch(t){r.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"Login failed. Please try again."}}return(s,e)=>{const t=Y("router-link");return E(),X(re,null,{form:l(()=>[a("div",ce,[n(t,{to:"/"},{default:l(()=>[a("img",{src:d(I)?d(me):d(de),class:"w-[130px] d-block mx-auto",alt:"image"},null,8,ge)]),_:1}),e[0]||(_(-1,!0),(e[0]=a("h2",{class:"text-[24px] md:text-[32px] font-medium mb-8 sm:mb-12 text-center text-text-primary"},[e[6]||(e[6]=p(" Sign in to Orchit AI "))])).cacheIndex=0,_(1),e[0]),a("form",{onSubmit:Z(O,["prevent"]),class:"space-y-4 w-full"},[n(V,{modelValue:c.value,"onUpdate:modelValue":[e[1]||(e[1]=o=>c.value=o),P],label:"Email",placeholder:"Email address",size:"lg",error:$.value,message:w.value,onBlur:e[2]||(e[2]=o=>m.email=!0)},null,8,["modelValue","error","message"]),a("div",null,[n(V,{modelValue:g.value,"onUpdate:modelValue":[e[3]||(e[3]=o=>g.value=o),P],label:"Password",placeholder:"Enter your password",size:"lg",type:"password",error:z.value,message:x.value,onBlur:e[4]||(e[4]=o=>m.password=!0)},null,8,["modelValue","error","message"]),a("div",fe,[n(t,{to:"/forgot-password",class:"text-sm text-accent hover:underline"},{default:l(()=>e[7]||(e[7]=[p(" Forgot password? ")])),_:1,__:[7]})])]),n(k,{disabled:F.value,size:"lg",block:!0,type:"submit"},{default:l(()=>[p(C(T.value),1)]),_:1},8,["disabled"]),e[11]||(e[11]=a("div",{class:"flex items-center"},[a("div",{class:"flex-grow border-t border-border"}),a("span",{class:"mx-3 text-[12px] text-primary"},"OR"),a("div",{class:"flex-grow border-t border-border"})],-1)),n(k,{size:"lg",block:!0,appearance:"outlined",variant:"ghost",type:"button",onClick:M},{icon:l(()=>e[8]||(e[8]=[a("img",{src:le,class:"w-5 h-5 mr-4"},null,-1)])),default:l(()=>[e[9]||(e[9]=p(" Continue with google "))]),_:1,__:[9]}),n(k,{size:"lg",block:!0,appearance:"outlined",variant:"ghost",type:"button",class:"felx flex-row",onClick:j},{icon:l(()=>[a("img",{src:d(I)?d(ne):d(ie),alt:"Apple icon",class:"w-[24px] mr-4"},null,8,ve)]),default:l(()=>[e[10]||(e[10]=p(" Continue with apple "))]),_:1,__:[10]}),r.value?(E(),ee("p",_e,C(r.value),1)):te("",!0)],32),e[5]||(_(-1,!0),(e[5]=a("p",{class:"text-sm font-medium text-text-secondary text-center mt-8"},[e[13]||(e[13]=p(" Donâ€™t have an account? ")),n(t,{to:"/register",class:"text-text-primary font-bold underline"},{default:l(()=>e[12]||(e[12]=[p("Sign up")])),_:1,__:[12]})])).cacheIndex=5,_(1),e[5])])]),_:1})}}});export{ke as default};
