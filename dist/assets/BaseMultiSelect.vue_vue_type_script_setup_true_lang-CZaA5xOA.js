import{d as ie,r,m as P,N as ue,i,o as u,y as h,z as W,j as w,A as Z,e as c,t as S,n as N,f as q,V as O,c as oe,q as ce,g as $,F as ne,x as ae,O as pe,U as fe,I as ve}from"./index-By-MWQyp.js";import{u as me}from"./useOpenAIGeneration-BEGKNKCu.js";import{_ as he}from"./info-DjaLHeD_.js";const ge={key:0,class:"absolute top-3 left-2 text-xs text-accent ml-2 mt-1"},we={key:0,class:"w-8 h-8 aspect-square rounded-lg cursor-pointer bg-accent p-2 flex items-center justify-center"},be={key:1,class:"w-8 h-8 aspect-square rounded-lg bg-accent flex justify-center items-center text-center cursor-pointer"},ye={key:2,class:"text-text-secondary"},xe={key:3,class:"text-red-500"},ke={key:4,class:"text-white mt-2 text-sm"},Re=3,le=200,Ue=ie({__name:"AudioRecorder",props:{class:{type:String,default:""}},emits:["transcribed","update:isRecording","update:hasAudio"],setup(j,{emit:X}){const a=X,E=j,b=r(0);let k=null;const V=r(null),p=r(null),s=r(!1),d=r(null);let y=[],v=null;const{mutate:M,data:A,isPending:K,isError:z}=me({onSuccess:t=>{a("update:isRecording",!1),a("update:hasAudio",!1),a("transcribed",t)}});P(A,t=>{t&&a("transcribed",t)});let g=null,x,R,C,L=0;const e=r(null),l=r(!1),n=r(0),f=new Array(le).fill(0),H=()=>{if(!d.value||!x)return;const t=d.value,o=t.getContext("2d");if(!o)return;x.getByteFrequencyData(R);const T=R.reduce((G,J)=>G+J,0)/R.length/255*.8;L++,L%Re===0&&(f.push(T),f.length>le&&f.shift()),o.clearRect(0,0,t.width,t.height);const _=t.height/2;o.strokeStyle="var(--accent)",o.setLineDash([2,2]),o.beginPath(),o.moveTo(0,_),o.lineTo(t.width,_),o.stroke(),o.setLineDash([]);const B=1,U=B+1,Y=t.width-f.length*U;o.fillStyle="var(--accent)",f.forEach((G,J)=>{const Q=G*t.height*1,te=Y+J*U;o.fillRect(te,_-Q,B,Q||5),o.fillRect(te,_,B,Q||5)}),C=requestAnimationFrame(H)},D=()=>{cancelAnimationFrame(C),g==null||g.close(),g=null},I=async()=>{if(s.value)v==null||v.stop(),D(),s.value=!1,k&&(clearInterval(k),k=null);else{const t=await navigator.mediaDevices.getUserMedia({audio:!0});v=new MediaRecorder(t),y=[],v.ondataavailable=m=>{m.data.size>0&&y.push(m.data)},v.onstop=()=>{const m=new Blob(y,{type:"audio/webm"});V.value=m,p.value=URL.createObjectURL(m);const T=new File([m],"recording.webm",{type:"audio/webm"});M(T),e.value=new Audio(p.value),e.value.addEventListener("timeupdate",()=>{n.value=Math.floor(e.value.currentTime)}),e.value.addEventListener("ended",()=>{l.value=!1,n.value=0}),p.value=URL.createObjectURL(m),e.value=new Audio(p.value),e.value.addEventListener("timeupdate",()=>{n.value=Math.floor(e.value.currentTime)}),e.value.addEventListener("ended",()=>{l.value=!1})},g=new AudioContext;const o=g.createMediaStreamSource(t);x=g.createAnalyser(),x.fftSize=2048,R=new Uint8Array(x.frequencyBinCount),o.connect(x),H(),v.start(),s.value=!0,b.value=0,k=setInterval(()=>{b.value++},1e3)}},ee=r(null),de=()=>{if(!ee.value||!V.value)return;const t=ee.value,o=t.getContext("2d");if(!o)return;t.width=t.clientWidth,t.height=t.clientHeight,o.clearRect(0,0,t.width,t.height);const m=t.height/2,T=300,_=2,B=2;for(let F=0;F<T;F++){const U=Math.random()*t.height*.6+4,Y=F*(_+B);o.fillStyle="white",o.fillRect(Y,m-U/2,_,U)}};return P(p,t=>{t?(a("update:hasAudio",!0),O(de)):a("update:hasAudio",!1)}),P(s,t=>{t&&a("update:isRecording",t)}),ue(()=>{D()}),(t,o)=>(u(),i("div",{class:h(["",s.value?"relative":` ${E.class} `])},[W(c("canvas",{ref_key:"canvasRef",ref:d,class:"w-full h-12 rounded-xl p-3 bg-bg-surface"},null,512),[[Z,s.value]]),s.value?(u(),i("div",ge,S(Math.floor(b.value/60))+":"+S((b.value%60).toString().padStart(2,"0")),1)):w("",!0),p.value?w("",!0):(u(),i("button",{key:1,onClick:I,class:h([" text-sm overflow-hidden",s.value?"text-red-500 mt-1  absolute right-2 top-1":"text-text-primary"])},[s.value?(u(),i("div",we,o[0]||(o[0]=[c("div",{class:"w-2 bg-white h-2 aspect-square"},null,-1)]))):(u(),i("div",be,o[1]||(o[1]=[c("i",{class:"text-white fa-solid fa-microphone font-base"},null,-1)])))],2)),N(K)&&p.value?(u(),i("p",ye,"Transcribing...")):w("",!0),N(z)&&p.value?(u(),i("p",xe,"Transcription failed.")):w("",!0),N(A)&&p.value?(u(),i("p",ke,[o[2]||(o[2]=c("strong",null,"Transcirpt:",-1)),q(" "+S(N(A)),1)])):w("",!0)],2))}}),Ce=["title"],Le={class:"flex flex-nowrap gap-1 h-full"},_e=["onClick"],Me=["placeholder","onKeydown"],Ae=["onClick"],Se=["innerHTML"],se=160,Ee=8,re=!0,$e=ie({__name:"BaseMultiSelect",props:{modelValue:{},options:{},label:{},tooltip:{},message:{},error:{type:Boolean},placeholder:{default:"Select..."},size:{default:"md"},theme:{default:"light"},allowCustom:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(j,{emit:X}){const a=j,E=X,b=r(null),k=r(null),V=r(null),p=r(null),s=r(""),d=r(!1),y=r(!1),v=oe(()=>a.modelValue.map(e=>a.options.find(n=>n._id===e)||{title:String(e),_id:e})),M=oe(()=>a.options.filter(e=>e.title.toLowerCase().includes(s.value.toLowerCase())&&!a.modelValue.includes(e._id)));function A(){d.value||(d.value=!0),O(()=>{var e;C(),(e=p.value)==null||e.focus()})}function K(){d.value=!0,O(C)}function z(e){E("update:modelValue",[...a.modelValue,e._id]),s.value="",d.value=!1}function g(e){E("update:modelValue",a.modelValue.filter(l=>l!==e))}function x(){if(!a.allowCustom||!s.value.trim())return;const e=s.value.trim();if(a.options.some(n=>n.title.toLowerCase()===e.toLowerCase())){const n=a.options.find(f=>f.title.toLowerCase()===e.toLowerCase());n&&z(n)}else{const n=e.toLowerCase().replace(/\s+/g,"-");E("update:modelValue",[...a.modelValue,n]),a.options.push({title:e,_id:n})}s.value="",d.value=!1}function R(e){b.value&&!b.value.contains(e.target)&&(d.value=!1)}function C(){var I;const e=k.value;if(!e)return;const l=e.getBoundingClientRect(),f=window.innerHeight-l.bottom,H=l.top,D=Math.min(((I=V.value)==null?void 0:I.scrollHeight)??se,se);f<D+Ee?y.value=H>f:y.value=!1}function L(){d.value&&C()}return ce(()=>{document.addEventListener("click",R),window.addEventListener("resize",L),window.addEventListener("scroll",L,re)}),ue(()=>{document.removeEventListener("click",R),window.removeEventListener("resize",L),window.removeEventListener("scroll",L,re)}),P([d,()=>M.value.length],()=>{d.value&&O(C)}),(e,l)=>(u(),i("div",{class:h([e.theme==="dark"?"text-white":"text-text-primary","relative"]),ref_key:"wrapperRef",ref:b},[e.label?(u(),i("label",{key:0,class:h(["text-base font-medium mb-1 flex items-center",e.theme==="dark"?"text-white":"text-text-primary"])},[q(S(e.label)+" ",1),e.tooltip?(u(),i("span",{key:0,class:"inline-block text-text-secondary ml-1 cursor-help",title:e.tooltip},l[2]||(l[2]=[c("img",{src:he,alt:"info"},null,-1)]),8,Ce)):w("",!0)],2)):w("",!0),c("div",{ref_key:"anchorRef",ref:k,class:h(["relative px-3 py-2 rounded-xl overflow-x-auto w-full border text-sm",[e.size==="md"?"h-10":"h-12",e.theme==="dark"?"bg-bg-input border-border":"bg-bg-input border-border ",e.error?"border-red-500 focus-within:ring-red-500":"focus-within:ring-black"]]),onMousedown:$(A,["self"])},[c("div",Le,[(u(!0),i(ne,null,ae(v.value,n=>(u(),i("span",{key:n._id,class:"bg-bg-body text-text-primary px-2 text-nowrap py-1 rounded text-xs flex items-center gap-1"},[q(S(n.title)+" ",1),c("span",{onClick:$(f=>g(n._id),["stop"]),class:"cursor-pointer"},"âœ•",8,_e)]))),128)),W(c("input",{ref_key:"inputRef",ref:p,class:h(["outline-none flex-1 bg-transparent text-sm h-full",e.theme=="dark"?"!text-white placeholder-white/60":"text-text-primary placeholder-gray-400"]),placeholder:v.value.length?"":e.placeholder,"onUpdate:modelValue":l[0]||(l[0]=n=>s.value=n),onFocus:A,onInput:K,onKeydown:fe($(x,["prevent"]),["enter"])},null,42,Me),[[pe,s.value]])])],34),W(c("ul",{ref_key:"menuRef",ref:V,class:h(["absolute left-0 z-10 text-sm p-2 border rounded-md shadow max-h-40 overflow-auto w-full",[e.theme==="dark"?"bg-[#131318] text-white border-border":"bg-bg-dropdown text-text-primary border-border",y.value?"bottom-[76%] ":"top-full "]])},[(u(!0),i(ne,null,ae(M.value,n=>(u(),i("li",{key:n._id,class:h(["px-3 py-2 rounded-lg cursor-pointer",e.theme==="dark"?"hover:bg-[#000000de]":"hover:bg-bg-dropdown-menu-hover"]),onMousedown:l[1]||(l[1]=$(()=>{},["prevent"])),onClick:$(f=>z(n),["stop"])},[c("span",{innerHTML:n.title},null,8,Se)],42,Ae))),128))],2),[[Z,d.value&&M.value.length>0]]),W(c("ul",{class:h(["absolute left-0 z-10 p-2 border rounded shadow w-full",[e.theme==="dark"?"bg-bg-dropdown text-text-primary border-border":"bg-bg-dropdown border-border",y.value?"bottom-full mb-2":"top-full mt-2"]])},l[3]||(l[3]=[c("li",{class:"px-3 py-2 text-sm text-text-secondary"},"No options found",-1)]),2),[[Z,d.value&&M.value.length===0]]),e.message?(u(),i("p",{key:1,class:h(["mt-2 text-xs flex items-center gap-1",e.error?"text-red-500":(e.theme==="dark","text-text-secondary ")])},[e.$slots.msgIcon?ve(e.$slots,"msgIcon",{key:0}):w("",!0),q(" "+S(e.message),1)],2)):w("",!0)],2))}});export{Ue as _,$e as a};
