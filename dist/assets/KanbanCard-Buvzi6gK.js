import{d as Z,c as W,r as k,q as ee,b as te,w as C,e as t,i as d,j as D,A as se,U as ae,a4 as ie,g as S,F as G,x as le,y as oe,a7 as N,n as u,aX as J,t as c,P as R,f as V,h as y,B as X,V as ne,o as r,O as re,bc as de,a as ue,k as ce}from"./index-BwDegMQR.js";import{_ as me}from"./DropMenu.vue_vue_type_script_setup_true_lang-FP483xO8.js";import{h as pe,i as ge,j as fe,k as be}from"./usePeople-jNulrvOc.js";import{_ as ve}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-BtEcibsL.js";import"./index-Cj6ciq7q.js";const ye={class:"px-6 pb-2"},ke={class:"relative mb-4"},xe=["onKeydown"],_e={key:0,class:"mt-3"},he={class:"divide-y divide-border rounded-xl border border-border bg-bg-card"},we=["onClick"],Ce={class:"flex items-center gap-3 min-w-0"},Se=["src"],Ve={class:"min-w-0"},Ae={class:"truncate font-medium leading-tight capitalize"},$e={class:"truncate text-xs text-text-secondary leading-tight"},Te={key:1,class:"mt-3 flex items-center gap-2"},qe={class:"inline-flex items-center gap-2 rounded-full px-3 py-2 bg-bg-muted text-text-secondary"},Me={class:"flex items-center justify-between gap-3 p-6 mt-3 pb-2 border-t border-border bg-bg-body"},je={class:"flex gap-2 justify-between w-full"},De=Z({__name:"AssignmentModal",props:{modelValue:{type:Boolean,default:!1},members:{default:()=>[]},directory:{default:()=>[]},placeholder:{default:"Search people by name or email"},isSubmitting:{}},emits:["update:modelValue","submit","copy-link"],setup(A,{emit:m}){const p=A,_=m,g=W({get:()=>p.modelValue,set:i=>_("update:modelValue",i)}),o=k(""),n=k(""),f=k(""),b=W(()=>{const i=o.value.trim().toLowerCase();return p.directory.filter(l=>{var e;return((e=l.name)==null?void 0:e.toLowerCase().includes(i))||l.email.toLowerCase().includes(i)})}),$=i=>{n.value=i.email,o.value=""},h=()=>{n.value=""},T=()=>{o.value&&(n.value=o.value.trim(),o.value="")},q=i=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i),M=()=>{if(!n.value||!q(n.value)){f.value="Please select a valid email.";return}_("submit",{invite:{email:n.value}})},j=()=>{h(),o.value="",g.value=!1};return ee(()=>{g.value&&(o.value="")}),(i,l)=>(r(),te(ne,{modelValue:g.value,"onUpdate:modelValue":l[1]||(l[1]=e=>g.value=e),size:"md"},{default:C(()=>[l[3]||(l[3]=t("div",{class:"sticky top-0 z-10 flex items-start gap-2 px-6 pb-4 mb-4 border-b border-border bg-bg-body"},[t("h2",{class:"text-xl font-semibold"},"Add team member")],-1)),t("div",ye,[t("div",ke,[se(t("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>o.value=e),type:"text",placeholder:"Search or add email",class:"w-full h-11 rounded-xl border border-border bg-bg-input px-3 text-sm outline-none focus:ring-2 focus:ring-primary/40",onKeydown:ie(S(T,["prevent"]),["enter"])},null,40,xe),[[ae,o.value]])]),b.value.length?(r(),d("div",_e,[t("ul",he,[(r(!0),d(G,null,le(b.value,e=>(r(),d("li",{key:e.id||e.email,class:oe(["flex items-center justify-between gap-3 px-3 py-3 cursor-pointer hover:bg-bg-muted",{"bg-bg-muted":n.value===e.email}]),onClick:U=>$(e)},[t("div",Ce,[e!=null&&e.profile_image?(r(),d("img",{key:0,class:"h-9 w-9 rounded-full aspect-square",src:e==null?void 0:e.profile_image,alt:"avatar"},null,8,Se)):(r(),d("div",{key:1,class:"h-9 w-9 bg-white capitalize rounded-full flex items-center justify-center text-xs font-semibold",style:N({backgroundColor:u(J)({email:e.email})})},c(u(R)(e.name||e.email)),5)),t("div",Ve,[t("div",Ae,c(e.name||e.email),1),t("div",$e,c(e.email),1)])])],10,we))),128))])])):D("",!0),n.value?(r(),d("div",Te,[t("span",qe,[V(c(n.value)+" ",1),t("button",{onClick:h,class:"ml-2 text-sm text-red-500"},"✕")])])):D("",!0)]),t("div",Me,[t("div",je,[y(X,{variant:"secondary",onClick:j},{default:C(()=>l[2]||(l[2]=[V("Cancel")])),_:1,__:[2]}),y(X,{variant:"primary",disabled:!!(!n.value||i.isSubmitting),onClick:M},{default:C(()=>[V(c(i.isSubmitting?"Assigning…":"Assign"),1)]),_:1},8,["disabled"])])])]),_:1,__:[3]},8,["modelValue"]))}}),Ne={class:"flex justify-between gap-2 items-start"},Ue={class:"flex items-center gap-2"},Be=["src"],Ie={key:0,class:"fa-solid fa-user text-white"},ze={class:""},Ke={class:"text-sm font-medium mb-1 text-card-foreground leading-tight"},Pe={class:"text-text-secondary text-xs"},Ee={class:"group-hover:flex justify-center items-center hidden w-6 h-6 bg-bg-surface/40 rounded-md"},We=Z({__name:"KanbanCard",props:{ticket:{}},setup(A){const m=k(!1),p=A,{workspaceId:_}=re(),{data:g}=de(),{data:o}=pe(_.value,g),n=k([]),f=k(!1),b=ue();function $(){return[{label:"Assign User",danger:!0,action:()=>{m.value=!0},icon:{prefix:"fa-regular",iconName:"fa-user-plus"}},...p.ticket.name?[{label:"UnAssign User",danger:!0,action:()=>{Y()},icon:{prefix:"fa-regular",iconName:"fa-user-minus"}}]:[],{label:"Delete Seat",danger:!0,action:()=>{f.value=!0},icon:{prefix:"fa-regular",iconName:"fa-trash"}}]}const h=()=>{},{mutate:T,isPending:q}=ge({onSuccess:()=>{b.invalidateQueries({queryKey:["people-lists"]})}}),M=()=>{T({id:p.ticket._id})},{mutate:j,isPending:i}=fe({onSuccess:()=>{m.value=!1,b.invalidateQueries({queryKey:["people-lists"]})}});function l(s){const w=(s.split("@")[0]||"").split("+")[0].split(/[^a-zA-Z]+/).filter(Boolean);return w.length?w.map(x=>x.charAt(0).toUpperCase()+x.slice(1).toLowerCase()).join(" "):s}const{mutate:e}=be({onSuccess:()=>{m.value=!1,b.invalidateQueries({queryKey:["people-lists"]})}});function U(s){j({id:p.ticket._id,payload:{name:l(s.email),email:s.email}})}function Y(){e({id:p.ticket._id})}return(s,a)=>{var x,B,I,z,K,P,E,L,F,Q,H,O;const w=ce("AssigmentDropdown");return r(),d(G,null,[t("div",{onClick:a[2]||(a[2]=v=>s.$emit("click")),class:"group bg-bg-card rounded-lg p-4 shadow-sm cursor-grab hover:shadow-md transition-all duration-200 active:cursor-grabbing",style:N({borderColor:(B=(x=s.ticket)==null?void 0:x.lane)==null?void 0:B.variables["lane-color"]})},[t("div",Ne,[t("div",Ue,[(I=s.ticket)!=null&&I.avatar?(r(),d("img",{key:0,src:(z=s.ticket)==null?void 0:z.avatar,class:"w-10 h-10 rounded-full",alt:"avartar"},null,8,Be)):(r(),d("div",{key:1,class:"w-10 aspect-square bg-bg-surface flex justify-center items-center rounded-full",style:N({backgroundColor:(K=s.ticket)!=null&&K.name?u(J)({email:(P=s.ticket)==null?void 0:P.email}):""})},[V(c(u(R)((E=s.ticket)==null?void 0:E.name))+" ",1),(L=s.ticket)!=null&&L.name?D("",!0):(r(),d("i",Ie))],4)),t("div",ze,[t("h3",Ke,c(((F=s.ticket)==null?void 0:F.name)??s.ticket.title??"Team Member "),1),t("p",Pe,c((Q=s.ticket)==null?void 0:Q.email),1)])]),t("div",Ee,[y(me,{onClick:a[0]||(a[0]=S(()=>{},["stop"])),items:$()},{trigger:C(()=>a[8]||(a[8]=[t("i",{class:"cursor-pointer fa-solid fa-ellipsis"},null,-1)])),_:1},8,["items"])])]),t("div",{onClick:a[1]||(a[1]=S(()=>{},["stop"]))},[y(w,{users:n.value,onAssign:h,assigneeId:s.ticket.assigned_to},null,8,["users","assigneeId"])])],4),y(ve,{onClick:a[3]||(a[3]=S(()=>{},["stop"])),modelValue:f.value,"onUpdate:modelValue":a[4]||(a[4]=v=>f.value=v),title:"Delete Team seat",itemLabel:"Seat",itemName:s.ticket.title,requireMatchText:s.ticket.title,confirmText:"Delete Seat",cancelText:"Cancel",size:"md",loading:u(q),onConfirm:M,onCancel:a[5]||(a[5]=()=>{f.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),y(De,{isSubmitting:u(i),modelValue:m.value,"onUpdate:modelValue":a[6]||(a[6]=v=>m.value=v),members:(H=u(o))==null?void 0:H.people,directory:(O=u(o))==null?void 0:O.people,onSubmit:a[7]||(a[7]=({invite:v})=>U(v))},null,8,["isSubmitting","modelValue","members","directory"])],64)}}});export{We as default};
