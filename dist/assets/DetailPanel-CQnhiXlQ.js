const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AddCustomRoleModal-BS-DgUCT.js","assets/index-BCXm2D5k.js","assets/index-BkThUD6V.css","assets/BaseTextAreaField.vue_vue_type_script_setup_true_lang-Cf3l1GHD.js","assets/Loader-TkwznJTW.js","assets/favicon-BAFXWHLW.js","assets/Loader-88TN_dqm.css","assets/usePeople-C-nuC1AB.js","assets/permissionUtils-fD2X1oS-.js"])))=>i.map(i=>d[i]);
import{d as qe,W as ze,K as Qe,r as c,c as v,n as f,N as We,ab as je,an as Le,j as i,o,f as l,e as re,k as m,i as Q,ah as Me,p as x,ad as $e,g as ne,t as d,Q as Be,aR as Fe,D as ue,P as Ye,ai as de,h as U,F as g,y as C,I as ce,z as ve,ao as He,ae as Je,al as Ge,U as K,A as Xe,J as Ze}from"./index-BCXm2D5k.js";import{_ as es}from"./ProgressBar.vue_vue_type_script_setup_true_lang-CdwEtXDw.js";import{m as ss,n as ts,a as as,o as ls}from"./usePeople-C-nuC1AB.js";import{a as os}from"./usePackages-DmUleHZp.js";import{f as is}from"./permissionUtils-fD2X1oS-.js";import{u as rs}from"./People-BEsyyAnh.js";import"./fuse-Ch1WBRTM.js";import"./lodash-CQYOKM_D.js";import"./_commonjsHelpers-_d1bhYXs.js";const ns={class:"pt-[17px] pb-[18px] flex justify-between items-center border-b border-border px-5 sticky top-0 bg-bg-card z-1"},us={class:"py-4 px-5"},ds={class:"bg-bg-surface/50 p-2 rounded-lg flex gap-2 items-center"},cs=["src"],vs={key:0,class:"fa-solid fa-user text-white"},ps={class:"text-base font-medium text-text-primary cursor-pointer"},ms={class:"text-sm font-medium text-text-secondary cursor-pointer"},_s={class:"flex flex-col mt-2"},fs={class:"text-sm text-text-secondary mt-2"},xs={key:0},bs={class:"mb-2 capitalize"},ys=["onKeydown"],hs={class:"mt-5 pt-3 border-t border-border-input relstive"},ks={key:0,class:"w-full mt-4"},ws=["onClick"],gs={class:"text-sm font-medium text-text-primary"},Cs={key:0,class:"py-2 border-t border-border bg-bg-card"},Ps=["value"],Ds={class:"text-xs font-medium text-text-primary"},Vs={class:"text-[11px] text-text-secondary leading-tight"},Es={key:1,class:"mt-3"},Rs={key:0,class:"border border-border space-y-1 p-2.5 mt-1 rounded-lg"},Is={class:"text-sm text-text-primary"},As={key:2,class:"mt-3"},Ss={key:0,class:"border border-border space-y-1 p-2.5 mt-1 rounded-lg"},Ts={class:"text-sm text-text-primary"},Us=qe({__name:"DetailPanel",props:{showPanel:{type:Boolean,default:!0}},emits:["close","update:details","comment:post","priority:change"],setup(pe,{emit:Ks}){var $,B,F,Y;const{canEditUser:P,isAdmin:me}=ze(),_e=rs(),N=Qe({}),k=c("details"),a=v(()=>_e.selectedCardPeople),fe=[{label:"Details",value:"details"},{label:"Tasks",value:"tasks"},{label:"History",value:"history"}],{data:xe}=ss(),{mutate:be}=ts({onSuccess:()=>{y.invalidateQueries({queryKey:["people-lists"]})}}),ye=pe,D=c(!1),_=c((($=a.value)==null?void 0:$.title)??""),he=c(((B=a.value)==null?void 0:B._id)??"");f(()=>{var e;return(e=a.value)==null?void 0:e.title},e=>{var s;_.value=e,he.value=(s=a.value)==null?void 0:s._id});const ke=c(((F=a.value)==null?void 0:F.description)??"");f(()=>a.value,()=>{ke.value=a.value.description??""}),f(()=>a.value,()=>{var e;(e=a.value)!=null&&e.variable_values&&a.value.variable_values.forEach(s=>{N[s.module_variable_id]=s.value})},{immediate:!0,deep:!0});const O=c(null);function we(){D.value=!0,Ge(()=>{var e,s;(e=O.value)==null||e.focus(),(s=O.value)==null||s.select()})}function W(){var e;_.value.trim()||(_.value=((e=a.value)==null?void 0:e.title)??""),Pe.mutate({card_id:a.value._id,variables:{"card-title":_.value.trim()}}),D.value=!1}function ge(){var e;_.value=((e=a.value)==null?void 0:e.title)??"",D.value=!1}const j=c({startDate:"",endDate:""}),Ce=v(()=>a.value||null);f(Ce,e=>{j.value={...j.value,startDate:e}});const y=We(),Pe=je({onSuccess:()=>{y.invalidateQueries({queryKey:["get-sheets"]}),y.invalidateQueries({queryKey:["sheet-list"]}),y.invalidateQueries({queryKey:["roles"]})}}),De=(e,s)=>{N[s]=e,be({id:a.value._id,payload:{variable_values:[{module_variable_id:s,value:e}]}})};function Ve(e){var s,p,n;if((s=a.value)!=null&&s.variable_values)return(n=((p=a.value)==null?void 0:p.variable_values.filter(A=>A.module_variable_id==e))[0])==null?void 0:n.value}const h=v(()=>{var e;return(e=a.value)==null?void 0:e.workspace_id}),{data:Ee}=Le(h,{enabled:v(()=>!!h.value)}),V=v(()=>{var e;return((e=Ee.value)==null?void 0:e.company_id)??null}),{data:q,isLoading:Re}=as({company_id:V,workspace_id:h},{enabled:v(()=>!!V.value&&!!h.value)}),b=c(((Y=a.value)==null?void 0:Y.workspace_access_role_id)??""),{mutate:L}=ls({onSuccess:()=>{console.log("Role assigned successfully!"),y.invalidateQueries({queryKey:["people-lists"]})},onError:e=>console.error(e)}),Ie=v(()=>{const e=(q.value||[]).map(s=>({_id:s._id,title:s.title}));return e.push({_id:"ADD_NEW_ROLE",title:"+ Add New Role",customClass:"text-accent font-medium sticky bottom-0  hover:bg-bg-dropdown-menu-hover transition-all duration-150 bg-bg-dropdown   border-t border-border w-full",isAction:!0}),e});f(b,e=>{var s;e!=="ADD_NEW_ROLE"&&L({id:(s=a.value)==null?void 0:s._id,workspace_access_role_id:e})}),f(()=>{var e;return(e=a.value)==null?void 0:e.workspace_access_role_id},e=>{b.value=e??""}),f(()=>{var e;return(e=a.value)==null?void 0:e._id},()=>{var e;b.value=((e=a.value)==null?void 0:e.workspace_access_role_id)??""},{immediate:!0});function Ae(){P||K.error("You have no permission to edit user details")}function Se(e){var s;if(!P){K.error("You have no permission to edit user details");return}if(e==="ADD_NEW_ROLE"){I.value=!0;return}b.value=e,L({id:(s=a.value)==null?void 0:s._id,workspace_access_role_id:e})}const r=v(()=>!q.value||!b.value?null:q.value.find(e=>e._id===b.value)),E=c({}),R=c([]),{mutate:Te}=os();function Ue(e){E.value[e]=!E.value[e]}f(r,e=>{if(!e)return;const s=[];e.permission_categories.forEach(p=>{p.permissions.forEach(n=>{n.enabled&&s.push(n._id)})}),R.value=s},{immediate:!0});function Ke(){var p;if(!((p=r.value)!=null&&p._id))return;const e=[];r.value.permission_categories.forEach(n=>{n.permissions.forEach(w=>e.push(w))});const s=is(e,R.value);Te({roleId:r.value._id,payload:{title:r.value.title,description:r.value.description,is_admin:r.value.is_admin,is_editor:r.value.is_editor,is_viewer:r.value.is_viewer,permission_ids:s.permission_ids,module_permissions:s.module_permissions,workspace_id:h.value}},{onSuccess:()=>{K.success("Permissions updated successfully"),y.invalidateQueries({queryKey:["workspace-roles"]})},onError:n=>{console.error("Failed to update permissions",n),K.error("Failed to update permissions")}})}const I=c(!1),Ne=Je(()=>Xe(()=>import("./AddCustomRoleModal-BS-DgUCT.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),M=v(()=>{var e,s;return((s=(e=a.value)==null?void 0:e.assigned_cards_status_counts)==null?void 0:s.Done)??0}),z=v(()=>{var e;return((e=a.value)==null?void 0:e.assigned_cards_count)??0}),Oe=v(()=>z.value?Math.round(M.value/z.value*100):0);return(e,s)=>{var p,n,w,A,H,J,G,X,Z,ee,se,te,ae,le,oe,ie;return o(),i("div",{class:ve(`max-w-[358px] bg-bg-card  rounded-lg overflow-y-auto overflow-x-hidden relative ${ye.showPanel?"!translate-x-0 w-full h-full min-w-full sm:min-w-[380px] overflow-y-auto":"!translate-x-100 w-0 h-0"} transition-all`)},[l("div",ns,[s[6]||(s[6]=l("h5",{class:"text-[16px] font-medium"},"Profile",-1)),l("i",{class:"cursor-pointer text-text-primary fa-solid fa-close",onClick:s[0]||(s[0]=()=>{e.$emit("close")})})]),l("div",us,[l("div",ds,[(p=a.value)!=null&&p.avatar?(o(),i("img",{key:0,src:(n=a.value)==null?void 0:n.avatar,class:"w-10 h-10 rounded-full",alt:"avartar"},null,8,cs)):(o(),i("div",{key:1,class:"min-w-10 max-h-10 aspect-square bg-bg-surface flex justify-center items-center rounded-full",style:Me({backgroundColor:(w=a.value)!=null&&w.name?x($e)({email:(A=a.value)==null?void 0:A.email}):""})},[ne(d(x(Be)((H=a.value)==null?void 0:H.name))+" ",1),(J=a.value)!=null&&J.name?m("",!0):(o(),i("i",vs))],4)),l("div",null,[l("h1",ps,d(((G=a.value)==null?void 0:G.name)??((X=a.value)==null?void 0:X.title)),1),l("p",ms,d((Z=a.value)==null?void 0:Z.email),1)])]),Q(Fe,{modelValue:k.value,"onUpdate:modelValue":s[1]||(s[1]=t=>k.value=t),class:"my-2",options:fe},null,8,["modelValue"]),l("div",_s,[s[7]||(s[7]=l("h1",{class:"text-base font-medium text-text-primary cursor-pointer"}," Task Progress ",-1)),Q(es,{class:"mt-2",progress:Oe.value,fillColor:"bg-accent ",indeterminate:!0},null,8,["progress"]),l("span",fs," Completed "+d(M.value)+" tasks out of "+d(z.value),1)]),k.value=="details"?(o(),i("section",xs,[l("div",bs,[D.value?ue((o(),i("input",{key:0,ref_key:"titleInput",ref:O,"onUpdate:modelValue":s[2]||(s[2]=t=>_.value=t),onBlur:W,onKeydown:[de(U(W,["prevent"]),["enter"]),de(U(ge,["prevent"]),["esc"])],class:"border border-border rounded px-2 py-1 w-full text-xl font-medium",type:"text"},null,40,ys)),[[Ye,_.value]]):(o(),i("h1",{key:1,class:"text-xl font-medium text-text-primary cursor-pointer",onClick:we},d(_.value),1))]),l("div",null,[(o(!0),i(g,null,C(x(xe),(t,u)=>{var S;return o(),i("div",{key:u,class:"grid grid-cols-2 capitalize items-center gap-2 text-sm mt-4"},[ne(d(t==null?void 0:t.title)+" ",1),(o(),re(ce,{size:"sm","model-value":N[t._id],key:u,placeholder:` ${t.title}`,onClick:s[3]||(s[3]=U(()=>{},["stop"])),defaultValue:Ve(t==null?void 0:t._id),options:t==null?void 0:t.data.map(T=>({_id:T,title:T})),cardId:(S=a.value)==null?void 0:S._id,disabled:!x(P),"onUpdate:modelValue":T=>De(T,t._id)},null,8,["model-value","placeholder","defaultValue","options","cardId","disabled","onUpdate:modelValue"]))])}),128))]),l("div",hs,[s[9]||(s[9]=l("div",{class:"flex items-center justify-between mb-1"},[l("span",{class:"text-base font-medium text-text-primary block"},"Select Role")],-1)),Q(ce,{size:"sm","model-value":b.value,options:Ie.value,placeholder:"Select Role",onClick:U(Ae,["stop"]),"onUpdate:modelValue":Se,disabled:!x(P),loading:x(Re)||!V.value},null,8,["model-value","options","disabled","loading"]),r.value&&!r.value.is_admin&&x(me)?(o(),i("div",ks,[s[8]||(s[8]=l("h2",{class:"text-base font-medium text-text-primary mb-1"}," Permissions ",-1)),(o(!0),i(g,null,C((ee=r.value)==null?void 0:ee.permission_categories,t=>(o(),i("div",{key:t==null?void 0:t.category,class:"border border-border mb-2 rounded-lg overflow-hidden bg-bg-surface/30"},[l("button",{onClick:u=>Ue(t==null?void 0:t.category),class:"w-full px-3 py-2 flex justify-between items-center hover:bg-bg-surface transition"},[l("span",gs,d(t==null?void 0:t.category_title),1),l("i",{class:ve(["fa-solid fa-chevron-down text-xs text-text-secondary transition-transform",E.value[t==null?void 0:t.category]?"rotate-180":""])},null,2)],8,ws),E.value[t==null?void 0:t.category]?(o(),i("div",Cs,[(o(!0),i(g,null,C(t==null?void 0:t.permissions,u=>(o(),i("div",{key:u._id,class:"flex items-start gap-2 px-3 py-2 hover:bg-bg-input"},[ue(l("input",{type:"checkbox","onUpdate:modelValue":s[4]||(s[4]=S=>R.value=S),value:u._id,onChange:Ke,class:"h-4 w-4 mt-0.5 rounded border-border accent-accent cursor-pointer flex-shrink-0"},null,40,Ps),[[He,R.value]]),l("div",null,[l("p",Ds,d(u.title),1),l("p",Vs,d(u.description),1)])]))),128))])):m("",!0)]))),128))])):m("",!0)])])):m("",!0),k.value=="tasks"?(o(),i("section",Es,[s[11]||(s[11]=l("span",{class:"text-base text-text-primary"},"Worked On",-1)),((te=(se=a.value)==null?void 0:se.assigned_cards)==null?void 0:te.length)>0?(o(),i("ul",Rs,[(o(!0),i(g,null,C((ae=a.value)==null?void 0:ae.assigned_cards,(t,u)=>(o(),i("li",{class:"p-2",key:u},[l("h1",Is,d(t==null?void 0:t.title),1),s[10]||(s[10]=l("p",{class:"text-xs text-text-secondary"}," Design Project . Olivia Updated on April 9, 2025 ",-1))]))),128))])):m("",!0)])):m("",!0),k.value=="history"?(o(),i("section",As,[s[13]||(s[13]=l("span",{class:"text-base text-text-primary"},"history",-1)),((oe=(le=a.value)==null?void 0:le.assignment_history)==null?void 0:oe.length)>0?(o(),i("ul",Ss,[(o(!0),i(g,null,C((ie=a.value)==null?void 0:ie.assignment_history,(t,u)=>(o(),i("li",{class:"p-2",key:u},[l("h1",Ts,d(t==null?void 0:t.title),1),s[12]||(s[12]=l("p",{class:"text-xs text-text-secondary"}," Design Project . Olivia Updated on April 9, 2025 ",-1))]))),128))])):m("",!0)])):m("",!0)]),I.value?(o(),re(x(Ne),{key:0,show:I.value,workspaceId:h.value,companyId:V.value,onClose:s[5]||(s[5]=t=>I.value=!1)},null,8,["show","workspaceId","companyId"])):m("",!0)],2)}}}),$s=Ze(Us,[["__scopeId","data-v-2e2ea5dd"]]);export{$s as default};
