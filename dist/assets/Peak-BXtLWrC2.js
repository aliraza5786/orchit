import{r as w,m as G,v as W,d as A,c as x,i as r,e,t as n,j as C,y as q,h as S,f as L,o as a,H as K,q as lt,aZ as z,p as nt,a_ as dt,P as D,b as it,F as y,x as h,n as f,w as ut,a$ as ct,ac as M,b0 as F,ap as k}from"./index-BpfDrHbe.js";import{_ as pt}from"./ProgressBar.vue_vue_type_script_setup_true_lang-DPOjCRg9.js";import{u as gt,a as ft}from"./usePeople-b_p-Bge9.js";function xt($,{start:u=0,maxWhileLoading:b=90,step:i=.8,intervalMs:c=120}={}){const d=w(u);let g=null;const l=()=>{g==null&&(g=window.setInterval(()=>{$()&&(d.value=Math.min(d.value+i,b))},c))},p=()=>{g!=null&&(clearInterval(g),g=null)};return G($,v=>{v?(d.value=u,l()):(d.value=100,setTimeout(()=>{d.value=u,p()},300))},{immediate:!0}),W(p),d}const vt={class:"relative p-3 rounded-lg min-w-sm border border-border overflow-hidden flex flex-col justify-between bg-bg-card w-full"},bt={class:"flex justify-between items-start pb-2"},mt={class:"text-lg font-semibold text-text-primary text-left"},_t={class:"text-xs text-text-secondary text-left"},yt={class:"flex items-center gap-2"},ht={class:""},kt={class:"flex justify-between text-sm text-text-secondary mb-1"},wt={key:0,class:"fa-regular text-left fa-arrows-spin animate-spin duration-250"},Ct={key:0},$t={key:1},jt=A({__name:"ProjectCard",props:{title:{},subtitle:{},status:{},progress:{default:0},avatars:{},maxVisible:{default:2},date:{},loading:{type:Boolean,default:!1},color:{default:"#9CA3AF"},totalCard:{default:0},ai:{type:Boolean},doneCard:{}},setup($){const u=$,b=xt(()=>!!u.loading),i=x(()=>u.loading?b.value:u.progress),c=x(()=>Math.round(i.value)>=100),d=w(0);G(c,(l,p)=>{l&&!p&&d.value++});function g(l){switch(l){case"completed":return"bg-green-400/40 border-green-400 text-green-400";case"failed":return"bg-red-400/40 border-red-400 text-red-400";case"in_progress":return"bg-blue-400/20 border-blue-400 text-blue-400";case"pending":return"bg-amber-400/20 border-amber-400 text-amber-400";default:return"progress-default"}}return(l,p)=>(a(),r("div",vt,[e("div",bt,[e("div",null,[e("h3",mt,n(l.title),1),e("p",_t,n(l.subtitle),1)]),e("div",yt,[!l.totalCard&&l.status?(a(),r("span",{key:0,class:q(["text-xs border rounded-full px-2 py-0.5",g(l.status)])},n(l.status),3)):C("",!0)])]),e("div",ht,[e("div",kt,[e("div",null,[e("span",null,n(l.status=="in_progress"?"Generating lane with AI...":"Progress"),1),p[0]||(p[0]=L()),l.status=="in_progress"?(a(),r("i",wt)):C("",!0)]),l.ai?(a(),r("span",Ct,[L(n(Math.round(i.value))+"% ",1),c.value?(a(),r("span",{key:d.value,class:"confetti-icon select-none","aria-label":"Completed"}," ðŸŽ‰ ")):C("",!0)])):(a(),r("span",$t,n(l.doneCard??0)+" / "+n(l.totalCard),1))]),S(pt,{class:"mt-2",progress:i.value,fillColor:"bg-accent",indeterminate:!!l.loading},null,8,["progress","indeterminate"])])]))}}),H=K(jt,[["__scopeId","data-v-c0790b92"]]),St={class:"flex flex-col gap-4 h-full overflow-x-auto w-full flex-auto"},Pt={class:"p-5 rounded-lg bg-bg-card space-y-6"},Tt={class:"flex items-center justify-between"},It={class:"flex flex-col w-full"},Et={class:"flex gap-2.5 overflow-x-auto w-full py-8 custom_scroll_bar"},Dt=["onClick"],Mt=["onClick"],At={class:"flex flex-grow flex-col sm:flex-row gap-4"},Lt={class:"bg-bg-card w-full max-h-full flex-auto p-5 rounded-lg"},Nt={class:"mb-4"},Ot={class:"text-sm text-text-secondary mt-1"},Rt={key:0,class:"ml-1"},Bt={class:"space-y-4"},Vt={key:1,class:"text-center py-8"},Jt={key:2,class:"text-center py-8"},Ut={class:"flex items-center gap-2 w-32 flex-shrink-0"},zt={key:0,class:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0"},Ft=["src","alt"],Ht={key:2,class:"w-8 h-8 rounded-full bg-bg-body flex items-center justify-center flex-shrink-0"},Gt=["title"],Wt={class:"flex-1"},qt=["title"],Kt={key:0,class:"absolute inset-0 flex items-center justify-start px-2 text-xs text-text-primary font-medium"},Yt={class:"bg-bg-card w-full flex-auto p-5 max-h-full rounded-lg overflow-y-auto flex flex-col"},Zt={class:"space-y-4 overflow-y-auto flex-1"},Qt={class:"flex-1 min-w-0"},Xt={class:"text-sm text-text-primary"},te={class:"font-medium text-accent/90"},ee={class:"text-text-secondary"},se={href:"#",class:"text-accent/90 hover:underline"},oe={class:"text-xs text-text-secondary mt-1"},ae=A({__name:"Peak",setup($){const u=w(!1),b=w(!1),i=w(null),c=w(null);let d=!1;const g="https://backend.streamed.space/api/v1/",l=()=>{if(d||c.value)return;const o=localStorage.getItem("token")||"",s=Q.value,_=localStorage.getItem("jobId"),t=s||_||P.value,rt=`${g}common/step2/tasks/${t}/stream?token=${o}&is_manual=${s||_?"false":"true"}`,j=new EventSource(rt);c.value=j,j.onopen=()=>{d||(b.value=!0)},j.onmessage=E=>{var J;if(!d)try{i.value=JSON.parse(E.data);const U=((J=i.value)==null?void 0:J.status)??"cancels";["completed","failed","canceled"].includes(U)&&p()}catch{}},j.onerror=()=>{p()},c.value.addEventListener("progress",E=>{console.log(">> trki g");try{i.value=JSON.parse(E.data)}catch{}})},p=()=>{b.value=!1,c.value&&(c.value.close(),c.value=null)};lt(()=>{d=!1,l()}),W(()=>{d=!0,p()});const v=x(()=>{var o;return((o=i.value)==null?void 0:o.percent)===100}),Y=x(()=>{var o,s;return((s=(o=i.value)==null?void 0:o.result)==null?void 0:s.lanes_summary)??[]}),Z=x(()=>{var o,s;return((s=(o=i.value)==null?void 0:o.progress_details)==null?void 0:s.lanes_progress)??[]}),N=["https://randomuser.me/api/portraits/women/1.jpg","https://randomuser.me/api/portraits/men/2.jpg","https://randomuser.me/api/portraits/men/3.jpg"],m=nt(),P=x(()=>{var o;return z((o=m==null?void 0:m.params)==null?void 0:o.id)}),Q=x(()=>{var o;return z((o=m==null?void 0:m.params)==null?void 0:o.job_id)}),O=o=>{console.log("Lane clicked:",o)},{data:T,isPending:X,error:tt,refetch:et}=gt(P),{data:st}=ft(P),R=x(()=>{var o;return(o=T.value)!=null&&o.team_workload?T.value.team_workload.map(s=>({id:s.assignee_id||"unassigned",name:s.assignee_name,initials:s.initials||D(s.assignee_name)||"",avatar:!!s.avatar_url||!!s.assignee_id,avatarUrl:s.avatar_url,color:dt(s.assignee_id,s.assignee_name),workload:s.work_distribution_percentage,totalTasks:s.total_tasks,totalHours:s.total_hours})):[]}),I=x(()=>{var o;return((o=T.value)==null?void 0:o.team_size)||0}),ot=o=>({"DEPLOYED-PROD":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",REOPENED:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200","IN-PROGRESS":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"})[o]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200",at=A({name:"SkeletonCard",setup(){return()=>k("div",{class:"w-[380px] min-w-[280px] h-[180px] rounded-xl border border-border bg-bg-body/60 animate-pulse p-4"},[k("div",{class:"h-5 w-2/3 rounded bg-bg-card/50 mb-2"}),k("div",{class:"h-3 w-1/2 rounded bg-bg-card/50 mb-4"}),k("div",{class:"h-2 w-full rounded bg-bg-card/50 mb-1"}),k("div",{class:"h-2 w-11/12 rounded bg-bg-card/50 mb-1"}),k("div",{class:"h-2 w-10/12 rounded bg-bg-card/50"})])}}),B=(o,s)=>o?(s.Done??0)/o*100:0;return(o,s)=>{var _;return a(),r("div",St,[e("div",Pt,[e("div",Tt,[e("div",It,[s[1]||(s[1]=e("h3",{class:"text-2xl text-text-primary font-semibold"},"Project Overview",-1)),s[2]||(s[2]=e("p",{class:"text-sm text-text-secondary mt-2"},"Last update on Sep 12, 2024 - 09.45 AM",-1)),e("div",Et,[u.value?(a(),r(y,{key:0},h(3,t=>S(f(at),{key:t})),64)):(a(),it(ct,{key:1,name:"list",tag:"div",class:"flex gap-2.5"},{default:ut(()=>[v.value?(a(!0),r(y,{key:0},h(Y.value,t=>(a(),r("button",{key:t==null?void 0:t.lane_title,class:"group focus:outline-none border-border border focus-visible:ring-2 focus-visible:ring-primary/50 rounded-xl",type:"button",role:"button","aria-label":"Open lane details",onClick:V=>O(t)},[S(H,{ai:!1,doneCard:t==null?void 0:t.status_distribution.Done,loading:u.value||(t==null?void 0:t.status)==="in_progress",title:t==null?void 0:t.lane_title,subtitle:"",progress:v.value?B(t==null?void 0:t.total_cards,t==null?void 0:t.status_distribution):t==null?void 0:t.progress,totalCard:t==null?void 0:t.total_cards,status:v.value?"":(t==null?void 0:t.status)??"",avatars:N,date:"May 28",class:"transition-transform duration-200 ease-out group-hover:shadow-lg border border-transparent hover:border-border-subtle rounded-xl cursor-pointer"},null,8,["doneCard","loading","title","progress","totalCard","status"])],8,Dt))),128)):(a(!0),r(y,{key:1},h(Z.value,t=>(a(),r("button",{key:`2-${t==null?void 0:t.lane_title}`,class:"group focus:outline-none border-border border focus-visible:ring-2 focus-visible:ring-primary/50 rounded-xl",type:"button",role:"button","aria-label":"Open lane details",onClick:V=>O(t)},[S(H,{ai:!0,loading:u.value||(t==null?void 0:t.status)==="in_progress",title:t==null?void 0:t.lane_title,subtitle:"",progress:v.value?B(t==null?void 0:t.total_cards,t==null?void 0:t.status_distribution):t==null?void 0:t.progress,totalCard:t==null?void 0:t.total_cards,status:v.value?"":(t==null?void 0:t.status)??"",avatars:N,date:"May 28",class:"transition-transform duration-200 ease-out group-hover:shadow-lg border border-transparent hover:border-border-subtle rounded-xl cursor-pointer"},null,8,["loading","title","progress","totalCard","status"])],8,Mt))),128))]),_:1}))])])])]),e("div",At,[e("div",Lt,[e("div",Nt,[s[4]||(s[4]=e("h3",{class:"text-lg font-semibold text-text-primary"},"Team workload",-1)),e("p",Ot,[s[3]||(s[3]=L(" Monitor the capacity of your team. ")),I.value>0?(a(),r("span",Rt,"("+n(I.value)+" member"+n(I.value!==1?"s":"")+")",1)):C("",!0)])]),e("div",Bt,[s[9]||(s[9]=e("div",{class:"flex items-center justify-between text-sm font-medium text-text-secondary mb-2"},[e("span",null,"Assignee"),e("span",null,"Work distribution")],-1)),f(X)?(a(),r(y,{key:0},h(3,t=>e("div",{key:t,class:"flex items-center gap-3 animate-pulse"},s[5]||(s[5]=[e("div",{class:"flex items-center gap-2 w-32 flex-shrink-0"},[e("div",{class:"w-8 h-8 rounded-full bg-bg-body"}),e("div",{class:"h-4 w-20 bg-bg-body rounded"})],-1),e("div",{class:"flex-1 h-6 bg-bg-body rounded"},null,-1)]))),64)):f(tt)?(a(),r("div",Vt,[s[6]||(s[6]=e("p",{class:"text-sm text-red-500 mb-2"},"Failed to load team workload",-1)),e("button",{onClick:s[0]||(s[0]=()=>f(et)()),class:"text-xs text-accent hover:underline"}," Try again ")])):R.value.length===0?(a(),r("div",Jt,s[7]||(s[7]=[e("i",{class:"pi pi-users text-3xl text-text-secondary mb-2"},null,-1),e("p",{class:"text-sm text-text-secondary"},"No team members assigned yet",-1)]))):(a(!0),r(y,{key:3},h(R.value,t=>(a(),r("div",{key:t.id,class:"flex items-center gap-3"},[e("div",Ut,[t.avatarUrl?(a(),r("div",zt,[e("img",{src:t.avatarUrl,alt:t.name,class:"w-full h-full object-cover"},null,8,Ft)])):t.avatar?(a(),r("div",{key:1,class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0",style:M({backgroundColor:f(F)({name:t==null?void 0:t.name})})},n(f(D)(t.name)),5)):(a(),r("div",Ht,s[8]||(s[8]=[e("i",{class:"pi pi-user text-text-secondary"},null,-1)]))),e("span",{class:"text-sm text-text-primary truncate",title:t.name},n(t.name),9,Gt)]),e("div",Wt,[e("div",{class:"h-6 bg-bg-body rounded overflow-hidden relative group cursor-help",title:`${t.totalTasks} task${t.totalTasks!==1?"s":""} â€¢ ${t.totalHours}h`},[e("div",{class:"h-full bg-border-subtle transition-all duration-300",style:M({width:t.workload+"%"})},null,4),t.workload>10?(a(),r("span",Kt,n(t.workload)+"% ",1)):C("",!0)],8,qt)])]))),128))])]),e("div",Yt,[s[11]||(s[11]=e("div",{class:"mb-4"},[e("h3",{class:"text-lg font-semibold text-text-primary"},"Recent activity"),e("p",{class:"text-sm text-text-secondary mt-1"},"Stay up to date with what's happening across the project.")],-1)),e("div",Zt,[s[10]||(s[10]=e("div",{class:"text-xs font-semibold text-text-secondary mb-3"},"Today",-1)),(a(!0),r(y,null,h((_=f(st))==null?void 0:_.activities,t=>(a(),r("div",{key:t.id,class:"flex gap-3 pb-4 border-b border-border last:border-0"},[e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0",style:M({backgroundColor:f(F)({email:t.user.email})})},n(f(D)(t.user.name)),5),e("div",Qt,[e("div",Xt,[e("span",te,n(t.user.name),1),e("span",ee,n(t.message),1),e("a",se,n(t.item),1),t.status?(a(),r("span",{key:0,class:q(["ml-2 px-2 py-0.5 rounded text-xs font-medium",ot(t.status)])},n(t.status),3)):C("",!0)]),e("div",oe,n(t.time),1)])]))),128))])])])])}}}),de=K(ae,[["__scopeId","data-v-ac9c3d24"]]);export{de as default};
