import{d as D,u as T,a as W,r as y,c as u,b as S,e as q,w as n,o as I,f as m,s as p,g as a,h as G,i as l,j as H,k as O,_ as h,t as P,B,l as U,m as j,n as J,p as K}from"./index-Ba5obg8y.js";import{_ as Q}from"./Header-CY9CXuUi.js";import{_ as X}from"./AuthLayout.vue_vue_type_script_setup_true_lang-BVhdJ_HR.js";import{l as Y,s as Z}from"./auth-LP0YslWs.js";import"./dark-logo-Mcb_sJlF.js";import"./favicon-BAFXWHLW.js";const ee={class:"max-w-[500px] md:mx-auto w-full text-text-primary bg-bg-body"},te={key:0,class:"text-red-500 text-sm text-center mt-2"},se={class:"text-center mt-4"},me=D({name:"LoginPage",__name:"Login",setup(oe){const w=T(),E=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,V=W(),g=y(""),c=y(""),r=y(""),d={email:!1,password:!1},v=u(()=>d.email?g.value.trim()?E.test(g.value)?"":"Invalid email":"Email is required":""),L=u(()=>!!v.value),x=u(()=>d.password?c.value?c.value.length<6?"Password must be at least 6 characters":"":"Password is required":""),A=u(()=>!!x.value),C=u(()=>!v.value&&!x.value),f=K(),{mutateAsync:F,isPending:_}=S({mutationFn:Y}),{mutateAsync:$}=S({mutationFn:Z}),z=u(()=>_.value),M=u(()=>_.value?"Signing In...":"Sign in");function b(){r.value&&(r.value="")}async function N(){var s,e;try{const t=await j(),o=await J.get("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${t.access_token}`}}),i=await $({u_email:o.data.email,u_social_id:o.data.sub,u_social_type:"google",u_full_name:o.data.name});k(i)}catch(t){(t==null?void 0:t.message)!=="Popup closed"&&(r.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"Google Login failed. Please try again.")}}async function k(s){var t,o;localStorage.setItem("token",(t=s==null?void 0:s.data)==null?void 0:t.token),await V.bootstrap();const e=localStorage.getItem("post_auth_intent");if(e)try{const i=JSON.parse(e);localStorage.removeItem("post_auth_intent"),i.aiResponse&&w.setWorkspace(i.aiResponse),f.push(i.path||"/dashboard");return}catch(i){console.error("Failed to parse post_auth_intent",i),localStorage.removeItem("post_auth_intent")}if((o=s==null?void 0:s.data)!=null&&o.is_new_user){f.push("/create-profile");return}w.pricing?f.push("/dashboard?stripePayment=true"):f.push("/dashboard")}async function R(){var s,e;if(r.value="",d.email=!0,d.password=!0,!C.value){r.value="Please fill all fields correctly.";return}try{const t=await F({u_email:g.value,u_password:c.value});k(t)}catch(t){r.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"Login failed. Please try again."}}return(s,e)=>{const t=U("router-link");return I(),q(X,null,{form:n(()=>[m("div",ee,[e[0]||(p(-1,!0),(e[0]=m("h2",{class:"text-[32px] font-medium mb-12 text-center text-text-primary"},[e[7]||(e[7]=a(" Sign in to Orchit AI "))])).cacheIndex=0,p(1),e[0]),m("form",{onSubmit:G(R,["prevent"]),class:"space-y-4 w-full"},[l(h,{modelValue:g.value,"onUpdate:modelValue":[e[1]||(e[1]=o=>g.value=o),b],label:"Email",placeholder:"Email address",size:"lg",error:L.value,message:v.value,onBlur:e[2]||(e[2]=o=>d.email=!0)},null,8,["modelValue","error","message"]),l(h,{modelValue:c.value,"onUpdate:modelValue":[e[3]||(e[3]=o=>c.value=o),b],label:"Password",placeholder:"Enter your password",size:"lg",type:"password",error:A.value,message:x.value,onBlur:e[4]||(e[4]=o=>d.password=!0)},null,8,["modelValue","error","message"]),l(B,{disabled:z.value,size:"lg",block:!0,type:"submit"},{default:n(()=>[a(P(M.value),1)]),_:1},8,["disabled"]),l(B,{size:"lg",block:!0,appearance:"outlined",variant:"ghost",type:"button",onClick:N},{icon:n(()=>e[8]||(e[8]=[m("img",{src:Q,class:"w-5 h-5 mr-4"},null,-1)])),default:n(()=>[e[9]||(e[9]=a(" Continue with google "))]),_:1,__:[9]}),r.value?(I(),H("p",te,P(r.value),1)):O("",!0),m("div",se,[l(t,{to:"/forgot-password",class:"text-sm text-accent hover:underline"},{default:n(()=>e[10]||(e[10]=[a(" Forgot password? ")])),_:1,__:[10]})])],32),e[5]||(p(-1,!0),(e[5]=m("p",{class:"text-sm font-medium text-text-secondary text-center mt-6"},[e[13]||(e[13]=a(" By signing in, you agree to the ")),l(t,{to:"/privacy-policy",class:"text-text-primary font-bold hover:underline"},{default:n(()=>e[11]||(e[11]=[a(" Privacy Policy ")])),_:1,__:[11]}),e[14]||(e[14]=a(" and ")),l(t,{to:"/terms-of-services",class:"text-text-primary font-bold hover:underline"},{default:n(()=>e[12]||(e[12]=[a(" Terms of Service ")])),_:1,__:[12]})])).cacheIndex=5,p(1),e[5]),e[6]||(p(-1,!0),(e[6]=m("p",{class:"text-sm font-medium text-text-secondary text-center mt-8"},[e[16]||(e[16]=a(" Donâ€™t have an account? ")),l(t,{to:"/register",class:"text-text-primary font-bold underline"},{default:n(()=>e[15]||(e[15]=[a("Sign up")])),_:1,__:[15]})])).cacheIndex=6,p(1),e[6])])]),_:1})}}});export{me as default};
