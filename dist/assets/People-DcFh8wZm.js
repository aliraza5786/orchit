const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/KanbanSkeleton-DwAjh5QW.js","assets/index-3ojefXkT.js","assets/index-DONjRhdW.css","assets/KanbanSkeleton-BjQaxKe3.css","assets/BaseTextField-C1kXAoHR.js","assets/ConfirmDeleteModal-ulMSRwhq.js","assets/ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-feCVk6iN.js","assets/BaseEmailChip-DBkryJ5b.js","assets/BaseEmailChip.vue_vue_type_script_setup_true_lang-BXENE5wp.js","assets/Dropdown-DOUUG-Rj.js","assets/index-CoFcT1Vn.js","assets/Dropdown-P9l2osTz.css","assets/DetailPanel-CWbw_8H6.js","assets/usePeople-CrGtqqDc.js","assets/usePackages-CuhZ_aZK.js","assets/permissionUtils-fD2X1oS-.js","assets/sidePanelStore-fJOkq24b.js","assets/DetailPanel-DWsKKgcb.css","assets/SearchBar-DEBAy_9O.js","assets/SearchBar.vue_vue_type_script_setup_true_lang-BscDi3Cs.js","assets/KanbanBoard-Dd_a40VF.js","assets/vuedraggable.umd-D0RJi0f3.js","assets/_commonjsHelpers-_d1bhYXs.js","assets/DropMenu.vue_vue_type_script_setup_true_lang-Ddot7H82.js","assets/KanbanBoard-IqVBNhxM.css","assets/KanbanCard-WfiPGnMu.js","assets/KanbanCard.vue_vue_type_script_setup_true_lang-CIoRRpdg.js"])))=>i.map(i=>d[i]);
import{a_ as Ve,n as Y,d as Le,X as Se,r,O as Ie,c as E,q as G,y as Te,P as Oe,bf as Re,j as x,f as n,i as c,e as X,G as Be,v as a,H as Ne,k as Z,w as V,h as L,C as F,F as Ue,o as p,af as d,g as q,t as S,V as Fe,D as u}from"./index-3ojefXkT.js";import{e as qe,f as $e,b as Me,R as Ke,g as Qe}from"./usePeople-CrGtqqDc.js";import{F as We}from"./fuse-Ch1WBRTM.js";import{l as je}from"./lodash-CQYOKM_D.js";import{u as ze}from"./sidePanelStore-fJOkq24b.js";import"./_commonjsHelpers-_d1bhYXs.js";const He="https://backend.orchit.ai/api/v1/",Je=localStorage.getItem("token"),Ye=Ve("people",{state:()=>({peopleData:[],isFetchingPeople:!1}),getters:{},actions:{async fetchPeopleList($,I,T){var w,g;this.isFetchingPeople=!0;try{const l=await Y.get(`${He}workspace/teams/${$}/people-grouped`,{params:{groupBy:I},headers:{Authorization:`Bearer ${Je}`},signal:T});l.status===200?(this.peopleData=(w=l==null?void 0:l.data)==null?void 0:w.data,this.isFetchingPeople=!1):(console.error(((g=l==null?void 0:l.data)==null?void 0:g.message)||"Failed to fetch people list"),this.isFetchingPeople=!1)}catch(l){if(this.isFetchingPeople=!1,Y.isCancel(l))return;console.error(l)}}}}),Ge={class:"flex-auto flex-grow h-full bg-bg-card rounded-[6px] border border-border overflow-x-auto flex-col flex"},Xe={class:"overflow-x-auto shrink-0 border-b border-border"},Ze={class:"header px-4 py-3 flex items-center justify-between gap-2"},et={class:"flex gap-3 items-center"},tt={key:1,class:"flex p-4 overflow-x-auto gap-3 custom_scroll_bar h-full"},st=["onClick","disabled"],at={key:1,class:"p-4 space-y-2 bg-bg-surface m-4 rounded-md"},ot={class:"text-sm text-text-primary"},lt={class:"flex items-center mt-3 gap-3"},it=["disabled"],mt=Le({__name:"People",setup($){const I=d(()=>u(()=>import("./KanbanSkeleton-DwAjh5QW.js"),__vite__mapDeps([0,1,2,3]))),T=d(()=>u(()=>import("./BaseTextField-C1kXAoHR.js"),__vite__mapDeps([4,1,2]))),w=d(()=>u(()=>import("./ConfirmDeleteModal-ulMSRwhq.js"),__vite__mapDeps([5,6,1,2]))),g=d(()=>u(()=>import("./index-3ojefXkT.js").then(e=>e.dq),__vite__mapDeps([1,2]))),l=d(()=>u(()=>import("./BaseEmailChip-DBkryJ5b.js"),__vite__mapDeps([7,8,1,2]))),ee=d(()=>u(()=>import("./Dropdown-DOUUG-Rj.js"),__vite__mapDeps([9,1,2,10,11]))),te=d(()=>u(()=>import("./DetailPanel-CWbw_8H6.js"),__vite__mapDeps([12,1,2,13,14,15,16,17]))),se=d(()=>u(()=>import("./SearchBar-DEBAy_9O.js"),__vite__mapDeps([18,19,1,2]))),ae=d(()=>u(()=>import("./KanbanBoard-Dd_a40VF.js"),__vite__mapDeps([20,21,22,1,2,23,10,24]))),oe=d(()=>u(()=>import("./KanbanCard-WfiPGnMu.js"),__vite__mapDeps([25,26,1,2,13]))),{canCreateVariable:k,canInviteUser:O}=Se(),M=ze(),R=Ye(),le=[{title:"Role",_id:"role"},{title:"Team",_id:"team"},{title:"Status",_id:"status"}],D=r("team"),C=r(!1),f=r(),{workspaceId:m}=Ie(),i=r([]),B=r(!1),K=E(()=>R.isFetchingPeople),N=E(()=>R.peopleData),{mutate:ie,isPending:ne}=qe({onSuccess:e=>{i.value=[...i.value||[],e],h.value="",y.value=!1}}),re=new AbortController,b=async()=>{R.fetchPeopleList(m.value,D.value,re.signal)};G(()=>D.value,(e,t)=>{e!==t&&b()}),Te(()=>{b(),i.value=N.value?JSON.parse(JSON.stringify(N.value)):[]});const de=r("kanban"),ue=r(),Q=e=>{M.selectCard(e),B.value=!1},ce=e=>{},y=r(!1),h=r("");function W(){y.value=!y.value}function pe(){const e=h.value.trim();if(!e){Fe.error("Column name is required.");return}j(e)}const j=e=>{const t={workspace_id:m.value,title:e,max_num_people:1};ie({payload:t})},U=Oe(),me=Re({onSuccess:()=>{U.invalidateQueries({queryKey:["people-lists"]})}}),ve=e=>{const t={workspace_id:m.value,title:e==null?void 0:e.title,max_num_people:1};me.mutate({id:e._id,payload:t})},{mutate:fe,isPending:_e}=$e({onSuccess:e=>{C.value=!1,i.value=i.value.filter(t=>{var o;return t._id!==((o=e.deletedRole)==null?void 0:o._id)})}}),xe=()=>{var e;fe({id:(e=f.value)==null?void 0:e.columnId})},ge=e=>{C.value=!0,f.value=e},{mutate:Ce,isPending:be}=Me({onSuccess:e=>{h.value="",y.value=!1;const t=i.value.findIndex(s=>s._id===f.value._id);if(t===-1)return;const o=i.value[t],v=[...o.cards??[],e==null?void 0:e.assigned_seat],P={...o,cards:v};i.value=[...i.value.slice(0,t),P,...i.value.slice(t+1)],U.invalidateQueries({queryKey:["people-lists"]}),U.invalidateQueries({queryKey:["workspaceRoles"]})}}),z=e=>{f.value=e;const t={name:e!=null&&e.email?ye(e==null?void 0:e.email[0]):"",email:e!=null&&e.email?e==null?void 0:e.email[0]:"",role_id:e==null?void 0:e._id,workspace_id:m==null?void 0:m.value,additional_seats:1};Ce({id:e._id,payload:t})};function ye(e){const o=(e.split("@")[0]||"").split("+")[0].split(/[^a-zA-Z]+/).filter(Boolean);return o.length?o.map(v=>v.charAt(0).toUpperCase()+v.slice(1).toLowerCase()).join(" "):e}const H=e=>{O.value&&(window.dispatchEvent(new CustomEvent("close-all-showADDNEW")),e.showADDNEW=!e.showADDNEW)},he=e=>{z(e)},we=e=>{ue.value=e,M.selectCard(e),B.value=!0},ke=Ke(),De=Qe();function Ae(e){e.type=="column"?ke.mutate({id:m.value,payload:{role_id:e.meta._id,new_sort_order:e.meta.newIndex}}):De.mutate({id:e.meta.toColumnId,payload:{team_member_id:e.meta.moved._id,new_sort_order:e.meta.newIndex}})}const A=r(""),Pe=r("");G(A,je.debounce(e=>{Pe.value=e},200));const Ee=E(()=>{const e=i.value.flatMap(t=>t.cards.map(o=>({...o,columnId:t.title})));return new We(e,{keys:["title","name"],threshold:.3})}),J=E(()=>{if(!A.value)return N.value;const e=Ee.value.search(A.value).map(t=>t.item);return i.value.map(t=>({...t,cards:e.filter(o=>o.columnId===t.title)})).filter(t=>t.cards.length>0)});return(e,t)=>{var o,v,P;return p(),x(Ue,null,[n("div",Ge,[n("div",Xe,[n("div",Ze,[c(a(ee),{actions:!1,prefix:"View By",modelValue:D.value,"onUpdate:modelValue":t[0]||(t[0]=s=>D.value=s),options:le,variant:"secondary",customClasses:"fixed w-[135px]"},null,8,["modelValue"]),n("div",et,[c(a(se),{class:"max-w-[250px]",onOnChange:t[1]||(t[1]=s=>{A.value=s}),placeholder:"Search in Orchit AI space"})])])]),K.value?(p(),X(a(I),{key:0})):Be((p(),x("div",tt,[((o=J.value)==null?void 0:o.length)>0?(p(),X(a(ae),{key:0,plusIcon:!1,onOnPlus:t[4]||(t[4]=s=>z(s)),"onDelete:column":t[5]||(t[5]=s=>ge(s)),"onUpdate:column":t[6]||(t[6]=s=>ve(s)),onReorder:Ae,onAddColumn:j,"onSelect:ticket":Q,board:J.value,onOnBoardUpdate:ce,variable_id:"",sheet_id:"selected_sheet_id"},{ticket:V(({ticket:s})=>[c(a(oe),{onClick:_=>we(s),ticket:s,onDeleted:t[2]||(t[2]=_=>b()),",":"",onAssigned:b,onUnAssigned:b},null,8,["onClick","ticket"])]),"column-footer":V(({column:s})=>[s.showADDNEW?s.showADDNEW?(p(),x("div",at,[n("p",ot,S(s.title)+" "+S(s.cards.length+1),1),c(a(l),{maxEmails:1,placeholder:"team member email",modelValue:s.email,"onUpdate:modelValue":_=>s.email=_},null,8,["modelValue","onUpdate:modelValue"]),t[15]||(t[15]=n("p",{class:"text-sm text-text-secondary"},"You can assign user later",-1)),c(a(g),{size:"md",onClick:_=>he(s)},{default:V(()=>[q(S(a(be)?"Adding...":"Add Seat"),1)]),_:2},1032,["onClick"]),n("i",{class:"fa-solid fa-close cursor-pointer ml-2",onClick:t[3]||(t[3]=_=>H(""))})])):Z("",!0):(p(),x("div",{key:0,onClick:_=>H(s),disabled:!a(O),class:F([a(O)?"cursor-pointer":"cursor-not-allowed","flex py-3 px-3 justify-center text-sm text-text-primary items-center gap-3 border border-text-primary border-dashed mb-4 mx-4 rounded-md"])},t[14]||(t[14]=[n("i",{class:"fa-solid fa-plus"},null,-1),q(" Add Seat ")]),10,st))]),_:1},8,["board"])):Z("",!0),n("div",{class:"min-w-[270px] sm:min-w-[328px]",onClick:t[9]||(t[9]=L(()=>{},["stop"]))},[y.value?(p(),x("form",{key:0,onSubmit:t[8]||(t[8]=L(()=>{},["prevent"])),class:"bg-bg-body rounded-lg p-4"},[c(a(T),{autofocus:!0,modelValue:h.value,"onUpdate:modelValue":t[7]||(t[7]=s=>h.value=s),placeholder:"Add New list"},null,8,["modelValue"]),t[16]||(t[16]=n("p",{class:"text-xs mt-1.5"},"You can add details while editing",-1)),n("div",lt,[c(a(g),{disabled:!a(k),class:F([a(k)?"cursor-pointer":"cursor-not-allowed","px-3 py-1 bg-accent text-white rounded"]),onClick:pe,type:"submit",variant:"primary"},{default:V(()=>[q(S(a(ne)?"Adding...":"Add Team"),1)]),_:1},8,["disabled","class"]),n("i",{class:"fa-solid fa-close cursor-pointer",onClick:W})])],32)):(p(),x("button",{key:1,class:F(["text-sm text-text-primary py-2.5 font-medium flex items-center justify-center w-full gap-2 bg-bg-body rounded-lg",a(k)?"cursor-pointer":"cursor-not-allowed"]),onClick:L(W,["stop"]),disabled:!a(k)}," + Add Team ",10,it))])],512)),[[Ne,de.value=="kanban"&&!K.value]])]),c(a(w),{onClick:t[10]||(t[10]=L(()=>{},["stop"])),modelValue:C.value,"onUpdate:modelValue":t[11]||(t[11]=s=>C.value=s),title:"Delete List",itemLabel:"list",itemName:(v=f.value)==null?void 0:v.title,requireMatchText:(P=f.value)==null?void 0:P.title,confirmText:"Delete List",cancelText:"Cancel",size:"md",loading:a(_e),onConfirm:xe,onCancel:t[12]||(t[12]=()=>{C.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),c(a(te),{onClose:t[13]||(t[13]=s=>Q(null)),showPanel:B.value},null,8,["showPanel"])],64)}}});export{mt as default};
