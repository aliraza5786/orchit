import{d as ee,X as te,Q as ae,P as se,a4 as le,a2 as ie,a3 as re,r as ne,c as r,N as z,x as u,f as A,Z as de,w,o as d,g as i,h as x,j as o,k as c,l as p,_ as oe,L as $,C as ue,H as ce,I as pe,F as fe,D as P,m as f,$ as q,t as C,a5 as me,a6 as be,B as L}from"./index-DhNbIl3H.js";const ve={class:"px-6 grid grid-cols-1 sm:grid-cols-2 gap-4"},ge={key:0,class:"flex flex-col"},De={key:1,class:"flex gap-1 flex-col"},xe={key:0,class:"text-xs text-red-500"},ke={key:2,class:"flex gap-1 flex-col"},_e={key:0,class:"text-xs text-red-500"},Ve={class:"flex flex-col gap-1"},ye={class:"mt-2"},we={class:"px-6 mt-2"},Ce={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},Ie=ee({__name:"CreateTaskModal",props:{modelValue:{type:Boolean,default:!1},sheet_id:{},listId:{},selectedVariable:{},pin:{},size:{default:"lg"}},emits:["update:modelValue","created"],setup(N,{emit:O}){const{canCreateCard:j}=te(),Q=O,n=N,F=ae(),{workspaceId:m,moduleId:K}=se(),{mutate:M,isPending:k}=le({onSuccess:()=>{E(),F.invalidateQueries({queryKey:["sheet-list"]}),v.value=!1}}),{data:_}=ie(m.value),{data:b}=re(m,K,ne(n.sheet_id??"")),v=r({get:()=>n.modelValue,set:e=>Q("update:modelValue",e)}),S=r(()=>((b==null?void 0:b.value)??[]).filter(e=>{var a;return((a=e==null?void 0:e.type)==null?void 0:a.title)==="Select"})),R=e=>e.map(a=>({_id:a,title:a})),I=r(()=>((_==null?void 0:_.value)??[]).map(e=>{var a;return{_id:e._id,title:((a=e==null?void 0:e.variables)==null?void 0:a["lane-title"])??String(e._id)}})),h=e=>e.slug,t=z({title:"",description:"",startDate:null,endDate:null,lane_id:null,assignee:null,variables:{}});u(S,e=>{for(const a of e){const l=h(a);l in t.variables||(t.variables[l]=null)}},{immediate:!0});const s=z({title:!1,description:!1,startDate:!1,endDate:!1,lane:!1}),H=r(()=>!!t.title.trim()&&(n.pin?!0:!!t.startDate&&!!t.endDate)&&!V.value&&!g.value&&!D.value&&!y.value);function W(e){t.startDate=e,s.startDate=!0}function X(e){t.endDate=e,s.endDate=!0}function Z(e){t.lane_id=e,s.lane=!0}function T(e){t.assignee=e}function B(){v.value=!1,E()}function E(){t.title="",t.description="",t.startDate=null,t.endDate=null,t.lane_id=null,t.assignee=null,t.variables={},s.title=!1,s.description=!1,s.startDate=!1,s.endDate=!1,s.lane=!1}const G=r(()=>b.value.find(e=>(e==null?void 0:e._id)==n.selectedVariable)),V=r(()=>s.title&&!t.title.trim()?"Title is required":""),g=r(()=>s.startDate?t.startDate?"":"Start date is required":""),D=r(()=>s.endDate?t.endDate?t.startDate&&t.endDate&&t.endDate<t.startDate?"End date cannot be before start date":"":"End date is required":""),y=r(()=>s.lane?t.lane_id?"":"Lane is required":""),U=new Date().toISOString().split("T")[0];function J(){var a,l;if(s.title=!0,s.description=!0,n.pin||(s.startDate=!0,s.endDate=!0),!H.value||k.value||!j.value)return;const e={sheet_list_id:n.listId,workspace_id:m.value,sheet_id:n.sheet_id,workspace_lane_id:t.lane_id,variables:{...t.variables,[`${(a=G.value)==null?void 0:a.slug}`]:n.listId,"card-title":t.title.trim(),"card-description":t.description.trim(),"start-date":t.startDate,"end-date":t.endDate},seat_id:((l=t.assignee)==null?void 0:l._id)??null,createdAt:new Date().toISOString()};M(e)}return u(()=>t.title,e=>{e!=null&&e.trim()&&s.title&&(s.title=!1)}),u(()=>t.lane_id,e=>{e&&s.lane&&(s.lane=!1)}),u(()=>t.startDate,e=>{e&&s.startDate&&(s.startDate=!1)}),u(()=>t.endDate,e=>{e&&s.endDate&&(s.endDate=!1)}),u(()=>t.description,e=>{e!=null&&e.trim()&&s.description&&(s.description=!1)}),(e,a)=>(d(),A(de,{modelValue:v.value,"onUpdate:modelValue":a[5]||(a[5]=l=>v.value=l),modalClass:"!py-0",size:e.size},{default:w(()=>[i("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[i("div",{class:"flex justify-between w-full"},[a[7]||(a[7]=i("h2",{class:"text-xl font-semibold"},"Create Ticket",-1)),i("div",{class:"w-6 h-6 rounded-full cursor-pointer hover:bg-border/50 transition p-0.5",onClick:B,title:"Close"},a[6]||(a[6]=[i("i",{class:"fa-solid fa-xmark text-sm"},null,-1)]))]),a[8]||(a[8]=i("p",{class:"text-sm text-text-secondary mt-1"},[x(" Provide the details below and click "),i("span",{class:"font-medium"},"Add Ticket"),x(". ")],-1))]),i("div",ve,[o(oe,{modelValue:t.title,"onUpdate:modelValue":a[0]||(a[0]=l=>t.title=l),label:"Ticket Title",placeholder:"e.g., Implement real-time notifications",error:!!V.value,message:V.value,onBlur:a[1]||(a[1]=l=>s.title=!0)},null,8,["modelValue","error","message"]),I.value.length>0?(d(),c("div",ge,[o($,{size:"md",label:"Lane",options:I.value,placeholder:"Select lane",allowCustom:!1,"model-value":t.lane_id,"onUpdate:modelValue":Z,error:!!y.value,message:y.value},null,8,["options","model-value","error","message"])])):p("",!0),(d(!0),c(fe,null,ue(S.value,l=>ce((d(),A($,{size:"md",key:h(l),modelValue:t.variables[l.slug],"onUpdate:modelValue":Y=>t.variables[l.slug]=Y,options:R(l.data),label:l.title,placeholder:"Select value",allowCustom:!0},null,8,["modelValue","onUpdate:modelValue","options","label"])),[[pe,(l==null?void 0:l._id)!=e.selectedVariable&&(l==null?void 0:l.title)!=="Process"]])),128)),e.pin?p("",!0):(d(),c("div",De,[a[9]||(a[9]=i("label",{class:"text-sm"},"Start date",-1)),i("div",{class:P(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",g.value?"border-red-500":""])},[o(q,{placeholder:"Set start date",class:"w-full","model-value":t.startDate,"emit-as":"ymd","onUpdate:modelValue":W,"min-date":f(U)},null,8,["model-value","min-date"])],2),g.value?(d(),c("p",xe,C(g.value),1)):p("",!0)])),e.pin?p("",!0):(d(),c("div",ke,[a[10]||(a[10]=i("label",{class:"text-sm"},"End date",-1)),i("div",{class:P(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",D.value?"border-red-500":""])},[o(q,{placeholder:"Set end date",class:"w-full","model-value":t.endDate,"emit-as":"ymd","onUpdate:modelValue":X,"min-date":t.startDate||f(U)},null,8,["model-value","min-date"])],2),D.value?(d(),c("p",_e,C(D.value),1)):p("",!0)])),i("div",Ve,[a[11]||(a[11]=i("label",{class:"text-sm"},"Assignee",-1)),i("div",ye,[o(me,{name:!0,workspaceId:f(m),onAssign:T,onUnassign:a[2]||(a[2]=l=>T(null)),assigneeId:t.assignee,seat:null,disabled:!1,skipPermissionCheck:!0,class:"w-full"},null,8,["workspaceId","assigneeId"])])])]),i("div",we,[o(be,{label:"Description",placeholder:"What needs to be done, acceptance criteria, links…",modelValue:t.description,"onUpdate:modelValue":a[3]||(a[3]=l=>t.description=l),onBlur:a[4]||(a[4]=l=>s.description=!0)},null,8,["modelValue"])]),i("div",Ce,[o(L,{variant:"secondary",onClick:B},{default:w(()=>a[12]||(a[12]=[x("Cancel")])),_:1,__:[12]}),o(L,{variant:"primary",disabled:f(k),onClick:J},{default:w(()=>[x(C(f(k)?"Adding…":"Add Ticket"),1)]),_:1},8,["disabled"])])]),_:1},8,["modelValue","size"]))}});export{Ie as _};
