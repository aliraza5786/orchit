import{d as H,u as J,a as K,b as Q,r as h,c as u,e as B,f as X,w as l,o as E,g as o,h as n,i as m,j as Y,s as w,k as p,l as Z,m as ee,n as te,_ as V,t as C,B as k,p as se,q as ae,v as oe}from"./index-DkDAC3Va.js";import{_ as re,a as le,d as ne,l as ie}from"./AuthLayout.vue_vue_type_script_setup_true_lang-B3ysmAy9.js";import{l as ue,s as pe}from"./auth-DGk294Ch.js";import{d as de,l as me}from"./dark-logo-Mcb_sJlF.js";const ce={class:"max-w-[500px] py-5 mx-auto w-full text-text-primary bg-bg-body min-h-full flex flex-col justify-center"},ge=["src"],fe={class:"text-end mt-1"},ve=["src"],we={key:0,class:"text-red-500 text-sm text-center mt-2"},ke=H({name:"LoginPage",__name:"Login",props:{isDark:{type:Boolean}},setup(_e){const S=J(),{isDark:I}=K(),N=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,U=Q(),c=h(""),g=h(""),r=h(""),d={email:!1,password:!1},_=u(()=>d.email?c.value.trim()?N.test(c.value)?"":"Invalid email":"Email is required":""),$=u(()=>!!_.value),x=u(()=>d.password?g.value?g.value.length<6?"Password must be at least 6 characters":"":"Password is required":""),z=u(()=>!!x.value),D=u(()=>!_.value&&!x.value),v=oe(),{mutateAsync:R,isPending:A}=B({mutationFn:ue}),{mutateAsync:L}=B({mutationFn:pe}),F=u(()=>A.value),T=u(()=>A.value?"Signing In...":"Sign in");function P(){r.value&&(r.value="")}async function M(){var s,e;try{const t=await se(),a=await ae.get("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${t.access_token}`}}),f=await L({u_email:a.data.email,u_social_id:a.data.sub,u_social_type:"google",u_full_name:a.data.name});b(f)}catch(t){(t==null?void 0:t.message)!=="Popup closed"&&(r.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"Google Login failed. Please try again.")}}async function j(){var s,e;try{AppleID.auth.init({clientId:"com.orchit.ai",scope:"name email",redirectURI:"https://www.orchit.ai/dashboard",usePopup:!0});const t=await AppleID.auth.signIn(),i=t.authorization.id_token.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),W=decodeURIComponent(atob(i).split("").map(function(G){return"%"+("00"+G.charCodeAt(0).toString(16)).slice(-2)}).join("")),y=JSON.parse(W),q=await L({u_email:y.email,u_social_id:y.sub,u_social_type:"apple",u_full_name:(s=t.user)!=null&&s.name?`${t.user.name.firstName} ${t.user.name.lastName}`:((e=y.email)==null?void 0:e.split("@")[0])||""});b(q)}catch(t){(t==null?void 0:t.error)!=="popup_closed_by_user"&&(r.value=(t==null?void 0:t.message)||"Apple Login failed. Please try again.")}}async function b(s){var t,a,f;localStorage.setItem("token",(t=s==null?void 0:s.data)==null?void 0:t.token),await U.bootstrap();const e=localStorage.getItem("post_auth_intent");if(e)try{const i=JSON.parse(e);localStorage.removeItem("post_auth_intent"),i.aiResponse&&S.setWorkspace(i.aiResponse),v.push(i.path||"/dashboard");return}catch(i){console.error("Failed to parse post_auth_intent",i),localStorage.removeItem("post_auth_intent")}if(console.log((a=s==null?void 0:s.data)==null?void 0:a.isNewUser,"new user"),(f=s==null?void 0:s.data)!=null&&f.isNewUser){v.push("/create-profile");return}S.pricing?v.push("/dashboard?stripePayment=true"):v.push("/dashboard")}async function O(){var s,e;if(r.value="",d.email=!0,d.password=!0,!D.value){r.value="Please fill all fields correctly.";return}try{const t=await R({u_email:c.value,u_password:g.value});b(t)}catch(t){r.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"Login failed. Please try again."}}return(s,e)=>{const t=Y("router-link");return E(),X(re,null,{form:l(()=>[o("div",ce,[n(t,{to:"/"},{default:l(()=>[o("img",{src:m(I)?m(de):m(me),class:"w-[130px] d-block mx-auto",alt:"image"},null,8,ge)]),_:1}),e[0]||(w(-1,!0),(e[0]=o("h2",{class:"text-[24px] md:text-[32px] font-medium mb-8 sm:mb-12 text-center text-text-primary"},[e[6]||(e[6]=p(" Sign in to Orchit AI "))])).cacheIndex=0,w(1),e[0]),o("form",{onSubmit:Z(O,["prevent"]),class:"space-y-4 w-full"},[n(V,{modelValue:c.value,"onUpdate:modelValue":[e[1]||(e[1]=a=>c.value=a),P],label:"Email",placeholder:"Email address",size:"lg",error:$.value,message:_.value,onBlur:e[2]||(e[2]=a=>d.email=!0)},null,8,["modelValue","error","message"]),o("div",null,[n(V,{modelValue:g.value,"onUpdate:modelValue":[e[3]||(e[3]=a=>g.value=a),P],label:"Password",placeholder:"Enter your password",size:"lg",type:"password",error:z.value,message:x.value,onBlur:e[4]||(e[4]=a=>d.password=!0)},null,8,["modelValue","error","message"]),o("div",fe,[n(t,{to:"/forgot-password",class:"text-sm text-accent hover:underline"},{default:l(()=>e[7]||(e[7]=[p(" Forgot password? ")])),_:1,__:[7]})])]),n(k,{disabled:F.value,size:"lg",block:!0,type:"submit"},{default:l(()=>[p(C(T.value),1)]),_:1},8,["disabled"]),e[11]||(e[11]=o("div",{class:"flex items-center"},[o("div",{class:"flex-grow border-t border-border"}),o("span",{class:"mx-3 text-[12px] text-primary"},"OR"),o("div",{class:"flex-grow border-t border-border"})],-1)),n(k,{size:"lg",block:!0,appearance:"outlined",variant:"ghost",type:"button",onClick:M},{icon:l(()=>e[8]||(e[8]=[o("img",{src:le,class:"w-5 h-5 mr-4"},null,-1)])),default:l(()=>[e[9]||(e[9]=p(" Continue with google "))]),_:1,__:[9]}),n(k,{size:"lg",block:!0,appearance:"outlined",variant:"ghost",type:"button",class:"felx flex-row",onClick:j},{icon:l(()=>[o("img",{src:m(I)?m(ne):m(ie),alt:"Apple icon",class:"w-[24px] mr-4"},null,8,ve)]),default:l(()=>[e[10]||(e[10]=p(" Continue with apple "))]),_:1,__:[10]}),r.value?(E(),ee("p",we,C(r.value),1)):te("",!0)],32),e[5]||(w(-1,!0),(e[5]=o("p",{class:"text-sm font-medium text-text-secondary text-center mt-8"},[e[13]||(e[13]=p(" Donâ€™t have an account? ")),n(t,{to:"/register",class:"text-text-primary font-bold underline"},{default:l(()=>e[12]||(e[12]=[p("Sign up")])),_:1,__:[12]})])).cacheIndex=5,w(1),e[5])])]),_:1})}}});export{ke as default};
