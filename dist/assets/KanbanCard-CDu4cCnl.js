import{d as Z,c as O,r as k,v as ie,e as le,o as r,w as A,f as a,j as d,k as z,D as oe,ae as ne,h as v,P as re,F as G,y as de,z as J,ad as q,p as g,ai as R,t as m,Q as Y,g as $,i as y,B as X,X as ue,V as ce,W as me,di as pe,N as ge,l as fe}from"./index-LB7gJH4G.js";import{_ as ve}from"./DropMenu.vue_vue_type_script_setup_true_lang-B8Dwn9ID.js";import{l as be,m as ye,n as ke,o as we}from"./usePeople-ANjAnn3u.js";import{_ as xe}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-32N7y02E.js";const he={class:"px-6 pb-2"},Ce={class:"relative mb-4"},_e=["onKeydown"],Se={key:0,class:"mt-3"},Ve={class:"divide-y divide-border rounded-xl border border-border bg-bg-card"},Ae=["onClick"],$e={class:"flex items-center gap-3 min-w-0"},ze=["src"],Te={class:"min-w-0"},Ue={class:"truncate font-medium leading-tight capitalize"},De={class:"truncate text-xs text-text-secondary leading-tight"},Me={key:1,class:"mt-3 flex items-center gap-2"},je={class:"inline-flex items-center gap-2 rounded-full px-3 py-2 bg-bg-muted text-text-secondary"},Ne={class:"flex items-center justify-between gap-3 p-6 mt-3 pb-2 border-t border-border bg-bg-body"},qe={class:"flex gap-2 justify-between w-full"},Be=Z({__name:"AssignmentModal",props:{modelValue:{type:Boolean,default:!1},members:{default:()=>[]},directory:{default:()=>[]},placeholder:{default:"Search people by name or email"},isSubmitting:{}},emits:["update:modelValue","submit","copy-link"],setup(T,{emit:U}){const _=T,S=U,u=O({get:()=>_.modelValue,set:l=>S("update:modelValue",l)}),i=k(""),n=k(""),D=k(""),w=O(()=>{const l=i.value.trim().toLowerCase();return _.directory.filter(o=>{var s;return((s=o.name)==null?void 0:s.toLowerCase().includes(l))||o.email.toLowerCase().includes(l)})}),M=l=>{n.value=l.email,i.value=""},f=()=>{n.value=""},x=()=>{i.value&&(n.value=i.value.trim(),i.value="")},V=l=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l),j=()=>{if(!n.value||!V(n.value)){D.value="Please select a valid email.";return}S("submit",{invite:{email:n.value}})},N=()=>{f(),i.value="",u.value=!1};return ie(()=>{u.value&&(i.value="")}),(l,o)=>(r(),le(ue,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=s=>u.value=s),size:"md"},{default:A(()=>[o[3]||(o[3]=a("div",{class:"sticky top-0 z-10 flex items-start gap-2 px-6 pb-4 mb-4 border-b border-border bg-bg-body"},[a("h2",{class:"text-xl font-semibold"},"Add team member")],-1)),a("div",he,[a("div",Ce,[oe(a("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>i.value=s),type:"text",placeholder:"Search or add email",class:"w-full h-11 rounded-xl border border-border bg-bg-input px-3 text-sm outline-none focus:ring-2 focus:ring-primary/40",onKeydown:ne(v(x,["prevent"]),["enter"])},null,40,_e),[[re,i.value]])]),w.value.length?(r(),d("div",Se,[a("ul",Ve,[(r(!0),d(G,null,de(w.value,s=>(r(),d("li",{key:s.id||s.email,class:J(["flex items-center justify-between gap-3 px-3 py-3 cursor-pointer hover:bg-bg-muted",{"bg-bg-muted":n.value===s.email}]),onClick:B=>M(s)},[a("div",$e,[s!=null&&s.profile_image?(r(),d("img",{key:0,class:"h-9 w-9 rounded-full aspect-square",src:s==null?void 0:s.profile_image,alt:"avatar"},null,8,ze)):(r(),d("div",{key:1,class:"h-9 w-9 bg-white capitalize rounded-full flex items-center justify-center text-xs font-semibold",style:q({backgroundColor:g(R)({email:s.email})})},m(g(Y)(s.name||s.email)),5)),a("div",Te,[a("div",Ue,m(s.name||s.email),1),a("div",De,m(s.email),1)])])],10,Ae))),128))])])):z("",!0),n.value?(r(),d("div",Me,[a("span",je,[$(m(n.value)+" ",1),a("button",{onClick:f,class:"ml-2 text-sm text-red-500"},"✕")])])):z("",!0)]),a("div",Ne,[a("div",qe,[y(X,{variant:"secondary",onClick:N},{default:A(()=>o[2]||(o[2]=[$("Cancel")])),_:1,__:[2]}),y(X,{variant:"primary",disabled:!!(!n.value||l.isSubmitting),onClick:j},{default:A(()=>[$(m(l.isSubmitting?"Assigning…":"Assign"),1)]),_:1},8,["disabled"])])])]),_:1,__:[3]},8,["modelValue"]))}}),Ie={class:"flex justify-between gap-2 items-start w-full relative"},Pe={class:"flex items-center gap-2 w-[70%]"},Ee=["src"],Ke={key:0,class:"fa-solid fa-user text-white"},Le={class:"max-w-[70%]"},Qe={class:"text-sm font-medium mb-1 text-card-foreground leading-tight overflow-hidden overflow-ellipsis text-nowrap"},Fe={class:"text-text-secondary text-xs overflow-hidden overflow-ellipsis"},He={key:0,class:"group-hover:flex justify-center items-center hidden w-6 h-6 bg-bg-surface/40 rounded-md"},Ge=Z({__name:"KanbanCard",props:{ticket:{}},setup(T){const{canInviteUser:U,canEditUser:_,canDeleteUser:S}=ce(),u=k(!1),i=T,{workspaceId:n}=me(),{data:D}=pe(),{data:w}=be(n.value,D),M=k([]),f=k(!1),x=ge();function V(){var p,h,C;const e=((h=(p=i.ticket)==null?void 0:p.role_title)==null?void 0:h.toLowerCase())==="admin",t=!!((C=i.ticket)!=null&&C.name),c=[];return U.value&&!e&&c.push({label:"Assign User",danger:!0,action:()=>{u.value=!0},icon:{prefix:"fa-regular",iconName:"fa-user-plus"}}),t&&_.value&&!e&&c.push({label:"UnAssign User",danger:!0,action:ae,icon:{prefix:"fa-regular",iconName:"fa-user-minus"}}),S.value&&!e&&c.push({label:"Delete Seat",danger:!0,action:()=>{f.value=!0},icon:{prefix:"fa-regular",iconName:"fa-trash"}}),c}const j=()=>{},{mutate:N,isPending:l}=ye({onSuccess:()=>{x.invalidateQueries({queryKey:["people-lists"]})}}),o=()=>{N({id:i.ticket._id})},{mutate:s,isPending:B}=ke({onSuccess:()=>{u.value=!1,x.invalidateQueries({queryKey:["people-lists"]})}});function ee(e){const c=(e.split("@")[0]||"").split("+")[0].split(/[^a-zA-Z]+/).filter(Boolean);return c.length?c.map(p=>p.charAt(0).toUpperCase()+p.slice(1).toLowerCase()).join(" "):e}const{mutate:te}=we({onSuccess:()=>{u.value=!1,x.invalidateQueries({queryKey:["people-lists"]})}});function se(e){s({id:i.ticket._id,payload:{name:ee(e.email),email:e.email}})}function ae(){te({id:i.ticket._id})}return(e,t)=>{var p,h,C,I,P,E,K,L,Q,F,H,W;const c=fe("AssigmentDropdown");return r(),d(G,null,[a("div",{onClick:t[2]||(t[2]=b=>e.$emit("click")),class:"group bg-bg-card rounded-lg p-4 shadow-sm cursor-grab hover:shadow-md transition-all duration-200 active:cursor-grabbing",style:q({borderColor:(h=(p=e.ticket)==null?void 0:p.lane)==null?void 0:h.variables["lane-color"]})},[a("div",Ie,[a("div",Pe,[(C=e.ticket)!=null&&C.avatar?(r(),d("img",{key:0,src:(I=e.ticket)==null?void 0:I.avatar,class:"min-w-10 w-10 h-10 rounded-full object-cover",alt:"avartar"},null,8,Ee)):(r(),d("div",{key:1,class:"w-10 min-w-10 overflow-hidden overflow-ellipsis aspect-square bg-bg-surface flex justify-center items-center rounded-full",style:q({backgroundColor:(P=e.ticket)!=null&&P.name?g(R)({email:(E=e.ticket)==null?void 0:E.email}):""})},[$(m(g(Y)((K=e.ticket)==null?void 0:K.name))+" ",1),(L=e.ticket)!=null&&L.name?z("",!0):(r(),d("i",Ke))],4)),a("div",Le,[a("h3",Qe,m(((Q=e.ticket)==null?void 0:Q.name)??e.ticket.title??"Team Member "),1),a("p",Fe,m((F=e.ticket)==null?void 0:F.email),1)])]),a("div",{class:J(["group-hover:hidden text-[11px]",{"capitalize flex items-center gap-2 rounded-md w-fit px-2 py-1 bg-amber-600/10 text-amber-600":e.ticket.status==="pending","capitalize flex items-center gap-2 rounded-md w-fit px-2 py-1 bg-red-600/10 text-red-600 ":e.ticket.status==="rejected","capitalize flex items-center gap-2 rounded-md w-fit px-2 py-1 bg-green-600/10 text-green-600  ":e.ticket.status==="accepted","capitalize flex items-center gap-2 rounded-md w-fit px-2 py-1 bg-gray-600/20 text-gray-400  ":e.ticket.status==="unassigned"}])},m(e.ticket.status),3),V().length>0?(r(),d("div",He,[y(ve,{onClick:t[0]||(t[0]=v(()=>{},["stop"])),items:V()},{trigger:A(()=>t[11]||(t[11]=[a("i",{class:"cursor-pointer fa-solid fa-ellipsis"},null,-1)])),_:1},8,["items"])])):z("",!0)]),a("div",{onClick:t[1]||(t[1]=v(()=>{},["stop"]))},[y(c,{users:M.value,onAssign:j,assigneeId:e.ticket.assigned_to},null,8,["users","assigneeId"])])],4),a("div",{class:"no-drag-zone",draggable:"false",onMousedown:t[8]||(t[8]=v(()=>{},["stop"])),onTouchstart:t[9]||(t[9]=v(()=>{},["stop"])),onPointerdown:t[10]||(t[10]=v(()=>{},["stop"]))},[y(xe,{onClick:t[3]||(t[3]=v(()=>{},["stop"])),modelValue:f.value,"onUpdate:modelValue":t[4]||(t[4]=b=>f.value=b),title:"Delete Team seat",itemLabel:"Seat",itemName:e.ticket.title,requireMatchText:e.ticket.title,confirmText:"Delete Seat",cancelText:"Cancel",size:"md",loading:g(l),onConfirm:o,onCancel:t[5]||(t[5]=()=>{f.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),y(Be,{isSubmitting:g(B),modelValue:u.value,"onUpdate:modelValue":t[6]||(t[6]=b=>u.value=b),members:(H=g(w))==null?void 0:H.people,directory:(W=g(w))==null?void 0:W.people,onSubmit:t[7]||(t[7]=({invite:b})=>se(b))},null,8,["isSubmitting","modelValue","members","directory"])],32)],64)}}});export{Ge as default};
