import{d as J,a as X,W as Y,a0 as ee,Z as te,$ as ae,c as i,M as T,m as u,b as E,S as le,w as y,e as r,f as D,h as o,i as c,j as p,_ as se,G as U,F as re,x as ie,A as de,C as ne,y as z,U as I,t as S,a1 as oe,B as q,n as A,o as d}from"./index-C-iqr35C.js";const ue={class:"px-6 grid grid-cols-2 gap-4"},ce={key:0,class:"flex flex-col"},pe={key:1,class:"flex gap-1 flex-col"},me={key:0,class:"text-xs text-red-500"},fe={key:2,class:"flex gap-1 flex-col"},be={key:0,class:"text-xs text-red-500"},ve={class:"px-6 mt-2"},De={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},_e=J({__name:"CreateTaskModal",props:{modelValue:{type:Boolean,default:!1},sheet_id:{},listId:{},selectedVariable:{},pin:{},size:{default:"lg"}},emits:["update:modelValue","created"],setup($,{emit:L}){const N=L,n=$,O=X(),{workspaceId:g,moduleId:M}=Y(),{mutate:P,isPending:_}=ee({onSuccess:()=>{B(),O.invalidateQueries({queryKey:["sheet-list"]}),f.value=!1}}),{data:V}=te(g.value),{data:m}=ae(g.value,M.value),f=i({get:()=>n.modelValue,set:e=>N("update:modelValue",e)}),h=i(()=>((m==null?void 0:m.value)??[]).filter(e=>{var a;return((a=e==null?void 0:e.type)==null?void 0:a.title)==="Select"})),j=e=>e.map(a=>({_id:a,title:a})),C=i(()=>((V==null?void 0:V.value)??[]).map(e=>{var a;return{_id:e._id,title:((a=e==null?void 0:e.variables)==null?void 0:a["lane-title"])??String(e._id)}})),w=e=>e.slug,t=T({title:"",description:"",startDate:null,endDate:null,lane_id:null,variables:{}});u(h,e=>{for(const a of e){const s=w(a);s in t.variables||(t.variables[s]=null)}},{immediate:!0});const l=T({title:!1,description:!1,startDate:!1,endDate:!1,lane:!1}),F=i(()=>!!t.title.trim()&&(n.pin?!0:!!t.startDate&&!!t.endDate)&&!x.value&&!b.value&&!v.value&&!k.value);function K(e){t.startDate=e,l.startDate=!0}function Q(e){t.endDate=e,l.endDate=!0}function R(e){t.lane_id=e,l.lane=!0}function W(){f.value=!1,B()}function B(){t.title="",t.description="",t.startDate=null,t.endDate=null,t.lane_id=null,t.variables={},l.title=!1,l.description=!1,l.startDate=!1,l.endDate=!1,l.lane=!1}const G=i(()=>m.value.find(e=>(e==null?void 0:e._id)==n.selectedVariable)),x=i(()=>l.title&&!t.title.trim()?"Title is required":""),b=i(()=>l.startDate?t.startDate?"":"Start date is required":""),v=i(()=>l.endDate?t.endDate?t.startDate&&t.endDate&&t.endDate<t.startDate?"End date cannot be before start date":"":"End date is required":""),k=i(()=>l.lane?t.lane_id?"":"Lane is required":"");function Z(){var a;if(l.title=!0,l.description=!0,n.pin||(l.startDate=!0,l.endDate=!0),!F.value||_.value)return;const e={sheet_list_id:n.listId,workspace_id:g.value,sheet_id:n.sheet_id,workspace_lane_id:t.lane_id,variables:{...t.variables,[`${(a=G.value)==null?void 0:a.slug}`]:n.listId,"card-title":t.title.trim(),"card-description":t.description.trim(),"start-date":t.startDate,"end-date":t.endDate},createdAt:new Date().toISOString()};P(e)}return u(()=>t.title,e=>{e!=null&&e.trim()&&l.title&&(l.title=!1)}),u(()=>t.lane_id,e=>{e&&l.lane&&(l.lane=!1)}),u(()=>t.startDate,e=>{e&&l.startDate&&(l.startDate=!1)}),u(()=>t.endDate,e=>{e&&l.endDate&&(l.endDate=!1)}),u(()=>t.description,e=>{e!=null&&e.trim()&&l.description&&(l.description=!1)}),(e,a)=>(d(),E(le,{modelValue:f.value,"onUpdate:modelValue":a[4]||(a[4]=s=>f.value=s),modalClass:"!py-0",size:e.size},{default:y(()=>[a[8]||(a[8]=r("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[r("h2",{class:"text-xl font-semibold"},"Create Ticket"),r("p",{class:"text-sm text-text-secondary mt-1"},[D(" Provide the details below and click "),r("span",{class:"font-medium"},"Add Ticket"),D(". ")])],-1)),r("div",ue,[o(se,{modelValue:t.title,"onUpdate:modelValue":a[0]||(a[0]=s=>t.title=s),label:"Ticket Title",placeholder:"e.g., Implement real-time notifications",error:!!x.value,message:x.value,onBlur:a[1]||(a[1]=s=>l.title=!0)},null,8,["modelValue","error","message"]),C.value.length>0?(d(),c("div",ce,[o(U,{size:"md",label:"Lane",options:C.value,placeholder:"Select lane",allowCustom:!1,"model-value":t.lane_id,"onUpdate:modelValue":R,error:!!k.value,message:k.value},null,8,["options","model-value","error","message"])])):p("",!0),(d(!0),c(re,null,ie(h.value,s=>de((d(),E(U,{size:"md",key:w(s),modelValue:t.variables[s.slug],"onUpdate:modelValue":H=>t.variables[s.slug]=H,options:j(s.data),label:s.title,placeholder:"Select value",allowCustom:!0},null,8,["modelValue","onUpdate:modelValue","options","label"])),[[ne,(s==null?void 0:s._id)!=e.selectedVariable]])),128)),e.pin?p("",!0):(d(),c("div",pe,[a[5]||(a[5]=r("label",{class:"text-sm"},"Start date",-1)),r("div",{class:z(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",b.value?"border-red-500":""])},[o(I,{placeholder:"Set start date",class:"w-full","model-value":t.startDate,"emit-as":"ymd","onUpdate:modelValue":K},null,8,["model-value"])],2),b.value?(d(),c("p",me,S(b.value),1)):p("",!0)])),e.pin?p("",!0):(d(),c("div",fe,[a[6]||(a[6]=r("label",{class:"text-sm"},"End date",-1)),r("div",{class:z(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",v.value?"border-red-500":""])},[o(I,{placeholder:"Set end date",class:"w-full","model-value":t.endDate,"emit-as":"ymd","onUpdate:modelValue":Q},null,8,["model-value"])],2),v.value?(d(),c("p",be,S(v.value),1)):p("",!0)]))]),r("div",ve,[o(oe,{label:"Description",placeholder:"What needs to be done, acceptance criteria, links…",modelValue:t.description,"onUpdate:modelValue":a[2]||(a[2]=s=>t.description=s),onBlur:a[3]||(a[3]=s=>l.description=!0)},null,8,["modelValue"])]),r("div",De,[o(q,{variant:"secondary",onClick:W},{default:y(()=>a[7]||(a[7]=[D("Cancel")])),_:1,__:[7]}),o(q,{variant:"primary",disabled:A(_),onClick:Z},{default:y(()=>[D(S(A(_)?"Adding…":"Add Ticket"),1)]),_:1},8,["disabled"])])]),_:1,__:[8]},8,["modelValue","size"]))}});export{_e as _};
