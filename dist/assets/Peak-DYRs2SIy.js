import{r as h,m as q,v as K,d as N,c as _,i as r,e,t as u,j as E,y as X,h as P,f as R,o,H as Z,aW as H,p as lt,q as nt,aX as it,P as J,b as dt,F as w,x as C,n as y,w as ut,aY as ct,a7 as L,aZ as G,ai as S}from"./index-CpwqMS23.js";import{_ as gt}from"./ProgressBar.vue_vue_type_script_setup_true_lang-CWg3z8TF.js";import{u as vt,a as pt}from"./usePeople-ED_pvMAO.js";function ft($,{start:g=0,maxWhileLoading:p=90,step:i=.8,intervalMs:v=120}={}){const l=h(g);let f=null;const n=()=>{f==null&&(f=window.setInterval(()=>{$()&&(l.value=Math.min(l.value+i,p))},v))},x=()=>{f!=null&&(clearInterval(f),f=null)};return q($,I=>{I?(l.value=g,n()):(l.value=100,setTimeout(()=>{l.value=g,x()},300))},{immediate:!0}),K(x),l}const xt={class:"relative p-3 rounded-lg min-w-sm border border-border overflow-hidden flex flex-col justify-between bg-bg-card w-full"},mt={class:"flex justify-between items-start pb-2"},bt={class:"text-lg font-semibold text-text-primary text-left"},_t={class:"text-xs text-text-secondary text-left"},yt={class:"flex items-center gap-2"},ht={class:""},kt={class:"flex justify-between text-sm text-text-secondary mb-1"},wt={key:0,class:"fa-regular text-left fa-arrows-spin animate-spin duration-250"},Ct={key:0},St={key:1},Et=N({__name:"ProjectCard",props:{title:{},subtitle:{},status:{},progress:{default:0},avatars:{},maxVisible:{default:2},date:{},loading:{type:Boolean,default:!1},color:{default:"#9CA3AF"},totalCard:{default:0},ai:{type:Boolean},doneCard:{}},setup($){const g=$,p=ft(()=>!!g.loading),i=_(()=>g.loading?p.value:g.progress),v=_(()=>Math.round(i.value)>=100),l=h(0);q(v,(n,x)=>{n&&!x&&l.value++});function f(n){switch(n){case"completed":return"bg-green-400/40 border-green-400 text-green-400";case"failed":return"bg-red-400/40 border-red-400 text-red-400";case"in_progress":return"bg-blue-400/20 border-blue-400 text-blue-400";case"pending":return"bg-amber-400/20 border-amber-400 text-amber-400";default:return"progress-default"}}return(n,x)=>(o(),r("div",xt,[e("div",mt,[e("div",null,[e("h3",bt,u(n.title),1),e("p",_t,u(n.subtitle),1)]),e("div",yt,[!n.totalCard&&n.status?(o(),r("span",{key:0,class:X(["text-xs border rounded-full px-2 py-0.5",f(n.status)])},u(n.status),3)):E("",!0)])]),e("div",ht,[e("div",kt,[e("div",null,[e("span",null,u(n.status=="in_progress"?"Generating lane with AI...":"Progress"),1),x[0]||(x[0]=R()),n.status=="in_progress"?(o(),r("i",wt)):E("",!0)]),n.ai?(o(),r("span",Ct,[R(u(Math.round(i.value))+"% ",1),v.value?(o(),r("span",{key:l.value,class:"confetti-icon select-none","aria-label":"Completed"}," ðŸŽ‰ ")):E("",!0)])):(o(),r("span",St,u(n.doneCard??0)+" / "+u(n.totalCard),1))]),P(gt,{class:"mt-2",progress:i.value,fillColor:"bg-accent",indeterminate:!!n.loading},null,8,["progress","indeterminate"])])]))}}),W=Z(Et,[["__scopeId","data-v-c0790b92"]]),$t={class:"flex flex-col gap-4 h-full overflow-x-auto w-full flex-auto"},Tt={class:"p-5 rounded-lg bg-bg-card space-y-6"},Pt={class:"flex items-center justify-between"},It={class:"flex flex-col w-full"},jt={class:"flex gap-2.5 overflow-x-auto w-full py-8 custom_scroll_bar"},Dt=["onClick"],Ot=["onClick"],Mt={class:"flex flex-grow flex-col sm:flex-row gap-4"},At={class:"bg-bg-card w-full max-h-full flex-auto p-5 rounded-lg"},Lt={class:"mb-4"},Nt={class:"text-sm text-text-secondary mt-1"},Rt={key:0,class:"ml-1"},Bt={class:"space-y-4"},Vt={key:1,class:"text-center py-8"},Ut={key:2,class:"text-center py-8"},zt={class:"flex items-center gap-2 w-32 flex-shrink-0"},Ft={key:0,class:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0"},Ht=["src","alt"],Jt={key:2,class:"w-8 h-8 rounded-full bg-bg-body flex items-center justify-center flex-shrink-0"},Gt=["title"],Wt={class:"flex-1"},Yt=["title"],qt={key:0,class:"absolute inset-0 flex items-center justify-start px-2 text-xs text-text-primary font-medium"},Kt={class:"bg-bg-card w-full flex-auto p-5 max-h-full rounded-lg overflow-y-auto flex flex-col"},Xt={class:"space-y-4 overflow-y-auto flex-1"},Zt={class:"flex-1 min-w-0"},Qt={class:"text-sm text-text-primary"},te={class:"font-medium text-accent/90"},ee={class:"text-text-secondary"},se={href:"#",class:"text-accent/90 hover:underline"},ae={class:"text-xs text-text-secondary mt-1"},Y=5,oe=N({__name:"Peak",setup($){const g=h(!1),p=h(null),i=h(null),v=h(0),l=h({}),f="https://backend.orchit.ai/api/v1/",n=_(()=>{var a;return((a=p.value)==null?void 0:a.percent)==100}),x=_(()=>{var a,s;return((s=(a=p.value)==null?void 0:a.result)==null?void 0:s.lanes_summary)??[]}),I=_(()=>{var a,s;return((s=(a=p.value)==null?void 0:a.progress_details)==null?void 0:s.lanes_progress)??[]}),T=h(!1),B=["https://randomuser.me/api/portraits/women/1.jpg","https://randomuser.me/api/portraits/men/2.jpg","https://randomuser.me/api/portraits/men/3.jpg"],k=lt(),j=_(()=>{var a;return H((a=k==null?void 0:k.params)==null?void 0:a.id)}),m=_(()=>{var a;return H((a=k==null?void 0:k.params)==null?void 0:a.job_id)}),D=()=>{if(i.value&&i.value.readyState===EventSource.OPEN||v.value>=Y)return;i.value&&i.value.close();const a=localStorage.getItem("token")||"",s=m!=null&&m.value?m==null?void 0:m.value:localStorage.getItem("jobId")?localStorage.getItem("jobId"):j.value,d=localStorage.getItem("jobId")||m!=null&&m.value?"false":"true",t=`${f}common/step2/tasks/${s}/stream?token=${a}&is_manual=${d}`;try{i.value=new EventSource(t,{withCredentials:!1}),i.value.onopen=()=>{T.value=!0,g.value=!0,v.value=0,l.value={...l.value,connectionStatus:"Connected",lastConnected:new Date().toISOString(),url:t},T.value=!1},i.value.onmessage=c=>{try{const b=JSON.parse(c.data);p.value=b,l.value={...l.value,lastMessage:b,lastMessageTime:new Date().toISOString()},["completed","failed","canceled"].includes(b.status)&&setTimeout(O,1200)}catch(b){l.value={...l.value,parseError:b==null?void 0:b.message,rawMessage:c.data}}},i.value.addEventListener("progress",c=>{try{p.value=JSON.parse(c.data)}catch{}}),i.value.addEventListener("error",c=>{try{l.value={...l.value,serverError:JSON.parse(c.data)}}catch{}}),i.value.onerror=()=>{var c;if(g.value=!1,l.value={...l.value,connectionError:!0,errorTime:new Date().toISOString(),readyState:(c=i.value)==null?void 0:c.readyState},v.value<Y){v.value++;const b=Math.min(3e4,1e3*2**v.value);setTimeout(D,b)}}}catch(c){l.value={...l.value,creationError:c==null?void 0:c.message,errorTime:new Date().toISOString()}}},O=()=>{i.value&&(i.value.close(),i.value=null),g.value=!1,l.value={...l.value,disconnectedAt:new Date().toISOString()}},Q=()=>{O(),v.value=0,setTimeout(D,600)};nt(()=>{D(),document.addEventListener("visibilitychange",V)}),K(()=>{O(),document.removeEventListener("visibilitychange",V)});const V=()=>{!document.hidden&&!g.value&&(!i.value||i.value.readyState===EventSource.CLOSED)&&Q()},U=a=>{console.log("Lane clicked:",a)},{data:M,isPending:tt,error:et,refetch:st}=vt(j),{data:at}=pt(j),z=_(()=>{var s;if(!((s=M.value)!=null&&s.team_workload))return console.log("Returning empty array - no team workload data"),[];const a=M.value.team_workload.map(d=>({id:d.assignee_id||"unassigned",name:d.assignee_name,initials:d.initials||J(d.assignee_name)||"",avatar:!!d.avatar_url||!!d.assignee_id,avatarUrl:d.avatar_url,color:it(d.assignee_id,d.assignee_name),workload:d.work_distribution_percentage,totalTasks:d.total_tasks,totalHours:d.total_hours}));return console.log("Mapped team workload:",a),a}),A=_(()=>{var a;return((a=M.value)==null?void 0:a.team_size)||0}),ot=a=>({"DEPLOYED-PROD":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",REOPENED:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200","IN-PROGRESS":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"})[a]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200",rt=N({name:"SkeletonCard",setup(){return()=>S("div",{class:"w-[380px] min-w-[280px] h-[180px] rounded-xl border border-border bg-bg-body/60 animate-pulse p-4"},[S("div",{class:"h-5 w-2/3 rounded bg-bg-card/50 mb-2"}),S("div",{class:"h-3 w-1/2 rounded bg-bg-card/50 mb-4"}),S("div",{class:"h-2 w-full rounded bg-bg-card/50 mb-1"}),S("div",{class:"h-2 w-11/12 rounded bg-bg-card/50 mb-1"}),S("div",{class:"h-2 w-10/12 rounded bg-bg-card/50"})])}}),F=(a,s)=>{if(a==0)return 0;const d=s.Done??0,t=d/a*100;return console.log(d,">>",a),t};return(a,s)=>{var d;return o(),r("div",$t,[e("div",Tt,[e("div",Pt,[e("div",It,[s[1]||(s[1]=e("h3",{class:"text-2xl text-text-primary font-semibold"},"Project Overview",-1)),s[2]||(s[2]=e("p",{class:"text-sm text-text-secondary mt-2"},"Last update on Sep 12, 2024 - 09.45 AM",-1)),e("div",jt,[T.value?(o(),r(w,{key:0},C(3,t=>P(y(rt),{key:t})),64)):(o(),dt(ct,{key:1,name:"list",tag:"div",class:"flex gap-2.5"},{default:ut(()=>[n.value?(o(!0),r(w,{key:0},C(x.value,t=>(o(),r("button",{key:t==null?void 0:t.lane_title,class:"group focus:outline-none border-border border focus-visible:ring-2 focus-visible:ring-primary/50 rounded-xl",type:"button",role:"button","aria-label":"Open lane details",onClick:c=>U(t)},[P(W,{ai:!1,doneCard:t==null?void 0:t.status_distribution.Done,loading:T.value||(t==null?void 0:t.status)==="in_progress",title:t==null?void 0:t.lane_title,subtitle:"Mobile Application",progress:n.value?F(t==null?void 0:t.total_cards,t==null?void 0:t.status_distribution):t==null?void 0:t.progress,totalCard:t==null?void 0:t.total_cards,status:n.value?"":(t==null?void 0:t.status)??"",avatars:B,date:"May 28",class:"transition-transform duration-200 ease-out group-hover:shadow-lg border border-transparent hover:border-border-subtle rounded-xl cursor-pointer"},null,8,["doneCard","loading","title","progress","totalCard","status"])],8,Dt))),128)):(o(!0),r(w,{key:1},C(I.value,t=>(o(),r("button",{key:`2-${t==null?void 0:t.lane_title}`,class:"group focus:outline-none border-border border focus-visible:ring-2 focus-visible:ring-primary/50 rounded-xl",type:"button",role:"button","aria-label":"Open lane details",onClick:c=>U(t)},[P(W,{ai:!0,loading:T.value||(t==null?void 0:t.status)==="in_progress",title:t==null?void 0:t.lane_title,subtitle:"Mobile Application",progress:n.value?F(t==null?void 0:t.total_cards,t==null?void 0:t.status_distribution):t==null?void 0:t.progress,totalCard:t==null?void 0:t.total_cards,status:n.value?"":(t==null?void 0:t.status)??"",avatars:B,date:"May 28",class:"transition-transform duration-200 ease-out group-hover:shadow-lg border border-transparent hover:border-border-subtle rounded-xl cursor-pointer"},null,8,["loading","title","progress","totalCard","status"])],8,Ot))),128))]),_:1}))])])])]),e("div",Mt,[e("div",At,[e("div",Lt,[s[4]||(s[4]=e("h3",{class:"text-lg font-semibold text-text-primary"},"Team workload",-1)),e("p",Nt,[s[3]||(s[3]=R(" Monitor the capacity of your team. ")),A.value>0?(o(),r("span",Rt,"("+u(A.value)+" member"+u(A.value!==1?"s":"")+")",1)):E("",!0)])]),e("div",Bt,[s[9]||(s[9]=e("div",{class:"flex items-center justify-between text-sm font-medium text-text-secondary mb-2"},[e("span",null,"Assignee"),e("span",null,"Work distribution")],-1)),y(tt)?(o(),r(w,{key:0},C(3,t=>e("div",{key:t,class:"flex items-center gap-3 animate-pulse"},s[5]||(s[5]=[e("div",{class:"flex items-center gap-2 w-32 flex-shrink-0"},[e("div",{class:"w-8 h-8 rounded-full bg-bg-body"}),e("div",{class:"h-4 w-20 bg-bg-body rounded"})],-1),e("div",{class:"flex-1 h-6 bg-bg-body rounded"},null,-1)]))),64)):y(et)?(o(),r("div",Vt,[s[6]||(s[6]=e("p",{class:"text-sm text-red-500 mb-2"},"Failed to load team workload",-1)),e("button",{onClick:s[0]||(s[0]=()=>y(st)()),class:"text-xs text-accent hover:underline"}," Try again ")])):z.value.length===0?(o(),r("div",Ut,s[7]||(s[7]=[e("i",{class:"pi pi-users text-3xl text-text-secondary mb-2"},null,-1),e("p",{class:"text-sm text-text-secondary"},"No team members assigned yet",-1)]))):(o(!0),r(w,{key:3},C(z.value,t=>(o(),r("div",{key:t.id,class:"flex items-center gap-3"},[e("div",zt,[t.avatarUrl?(o(),r("div",Ft,[e("img",{src:t.avatarUrl,alt:t.name,class:"w-full h-full object-cover"},null,8,Ht)])):t.avatar?(o(),r("div",{key:1,class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0",style:L({backgroundColor:y(G)({email:t==null?void 0:t.assignee_id})})},u(t.initials),5)):(o(),r("div",Jt,s[8]||(s[8]=[e("i",{class:"pi pi-user text-text-secondary"},null,-1)]))),e("span",{class:"text-sm text-text-primary truncate",title:t.name},u(t.name),9,Gt)]),e("div",Wt,[e("div",{class:"h-6 bg-bg-body rounded overflow-hidden relative group cursor-help",title:`${t.totalTasks} task${t.totalTasks!==1?"s":""} â€¢ ${t.totalHours}h`},[e("div",{class:"h-full bg-border-subtle transition-all duration-300",style:L({width:t.workload+"%"})},null,4),t.workload>10?(o(),r("span",qt,u(t.workload)+"% ",1)):E("",!0)],8,Yt)])]))),128))])]),e("div",Kt,[s[11]||(s[11]=e("div",{class:"mb-4"},[e("h3",{class:"text-lg font-semibold text-text-primary"},"Recent activity"),e("p",{class:"text-sm text-text-secondary mt-1"},"Stay up to date with what's happening across the project.")],-1)),e("div",Xt,[s[10]||(s[10]=e("div",{class:"text-xs font-semibold text-text-secondary mb-3"},"Today",-1)),(o(!0),r(w,null,C((d=y(at))==null?void 0:d.activities,t=>(o(),r("div",{key:t.id,class:"flex gap-3 pb-4 border-b border-border last:border-0"},[e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0",style:L({backgroundColor:y(G)({email:t.user.email})})},u(y(J)(t.user.name)),5),e("div",Zt,[e("div",Qt,[e("span",te,u(t.user.name),1),e("span",ee,u(t.message),1),e("a",se,u(t.item),1),t.status?(o(),r("span",{key:0,class:X(["ml-2 px-2 py-0.5 rounded text-xs font-medium",ot(t.status)])},u(t.status),3)):E("",!0)]),e("div",ae,u(t.time),1)])]))),128))])])])])}}}),ie=Z(oe,[["__scopeId","data-v-7420021c"]]);export{ie as default};
