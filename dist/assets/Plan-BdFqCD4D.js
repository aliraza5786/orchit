const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CreateTaskModal-DpxeH-Iv.js","assets/CreateTaskModal.vue_vue_type_script_setup_true_lang-DVh2IrmV.js","assets/index-Dp_Ec3Oc.js","assets/index-CD2HKrT3.css","assets/ConfirmDeleteModal-GwbB0rUl.js","assets/ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-CU_4zkLZ.js","assets/SidePanel-TgjrCkek.js","assets/SidePanel-fKwN4j-K.css","assets/KanbanBoard-DnPzG2rY.js","assets/DropMenu.vue_vue_type_script_setup_true_lang-BHXf9yih.js","assets/index-BPTSWC-U.js","assets/workspace-Bxu48BK2.js","assets/KanbanBoard-CMODmavE.css"])))=>i.map(i=>d[i]);
import{J as ne,K as Se,L as R,n as g,r as D,m as K,M as ue,c as q,N as ce,d as oe,O as je,i as A,e,g as se,y as te,b as j,h as H,w as B,f as I,B as ae,T as Ke,t as F,P as ze,o as V,Q as it,R as dt,q as ut,S as ct,A as G,U as xe,V as Ae,H as pt,_ as mt,W as Ze,j as de,X as He,Y as gt,Z as ft,a as Ge,$ as vt,a0 as yt,a1 as bt,a2 as kt,F as Ue,C as Fe,a3 as Le,a4 as Me,p as xt}from"./index-Dp_Ec3Oc.js";import{K as St,D as Ct}from"./KanbanSkeleton-CTfeYFCh.js";import{_ as _t}from"./SearchBar.vue_vue_type_script_setup_true_lang-EOSfS2XM.js";import{_ as wt}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-CU_4zkLZ.js";import{u as ht}from"./workspace-Bxu48BK2.js";import"./index-BPTSWC-U.js";const Tt="data:image/svg+xml,%3csvg%20width='60'%20height='46'%20viewBox='0%200%2060%2046'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20opacity='0.4'%3e%3cpath%20d='M59.7443%2034.8967L50.5682%2025.7206C50.4457%2025.5984%2050.2897%2025.5152%2050.1199%2025.4816C49.9501%2025.4479%2049.7742%2025.4653%2049.6143%2025.5315C49.4544%2025.5976%2049.3176%2025.7097%2049.2213%2025.8535C49.125%2025.9973%2049.0734%2026.1664%2049.073%2026.3394V30.517H25.9775V40.5114H49.0755V44.689C49.0759%2044.8621%2049.1275%2045.0312%2049.2238%2045.175C49.3201%2045.3187%2049.4569%2045.4308%2049.6168%2045.497C49.7767%2045.5632%2049.9527%2045.5805%2050.1224%2045.5468C50.2922%2045.5132%2050.4482%2045.43%2050.5708%2045.3078L59.7468%2036.1318C59.9095%2035.9672%2060.0005%2035.7451%2060.0001%2035.5137C59.9996%2035.2823%2059.9076%2035.0605%2059.7443%2034.8967Z'%20fill='%23C6DBA9'/%3e%3cpath%20d='M32.3149%2030.5293C30.664%2031.5967%2028.7394%2032.1633%2026.7734%2032.1609V40.5237H34.7295C39.2829%2038.5638%2042.9649%2035.0102%2045.0851%2030.5293H32.3149Z'%20fill='url(%23paint0_linear_250_16424)'/%3e%3cpath%20d='M46.2209%2020.2832C46.2317%2015.0884%2044.2448%2010.0884%2040.6714%206.3179C37.0981%202.54738%2032.2119%200.295026%2027.024%200.0269855C21.8362%20-0.241055%2016.7439%201.49574%2012.801%204.87791C8.85809%208.26009%206.36647%2013.0287%205.84178%2018.1969L2.46233%2017.8913C2.31055%2017.8782%202.15829%2017.9103%202.02467%2017.9835C1.89106%2018.0566%201.78205%2018.1677%201.71134%2018.3026C1.64063%2018.4376%201.61138%2018.5904%201.62726%2018.7419C1.64313%2018.8934%201.70343%2019.0368%201.80058%2019.1542L9.51927%2028.406C9.79205%2028.7344%2010.277%2028.7773%2010.378%2028.5045L19.6298%2020.7833C20.3876%2020.3413%2020.1173%2019.4825%2019.4328%2019.4194L15.8008%2019.091C16.0297%2017.1283%2016.8213%2015.2735%2018.0802%2013.7503C19.3391%2012.2271%2021.0115%2011.1004%2022.8961%2010.5059C24.7806%209.9114%2026.7969%209.8745%2028.7019%2010.3996C30.6069%2010.9248%2032.3195%2011.9896%2033.6332%2013.4657C34.947%2014.9419%2035.8059%2016.7664%2036.1065%2018.7195C36.4071%2020.6726%2036.1365%2022.6709%2035.3274%2024.4738C34.5183%2026.2766%2033.2051%2027.8071%2031.5462%2028.8807C29.8872%2029.9544%2027.9531%2030.5254%2025.977%2030.5251H25.9283V40.5094C31.2249%2040.4031%2036.7093%2038.2263%2040.4202%2034.4455C44.1311%2030.6648%2046.2134%2025.5808%2046.2209%2020.2832Z'%20fill='%23D7A39E'/%3e%3cpath%20d='M25.9773%2030.5293H0V40.5237H25.9773V30.5293Z'%20fill='url(%23paint1_linear_250_16424)'/%3e%3c/g%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_250_16424'%20x1='6.53714'%20y1='35.5252'%20x2='47.0198'%20y2='35.5252'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%236C798F'/%3e%3cstop%20offset='1'%20stop-color='%236C798F'%20stop-opacity='0.1'/%3e%3c/linearGradient%3e%3clinearGradient%20id='paint1_linear_250_16424'%20x1='0'%20y1='36'%20x2='26'%20y2='36'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23E8D4D3'%20stop-opacity='0'/%3e%3cstop%20offset='1'%20stop-color='%23E2A39F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",Je="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='20'%20height='20'%20rx='3.33333'%20fill='%2329BF7F'/%3e%3cpath%20d='M6.43164%2014.3018L9.29004%2012.167L9.29102%2012.166C9.47176%2012.0328%209.69053%2011.9609%209.91504%2011.9609C10.0834%2011.9609%2010.2482%2012.0017%2010.3965%2012.0781L10.5391%2012.166L10.54%2012.167L13.373%2014.291V5.91699H6.43164V14.3018ZM14.4316%2014.3789C14.4277%2014.5672%2014.3725%2014.7506%2014.2725%2014.9102C14.1723%2015.0699%2014.0303%2015.1996%2013.8623%2015.2852C13.6944%2015.3706%2013.5064%2015.4094%2013.3184%2015.3965C13.1304%2015.3835%2012.9495%2015.3196%2012.7949%2015.2119L12.79%2015.208L9.91504%2013.0518L7.01465%2015.209C6.83427%2015.3432%206.61546%2015.4161%206.39062%2015.417H6.38965C6.2298%2015.4164%206.07171%2015.38%205.92773%2015.3105V15.3096C5.75087%2015.2261%205.60123%2015.0946%205.49609%2014.9297C5.3907%2014.7642%205.33364%2014.5721%205.33301%2014.376V5.87402C5.3338%205.7361%205.36234%205.59971%205.41602%205.47266C5.46971%205.3456%205.54812%205.23049%205.64648%205.13379C5.74485%205.0371%205.86131%204.96069%205.98926%204.90918C6.1165%204.85797%206.2525%204.83272%206.38965%204.83398V4.83301H13.3906C13.6661%204.83457%2013.9302%204.94494%2014.125%205.13965C14.3198%205.33446%2014.4301%205.59852%2014.4316%205.87402V14.3789Z'%20fill='white'%20stroke='white'%20stroke-width='0.333333'/%3e%3c/svg%3e",Vt=(l,o={})=>Se({queryKey:["sprint-list"],queryFn:({signal:f})=>R({url:`sprints/${l}`,method:"GET",signal:f}),...o}),Dt=(l,o={})=>Se({queryKey:["sprint-cards",l],queryFn:({signal:f})=>R({url:`sprints/${g(l)}/backlog`,method:"GET",signal:f}),...o}),$t=(l,o={})=>Se({queryKey:["sprint-kanban",l],queryFn:({signal:f})=>R({url:`workspace/cards/sprintgrouped?sprint_id=${g(l)}&variable_id=68b6c96e0a95eef7d14e6981`,method:"GET",signal:f}),...o}),Lt=(l,o={})=>ne({key:["sprint-complete"]},{mutationFn:f=>R({url:`sprints/${g(l)}/complete`,method:"POST",data:f.payload}),...o}),Mt=(l,o={})=>Se({queryKey:["sprint-detail",l],queryFn:({signal:f})=>R({url:`sprints/detail/${g(l)}?include_cards=true`,method:"GET",signal:f}),...o}),Ee=(l,o={})=>Se({queryKey:["backlog-list",l],queryFn:({signal:f})=>R({url:`sprints/workspace/${g(l)}/cards?include_sprint_cards=false`,method:"GET",signal:f}),...o}),Pt=(l={})=>ne({key:["add-sprint"]},{mutationFn:o=>R({url:"/sprints",method:"POST",data:o.payload}),...l}),Qe=(l={})=>ne({key:["move-card-to-sprint"]},{mutationFn:o=>R({url:`/sprints/${o.id}/cards`,method:"POST",data:o.payload}),...l}),Ne=(l={})=>ne({key:["add-sprint"]},{mutationFn:o=>R({url:`/sprints/${o.id}`,method:"PUT",data:o.payload}),...l}),Bt=(l={})=>ne({key:["start-sprint"]},{mutationFn:o=>R({url:`/sprints/${o.id}/start`,method:"POST",data:o.payload}),...l}),Ot=(l={})=>ne({key:["delete-sprint"]},{mutationFn:o=>R({url:`/sprints/${o}`,method:"DELETE"}),...l}),Ut=(l={})=>ne({key:["remove-card-from-sprint"]},{mutationFn:o=>R({url:`sprints/${g(o.sprintId)}/cards/remove `,method:"POST",data:{card_ids:[o.cardId]}}),...l}),We="jira-like:";function qe(l="id"){return`${l}_${Math.random().toString(36).slice(2,9)}`}function Ie(l,o){try{localStorage.setItem(We+l,JSON.stringify(o))}catch{}}function Re(l,o){try{const f=localStorage.getItem(We+l);return f?JSON.parse(f):o}catch{return o}}function Xe(l){switch(l){case"Highest":return"rounded-md bg-red-50 px-2 py-0.5 text-xs text-red-700";case"High":return"rounded-md bg-orange-50 px-2 py-0.5 text-xs text-orange-700";case"Medium":return"rounded-md bg-amber-50 px-2 py-0.5 text-xs text-amber-700";case"Low":return"rounded-md bg-gray-100 px-2 py-0.5 text-xs text-gray-600"}}function Ye(){const l=D(Re("backlog",[])),o=D(Re("sprints",[]));if(o.value.length===0)o.value.push({id:qe("sprint"),name:"Sprint 1",goal:"",start:"",end:"",started:!1,tickets:[]});else if(o.value.length>1){for(let a=1;a<o.value.length;a++)l.value.push(...o.value[a].tickets);o.value=[o.value[0]]}const f=D(o.value[0].id);K([l,o],()=>{Ie("backlog",l.value),Ie("sprints",o.value)},{deep:!0});const $=D([]),_=ue({}),c=q(()=>l.value.length>0&&$.value.length===l.value.length),k=a=>{var n;const s=o.value.find(p=>p.id===a);return!!s&&s.tickets.length>0&&(((n=_[a])==null?void 0:n.length)||0)===s.tickets.length};function h(a,s,n){const p=s.target.checked;if(a==="backlog")$.value=p?l.value.map(w=>w.id):[];else if(n){const w=o.value.find(v=>v.id===n);_[n]=p&&w?w.tickets.map(v=>v.id):[]}}function L(a,s,n,p){const w=n.target.checked,v=a==="backlog"?$.value:_[p]||(_[p]=[]);if(w&&!v.includes(s)&&v.push(s),!w){const P=v.indexOf(s);P>=0&&v.splice(P,1)}}function m(){return o.value.find(a=>a.id===f.value)||o.value[0]}function u(){const s=[...l.value,...o.value.flatMap(p=>p.tickets)].map(p=>Number(String(p.key).replace(/[^0-9]/g,""))).filter(p=>!Number.isNaN(p));return`PRJ-${s.length?Math.max(...s)+1:1}`}const{mutate:x}=Qe({onSuccess:()=>{ce.success("Cards moved to sprint successfully")},onError:a=>{ce.error("Failed to move cards: "+(a.message||"Unknown error"))}});function y(){var p,w;const a=m();if(!a||!$.value.length)return;const s=[],n=[];for(const v of l.value)($.value.includes(v.id)?n:s).push(v);l.value=s,a.tickets.push(...n),$.value=[],n.length>0&&x({id:a.id,payload:{card_ids:n.map(v=>v.id),priority:((w=(p=n[0])==null?void 0:p.priority)==null?void 0:w.toLowerCase())||"medium",story_points:n.reduce((v,P)=>v+(P.storyPoints||0),0)}})}function T(a){const s=o.value.find(v=>v.id===a);if(!s)return;const n=_[a]||[],p=[],w=[];for(const v of s.tickets)(n.includes(v.id)?w:p).push(v);s.tickets=p,l.value.push(...w),_[a]=[]}function U(a,s){if(a==="backlog")l.value=l.value.filter(n=>!$.value.includes(n.id)),$.value=[];else if(s){const n=_[s]||[],p=o.value.find(w=>w.id===s);if(!p)return;p.tickets=p.tickets.filter(w=>!n.includes(w.id)),_[s]=[]}}function C(a,s){const n={id:qe("T"),key:u(),createdAt:new Date().toISOString(),...s};if(a==="backlog")l.value.push(n);else{const p=m();p==null||p.tickets.push(n)}}function t(a){const s=m();s&&(s.name=a.name??s.name,s.goal=a.goal??s.goal,s.start=a.start??s.start,s.end=a.end??s.end)}function r(){const a=m();a&&(a.started=!a.started)}function b(a){return a.tickets.reduce((s,n)=>s+(n.storyPoints||0),0)}return{backlog:l,sprints:o,activeSprintId:f,selectedBacklogIds:$,selectedSprintIds:_,allBacklogChecked:c,allSprintChecked:k,toggleAll:h,toggleOne:L,getActiveSprint:m,createTicket:C,saveSprintMeta:t,toggleStartSprint:r,sprintPoints:b,moveSelectedToSprint:y,moveSelectedToBacklog:T,deleteSelected:U,priorityClass:Xe}}const Et={class:"space-y-3 flex flex-col overflow-y-auto"},At={key:0,class:"empty-state flex flex-col justify-center items-center h-full"},Ht={class:"flex items-center gap-2 text-text-secondary float-start"},Ft={class:"inline-block rounded-full px-2 py-0.5 text-xs"},Nt={class:"truncate"},qt={key:0,class:"float-end flex justify-center text-gray-500 items-center text-xs aspect-square max-w-6 min-h-6 bg-gray-500/10 rounded-full"},It={key:1,class:"text-xs aspect-square max-w-6 flex justify-center items-center text-center min-h-6 bg-accent/30 text-accent border-accent border rounded-full"},Rt=["onDragstart"],jt=oe({__name:"BacklogTable",props:{sorters:{}},emits:["ticket-dragged-to-sprint","open-ticket","ticket-moved-to-backlog"],setup(l,{emit:o}){const f=o,{workspaceId:$}=je(),{data:_,isPending:c}=Ee($),k=D([]);K(_,C=>{C!=null&&C.cards&&(k.value=C.cards.map(t=>{var n,p,w,v,P;const r=((n=t.card)==null?void 0:n.variables)??{},b=((p=t.card)==null?void 0:p._id)??t.card_id,a=String(r["card-status"]??"").trim(),s=String(r.priority??"").trim();return{id:b,key:r["card-code"]||(b==null?void 0:b.slice(-6))||"PRJ-?",summary:r["card-title"]||"(untitled)",type:"Story",status:a,assignee:((v=(w=t.card)==null?void 0:w.assigned_to)==null?void 0:v.name)??"Unassigned",storyPoints:Number(t.story_points??0)||0,priority:L(s),createdAt:((P=t.card)==null?void 0:P.created_at)??new Date().toISOString(),description:r["card-description"]||""}}))},{immediate:!0});function h(C){const t=C.toLowerCase();switch(t.trim()){case"todo":return"bg-gray-500/10 text-gray-500";case"to do":return"bg-gray-500/10 text-gray-500";case"in progress":return"bg-gray-amber/10 text-amber-500";case"done":return"bg-green-500/10 text-green-500"}return t.includes("progress")?"In Progress":t.includes("done")||t.includes("complete")?"Done":"Todo"}function L(C){const t=String(C??"").toLowerCase();return t==="highest"||t==="blocker"||t==="critical"?"Highest":t==="high"||t==="major"?"High":t==="medium"||t==="normal"?"Medium":"Low"}const m=D(!1),u=D(null);function x(C,t,r){var a;u.value=t.id;const b=JSON.stringify({id:t.id,from:r,ticket:t});(a=C.dataTransfer)==null||a.setData("text/plain",b),C.dataTransfer&&(C.dataTransfer.effectAllowed="move")}function y(C){var t;m.value=!1,((t=C.dataTransfer)==null?void 0:t.dropEffect)!=="none"&&u.value&&(k.value=k.value.filter(r=>r.id!==u.value)),u.value=null}function T(C){var t;C.preventDefault(),m.value=!1;try{const r=(t=C.dataTransfer)==null?void 0:t.getData("text/plain");if(!r)return;const b=JSON.parse(r);if(b.from!=="sprint"||k.value.some(s=>s.id===b.id))return;k.value.push(b.ticket),f("ticket-moved-to-backlog",b.id,b.sprintId)}catch(r){console.error("Drop error:",r)}}const U=q(()=>[{key:"summary",label:"Summary",sortable:!1},{key:"status",label:"Status",width:120,sortable:!1},{key:"assignee",label:"",width:120,sortable:!1}]);return(C,t)=>(V(),A("section",Et,[e("div",{class:te(["rounded-lg border h-[300px] border-border flex flex-col",m.value?"ring-2 ring-blue-400":""]),onDragover:t[4]||(t[4]=se(()=>{},["prevent"])),onDragenter:t[5]||(t[5]=r=>m.value=!0),onDragleave:t[6]||(t[6]=r=>m.value=!1),onDrop:t[7]||(t[7]=r=>T(r))},[!g(c)&&k.value.length===0?(V(),A("div",At,[t[9]||(t[9]=e("img",{src:Tt,class:"mb-4",alt:"backlog-plan"},null,-1)),t[10]||(t[10]=e("h6",{class:"text-sm text-text-primary font-semibold mb-1"},"Get started in the backlog",-1)),t[11]||(t[11]=e("p",{class:"text-sm text-text-primary/90 mb-3"},"Plan and start a sprint to see issues here.",-1)),H(ae,null,{default:B(()=>t[8]||(t[8]=[I("Add Task Backlog")])),_:1,__:[8]})])):(V(),j(Ke,{key:1,showHeader:!1,pagination:!1,class:"flex-grow h-full",rowDraggable:!0,onRowDragstart:t[1]||(t[1]=({row:r,$event:b})=>x(b,r,"backlog")),onRowDragend:t[2]||(t[2]=({$event:r})=>y(r)),columns:U.value,rows:k.value,"page-size":20,hover:!0,itemKey:r=>r.id,sorters:C.sorters,onRowClick:t[3]||(t[3]=({row:r})=>C.$emit("open-ticket",r))},{summary:B(({row:r})=>[e("div",Ht,[t[12]||(t[12]=e("img",{src:Je,alt:""},null,-1)),e("span",Ft,F(r.key),1),e("span",Nt,F(r.summary),1)])]),status:B(({row:r})=>[e("span",{class:te([h(r.status),"px-2 py-1 rounded-md"])},F(r.status),3)]),assignee:B(({row:r})=>[r.assignee=="Unassigned"?(V(),A("span",qt,"UA")):(V(),A("span",It,F(g(ze)(r.assignee)),1))]),drag:B(({row:r})=>[e("button",{class:"cursor-grab",title:"Drag to Sprint",draggable:"",onClick:t[0]||(t[0]=se(()=>{},["stop"])),onDragstart:b=>x(b,r,"backlog"),onDragend:y},"↕",40,Rt)]),_:1},8,["columns","rows","itemKey","sorters"]))],34)]))}}),Kt="data:image/svg+xml,%3csvg%20width='60'%20height='60'%20viewBox='0%200%2060%2060'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20opacity='0.4'%3e%3cpath%20d='M9.375%2030C11.6402%2030%2013.4766%2028.1637%2013.4766%2025.8984C13.4766%2023.6332%2011.6402%2021.7969%209.375%2021.7969C7.10977%2021.7969%205.27344%2023.6332%205.27344%2025.8984C5.27344%2028.1637%207.10977%2030%209.375%2030Z'%20fill='%23AE2A19'/%3e%3cpath%20d='M26.25%2024.375C28.5152%2024.375%2030.3516%2022.5387%2030.3516%2020.2734C30.3516%2018.0082%2028.5152%2016.1719%2026.25%2016.1719C23.9848%2016.1719%2022.1484%2018.0082%2022.1484%2020.2734C22.1484%2022.5387%2023.9848%2024.375%2026.25%2024.375Z'%20fill='%23BF63F3'/%3e%3cpath%20d='M15.3931%2035.8594H11.0159V33.0938C9.93587%2033.3387%208.81469%2033.3387%207.73465%2033.0938V35.8594H1.87528C1.55115%2035.8601%201.2345%2035.9568%200.965283%2036.1373C0.696064%2036.3178%200.486343%2036.574%200.362583%2036.8736C0.238824%2037.1731%200.206573%2037.5027%200.269899%2037.8205C0.333226%2038.1384%200.489292%2038.4304%200.718404%2038.6597L7.05872%2045L0.718404%2051.3403C0.489292%2051.5696%200.333226%2051.8616%200.269899%2052.1795C0.206573%2052.4973%200.238824%2052.8269%200.362583%2053.1264C0.486343%2053.426%200.696064%2053.6822%200.965283%2053.8627C1.2345%2054.0432%201.55115%2054.1399%201.87528%2054.1406H15.3931L21.7503%2045L15.3931%2035.8594Z'%20fill='%2382B536'/%3e%3cpath%20d='M34.4562%2035.8594H27.8937V27.4688C26.8137%2027.7138%2025.6925%2027.7138%2024.6125%2027.4688V35.8594H19.3896L25.7487%2045L19.3896%2054.1406H34.4562L40.8143%2045L34.4562%2035.8594Z'%20fill='%2382B536'/%3e%3cpath%20d='M43.8281%2019.6875H55.3125C55.7475%2019.6873%2056.1647%2019.5143%2056.4723%2019.2067C56.7799%2018.8991%2056.9529%2018.4819%2056.9531%2018.0469V9.375C56.9529%208.93996%2056.7799%208.5228%2056.4723%208.21518C56.1647%207.90755%2055.7475%207.73462%2055.3125%207.73438H43.8281V7.5C43.8281%207.06488%2043.6553%206.64758%2043.3476%206.3399C43.0399%206.03223%2042.6226%205.85938%2042.1875%205.85938C41.7524%205.85938%2041.3351%206.03223%2041.0274%206.3399C40.7197%206.64758%2040.5469%207.06488%2040.5469%207.5V32.5781H43.8281V19.6875Z'%20fill='%23FCA700'/%3e%3cpath%20d='M59.2843%2043.8403L51.7843%2036.3403C51.6322%2036.1878%2051.4514%2036.0668%2051.2524%2035.9842C51.0534%2035.9017%2050.8401%2035.8593%2050.6246%2035.8594H38.4521L44.8121%2045L38.4531%2054.1406H50.6246C50.8401%2054.1407%2051.0534%2054.0983%2051.2524%2054.0158C51.4514%2053.9332%2051.6322%2053.8122%2051.7843%2053.6597L59.2843%2046.1597C59.4368%2046.0075%2059.5577%2045.8267%2059.6402%2045.6277C59.7228%2045.4287%2059.7652%2045.2154%2059.7652%2045C59.7652%2044.7846%2059.7228%2044.5713%2059.6402%2044.3723C59.5577%2044.1733%2059.4368%2043.9925%2059.2843%2043.8403Z'%20fill='%2382B536'/%3e%3c/g%3e%3c/svg%3e",zt={class:"rounded-lg flex flex-col"},Zt=["checked"],Gt=["checked","onChange"],Jt={class:"flex items-center gap-2 text-text-secondary float-start"},Qt={class:"inline-block rounded-full px-2 py-0.5 text-xs"},Wt={class:"truncate"},Xt={key:0,class:"float-end flex justify-center text-gray-500 items-center text-xs aspect-square max-w-6 min-h-6 bg-gray-500/10 rounded-full"},Yt={key:1,class:"text-xs aspect-square max-w-6 flex justify-center items-center text-center min-h-6 bg-accent/30 text-accent border-accent border rounded-full"},es=["onDragstart"],ts={key:1,class:"empty-state flex flex-col h-full justify-center items-center border-dashed border border-border"},ss=oe({__name:"SprintCard",props:{sprint:{},sprintId:{}},emits:["edit-sprint","toggle-start","open-ticket","move-selected-to-backlog","delete-selected-sprint","refresh"],setup(l,{emit:o}){const f=l;K(f,a=>{console.log("props changes",a)});const $=o,_=Ye(),{selectedSprintIds:c,allSprintChecked:k,toggleAll:h,toggleOne:L}=_,m=D([]);K(()=>f.sprint.tickets,a=>{m.value=[...a||[]]},{immediate:!0,deep:!0});const u=D(!1),x=D(null),{mutate:y}=Qe({onSuccess:()=>{ce.success("Card moved to sprint successfully"),$("refresh")},onError:a=>{ce.error("Failed to move card: "+(a.message||"Unknown error"))}});function T(a,s,n,p){var v;x.value=s.id;const w=JSON.stringify({id:s.id,from:n,sprintId:p,ticket:s});(v=a.dataTransfer)==null||v.setData("text/plain",w),a.dataTransfer&&(a.dataTransfer.effectAllowed="move")}function U(a){var s;u.value=!1,((s=a.dataTransfer)==null?void 0:s.dropEffect)!=="none"&&x.value&&(m.value=m.value.filter(n=>n.id!==x.value)),x.value=null}function C(){u.value=!0}function t(){u.value=!1}function r(a){var s;a.preventDefault(),u.value=!1;try{const n=(s=a.dataTransfer)==null?void 0:s.getData("text/plain");if(!n)return;const p=JSON.parse(n);if(p.from!=="backlog"||m.value.some(v=>v.id===p.id))return;m.value.push(p.ticket),y({id:f.sprintId,payload:{card_ids:[p.ticket.id],priority:p.ticket.priority.toLowerCase(),story_points:p.ticket.storyPoints||0}})}catch(n){console.error("Drop error:",n)}}const b=[{key:"summary",label:"Summary",sortable:!0},{key:"status",label:"Status",width:120,sortable:!0},{key:"assignee",label:"Assignee",width:120,sortable:!0}];return(a,s)=>(V(),A("div",zt,[e("div",{class:te(["h-[300px]",u.value?"ring-2 ring-blue-400 rounded-lg":""]),onDragover:s[5]||(s[5]=se(()=>{},["prevent"])),onDragenter:C,onDragleave:t,onDrop:r},[m.value.length>0?(V(),j(Ke,{key:0,showHeader:!1,pagination:!1,"row-draggable":!0,class:"h-full",onRowDragstart:s[2]||(s[2]=({row:n,$event:p})=>T(p,n,"sprint",a.sprint.id)),onRowDragend:s[3]||(s[3]=({$event:n})=>U(n)),columns:b,rows:m.value,"page-size":100,hover:!0,"item-key":n=>n.id,onRowClick:s[4]||(s[4]=({row:n})=>a.$emit("open-ticket",n))},{"select-header":B(()=>[e("input",{type:"checkbox",checked:g(k)(a.sprint.id),onChange:s[0]||(s[0]=n=>g(h)("sprint",n,a.sprint.id))},null,40,Zt)]),select:B(({row:n})=>[e("input",{type:"checkbox",checked:(g(c)[a.sprint.id]||[]).includes(n.id),onChange:p=>g(L)("sprint",n.id,p,a.sprint.id)},null,40,Gt)]),summary:B(({row:n})=>[e("div",Jt,[s[6]||(s[6]=e("img",{src:Je,alt:""},null,-1)),e("span",Qt,F(n.key),1),e("span",Wt,F(n.summary),1)])]),status:B(({row:n})=>[e("span",{class:te([g(it)(n.status),"px-2 py-1 rounded-md"])},F(n.status),3)]),assignee:B(({row:n})=>[n.assignee=="Unassigned"?(V(),A("span",Xt,"UA")):(V(),A("span",Yt,F(g(ze)(`${n.assignee}`)),1))]),priority:B(({row:n})=>[e("span",{class:te(g(Xe)(n.priority))},F(n.priority),3)]),drag:B(({row:n})=>[e("button",{class:"cursor-grab",title:"Drag to Backlog",draggable:"",onClick:s[1]||(s[1]=se(()=>{},["stop"])),onDragstart:p=>T(p,n,"sprint",a.sprint.id),onDragend:U},"↕",40,es)]),_:1},8,["rows","item-key"])):(V(),A("div",ts,s[7]||(s[7]=[dt('<img src="'+Kt+'" class="mb-4" alt="backlog-plan"><h6 class="text-sm text-text-primary font-semibold mb-1 text-center">Plan your sprint</h6><p class="text-sm text-text-primary/90 mb-3 max-w-120 text-center">Drag work items from the <span class="font-bold"> Backlog </span> section or create new ones to plan the work for this sprint. Select <span class="font-bold">Start sprint</span> when you&#39;re ready.</p>',3)])))],34)]))}}),as={class:"text-lg font-semibold"},ns={class:"grid grid-cols-1 gap-3"},os={class:"space-y-1"},rs={class:"grid grid-cols-2 gap-3"},ls={class:"space-y-1"},is={class:"space-y-1"},ds={class:"grid grid-cols-2 gap-3"},us={class:"space-y-1"},cs={class:"space-y-1"},ps={class:"space-y-1"},ms=oe({__name:"TicketModal",props:{modelValue:{type:Boolean},editing:{type:Boolean},ticket:{}},emits:["update:modelValue","save","close"],setup(l,{emit:o}){const f=l,$=o,_=D(),c=ue({type:"Story",priority:"Medium",storyPoints:1,status:"Todo"});function k(){var m;(m=_.value)==null||m.showModal()}function h(){var m;(m=_.value)==null||m.close(),$("update:modelValue",!1)}K(()=>f.modelValue,m=>{m?k():h()}),K(()=>f.ticket,m=>{Object.assign(c,{summary:"",type:"Story",priority:"Medium",storyPoints:1,status:"Todo",assignee:"",description:""}),m&&Object.assign(c,m)});function L(){var m;(m=c.summary)!=null&&m.trim()&&($("save",{...c}),h())}return ut(()=>{f.modelValue&&k()}),ct(h),(m,u)=>(V(),A("dialog",{ref_key:"dlg",ref:_,class:"modal",onClose:u[7]||(u[7]=x=>m.$emit("close"))},[e("form",{method:"dialog",class:"modal-box max-w-lg space-y-4",onSubmit:u[6]||(u[6]=se(()=>{},["prevent"]))},[e("h3",as,F(m.editing?"Edit":"Create")+" Ticket",1),e("div",ns,[e("label",os,[u[8]||(u[8]=e("span",{class:"text-sm"},"Summary",-1)),G(e("input",{"onUpdate:modelValue":u[0]||(u[0]=x=>c.summary=x),class:"w-full rounded-md border px-3 py-2",placeholder:"As a user, I want…"},null,512),[[xe,c.summary]])]),e("div",rs,[e("label",ls,[u[10]||(u[10]=e("span",{class:"text-sm"},"Type",-1)),G(e("select",{"onUpdate:modelValue":u[1]||(u[1]=x=>c.type=x),class:"w-full rounded-md border px-3 py-2"},u[9]||(u[9]=[e("option",null,"Story",-1),e("option",null,"Bug",-1),e("option",null,"Task",-1)]),512),[[Ae,c.type]])]),e("label",is,[u[12]||(u[12]=e("span",{class:"text-sm"},"Priority",-1)),G(e("select",{"onUpdate:modelValue":u[2]||(u[2]=x=>c.priority=x),class:"w-full rounded-md border px-3 py-2"},u[11]||(u[11]=[e("option",null,"Highest",-1),e("option",null,"High",-1),e("option",null,"Medium",-1),e("option",null,"Low",-1)]),512),[[Ae,c.priority]])])]),e("div",ds,[e("label",us,[u[13]||(u[13]=e("span",{class:"text-sm"},"Story Points",-1)),G(e("input",{type:"number",min:"0","onUpdate:modelValue":u[3]||(u[3]=x=>c.storyPoints=x),class:"w-full rounded-md border px-3 py-2"},null,512),[[xe,c.storyPoints,void 0,{number:!0}]])]),e("label",cs,[u[14]||(u[14]=e("span",{class:"text-sm"},"Assignee",-1)),G(e("input",{"onUpdate:modelValue":u[4]||(u[4]=x=>c.assignee=x),class:"w-full rounded-md border px-3 py-2",placeholder:"Unassigned"},null,512),[[xe,c.assignee]])])]),e("label",ps,[u[15]||(u[15]=e("span",{class:"text-sm"},"Description",-1)),G(e("textarea",{"onUpdate:modelValue":u[5]||(u[5]=x=>c.description=x),class:"w-full rounded-md border px-3 py-2",rows:"3"},null,512),[[xe,c.description]])])]),e("div",{class:"modal-action"},[e("button",{type:"button",class:"rounded-md border px-3 py-1.5",onClick:h},"Cancel"),e("button",{type:"button",class:"rounded-md bg-blue-600 px-3 py-1.5 text-white",onClick:L},"Save")])],32)],544))}}),gs=pt(ms,[["__scopeId","data-v-124bfadf"]]),fs={class:"px-6 gap-4"},vs={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},ys=oe({__name:"SprintModal",props:{modelValue:{type:Boolean,default:!1},sprint:{},creatingSprint:{type:Boolean}},emits:["update:modelValue","save","close"],setup(l,{emit:o}){const f=o,$=l,_=q({get:()=>$.modelValue,set:y=>f("update:modelValue",y)}),c=ue({name:""}),k=ue({name:!1}),h=q(()=>k.name&&!String(c.name||"").trim()?"Name is required":""),L=q(()=>!!String(c.name||"").trim()&&!h.value);function m(){_.value=!1,f("close")}function u(){k.name=!0,L.value&&f("save",{name:String(c.name||"").trim()})}function x(){k.name=!1}return K(()=>$.sprint,y=>{if(!y){c.name="";return}c.name=y.name??(y==null?void 0:y.title)??"",x()},{immediate:!0}),(y,T)=>(V(),j(Ze,{modelValue:_.value,"onUpdate:modelValue":T[2]||(T[2]=U=>_.value=U),modalClass:"!py-0",size:"md"},{default:B(()=>[T[5]||(T[5]=e("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[e("h2",{class:"text-xl font-semibold"},"Add Sprint"),e("p",{class:"text-sm text-text-secondary mt-1"},[I(" Add sprint name and then click "),e("span",{class:"font-medium"},"Save"),I(". ")])],-1)),e("div",fs,[H(mt,{modelValue:c.name,"onUpdate:modelValue":T[0]||(T[0]=U=>c.name=U),label:"Name",placeholder:"Sprint 1",error:!!h.value,message:h.value,onBlur:T[1]||(T[1]=U=>k.name=!0)},null,8,["modelValue","error","message"]),T[3]||(T[3]=e("div",null,null,-1))]),e("div",vs,[H(ae,{variant:"secondary",onClick:m},{default:B(()=>T[4]||(T[4]=[I("Cancel")])),_:1,__:[4]}),H(ae,{variant:"primary",disabled:!L.value,onClick:u},{default:B(()=>[I(F(y.creatingSprint?"Saving...":"Save"),1)]),_:1},8,["disabled"])])]),_:1,__:[5]},8,["modelValue"]))}}),bs={class:"px-6 grid grid-cols-2 gap-4"},ks={class:"flex gap-1 flex-col"},xs={key:0,class:"text-xs text-red-500"},Ss={class:"flex gap-1 flex-col"},Cs={key:0,class:"text-xs text-red-500"},_s={class:"flex flex-col col-span-2"},ws={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},hs=oe({__name:"StartSprintModal",props:{modelValue:{type:Boolean,default:!1},sprint:{},creatingSprint:{type:Boolean}},emits:["update:modelValue","save","close"],setup(l,{emit:o}){const f=o,$=l,_=q({get:()=>$.modelValue,set:t=>f("update:modelValue",t)}),c=ue({goal:"",start:"",end:""});K(()=>$.sprint,t=>{t&&(c.goal=t.goal??"",c.start=t.start??"",c.end=t.end??"",U())},{immediate:!0});const k=ue({start:!1,end:!1}),h=q(()=>""),L=q(()=>{if(!k.end)return"";if(c.start&&c.end){const t=C(c.start),r=C(c.end);if(Number.isFinite(t)&&Number.isFinite(r)&&r<t)return"End date cannot be before start date"}return""}),m=q(()=>!L.value);function u(t){c.start=t||"",k.start=!0}function x(t){c.end=t||"",k.end=!0}function y(){_.value=!1,f("close")}function T(){k.start=!0,k.end=!0,m.value&&f("save",{goal:c.goal??"",start:c.start||"",end:c.end||""})}function U(){k.start=!1,k.end=!1}function C(t){return t?new Date(`${t}T00:00:00`).getTime():NaN}return(t,r)=>(V(),j(Ze,{modelValue:_.value,"onUpdate:modelValue":r[1]||(r[1]=b=>_.value=b),modalClass:"!py-0",size:"md"},{default:B(()=>[r[6]||(r[6]=e("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[e("h2",{class:"text-xl font-semibold"},"Start Sprint"),e("p",{class:"text-sm text-text-secondary mt-1"},[I(" Update sprint name, goal, and dates, then click "),e("span",{class:"font-medium"},"Start"),I(". ")])],-1)),e("div",bs,[e("div",ks,[r[2]||(r[2]=e("label",{class:"text-sm"},"Start date",-1)),e("div",{class:te(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",h.value?"border-red-500":""])},[H(He,{placeholder:"Set start date",class:"w-full","model-value":c.start,"emit-as":"ymd","onUpdate:modelValue":u},null,8,["model-value"])],2),h.value?(V(),A("p",xs,F(h.value),1)):de("",!0)]),e("div",Ss,[r[3]||(r[3]=e("label",{class:"text-sm"},"End date",-1)),e("div",{class:te(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",L.value?"border-red-500":""])},[H(He,{placeholder:"Set end date",class:"w-full","model-value":c.end,"emit-as":"ymd","onUpdate:modelValue":x},null,8,["model-value"])],2),L.value?(V(),A("p",Cs,F(L.value),1)):de("",!0)]),e("div",_s,[r[4]||(r[4]=e("label",{class:"text-sm"},"Goal (optional)",-1)),G(e("textarea",{"onUpdate:modelValue":r[0]||(r[0]=b=>c.goal=b),class:"w-full rounded-lg border border-border px-3 py-2 bg-bg-input",rows:"2",placeholder:"Ship onboarding flow"},null,512),[[xe,c.goal]])])]),e("div",ws,[H(ae,{variant:"secondary",onClick:y},{default:B(()=>r[5]||(r[5]=[I("Cancel")])),_:1,__:[5]}),H(ae,{variant:"primary",disabled:!m.value,onClick:T},{default:B(()=>[I(F(t.creatingSprint?"Starting...":"Start"),1)]),_:1},8,["disabled"])])]),_:1,__:[6]},8,["modelValue"]))}}),Ts={class:"flex-auto bg-gradient-to-b from-bg-card/95 to-bg-card/90 backdrop-blur rounded-2xl shadow-[0_10px_40px_-10px_rgba(0,0,0,.5)] flex-grow h-full bg-bg-card border border-border overflow-x-auto flex-col flex"},Vs={class:"flex overflow-x-auto gap-3 p-4"},Ds={key:0,class:"mx-auto text-text-secondary/80 m-2 w-[90%] h-full justify-center flex items-center border border-dashed border-border"},$s=oe({__name:"ActiveSprint",props:{sptint_id:{}},setup(l){const o=l,f=Le(()=>Me(()=>import("./CreateTaskModal-DpxeH-Iv.js"),__vite__mapDeps([0,1,2,3]))),$=Le(()=>Me(()=>import("./ConfirmDeleteModal-GwbB0rUl.js"),__vite__mapDeps([4,5,2,3]))),_=Le(()=>Me(()=>import("./SidePanel-TgjrCkek.js"),__vite__mapDeps([6,2,3,7]))),c=Le(()=>Me(()=>import("./KanbanBoard-DnPzG2rY.js"),__vite__mapDeps([8,2,3,9,10,5,11,12]))),k=xt(),{workspaceId:h,moduleId:L}=gt(),{data:m}=ft(h.value,L.value),u=Ge(),{mutate:x,isPending:y}=vt({onSuccess:()=>{u.invalidateQueries({queryKey:["sheet-list"]}),me.value="",Q.value=!1,J.value=!1,Q.value=!1}}),T=S=>{x({workspace_id:h.value,module_id:L.value,variable_id:b.value,value:S})},{data:U}=yt({workspace_id:h,workspace_module_id:L}),C=q(()=>{var S;return U.value?(S=U.value[0])==null?void 0:S._id:""}),t=D(C),r=q(()=>{var S;return m.value?(S=m.value[0])==null?void 0:S._id:""}),b=D(r),a=ht(),s=q(()=>o.sptint_id),{data:n,isPending:p}=$t(s),w=D(!1),v=D(),P=S=>{v.value=S},Ce=bt(),pe=kt();function re(S){S.type=="column"?Ce.mutate({payload:{workspace_id:h.value,workspace_module_id:L.value,variable_id:b.value,moved_value:S.meta.id,new_index:S.meta.newIndex}}):pe.mutate({payload:{workspace_id:h.value,card_id:S.meta.moved._id,group_value:S.meta.fromColumnId,group_variable_id:b.value,new_index:S.meta.newIndex,sheet_id:t.value}})}const Pe=S=>{};K(U,S=>{var M;(S==null?void 0:S.length)>0&&(t.value=(M=S[0])==null?void 0:M._id)});const J=D(!1),me=D(""),ge=S=>{x({workspace_id:k.params.id,module_id:k.params.module_id,new_value:S.title,value:S.oldTitle,variable_id:b.value})},Q=D(!1),z=D(),Be=()=>{x({value:z.value.title,workspace_id:h.value,module_id:L.value,newValue:z.value.title,variable_id:b.value,is_trash:!0})},_e=S=>{Q.value=!0,z.value=S},Oe=S=>{w.value=!0,z.value=S};return(S,M)=>{var Z,le,we,fe,he;return V(),A(Ue,null,[e("div",Ts,[G(H(St,null,null,512),[[Fe,g(p)]]),G(e("div",Vs,[H(g(c),{onOnPlus:Oe,"onDelete:column":M[0]||(M[0]=E=>_e(E)),"onUpdate:column":M[1]||(M[1]=E=>ge(E)),onReorder:re,onAddColumn:T,"onSelect:ticket":P,board:g(n),onOnBoardUpdate:Pe,variable_id:b.value,sheet_id:t.value},{"column-footer":B(E=>{var Te,ie,Ve,De,$e;return[(ie=(Te=g(a))==null?void 0:Te.transitions)!=null&&ie.all_allowed&&!(($e=(De=(Ve=g(a))==null?void 0:Ve.transitions)==null?void 0:De.all_allowed)!=null&&$e.includes(E.column.title))&&g(a).transitions.currentColumn!=E.column.title?(V(),A("div",Ds," Disbale ( you can't drop here )")):de("",!0)]}),_:1},8,["board","variable_id","sheet_id"])],512),[[Fe,!g(p)]])]),H(g($),{onClick:M[2]||(M[2]=se(()=>{},["stop"])),modelValue:Q.value,"onUpdate:modelValue":M[3]||(M[3]=E=>Q.value=E),title:"Delete List",itemLabel:"list",itemName:(Z=z.value)==null?void 0:Z.title,requireMatchText:(le=z.value)==null?void 0:le.title,confirmText:"Delete workspace",cancelText:"Cancel",size:"md",loading:g(y),onConfirm:Be,onCancel:M[4]||(M[4]=()=>{Q.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),w.value?(V(),j(g(f),{selectedVariable:b.value,listId:(we=z.value)==null?void 0:we.title,sheet_id:t.value,key:"createTaskModalKey",modelValue:w.value,"onUpdate:modelValue":M[5]||(M[5]=E=>w.value=E),onSubmit:M[6]||(M[6]=()=>{})},null,8,["selectedVariable","listId","sheet_id","modelValue"])):de("",!0),(fe=v.value)!=null&&fe._id?(V(),j(g(_),{key:1,details:v.value,onClose:M[7]||(M[7]=()=>{P({variables:{}})}),showPanel:!!((he=v.value)!=null&&he._id)},null,8,["details","showPanel"])):de("",!0)],64)}}}),Ls={class:"flex-auto flex-grow h-full bg-bg-card rounded-lg border border-border overflow-x-auto flex-col flex"},Ms={class:"header px-4 py-3 border-b border-border flex items-center justify-between gap-1"},Ps={class:"flex gap-3 items-center"},Bs={key:1,class:"space-y-6 p-4 w-full flex-auto overflow-y-auto"},Os={class:"flex flex-col gap-6"},Us={class:"space-y-4 bg-bg-surface/30 p-4 rounded-md"},Es={class:"flex items-center justify-between"},As={class:"text-sm font-semibold"},Hs={key:0,class:"w-full h-full min-h-[250px] flex justify-center items-center"},Fs={class:"space-y-4 bg-bg-surface/30 p-4 rounded-md"},Ns={class:"flex items-center justify-between"},qs={class:"text-sm font-semibold"},Is={key:0,class:"w-full h-full min-h-[250px] flex justify-center items-center"},Js=oe({__name:"Plan",setup(l){const{workspaceId:o}=je(),f=D(!1),{moveSelectedToSprint:$,moveSelectedToBacklog:_,deleteSelected:c,createTicket:k,saveSprintMeta:h,toggleStartSprint:L}=Ye(),{data:m}=Ee(o),{mutate:u,isPending:x}=Ot({onSuccess:()=>{ie.invalidateQueries({queryKey:["sprint-list"]}),T.value=!1}}),y=D({}),T=D(!1),U=()=>{var d;u((d=y.value)==null?void 0:d._id)},{mutate:C,isPending:t}=Ne({onSuccess:d=>{h({name:d.title}),r({id:P.value}),re.value=!1}}),{mutate:r,isPending:b}=Bt({onSuccess:()=>{pe()}}),a=d=>{console.log("helo",y.value,d),C({id:P.value,payload:{goal:d.goal,start_date:d.start,end_date:d.end}})},{data:s,refetch:n}=Vt(o.value),{refetch:p,isPending:w}=Ee(o),v=q(()=>{var d,i;return(i=(d=s==null?void 0:s.value)==null?void 0:d.sprints[0])==null?void 0:i._id}),P=D(v.value);K(()=>v.value,d=>{P.value=d});const{data:Ce,refetch:pe}=Mt(v),re=D(!1),Pe=()=>{re.value=!0},{data:J,isPending:me}=Dt(P);K(()=>me.value,d=>{console.log(d,me.value,">>>> laoding state changes")});const ge=q(()=>{var Y,W;const d=(Y=J==null?void 0:J.value)==null?void 0:Y.backlog_items;if(!d)return null;const i=(((W=J==null?void 0:J.value)==null?void 0:W.backlog_items)||[]).map(O=>{var ve,ye,be,ke,N;const X=((ve=O==null?void 0:O.card)==null?void 0:ve.variables)||{},ee=((ye=O==null?void 0:O.card)==null?void 0:ye._id)||O.card_id;return{id:ee,key:X["card-code"]||(ee==null?void 0:ee.slice(-6))||"PRJ-?",summary:X["card-title"]||"(untitled)",type:"Story",status:Q(String(X["card-status"]||"").trim()),assignee:((ke=(be=O==null?void 0:O.card)==null?void 0:be.assigned_to)==null?void 0:ke.name)||"Unassigned",storyPoints:Number(O.story_points||0),priority:z(String(X.priority||"").trim()),createdAt:((N=O==null?void 0:O.card)==null?void 0:N.created_at)||new Date().toISOString(),description:X["card-description"]||""}});return{id:d._id,name:d.title||"Sprint 1",title:d.title,goal:"",start:"",end:"",started:!1,tickets:i}});function Q(d){const i=d.toLowerCase();return i.includes("progress")?"In Progress":i.includes("done")||i.includes("complete")?"Done":"Todo"}function z(d){const i=d.toLowerCase();return i==="highest"||i==="blocker"||i==="critical"?"Highest":i==="high"||i==="major"?"High":i==="medium"||i==="normal"?"Medium":"Low"}const{mutate:Be}=Ut({onSuccess:()=>{ce.success("Card removed from sprint successfully"),_e()},onError:d=>{ce.error("Failed to remove card from sprint"),console.error("Failed to remove card from sprint:",d)}});function _e(){n(),p(),pe()}function Oe(d){console.log(">>> moving back to backlog"),P&&Be({sprintId:P,cardId:d})}const S={createdAt:(d,i,Y)=>{const W=new Date(d.createdAt).getTime(),O=new Date(i.createdAt).getTime();return Y==="asc"?W-O:O-W}},M=D(!1),Z=D(null);let le="backlog";function we(){f.value=!0,Z.value=null,le="backlog"}function fe(d){Z.value=d,le="backlog",M.value=!0}function he(d){var i;Z.value?Object.assign(Z.value,d):k(le,{summary:d.summary,type:d.type,status:d.status||"Todo",assignee:((i=d.assignee)==null?void 0:i.trim())||"Unassigned",storyPoints:Number(d.storyPoints)||0,priority:d.priority,description:d.description||""})}const E=D(!1);function Te(){E.value=!0}const ie=Ge(),{mutate:Ve,isPending:De}=Pt({onSuccess:d=>{h({name:d.title}),ie.invalidateQueries({queryKey:["sprint-list"]}),E.value=!1}}),{mutate:$e,isPending:et}=Ne({onSuccess:d=>{h({name:d.title}),ie.invalidateQueries({queryKey:["sprint-list"]}),E.value=!1}});function tt(d){var i;y.value?$e({id:(i=y.value)==null?void 0:i._id,payload:{workspace_id:o.value,title:d.name}}):Ve({payload:{workspace_id:o.value,title:d.name}})}function st(){y.value=null,E.value=!0}function at(d){y.value=d,E.value=!0}function nt(d){y.value=d,T.value=!0}const{mutate:ot,isPending:rt}=Lt(P,{onSuccess:()=>{pe()}}),lt=()=>{ot({})};return(d,i)=>{var Y,W,O,X,ee,ve,ye,be,ke;return V(),A(Ue,null,[e("div",Ls,[e("div",Ms,[H(Ct,{prefix:"View By",modelValue:P.value,"onUpdate:modelValue":i[1]||(i[1]=N=>P.value=N),options:(Y=g(s))==null?void 0:Y.sprints,variant:"secondary",onEditOption:at,onDeleteOption:nt},{more:B(()=>[e("div",{onClick:i[0]||(i[0]=N=>st()),class:"capitalize border-t border-border px-4 py-2 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-1 overflow-hidden overflow-ellipsis text-nowrap"},i[10]||(i[10]=[e("i",{class:"fa-solid fa-plus"},null,-1),I(" Add new ")]))]),_:1},8,["modelValue","options"]),e("div",Ps,[H(_t,{placeholder:"Search in Orchit AI space"}),((W=g(Ce))==null?void 0:W.status)=="active"?(V(),j(ae,{key:0,size:"sm",onClick:lt},{default:B(()=>[I(F(g(rt)?"Ending...":"End"),1)]),_:1})):(V(),j(ae,{key:1,size:"sm",onClick:Pe},{default:B(()=>i[11]||(i[11]=[I("Start Sprint")])),_:1,__:[11]}))])]),((O=g(Ce))==null?void 0:O.status)=="active"?(V(),j($s,{key:0,sptint_id:P.value},null,8,["sptint_id"])):(V(),A("div",Bs,[e("div",Os,[e("section",Us,[e("div",Es,[e("h2",As,"Sprint ("+F((ee=(X=ge.value)==null?void 0:X.tickets)==null?void 0:ee.length)+" Taks)",1)]),g(me)?(V(),A("div",Hs,i[12]||(i[12]=[e("div",{role:"status","aria-label":"Loading",class:"h-10 w-10 rounded-full border-4 border-neutral-700 border-t-transparent animate-spin"},null,-1)]))):(V(),A(Ue,{key:1},[ge.value?(V(),j(ss,{key:0,sprintId:P.value,sprint:ge.value,onOpenTicket:fe,onEditSprint:Te,onToggleStart:g(L),onMoveSelectedToBacklog:g(_),onDeleteSelectedSprint:i[2]||(i[2]=N=>g(c)("sprint",N)),onRefresh:_e},null,8,["sprintId","sprint","onToggleStart","onMoveSelectedToBacklog"])):de("",!0)],64))]),e("section",Fs,[e("div",Ns,[e("h2",qs,"Backlog ("+F((ye=(ve=g(m))==null?void 0:ve.cards)==null?void 0:ye.length)+" Tasks)",1),e("div",{class:"flex items-center gap-2"},[e("button",{class:"w-8 h-8 rounded-md border cursor-pointer aspect-square text-sm border-border hover:bg-gray-50",onClick:we},i[13]||(i[13]=[e("i",{class:"text-text-primary fa-regular fa-plus"},null,-1)]))])]),g(w)?(V(),A("div",Is,i[14]||(i[14]=[e("div",{role:"status","aria-label":"Loading",class:"h-10 w-10 rounded-full border-4 border-neutral-700 border-t-transparent animate-spin"},null,-1)]))):(V(),j(jt,{key:1,sorters:S,onMoveSelectedToSprint:g($),onDeleteSelectedBacklog:i[3]||(i[3]=N=>g(c)("backlog")),onOpenTicket:fe,onTicketMovedToBacklog:Oe},null,8,["onMoveSelectedToSprint"]))])])]))]),H(wt,{onClick:i[4]||(i[4]=se(()=>{},["stop"])),modelValue:T.value,"onUpdate:modelValue":i[5]||(i[5]=N=>T.value=N),title:"Delete Sprint",itemLabel:"Sprint",itemName:(be=y.value)==null?void 0:be.title,requireMatchText:(ke=y.value)==null?void 0:ke.title,confirmText:"Delete Ticket",cancelText:"Cancel",size:"md",loading:g(x),onConfirm:U,onCancel:i[6]||(i[6]=()=>{y.value=null,T.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),H(gs,{modelValue:M.value,"onUpdate:modelValue":i[7]||(i[7]=N=>M.value=N),editing:!!Z.value,ticket:Z.value,onSave:he},null,8,["modelValue","editing","ticket"]),H(ys,{modelValue:E.value,"onUpdate:modelValue":i[8]||(i[8]=N=>E.value=N),onSave:tt,sprint:y.value,creatingSprint:y.value?g(et):g(De)},null,8,["modelValue","sprint","creatingSprint"]),H(hs,{sprint:y.value,modelValue:re.value,"onUpdate:modelValue":i[9]||(i[9]=N=>re.value=N),onSave:a,creatingSprint:g(b)||g(t)},null,8,["sprint","modelValue","creatingSprint"])],64)}}});export{Js as default};
