import{d as Xe,W as Ye,r as m,bk as et,m as U,q as ce,al as tt,M as ve,c as b,Z as st,bl as at,bm as lt,bn as ot,bo as it,bp as nt,a as dt,aa as rt,ah as ut,i as n,b as ct,n as x,e as s,a8 as M,w as _,A as F,C as vt,h as p,a9 as me,g as pe,V as Z,t as c,a1 as mt,aD as pt,j as D,G as fe,bd as ft,F as w,U as he,y as ht,x as j,B as J,f as $,af as xe,o as i,H as xt}from"./index-DKO9vpWs.js";const gt={key:0,class:"flex max-w-[380px] justify-center min-h-[400px] items-center h-full w-full"},bt={class:"flex flex-col max-w-[380px] min-w-[380px] h-full overflow-y-auto bg-gradient-to-b from-bg-card/95 to-bg-card/90 backdrop-blur rounded-2xl shadow-[0_10px_40px_-10px_rgba(0,0,0,.5)] border border-orchit-white/5 overflow-hidden",role:"complementary","aria-label":"Details panel"},_t={class:"sticky top-0 z-10 backdrop-blur-2xl border-b border-orchit-white/5 px-6 py-4 flex items-center justify-between"},wt={class:"py-5 px-6 flex flex-col gap-5 flex-grow"},yt={class:"capitalize"},kt=["onKeydown"],Ct=["innerHTML"],St={key:1,class:"opacity-60"},Dt={key:"tab-details",class:"space-y-6"},Vt={class:"grid grid-cols-2 gap-4 text-sm"},It={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-4"},Ut={class:"mt-1 font-medium"},Et={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-4"},Tt={class:"mt-1 font-medium"},Pt={class:"rounded-2xl border border-orchit-white/10 bg-orchit-white/5 p-4 grid grid-cols-1 sm:grid-cols-2 gap-4"},Lt={class:"space-y-2"},Bt={class:"space-y-2"},Mt={class:"space-y-2"},jt={class:"h-8 px-3 flex items-center gap-2 rounded-lg bg-bg-input border border-orchit-white/10"},zt={class:"space-y-2"},At={key:0,class:"text-xs text-red-400 mt-1"},Ot={key:0,class:"space-y-2 sm:col-span-1"},Ft={class:"text-xs uppercase tracking-wider text-text-secondary"},$t={key:1},qt={class:"relative border-l border-orchit-white/10 pl-5 space-y-4 ml-1"},Ht={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-3 hover:bg-orchit-white/7 transition"},Kt={class:"font-semibold"},Nt={class:"font-semibold"},Rt={key:"tab-comments",class:"space-y-4"},Qt={class:"flex items-center gap-3 mb-2"},Wt={class:"h-8 w-8 rounded-full bg-accent/15 text-accent flex items-center justify-center text-xs font-semibold"},Gt={class:"flex-1"},Zt={class:"text-sm font-medium"},Jt={class:"text-xs text-text-secondary"},Xt={key:0,class:"flex items-center gap-2"},Yt=["onClick"],es=["onClick"],ts={class:"flex items-center gap-2 justify-end"},ss={key:0,class:"mt-3 grid grid-cols-2 gap-2"},as=["href"],ls={class:"text-xs truncate"},os={class:"rounded-xl border border-orchit-white/10 bg-orchit-white/5 overflow-hidden"},is={class:"grid grid-cols-3 items-center w-full justify-between p-2 border-t border-orchit-white/10"},ns={key:"tab-attachments",class:"space-y-3"},ds={class:"text-xs text-text-secondary"},rs={class:"grid sm:grid-cols-2 gap-4"},us={class:"p-3"},cs={key:0,class:"rounded-lg overflow-hidden"},vs=["src"],ms={key:1,class:"rounded-lg overflow-hidden"},ps=["src"],fs={key:2,class:"h-40 rounded-lg bg-black/5 grid place-items-center"},hs={class:"mt-3"},xs={class:"font-medium truncate"},gs={class:"text-xs text-text-secondary capitalize"},bs={class:"p-3 pt-0"},_s=["href"],ws=Xe({__name:"SidePanel",props:{pin:{type:Boolean,default:!1},showPanel:{type:Boolean,default:!0},details:{type:Object,default:()=>({})}},emits:["close","update:details","comment:post","priority:change"],setup(E,{emit:ge}){var ne,de,re;const{workspaceId:be}=Ye(),r=E,_e=ge,X=m(r.details._id),{data:o,isPending:Y,isFetching:ee}=et(X);U(r,()=>{console.log("chaning props, >>>"),X.value=r.details._id});const T=m("details"),we=[{label:"Details",value:"details"},{label:"Comments",value:"comments"},{label:"History",value:"history"},{label:"Attachment",value:"attachment"}],z=m(!1),y=m(o.value?o.value["card-title"]:""),q=m(null);function ye(){z.value=!0,xe(()=>{var t,e;(t=q.value)==null||t.focus(),(e=q.value)==null||e.select()})}function te(){y.value.trim()||(y.value=r.details["card-title"]??""),C.mutate({card_id:r.details._id,variables:{"card-title":y.value.trim()}}),z.value=!1}const V=m(o!=null&&o.value?o==null?void 0:o.value["card-description"]:""),A=m(!1),H=m(null);function ke(t){var v,h;const e=(v=t==null?void 0:t.querySelector)==null?void 0:v.call(t,".ProseMirror");if(!e)return;e.focus();const a=(h=window.getSelection)==null?void 0:h.call(window),d=document.createRange();d.selectNodeContents(e),d.collapse(!1),a==null||a.removeAllRanges(),a==null||a.addRange(d)}async function Ce(){A.value=!0,await xe(),ke(H.value||void 0)}function se(t){console.log(t,"???"),C.mutate({card_id:r.details._id,attachments:t??[],variables:{"card-description":V.value}}),A.value=!1}function ae(t){var a;if(!A.value)return;const e=t.target;(a=H.value)!=null&&a.contains(e)||se()}ce(()=>document.addEventListener("mousedown",ae)),tt(()=>document.removeEventListener("mousedown",ae));const le=ve({posted_on:((ne=r.details)==null?void 0:ne.posted_on)??((de=r.details)==null?void 0:de.created_at)??new Date().toISOString()}),Se=b({get:()=>new Date(le.posted_on).toISOString().slice(0,10),set:t=>{le.posted_on=new Date(t+"T00:00:00").toISOString()}}),{data:K}=st(be.value),N=m(o!=null&&o.value?o.value.workspace_lane_id:"");U([()=>o.value,()=>ee.value],()=>{o!=null&&o.value&&(y.value=o==null?void 0:o.value["card-title"],V.value=o.value["card-description"],N.value=o.value.workspace_lane_id)});const De=b(()=>((K==null?void 0:K.value)??[]).map(t=>{var e;return{_id:t._id,title:((e=t==null?void 0:t.variables)==null?void 0:e["lane-title"])??String(t._id)}}));function Ve(t){N.value=t,C.mutate({card_id:r.details._id,workspace_lane_id:t})}const f=m({startDate:o.value?o.value["start-date"]:"",endDate:o.value?o.value["end-date"]:""}),Ie=b(()=>r.details["start-date"]),Ue=b(()=>r.details["end-date"]);U(Ie,t=>{f.value={...f.value,startDate:t}}),U(Ue,t=>{f.value={...f.value,endDate:t}});const R=b(()=>f!=null&&f.value.startDate&&f.value.endDate&&f.value.endDate<f.value.startDate?"End date cannot be before start date":""),Ee=t=>C.mutate({card_id:r.details._id,variables:{"start-date":t}}),Te=t=>C.mutate({card_id:r.details._id,variables:{"end-date":t}}),Pe=b(()=>o==null?void 0:o.value.assigned_to),Le=t=>{C.mutate({card_id:r.details._id,seat_id:t==null?void 0:t._id})},Be=b(()=>{var t;return(t=r.details)==null?void 0:t._id}),{data:Q}=at(Be),u=m((re=Q.value)==null?void 0:re.comments);U(()=>Q.value,()=>{var t;u.value=(t=Q.value)==null?void 0:t.comments});const{mutate:Me,isPending:je}=lt({onSuccess:t=>{P.value="",B.value=[],u.value=[...u.value,t]}}),P=m(""),ze=t=>(t??"").split(" ").map(e=>e[0]).filter(Boolean).slice(0,2).join("").toUpperCase(),Ae=t=>t?new Date(t).toLocaleString():"",{data:Oe}=ot(),Fe=t=>{var e;return((e=t==null?void 0:t.created_by)==null?void 0:e._id)===Oe.value},L=m(null),k=m(""),{mutate:$e,isPending:oe}=it({onSuccess:t=>{const e=u.value.findIndex(a=>a._id===t._id);e>-1&&(u.value[e]={...u.value[e],comment_text:t.comment_text}),L.value=null,k.value=""}}),{mutate:qe}=nt();function He(t){L.value=t._id,k.value=t.comment_text??""}function W(){L.value=null,k.value="",z.value=!1}function Ke(t){const e=k.value.trim();if(!e)return;const a=u.value.findIndex(v=>v._id===t._id),d=a>-1?{...u.value[a]}:null;a>-1&&(u.value[a]={...u.value[a],comment_text:e}),$e({id:t._id,payload:{comment_text:e}},{onError:()=>{a>-1&&d&&(u.value[a]=d)},onSuccess:v=>{a>-1&&(u.value[a]=v??u.value[a]),W()}})}function Ne(t){const e=u.value.findIndex(d=>d._id===t._id),a=e>-1?u.value[e]:null;e>-1&&u.value.splice(e,1),qe({id:t._id},{onError:()=>{a&&u.value.splice(e,0,a)}})}const Re=b(()=>{var t,e;return console.log((t=r.details)==null?void 0:t.attachments,">>>"),(e=o.value)==null?void 0:e.attachments.map(a=>{var d;return{_id:a._id??a.id??((d=crypto.randomUUID)==null?void 0:d.call(crypto))??Math.random(),name:a.name??a.filename??"file",url:a.url,kind:(a.type??a.kind??"").toLowerCase().includes("image")?"image":(a.type??a.kind??"").toLowerCase().includes("video")?"video":"file"}})}),G=dt(),C=rt({onSuccess:()=>{G.invalidateQueries({queryKey:["get-sheets"]}),G.invalidateQueries({queryKey:["sheet-list"]}),G.invalidateQueries({queryKey:["roles"]})}}),B=m([]),{mutate:Qe}=ut({onSuccess:t=>{B.value=[t]}});function We(t){const e=t.target.files;Array.from(e).forEach(a=>{const d=new FormData;d.append("file",a),Qe(d)})}function Ge(){const t=P.value.trim();!t&&!B.value.length||Me({id:r.details._id,payload:{comment_text:t,attachments:B.value.map(e=>({name:e.data.name,url:e.data.url}))}})}const O=ve({}),ie=()=>{var t;(t=o==null?void 0:o.value)!=null&&t.variables&&(o.value.variables??[]).forEach(a=>{var v,h;if(!a||a.type!=="Select")return;const d=Array.isArray(a.data)&&a.data.length?((v=a.data[0])==null?void 0:v.value)??((h=a.data[0])==null?void 0:h._id)??a.data[0]:void 0;O[a.slug]=a.value??O[a.slug]??d??null})};ce(ie),U(()=>o.value,ie,{deep:!0});function Ze(t,e){var d,v;O[e]=t,((v=(((d=o.value)==null?void 0:d.variables)??[]).find(h=>h.slug===e))==null?void 0:v.value)!==t&&C.mutate({card_id:r.details._id,variables:{[e]:t}})}return(t,e)=>x(ee)||x(Y)?(i(),n("div",gt,e[7]||(e[7]=[s("div",{role:"status","aria-label":"Loading",class:"h-10 w-10 rounded-full border-4 border-neutral-700 border-t-transparent animate-spin"},null,-1)]))):(i(),ct(M,{key:1,name:"panel",appear:""},{default:_(()=>[F(s("div",bt,[s("div",_t,[e[9]||(e[9]=s("h5",{class:"text-[18px] font-semibold tracking-tight"},"Details",-1)),s("button",{class:"p-2 rounded-xl hover:bg-orchit-white/5 active:scale-[.98] cursor-pointer transition",onClick:e[0]||(e[0]=()=>_e("close")),"aria-label":"Close details"},e[8]||(e[8]=[s("i",{class:"fa-solid fa-xmark text-xl"},null,-1)]))]),s("div",wt,[s("div",yt,[p(M,{name:"fade-scale",mode:"out-in"},{default:_(()=>[z.value?F((i(),n("input",{key:"title-edit",ref_key:"titleInput",ref:q,"onUpdate:modelValue":e[1]||(e[1]=a=>y.value=a),onBlur:te,onKeydown:[me(pe(te,["prevent"]),["enter"]),me(pe(W,["prevent"]),["esc"])],class:"w-full text-2xl font-semibold rounded-xl px-3 py-2 bg-orchit-white/5 border border-orchit-white/10 focus:outline-none focus:ring-2 focus:ring-accent/40 transition",type:"text","aria-label":"Edit title"},null,40,kt)),[[Z,y.value]]):(i(),n("h1",{key:"title-view",class:"text-2xl font-semibold tracking-tight cursor-text rounded-lg px-2 py-1 hover:bg-orchit-white/5 transition",onClick:ye,"aria-label":"Card title"},c(y.value||"Untitled"),1))]),_:1})]),s("div",null,[e[10]||(e[10]=s("h3",{class:"mb-2 text-base font-semibold tracking-wide px-1"},"Description",-1)),p(M,{name:"fade-scale",mode:"out-in"},{default:_(()=>[A.value?(i(),n("div",{key:"desc-edit",ref_key:"descEditorWrap",ref:H,class:"rounded-xl overflow-hidden border border-orchit-white/10 shadow-sm"},[p(mt,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=a=>V.value=a),onFocusOut:se},null,8,["modelValue"])],512)):(i(),n("div",{key:"desc-view",class:"text-[15px] leading-6 text-text-secondary whitespace-pre-wrap cursor-text rounded-xl px-4 py-3 border border-orchit-white/10 bg-orchit-white/5 hover:border-orchit-white/20 transition",onClick:Ce},[V.value?(i(),n("div",{key:0,innerHTML:V.value},null,8,Ct)):(i(),n("span",St,"Click to add a description…"))]))]),_:1})]),p(pt,{modelValue:T.value,"onUpdate:modelValue":e[3]||(e[3]=a=>T.value=a),options:we,size:"md"},null,8,["modelValue"]),p(M,{name:"section",mode:"out-in"},{default:_(()=>{var a,d,v,h;return[T.value==="details"?(i(),n("section",Dt,[s("div",Vt,[s("div",It,[e[11]||(e[11]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"Posted On",-1)),s("div",Ut,c(Se.value),1)]),s("div",Et,[e[12]||(e[12]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"ID",-1)),s("div",Tt,c(E.details["card-code"]),1)])]),s("div",Pt,[s("div",Lt,[e[13]||(e[13]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"Lane",-1)),p(fe,{size:"sm",options:De.value,placeholder:"Select lane",allowCustom:!1,"model-value":N.value,"onUpdate:modelValue":Ve},null,8,["options","model-value"])]),s("div",Bt,[e[14]||(e[14]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"Assign",-1)),p(ft,{onAssign:e[4]||(e[4]=l=>Le(l)),assigneeId:Pe.value,seat:x(o).seat},null,8,["assigneeId","seat"])]),E.pin?D("",!0):(i(),n(w,{key:0},[s("div",Mt,[e[16]||(e[16]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"Start Date",-1)),s("div",jt,[e[15]||(e[15]=s("i",{class:"fa-regular fa-calendar"},null,-1)),p(he,{placeholder:"Set start date",class:"w-full","model-value":f.value.startDate,"emit-as":"ymd","onUpdate:modelValue":Ee},null,8,["model-value"])])]),s("div",zt,[e[18]||(e[18]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"Target End",-1)),s("div",{class:ht(["h-8 px-3 flex items-center gap-2 rounded-lg bg-bg-input border transition-colors",R.value?"border-red-500":"border-orchit-white/10"])},[e[17]||(e[17]=s("i",{class:"fa-regular fa-calendar"},null,-1)),p(he,{placeholder:"Set end date",class:"w-full","model-value":f.value.endDate,"emit-as":"ymd","onUpdate:modelValue":Te},null,8,["model-value"])],2),R.value?(i(),n("p",At,c(R.value),1)):D("",!0)])],64)),x(Y)?(i(),n(w,{key:1},[e[19]||(e[19]=s("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),e[20]||(e[20]=s("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),e[21]||(e[21]=s("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),e[22]||(e[22]=s("div",{class:"bg-bg-surface/40 w-full animate-pulse h-6 p-1"},null,-1))],64)):(a=x(o))!=null&&a.variables?(i(!0),n(w,{key:2},j((d=x(o))==null?void 0:d.variables,(l,I)=>(i(),n(w,{key:l.slug||`var-${I}`},[(l==null?void 0:l.type)==="Select"?(i(),n("div",Ot,[s("div",Ft,c(l.title),1),p(fe,{size:"sm",options:l==null?void 0:l.data.map(S=>({_id:S,title:S})),placeholder:"Select option",allowCustom:!1,"model-value":O[l.slug],"onUpdate:modelValue":S=>Ze(S,l.slug)},null,8,["options","model-value","onUpdate:modelValue"])])):D("",!0)],64))),128)):D("",!0)])])):T.value==="history"?(i(),n("section",$t,[s("div",null,[e[25]||(e[25]=s("h3",{class:"text-sm font-semibold tracking-wide mb-3"},"History",-1)),s("ol",qt,[(i(!0),n(w,null,j((v=x(o))==null?void 0:v.history,(l,I)=>(i(),n("li",{key:I,class:"group"},[e[24]||(e[24]=s("span",{class:"absolute -left-[5px] top-0 w-2 h-2 rounded-full bg-accent/70 ring-4 ring-accent/10"},null,-1)),s("div",Ht,[s("span",Kt,c(l.user.u_full_name),1),e[23]||(e[23]=s("span",{class:"text-text-secondary"}," changed ",-1)),s("span",Nt,c(l.field_name),1)])]))),128))])])])):T.value==="comments"?(i(),n("section",Rt,[(i(!0),n(w,null,j(u.value??[],l=>{var I,S,ue;return i(),n("div",{key:l._id,class:"rounded-xl border border-orchit-white/10 bg-orchit-white/5 p-4 hover:bg-orchit-white/7 transition"},[s("div",Qt,[s("div",Wt,c(ze((I=l.commented_by)==null?void 0:I.u_full_name)),1),s("div",Gt,[s("div",Zt,c((S=l.commented_by)==null?void 0:S.u_full_name),1),s("div",Jt,c(Ae(l.created_at)),1)]),Fe(l)?(i(),n("div",Xt,[L.value!==l._id?(i(),n("button",{key:0,class:"text-xs text-accent hover:underline",onClick:g=>He(l)},"Edit",8,Yt)):D("",!0),s("button",{class:"text-xs text-red-400 hover:underline",onClick:g=>Ne(l)},"Delete",8,es)])):D("",!0)]),p(M,{name:"fade",mode:"out-in"},{default:_(()=>[L.value!==l._id?(i(),n("p",{key:`c-view-${l._id}`,class:"text-[15px] leading-6"},c(l.comment_text),1)):(i(),n("div",{key:`c-edit-${l._id}`,class:"space-y-2"},[F(s("textarea",{"onUpdate:modelValue":e[5]||(e[5]=g=>k.value=g),rows:"3",class:"w-full p-3 rounded-lg bg-bg-input/80 border border-orchit-white/10 focus:ring-2 focus:ring-accent/40 outline-none"},null,512),[[Z,k.value]]),s("div",ts,[p(J,{variant:"secondary",size:"sm",onClick:W},{default:_(()=>e[26]||(e[26]=[$("Cancel")])),_:1,__:[26]}),p(J,{class:"btn",size:"sm",onClick:g=>Ke(l),disabled:!k.value.trim()||x(oe)},{default:_(()=>[$(c(x(oe)?"Saving…":"Save"),1)]),_:2},1032,["onClick","disabled"])])]))]),_:2},1024),(ue=l==null?void 0:l.attachments)!=null&&ue.length?(i(),n("div",ss,[(i(!0),n(w,null,j(l.attachments,(g,Je)=>(i(),n("a",{key:Je,href:g.url,target:"_blank",class:"group flex items-center gap-2 rounded-lg border border-orchit-white/10 bg-orchit-white/5 px-2 py-1 hover:bg-orchit-white/10 transition"},[e[27]||(e[27]=s("i",{class:"fa-regular fa-file text-text-secondary group-hover:text-text-primary transition"},null,-1)),s("span",ls,c(g==null?void 0:g.name),1)],8,as))),128))])):D("",!0)])}),128)),s("div",os,[F(s("textarea",{"onUpdate:modelValue":e[6]||(e[6]=l=>P.value=l),rows:"3",class:"w-full p-3 bg-transparent outline-none text-sm",placeholder:"Write a comment"},null,512),[[Z,P.value]]),s("div",is,[s("input",{type:"file",multiple:"",onChange:We,class:"max-w-full text-ellipsis text-xs text-text-secondary file:mr-3 col-span-2 file:px-3 file:py-1.5 file:rounded-md file:border file:border-orchit-white/10 file:bg-orchit-white/10 hover:file:bg-orchit-white/15 file:text-text-primary transition inline w-fit"},null,32),p(J,{variant:"primary",class:"",size:"sm",onClick:Ge,disabled:!P.value.trim()&&!B.value.length},{default:_(()=>[$(c(x(je)?"Posting…":"Post"),1)]),_:1},8,["disabled"])])])])):(i(),n("section",ns,[s("div",ds," Files attached to this "+c(((h=E.details)==null?void 0:h.type)??"item")+". ",1),s("div",rs,[(i(!0),n(w,null,j(Re.value,l=>(i(),n("div",{key:l._id,class:"rounded-2xl overflow-hidden border border-orchit-white/10 bg-orchit-white/5 hover:bg-orchit-white/8 transition group"},[s("div",us,[l.kind==="image"?(i(),n("div",cs,[s("img",{src:l.url,class:"w-full h-40 object-cover group-hover:scale-[1.02] transition"},null,8,vs)])):l.kind==="video"?(i(),n("div",ms,[s("video",{src:l.url,controls:"",class:"w-full h-40 object-cover"},null,8,ps)])):(i(),n("div",fs,e[28]||(e[28]=[s("i",{class:"fa-regular fa-file text-3xl text-text-secondary"},null,-1)]))),s("div",hs,[s("div",xs,c(l.name),1),s("div",gs,c(l.kind),1)])]),s("div",bs,[s("a",{href:l.url,target:"_blank",rel:"noopener",class:"w-full inline-flex items-center justify-center gap-2 h-9 rounded-lg bg-accent text-orchit-white text-sm hover:opacity-90 transition"},e[29]||(e[29]=[s("i",{class:"fa-regular fa-arrow-up-right-from-square"},null,-1),$(" View ")]),8,_s)])]))),128))])]))]}),_:1})])],512),[[vt,E.showPanel]])]),_:1}))}}),ks=xt(ws,[["__scopeId","data-v-d55e1ceb"]]);export{ks as default};
