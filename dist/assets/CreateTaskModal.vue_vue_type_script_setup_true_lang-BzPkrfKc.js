import{d as ee,V as te,N as ae,M as se,a2 as le,a0 as ie,a1 as ne,c as n,K as z,n as u,e as U,X as re,w,o as d,f as i,g as _,i as o,j as c,k as p,_ as de,I as A,y as oe,D as ue,E as ce,F as pe,z as $,p as m,Y as q,t as C,a3 as me,a4 as fe,B as L}from"./index-tfagm7Um.js";const be={class:"px-6 grid grid-cols-1 sm:grid-cols-2 gap-4"},ve={key:0,class:"flex flex-col"},ge={key:1,class:"flex gap-1 flex-col"},De={key:0,class:"text-xs text-red-500"},_e={key:2,class:"flex gap-1 flex-col"},xe={key:0,class:"text-xs text-red-500"},Ve={class:"flex flex-col gap-1"},ke={class:"mt-2"},ye={class:"px-6 mt-2"},we={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},Se=ee({__name:"CreateTaskModal",props:{modelValue:{type:Boolean,default:!1},sheet_id:{},listId:{},selectedVariable:{},pin:{},size:{default:"lg"}},emits:["update:modelValue","created"],setup(N,{emit:O}){const{canCreateCard:P}=te(),K=O,r=N,M=ae(),{workspaceId:f,moduleId:j}=se(),{mutate:F,isPending:x}=le({onSuccess:()=>{B(),M.invalidateQueries({queryKey:["sheet-list"]}),v.value=!1}}),{data:V}=ie(f.value),{data:b}=ne(f.value,j.value,r.sheet_id),v=n({get:()=>r.modelValue,set:e=>K("update:modelValue",e)}),S=n(()=>((b==null?void 0:b.value)??[]).filter(e=>{var a;return((a=e==null?void 0:e.type)==null?void 0:a.title)==="Select"})),Q=e=>e.map(a=>({_id:a,title:a})),h=n(()=>((V==null?void 0:V.value)??[]).map(e=>{var a;return{_id:e._id,title:((a=e==null?void 0:e.variables)==null?void 0:a["lane-title"])??String(e._id)}})),I=e=>e.slug,t=z({title:"",description:"",startDate:null,endDate:null,lane_id:null,assignee:null,variables:{}});u(S,e=>{for(const a of e){const l=I(a);l in t.variables||(t.variables[l]=null)}},{immediate:!0});const s=z({title:!1,description:!1,startDate:!1,endDate:!1,lane:!1}),R=n(()=>!!t.title.trim()&&(r.pin?!0:!!t.startDate&&!!t.endDate)&&!k.value&&!g.value&&!D.value&&!y.value);function W(e){t.startDate=e,s.startDate=!0}function X(e){t.endDate=e,s.endDate=!0}function Y(e){t.lane_id=e,s.lane=!0}function T(e){t.assignee=e}function G(){v.value=!1,B()}function B(){t.title="",t.description="",t.startDate=null,t.endDate=null,t.lane_id=null,t.assignee=null,t.variables={},s.title=!1,s.description=!1,s.startDate=!1,s.endDate=!1,s.lane=!1}const H=n(()=>b.value.find(e=>(e==null?void 0:e._id)==r.selectedVariable)),k=n(()=>s.title&&!t.title.trim()?"Title is required":""),g=n(()=>s.startDate?t.startDate?"":"Start date is required":""),D=n(()=>s.endDate?t.endDate?t.startDate&&t.endDate&&t.endDate<t.startDate?"End date cannot be before start date":"":"End date is required":""),y=n(()=>s.lane?t.lane_id?"":"Lane is required":""),E=new Date().toISOString().split("T")[0];function J(){var a,l;if(s.title=!0,s.description=!0,r.pin||(s.startDate=!0,s.endDate=!0),!R.value||x.value||!P.value)return;const e={sheet_list_id:r.listId,workspace_id:f.value,sheet_id:r.sheet_id,workspace_lane_id:t.lane_id,variables:{...t.variables,[`${(a=H.value)==null?void 0:a.slug}`]:r.listId,"card-title":t.title.trim(),"card-description":t.description.trim(),"start-date":t.startDate,"end-date":t.endDate},seat_id:((l=t.assignee)==null?void 0:l._id)??null,createdAt:new Date().toISOString()};F(e)}return u(()=>t.title,e=>{e!=null&&e.trim()&&s.title&&(s.title=!1)}),u(()=>t.lane_id,e=>{e&&s.lane&&(s.lane=!1)}),u(()=>t.startDate,e=>{e&&s.startDate&&(s.startDate=!1)}),u(()=>t.endDate,e=>{e&&s.endDate&&(s.endDate=!1)}),u(()=>t.description,e=>{e!=null&&e.trim()&&s.description&&(s.description=!1)}),(e,a)=>(d(),U(re,{modelValue:v.value,"onUpdate:modelValue":a[5]||(a[5]=l=>v.value=l),modalClass:"!py-0",size:e.size},{default:w(()=>[a[10]||(a[10]=i("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[i("h2",{class:"text-xl font-semibold"},"Create Ticket"),i("p",{class:"text-sm text-text-secondary mt-1"},[_(" Provide the details below and click "),i("span",{class:"font-medium"},"Add Ticket"),_(". ")])],-1)),i("div",be,[o(de,{modelValue:t.title,"onUpdate:modelValue":a[0]||(a[0]=l=>t.title=l),label:"Ticket Title",placeholder:"e.g., Implement real-time notifications",error:!!k.value,message:k.value,onBlur:a[1]||(a[1]=l=>s.title=!0)},null,8,["modelValue","error","message"]),h.value.length>0?(d(),c("div",ve,[o(A,{size:"md",label:"Lane",options:h.value,placeholder:"Select lane",allowCustom:!1,"model-value":t.lane_id,"onUpdate:modelValue":Y,error:!!y.value,message:y.value},null,8,["options","model-value","error","message"])])):p("",!0),(d(!0),c(pe,null,oe(S.value,l=>ue((d(),U(A,{size:"md",key:I(l),modelValue:t.variables[l.slug],"onUpdate:modelValue":Z=>t.variables[l.slug]=Z,options:Q(l.data),label:l.title,placeholder:"Select value",allowCustom:!0},null,8,["modelValue","onUpdate:modelValue","options","label"])),[[ce,(l==null?void 0:l._id)!=e.selectedVariable]])),128)),e.pin?p("",!0):(d(),c("div",ge,[a[6]||(a[6]=i("label",{class:"text-sm"},"Start date",-1)),i("div",{class:$(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",g.value?"border-red-500":""])},[o(q,{placeholder:"Set start date",class:"w-full","model-value":t.startDate,"emit-as":"ymd","onUpdate:modelValue":W,"min-date":m(E)},null,8,["model-value","min-date"])],2),g.value?(d(),c("p",De,C(g.value),1)):p("",!0)])),e.pin?p("",!0):(d(),c("div",_e,[a[7]||(a[7]=i("label",{class:"text-sm"},"End date",-1)),i("div",{class:$(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",D.value?"border-red-500":""])},[o(q,{placeholder:"Set end date",class:"w-full","model-value":t.endDate,"emit-as":"ymd","onUpdate:modelValue":X,"min-date":t.startDate||m(E)},null,8,["model-value","min-date"])],2),D.value?(d(),c("p",xe,C(D.value),1)):p("",!0)])),i("div",Ve,[a[8]||(a[8]=i("label",{class:"text-sm"},"Assignee",-1)),i("div",ke,[o(me,{name:!0,workspaceId:m(f),onAssign:T,onUnassign:a[2]||(a[2]=l=>T(null)),assigneeId:t.assignee,seat:null,disabled:!1,skipPermissionCheck:!0,class:"w-full"},null,8,["workspaceId","assigneeId"])])])]),i("div",ye,[o(fe,{label:"Description",placeholder:"What needs to be done, acceptance criteria, links…",modelValue:t.description,"onUpdate:modelValue":a[3]||(a[3]=l=>t.description=l),onBlur:a[4]||(a[4]=l=>s.description=!0)},null,8,["modelValue"])]),i("div",we,[o(L,{variant:"secondary",onClick:G},{default:w(()=>a[9]||(a[9]=[_("Cancel")])),_:1,__:[9]}),o(L,{variant:"primary",disabled:m(x),onClick:J},{default:w(()=>[_(C(m(x)?"Adding…":"Add Ticket"),1)]),_:1},8,["disabled"])])]),_:1,__:[10]},8,["modelValue","size"]))}});export{Se as _};
