import{d as ye,W as we,S as Ve,Q as Ce,a3 as Ie,a1 as Te,r as m,a0 as Ee,c as o,a2 as Me,O as K,x as v,f as N,Y as Ae,w as $,o as i,g as n,k as _,h as f,m as d,n as u,_ as Be,M as Q,E as R,y as $e,J as ze,G as F,F as W,i as c,Z as G,t as x,a4 as Ue,A as Oe,l as J,a5 as qe,B as Y}from"./index-BUo6hkzk.js";import{b as Le}from"./usePlan-_Px9HXHw.js";const Pe={class:"px-6 grid grid-cols-1 sm:grid-cols-2 gap-4"},je={key:0,class:"flex flex-col"},Ke={key:1,class:"flex gap-1 flex-col"},Ne={key:0,class:"text-xs text-red-500"},Qe={key:2,class:"flex gap-1 flex-col"},Re={key:0,class:"text-xs text-red-500"},Fe={class:"flex flex-col gap-1"},We={class:"mt-2"},Ge={key:3},Je={class:"border border-border rounded-lg h-fit mt-16 sm:mt-0 bg-card relative"},Ye={class:"truncate"},Ze={key:0,class:"absolute z-50 mt-2 w-full bg-card border border-border rounded-lg shadow-lg"},He=["onClick"],Xe={class:"truncate"},et={class:"flex gap-2"},tt=["onClick"],at=["onClick"],st={class:"px-6 mt-2"},lt={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},it=ye({__name:"CreateTaskModal",props:{modelValue:{type:Boolean,default:!1},sheet_id:{},listId:{},selectedVariable:{},pin:{},size:{default:"lg"}},emits:["update:modelValue","created"],setup(Z,{emit:H}){const{canCreateCard:X,canEditSheet:ee,canDeleteSheet:te,canCreateSheet:ae}=we(),se=Oe(),le=H,p=Z,ne=Ve(),{workspaceId:b,moduleId:re}=Ce(),{mutate:ie,isPending:w}=Ie({onSuccess:()=>{P(),ne.invalidateQueries({queryKey:["sheet-list"]}),D.value=!1,de()}}),{refetch:de}=Le(localStorage.getItem("activeSprintId")||""),{data:V}=Te(b.value),oe=m(localStorage.getItem("selectedModuleId")||""),{data:C}=Ee({workspace_id:b,workspace_module_id:oe}),ue=o(()=>{var e;return C.value?(e=C.value[0])==null?void 0:e._id:""}),g=m(ue.value),I=m(!1),T=m(),ce=o(()=>p.sheet_id||g.value||""),{data:k}=Me(b,re,ce),D=o({get:()=>p.modelValue,set:e=>le("update:modelValue",e)}),z=o(()=>((k==null?void 0:k.value)??[]).filter(e=>{var t;return((t=e==null?void 0:e.type)==null?void 0:t.title)==="Select"})),pe=e=>e.map(t=>({_id:t,title:t})),E=o(()=>{const e=((V==null?void 0:V.value)??[]).map(t=>{var r;return{_id:t._id,title:((r=t==null?void 0:t.variables)==null?void 0:r["lane-title"])??String(t._id)}});return e.find(t=>t.title==="Main")||e.unshift({_id:"main",title:"Main"}),e}),U=e=>e.slug,a=K({title:"",description:"",startDate:null,endDate:null,lane_id:null,assignee:null,variables:{}});v(z,e=>{for(const t of e){const r=U(t);r in a.variables||(a.variables[r]=null)}},{immediate:!0});const l=K({title:!1,description:!1,startDate:!1,endDate:!1,lane:!1}),fe=o(()=>!!a.title.trim()&&(p.pin?!0:!!a.startDate&&!!a.endDate)&&!A.value&&!h.value&&!S.value&&!B.value);function ve(e){a.startDate=e,l.startDate=!0}function me(e){a.endDate=e,l.endDate=!0}function be(e){a.lane_id=e,l.lane=!0}function O(e){a.assignee=e}function ge(e){I.value=!0,T.value=e}const q=o(()=>(C.value||[]).map(e=>({_id:e._id,title:e==null?void 0:e.variables["sheet-title"],description:e==null?void 0:e.variables["sheet-description"],icon:e.icon,status:(e==null?void 0:e.generation_status)||localStorage.getItem("selectedStatusTitle")}))),M=m(!1),_e=e=>{console.log("Selected option:",e),g.value=e._id},xe=m(!1);function ke(e){xe.value=!0,T.value=e}const De=()=>{T.value={},I.value=!I.value};function L(){D.value=!1,P()}function P(){a.title="",a.description="",a.startDate=null,a.endDate=null,a.lane_id=null,a.assignee=null,a.variables={},l.title=!1,l.description=!1,l.startDate=!1,l.endDate=!1,l.lane=!1}const he=o(()=>{var e;return(e=k.value)==null?void 0:e.find(t=>(t==null?void 0:t._id)==p.selectedVariable)}),A=o(()=>l.title&&!a.title.trim()?"Title is required":""),h=o(()=>l.startDate?a.startDate?"":"Start date is required":""),S=o(()=>l.endDate?a.endDate?a.startDate&&a.endDate&&a.endDate<a.startDate?"End date cannot be before start date":"":"End date is required":""),B=o(()=>l.lane?a.lane_id?"":"Lane is required":""),j=new Date().toISOString().split("T")[0];function Se(){var r,s;if(l.title=!0,l.description=!0,p.pin||(l.startDate=!0,l.endDate=!0),!fe.value||w.value||!X.value)return;const e=(r=he.value)==null?void 0:r.slug,t={sheet_list_id:p.listId,workspace_id:b.value,sheet_id:p.sheet_id||g.value,...a.lane_id&&a.lane_id!=="main"?{workspace_lane_id:a.lane_id}:{},variables:{...a.variables,...e?{[e]:p.listId}:{},"card-title":a.title.trim(),"card-description":a.description.trim(),"start-date":a.startDate,"end-date":a.endDate,"card-status":localStorage.getItem("selectedStatusTitle")},seat_id:((s=a.assignee)==null?void 0:s._id)??null,sprint_id:localStorage.getItem("activeSprintId")||null,createdAt:new Date().toISOString()};ie(t)}return v(()=>a.title,e=>{e!=null&&e.trim()&&l.title&&(l.title=!1)}),v(()=>a.lane_id,e=>{e&&l.lane&&(l.lane=!1)}),v(()=>a.startDate,e=>{e&&l.startDate&&(l.startDate=!1)}),v(()=>a.endDate,e=>{e&&l.endDate&&(l.endDate=!1)}),v(()=>a.description,e=>{e!=null&&e.trim()&&l.description&&(l.description=!1)}),v(E,e=>{if(!a.lane_id){const t=e.find(r=>r.title==="Main");t&&(a.lane_id=t._id)}},{immediate:!0}),(e,t)=>(i(),N(Ae,{modelValue:D.value,"onUpdate:modelValue":t[6]||(t[6]=r=>D.value=r),modalClass:"!py-0",size:e.size},{default:$(()=>{var r;return[n("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[n("div",{class:"flex justify-between w-full"},[t[8]||(t[8]=n("h2",{class:"text-xl font-semibold"},"Create Ticket",-1)),n("div",{class:"w-6 h-6 rounded-full cursor-pointer hover:bg-border/50 transition p-0.5",onClick:L,title:"Close"},t[7]||(t[7]=[n("i",{class:"fa-solid fa-xmark text-sm"},null,-1)]))]),t[9]||(t[9]=n("p",{class:"text-sm text-text-secondary mt-1"},[_(" Provide the details below and click "),n("span",{class:"font-medium"},"Add Ticket"),_(". ")],-1))]),n("div",Pe,[f(Be,{modelValue:a.title,"onUpdate:modelValue":t[0]||(t[0]=s=>a.title=s),label:"Ticket Title",placeholder:"e.g., Implement real-time notifications",error:!!A.value,message:A.value,onBlur:t[1]||(t[1]=s=>l.title=!0)},null,8,["modelValue","error","message"]),E.value.length>0?(i(),d("div",je,[f(Q,{size:"md",label:"Tab",options:E.value,placeholder:"Select tab",allowCustom:!1,"model-value":a.lane_id,"onUpdate:modelValue":be,error:!!B.value,message:B.value},null,8,["options","model-value","error","message"])])):u("",!0),(i(!0),d(F,null,R(z.value,s=>$e((i(),N(Q,{size:"md",key:U(s),modelValue:a.variables[s.slug],"onUpdate:modelValue":y=>a.variables[s.slug]=y,options:pe(s.data),label:s.title,placeholder:"Select value",allowCustom:!0},null,8,["modelValue","onUpdate:modelValue","options","label"])),[[ze,(s==null?void 0:s._id)!=e.selectedVariable&&(s==null?void 0:s.title)!=="Process"]])),128)),e.pin?u("",!0):(i(),d("div",Ke,[t[10]||(t[10]=n("label",{class:"text-sm"},"Start date",-1)),n("div",{class:W(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",h.value?"border-red-500":""])},[f(G,{placeholder:"Set start date",class:"w-full","model-value":a.startDate,"emit-as":"ymd","onUpdate:modelValue":ve,"min-date":c(j)},null,8,["model-value","min-date"])],2),h.value?(i(),d("p",Ne,x(h.value),1)):u("",!0)])),e.pin?u("",!0):(i(),d("div",Qe,[t[11]||(t[11]=n("label",{class:"text-sm"},"End date",-1)),n("div",{class:W(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",S.value?"border-red-500":""])},[f(G,{placeholder:"Set end date",class:"w-full","model-value":a.endDate,"emit-as":"ymd","onUpdate:modelValue":me,"min-date":a.startDate||c(j)},null,8,["model-value","min-date"])],2),S.value?(i(),d("p",Re,x(S.value),1)):u("",!0)])),n("div",Fe,[t[12]||(t[12]=n("label",{class:"text-sm"},"Assignee",-1)),n("div",We,[f(Ue,{name:!0,workspaceId:c(b),onAssign:O,onUnassign:t[2]||(t[2]=s=>O(null)),assigneeId:a.assignee,seat:null,disabled:!1,skipPermissionCheck:!0,class:"w-full"},null,8,["workspaceId","assigneeId"])])]),c(se).path.includes("/plan")?(i(),d("div",Ge,[t[15]||(t[15]=n("p",null,"Select Sheet",-1)),n("div",Je,[n("button",{class:"w-full flex items-center justify-between px-4 py-2 rounded-lg bg-card border border-border",onClick:t[3]||(t[3]=s=>M.value=!M.value)},[n("span",Ye,x(g.value&&((r=q.value.find(s=>s._id===g.value))==null?void 0:r.title)||"Select Sheet"),1),t[13]||(t[13]=n("i",{class:"fa-solid fa-chevron-down text-xs"},null,-1))]),M.value?(i(),d("div",Ze,[(i(!0),d(F,null,R(q.value,s=>(i(),d("div",{key:s._id,class:"flex items-center justify-between px-4 py-2 hover:bg-bg-dropdown-menu-hover cursor-pointer",onClick:y=>_e(s)},[n("span",Xe,x(s.title),1),n("div",et,[c(ee)?(i(),d("i",{key:0,class:"fa-solid fa-pen text-xs hover:text-primary",onClick:J(y=>ge(s),["stop"])},null,8,tt)):u("",!0),c(te)?(i(),d("i",{key:1,class:"fa-solid fa-trash text-xs hover:text-destructive",onClick:J(y=>ke(s),["stop"])},null,8,at)):u("",!0)])],8,He))),128)),c(ae)?(i(),d("div",{key:0,class:"border-t border-border px-4 py-2 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-1",onClick:De},t[14]||(t[14]=[n("i",{class:"fa-solid fa-plus"},null,-1),_(" Add new ")]))):u("",!0)])):u("",!0)])])):u("",!0)]),n("div",st,[f(qe,{label:"Description",placeholder:"What needs to be done, acceptance criteria, links…",modelValue:a.description,"onUpdate:modelValue":t[4]||(t[4]=s=>a.description=s),onBlur:t[5]||(t[5]=s=>l.description=!0)},null,8,["modelValue"])]),n("div",lt,[f(Y,{variant:"secondary",onClick:L},{default:$(()=>t[16]||(t[16]=[_("Cancel")])),_:1,__:[16]}),f(Y,{variant:"primary",disabled:c(w),onClick:Se},{default:$(()=>[_(x(c(w)?"Adding…":"Add Ticket"),1)]),_:1},8,["disabled"])])]}),_:1},8,["modelValue","size"]))}});export{it as _};
