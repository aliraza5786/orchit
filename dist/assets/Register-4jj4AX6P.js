import{d as j,r as m,b as q,u as M,c as v,e as I,x as O,f as D,w as p,o as V,g as o,i as G,j as d,k as J,l as Z,_ as y,h as i,t as A,m as C,B as h,n as H,p as K,q as Q,v as X}from"./index-DhNbIl3H.js";import{_ as Y,a as ee}from"./Header-h8YsuDZu.js";import{_ as te}from"./AuthLayout.vue_vue_type_script_setup_true_lang-Crn6Uvu8.js";import{r as ae,s as se}from"./auth-CfJuJlUR.js";import"./dark-logo-Mcb_sJlF.js";import"./favicon-BAFXWHLW.js";const oe={class:"max-w-[500px] md:mx-auto w-full"},re={key:0,class:"text-red-500 text-sm text-center mt-2"},le={class:"text-sm font-medium text-text-secondary text-center mt-8"},fe=j({__name:"Register",setup(ne){const g=X(),c=m(""),u=m(""),f=m(""),r=m(""),l={fName:m(!1),email:m(!1),password:m(!1)},B=q(),k=M(),_=v(()=>l.fName.value?c.value.trim()?c.value.trim().length<2?"Full name must be at least 2 characters":"":"Full name is required":""),x=v(()=>l.email.value?u.value.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u.value)?"":"Invalid email format":"Email is required":""),w=v(()=>l.password.value?f.value?/^(?=.*[a-z])(?=.*[A-Z])(?=.*[\W_]).{8,}$/.test(f.value)?"":"Password must be at least 8 characters and include uppercase, lowercase, and a special character":"Password is required":""),$=v(()=>!_.value&&!x.value&&!w.value),{mutate:R,isPending:S}=I({mutationFn:ae,onSuccess:()=>{g.push(`/otp-verification/${u.value}`)},onError:a=>{var e,t;r.value=((t=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:t.message)||"Something went wrong"}}),{mutateAsync:P}=I({mutationFn:se});async function z(){var a,e;try{const t=await K(),s=await Q.get("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${t.access_token}`}}),n=await P({u_email:s.data.email,u_social_id:s.data.sub,u_social_type:"google",u_full_name:s.data.name});N(n)}catch(t){(t==null?void 0:t.message)!=="Popup closed"&&(r.value=((e=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:e.message)||"Google Login failed. Please try again.")}}async function F(){var a,e;try{AppleID.auth.init({clientId:"100465282340299456069",scope:"name email",redirectURI:window.location.origin+"/register",usePopup:!0});const t=await AppleID.auth.signIn(),U=t.authorization.id_token.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),W=decodeURIComponent(atob(U).split("").map(function(T){return"%"+("00"+T.charCodeAt(0).toString(16)).slice(-2)}).join("")),b=JSON.parse(W),L=await P({u_email:b.email,u_social_id:b.sub,u_social_type:"apple",u_full_name:(a=t.user)!=null&&a.name?`${t.user.name.firstName} ${t.user.name.lastName}`:((e=b.email)==null?void 0:e.split("@")[0])||""});N(L)}catch(t){(t==null?void 0:t.error)!=="popup_closed_by_user"&&(r.value=(t==null?void 0:t.message)||"Apple Login failed. Please try again.")}}async function N(a){var t,s;localStorage.setItem("token",(t=a==null?void 0:a.data)==null?void 0:t.token),await B.bootstrap();const e=localStorage.getItem("post_auth_intent");if(e)try{const n=JSON.parse(e);localStorage.removeItem("post_auth_intent"),n.aiResponse&&k.setWorkspace(n.aiResponse),g.push(n.path||"/dashboard");return}catch(n){console.error("Failed to parse post_auth_intent",n),localStorage.removeItem("post_auth_intent")}if((s=a==null?void 0:a.data)!=null&&s.is_new_user){g.push("/create-profile");return}k.pricing?g.push("/dashboard?stripePayment=true"):g.push("/dashboard")}function E(){if(r.value="",l.fName.value=!0,l.email.value=!0,l.password.value=!0,!$.value){r.value="Please fill all fields correctly.";return}R({u_full_name:c.value,u_email:u.value,u_password:f.value})}return O([c,u,f],()=>{r.value&&(r.value="")}),(a,e)=>{const t=H("router-link");return V(),D(te,null,{form:p(()=>[o("div",oe,[e[14]||(e[14]=o("div",{class:"mb-12 space-y-2 text-center"},[o("h2",{class:"text-[32px] font-medium text-text-primary"},"Welcome to Orchit AI"),o("p",{class:"text-base font-medium text-text-secondary"},"Create your free account")],-1)),o("form",{onSubmit:G(E,["prevent"]),class:"space-y-4 w-full"},[d(y,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),label:"Full Name",placeholder:"Full Name",size:"lg",error:!!_.value,message:_.value,onBlur:e[1]||(e[1]=s=>l.fName.value=!0)},null,8,["modelValue","error","message"]),d(y,{modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=s=>u.value=s),label:"Email",placeholder:"john@example.com",size:"lg",error:!!x.value,message:x.value,onBlur:e[3]||(e[3]=s=>l.email.value=!0)},null,8,["modelValue","error","message"]),d(y,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=s=>f.value=s),label:"Password",placeholder:"Password",size:"lg",type:"password",error:!!w.value,message:w.value,onBlur:e[5]||(e[5]=s=>l.password.value=!0)},null,8,["modelValue","error","message"]),d(h,{disabled:C(S),size:"lg",block:!0,type:"submit"},{default:p(()=>[i(A(C(S)?"Creating Account...":"Sign up"),1)]),_:1},8,["disabled"]),e[12]||(e[12]=o("div",{class:"flex items-center"},[o("div",{class:"flex-grow border-t border-border"}),o("span",{class:"mx-3 text-[12px] text-primary"},"OR"),o("div",{class:"flex-grow border-t border-border"})],-1)),d(h,{size:"lg",block:!0,appearance:"outlined",variant:"ghost",type:"button",onClick:z},{icon:p(()=>e[6]||(e[6]=[o("img",{src:Y,class:"w-5 h-5 mr-4"},null,-1)])),default:p(()=>[e[7]||(e[7]=i(" Continue with google "))]),_:1,__:[7]}),d(h,{size:"lg",block:!0,appearance:"outlined",variant:"ghost",type:"button",class:"mt-4",onClick:F},{icon:p(()=>e[8]||(e[8]=[o("img",{src:ee,class:"w-5 h-5 mr-4"},null,-1)])),default:p(()=>[e[9]||(e[9]=i(" Continue with apple "))]),_:1,__:[9]}),r.value?(V(),J("p",re,A(r.value),1)):Z("",!0),e[13]||(e[13]=o("p",{class:"text-sm font-medium text-text-secondary text-center mt-6"},[i(" By signing up, I agree to the "),o("span",{class:"text-text-primary font-bold"},"Privacy Policy"),i(" and "),o("span",{class:"text-text-primary font-bold"},"Terms of Service"),i(". ")],-1)),o("p",le,[e[11]||(e[11]=i(" Already have an account? ")),d(t,{to:"/login",class:"text-text-primary font-bold underline"},{default:p(()=>e[10]||(e[10]=[i("Sign in")])),_:1,__:[10]})])],32)])]),_:1})}}});export{fe as default};
