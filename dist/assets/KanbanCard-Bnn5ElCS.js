import{d as G,c as W,r as w,q as ee,b as te,w as S,e as s,i as d,j as D,A as se,V as ae,a9 as ie,g as f,F as J,x as le,y as oe,ac as N,n as u,b0 as R,t as c,P as X,f as V,h as k,B as Z,S as ne,o as r,O as re,bi as de,a as ue,k as ce}from"./index-AKKd6Xtu.js";import{_ as me}from"./DropMenu.vue_vue_type_script_setup_true_lang-DsJy36mP.js";import{i as pe,j as fe,k as ge,l as ve}from"./usePeople-2qBiP_CW.js";import{_ as be}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-DRS5nHgS.js";const ye={class:"px-6 pb-2"},ke={class:"relative mb-4"},we=["onKeydown"],xe={key:0,class:"mt-3"},he={class:"divide-y divide-border rounded-xl border border-border bg-bg-card"},_e=["onClick"],Ce={class:"flex items-center gap-3 min-w-0"},Se=["src"],Ve={class:"min-w-0"},Ae={class:"truncate font-medium leading-tight capitalize"},$e={class:"truncate text-xs text-text-secondary leading-tight"},Te={key:1,class:"mt-3 flex items-center gap-2"},Me={class:"inline-flex items-center gap-2 rounded-full px-3 py-2 bg-bg-muted text-text-secondary"},je={class:"flex items-center justify-between gap-3 p-6 mt-3 pb-2 border-t border-border bg-bg-body"},qe={class:"flex gap-2 justify-between w-full"},De=G({__name:"AssignmentModal",props:{modelValue:{type:Boolean,default:!1},members:{default:()=>[]},directory:{default:()=>[]},placeholder:{default:"Search people by name or email"},isSubmitting:{}},emits:["update:modelValue","submit","copy-link"],setup(A,{emit:m}){const p=A,h=m,g=W({get:()=>p.modelValue,set:i=>h("update:modelValue",i)}),o=w(""),n=w(""),v=w(""),b=W(()=>{const i=o.value.trim().toLowerCase();return p.directory.filter(l=>{var e;return((e=l.name)==null?void 0:e.toLowerCase().includes(i))||l.email.toLowerCase().includes(i)})}),$=i=>{n.value=i.email,o.value=""},_=()=>{n.value=""},T=()=>{o.value&&(n.value=o.value.trim(),o.value="")},M=i=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i),j=()=>{if(!n.value||!M(n.value)){v.value="Please select a valid email.";return}h("submit",{invite:{email:n.value}})},q=()=>{_(),o.value="",g.value=!1};return ee(()=>{g.value&&(o.value="")}),(i,l)=>(r(),te(ne,{modelValue:g.value,"onUpdate:modelValue":l[1]||(l[1]=e=>g.value=e),size:"md"},{default:S(()=>[l[3]||(l[3]=s("div",{class:"sticky top-0 z-10 flex items-start gap-2 px-6 pb-4 mb-4 border-b border-border bg-bg-body"},[s("h2",{class:"text-xl font-semibold"},"Add team member")],-1)),s("div",ye,[s("div",ke,[se(s("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>o.value=e),type:"text",placeholder:"Search or add email",class:"w-full h-11 rounded-xl border border-border bg-bg-input px-3 text-sm outline-none focus:ring-2 focus:ring-primary/40",onKeydown:ie(f(T,["prevent"]),["enter"])},null,40,we),[[ae,o.value]])]),b.value.length?(r(),d("div",xe,[s("ul",he,[(r(!0),d(J,null,le(b.value,e=>(r(),d("li",{key:e.id||e.email,class:oe(["flex items-center justify-between gap-3 px-3 py-3 cursor-pointer hover:bg-bg-muted",{"bg-bg-muted":n.value===e.email}]),onClick:z=>$(e)},[s("div",Ce,[e!=null&&e.profile_image?(r(),d("img",{key:0,class:"h-9 w-9 rounded-full aspect-square",src:e==null?void 0:e.profile_image,alt:"avatar"},null,8,Se)):(r(),d("div",{key:1,class:"h-9 w-9 bg-white capitalize rounded-full flex items-center justify-center text-xs font-semibold",style:N({backgroundColor:u(R)({email:e.email})})},c(u(X)(e.name||e.email)),5)),s("div",Ve,[s("div",Ae,c(e.name||e.email),1),s("div",$e,c(e.email),1)])])],10,_e))),128))])])):D("",!0),n.value?(r(),d("div",Te,[s("span",Me,[V(c(n.value)+" ",1),s("button",{onClick:_,class:"ml-2 text-sm text-red-500"},"✕")])])):D("",!0)]),s("div",je,[s("div",qe,[k(Z,{variant:"secondary",onClick:q},{default:S(()=>l[2]||(l[2]=[V("Cancel")])),_:1,__:[2]}),k(Z,{variant:"primary",disabled:!!(!n.value||i.isSubmitting),onClick:j},{default:S(()=>[V(c(i.isSubmitting?"Assigning…":"Assign"),1)]),_:1},8,["disabled"])])])]),_:1,__:[3]},8,["modelValue"]))}}),Ne={class:"flex justify-between gap-2 items-start w-full"},ze={class:"flex items-center gap-2 w-[90%]"},Be=["src"],Ie={key:0,class:"fa-solid fa-user text-white"},Ue={class:"max-w-[70%]"},Pe={class:"text-sm font-medium mb-1 text-card-foreground leading-tight w-full"},Ke={class:"text-text-secondary text-xs overflow-hidden overflow-ellipsis"},Ee={class:"group-hover:flex justify-center items-center hidden w-6 h-6 bg-bg-surface/40 rounded-md"},Oe=G({__name:"KanbanCard",props:{ticket:{}},setup(A){const m=w(!1),p=A,{workspaceId:h}=re(),{data:g}=de(),{data:o}=pe(h.value,g),n=w([]),v=w(!1),b=ue();function $(){return[{label:"Assign User",danger:!0,action:()=>{m.value=!0},icon:{prefix:"fa-regular",iconName:"fa-user-plus"}},...p.ticket.name?[{label:"UnAssign User",danger:!0,action:()=>{Y()},icon:{prefix:"fa-regular",iconName:"fa-user-minus"}}]:[],{label:"Delete Seat",danger:!0,action:()=>{v.value=!0},icon:{prefix:"fa-regular",iconName:"fa-trash"}}]}const _=()=>{},{mutate:T,isPending:M}=fe({onSuccess:()=>{b.invalidateQueries({queryKey:["people-lists"]})}}),j=()=>{T({id:p.ticket._id})},{mutate:q,isPending:i}=ge({onSuccess:()=>{m.value=!1,b.invalidateQueries({queryKey:["people-lists"]})}});function l(a){const C=(a.split("@")[0]||"").split("+")[0].split(/[^a-zA-Z]+/).filter(Boolean);return C.length?C.map(x=>x.charAt(0).toUpperCase()+x.slice(1).toLowerCase()).join(" "):a}const{mutate:e}=ve({onSuccess:()=>{m.value=!1,b.invalidateQueries({queryKey:["people-lists"]})}});function z(a){q({id:p.ticket._id,payload:{name:l(a.email),email:a.email}})}function Y(){e({id:p.ticket._id})}return(a,t)=>{var x,B,I,U,P,K,E,L,F,Q,H,O;const C=ce("AssigmentDropdown");return r(),d(J,null,[s("div",{onClick:t[2]||(t[2]=y=>a.$emit("click")),class:"group bg-bg-card rounded-lg p-4 shadow-sm cursor-grab hover:shadow-md transition-all duration-200 active:cursor-grabbing",style:N({borderColor:(B=(x=a.ticket)==null?void 0:x.lane)==null?void 0:B.variables["lane-color"]})},[s("div",Ne,[s("div",ze,[(I=a.ticket)!=null&&I.avatar?(r(),d("img",{key:0,src:(U=a.ticket)==null?void 0:U.avatar,class:"min-w-10 w-10 h-10 rounded-full object-cover",alt:"avartar"},null,8,Be)):(r(),d("div",{key:1,class:"w-10 min-w-10 overflow-hidden overflow-ellipsis aspect-square bg-bg-surface flex justify-center items-center rounded-full",style:N({backgroundColor:(P=a.ticket)!=null&&P.name?u(R)({email:(K=a.ticket)==null?void 0:K.email}):""})},[V(c(u(X)((E=a.ticket)==null?void 0:E.name))+" ",1),(L=a.ticket)!=null&&L.name?D("",!0):(r(),d("i",Ie))],4)),s("div",Ue,[s("h3",Pe,c(((F=a.ticket)==null?void 0:F.name)??a.ticket.title??"Team Member "),1),s("p",Ke,c((Q=a.ticket)==null?void 0:Q.email),1)])]),s("div",Ee,[k(me,{onClick:t[0]||(t[0]=f(()=>{},["stop"])),items:$()},{trigger:S(()=>t[11]||(t[11]=[s("i",{class:"cursor-pointer fa-solid fa-ellipsis"},null,-1)])),_:1},8,["items"])])]),s("div",{onClick:t[1]||(t[1]=f(()=>{},["stop"]))},[k(C,{users:n.value,onAssign:_,assigneeId:a.ticket.assigned_to},null,8,["users","assigneeId"])])],4),s("div",{class:"no-drag-zone",draggable:"false",onMousedown:t[8]||(t[8]=f(()=>{},["stop"])),onTouchstart:t[9]||(t[9]=f(()=>{},["stop"])),onPointerdown:t[10]||(t[10]=f(()=>{},["stop"]))},[k(be,{onClick:t[3]||(t[3]=f(()=>{},["stop"])),modelValue:v.value,"onUpdate:modelValue":t[4]||(t[4]=y=>v.value=y),title:"Delete Team seat",itemLabel:"Seat",itemName:a.ticket.title,requireMatchText:a.ticket.title,confirmText:"Delete Seat",cancelText:"Cancel",size:"md",loading:u(M),onConfirm:j,onCancel:t[5]||(t[5]=()=>{v.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),k(De,{isSubmitting:u(i),modelValue:m.value,"onUpdate:modelValue":t[6]||(t[6]=y=>m.value=y),members:(H=u(o))==null?void 0:H.people,directory:(O=u(o))==null?void 0:O.people,onSubmit:t[7]||(t[7]=({invite:y})=>z(y))},null,8,["isSubmitting","modelValue","members","directory"])],32)],64)}}});export{Oe as default};
