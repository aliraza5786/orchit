import{_ as B}from"./whitePlus-Cs_P7rE9.js";import{d as S,r as b,M as P,q as U,i as o,e as a,t as l,F as y,x as w,j as v,f as c,h as m,w as u,B as x,_ as q,o as i}from"./index-vaYjaRQi.js";import{_ as F}from"./BaseTextAreaField.vue_vue_type_script_setup_true_lang-DyZXOypc.js";import{_ as H}from"./BaseEmailChip.vue_vue_type_script_setup_true_lang-CiTBLgrP.js";import{u as G}from"./workspace-CIZghkM1.js";const J={class:"w-full"},K={class:"text-sm md:text-base text-text-secondary text-left mt-3 sm:mt-5.5 mb-0 md:mb-6"},O={class:"space-y-3 w-full pb-[80px]"},Q={class:"flex items-center justify-between mb-2"},X={class:"flex gap-4 items-start text-2xl justify-between w-full"},Y={class:"flex flex-col text-text-primary text-lg font-semibold flex-1 min-w-0"},Z={key:0,class:"text-xl mr-2"},ee={class:"text-sm text-text-secondary break-words"},te={class:"flex items-center gap-3 text-text-primary flex-shrink-0"},se=["onClick","title","aria-label"],ae={key:0},ne={key:1,class:"text-base cursor-pointer"},oe={class:"text-lg"},ie=["onClick"],le={class:"text-text-primary"},pe={class:"text-sm font-medium text-text-secondary mb-2 flex justify-between items-center gap-2.5"},me={class:"flex items-center gap-2"},ce={class:"text-xs text-text-secondary"},re={key:0,class:"text-sm text-text-secondary mb-3"},de={class:"text-sm font-medium capitalize"},ue={class:"text-xs text-text-secondary"},xe=["onClick"],_e={key:1,class:"mt-2 space-y-2"},fe={class:"flex items-center justify-end gap-2"},ye={key:1,class:"bg-bg-surface mt-2 cursor-pointer rounded-xl p-6"},ve={class:"flex gap-2 mt-6 justify-end"},Ee=S({__name:"StepThree",props:{ai:{type:Boolean}},setup(ge,{expose:h}){const f=G(),_=b(!1),p=b({name:"",description:""}),r=P({roles:[]}),k=/^[^\s@]+@[^\s@]+\.[^\s@]+$/i,C=e=>k.test(e);function I(e){e.showInput=!0,e.capacityWarning=e.people.length>=e.max_num_people}function g(e){for(;e.people.length>e.max_num_people;)e.people.pop();e.capacityWarning=e.people.length>=e.max_num_people}function E(e,s){e.people.some(t=>t.email.toLowerCase()===s.toLowerCase())||e.people.push({name:s.split("@")[0],email:s})}function j(e,s){const[t]=e.people.splice(s,1),n=e.emailList.findIndex(d=>d.toLowerCase()===t.email.toLowerCase());n!==-1&&e.emailList.splice(n,1),e.capacityWarning=e.people.length>=e.max_num_people}function L(e,s){e.emailError=s.length?`Invalid: ${s.join(", ")}`:""}function V(e,s){s.forEach(t=>{C(t)&&(e.people.length<e.max_num_people?E(e,t):e.capacityWarning=!0)})}function W(e,s){const t=e.people.findIndex(n=>n.email.toLowerCase()===s.toLowerCase());t!==-1&&e.people.splice(t,1),e.capacityWarning=e.people.length>=e.max_num_people}function $(e){e.showInput=!1,e.capacityWarning=e.people.length>=e.max_num_people}function T(e){e.showInput=!1,e.emailError="",e.capacityWarning=e.people.length>=e.max_num_people}function N(){const e={id:`role-${Date.now()}`,title:p.value.name,description:p.value.description,people:[],showInput:!1,max_num_people:1,role_emoji:"",emailList:[],emailError:"",capacityWarning:!1};r.roles.push(e),p.value.name="",p.value.description="",_.value=!1}function R(){const e=f.workspace,s=e||{variables:{roles:[]}};s.variables.roles=r.roles,f.setWorkspace(s)}U(()=>{try{const e=f.workspace;if(e){const s=e;r.roles=(s.variables.roles||[]).map(t=>{var n;return{...t,showInput:t.showInput??!1,emailList:t.emailList??((n=t.people)==null?void 0:n.map(d=>d.email))??[],emailError:"",capacityWarning:!1,max_num_people:typeof t.max_num_people=="number"?t.max_num_people:1,role_emoji:t.role_emoji??""}})}}catch(e){console.error("Error parsing workspace from localStorage",e)}});function A(e){e.max_num_people>1&&(e.max_num_people--,g(e))}function z(e){e.max_num_people++,g(e)}function M(){R()}function D(e){const s=r.roles.findIndex(t=>t.id===e);s!==-1&&r.roles.splice(s,1)}return h({continueHandler:M}),(e,s)=>(i(),o(y,null,[a("div",J,[s[4]||(s[4]=a("h2",{class:"text-2xl md:text-5xl font-semibold text-text-primary text-left m-0"},"Team Resources",-1)),a("p",K,l(e.ai?" AI-recommended team composition for your project":"Team composition for your project"),1)]),a("div",O,[(i(!0),o(y,null,w(r.roles,t=>(i(),o("div",{key:t.id,class:"bg-bg-surface rounded-xl p-6"},[a("div",Q,[a("div",X,[a("div",Y,[a("span",null,[t!=null&&t.role_emoji?(i(),o("span",Z,l(t.role_emoji),1)):v("",!0),c(" "+l(t.title),1)]),a("p",ee,l(t.description),1)]),a("div",te,[a("button",{onClick:n=>t.max_num_people===1?D(t.id):A(t),class:"w-8 cursor-pointer h-8 aspect-square rounded-full bg-bg-card flex items-center justify-center text-xl",title:t.max_num_people===1?"Remove team":"Decrease capacity","aria-label":t.max_num_people===1?"Remove team":"Decrease capacity"},[t.max_num_people>1?(i(),o("span",ae,"−")):(i(),o("span",ne,s[5]||(s[5]=[a("i",{class:"fa-regular fa-trash"},null,-1)])))],8,se),a("span",oe,l(t.max_num_people),1),a("button",{onClick:n=>z(t),class:"w-8 h-8 aspect-square cursor-pointer rounded-full bg-bg-card flex items-center justify-center text-xl",title:"Increase capacity","aria-label":"Increase capacity"},"+",8,ie)])])]),a("div",le,[a("p",pe,[s[7]||(s[7]=c(" Team Members ")),a("span",me,[a("span",ce,l(t.people.length)+"/"+l(t.max_num_people),1),m(x,{size:"sm",variant:"secondary",onClick:n=>I(t),disabled:t.people.length>=t.max_num_people,title:"Add people by email"},{default:u(()=>s[6]||(s[6]=[c(" Add people ")])),_:2,__:[6]},1032,["onClick","disabled"])])]),t.people.length===0?(i(),o("div",re," No team members assigned yet ")):v("",!0),(i(!0),o(y,null,w(t.people,(n,d)=>(i(),o("div",{key:d,class:"flex justify-between items-center mb-3"},[a("div",null,[a("p",de,l(n.name),1),a("p",ue,l(n.email),1)]),a("button",{onClick:be=>j(t,d),class:"text-text-primary w-8 h-8 bg-bg-card rounded-md cursor-pointer"},"✕",8,xe)]))),128)),t.showInput?(i(),o("div",_e,[m(H,{modelValue:t.emailList,"onUpdate:modelValue":n=>t.emailList=n,error:!!t.emailError||t.capacityWarning,message:t.capacityWarning?`Reached role capacity (${t.max_num_people}).`:t.emailError||"Press Enter, comma, semicolon, or space to add. Invalid entries won’t be added.",showName:"",onInvalid:n=>L(t,n),onAdd:n=>V(t,n),onRemove:n=>W(t,n)},null,8,["modelValue","onUpdate:modelValue","error","message","onInvalid","onAdd","onRemove"]),a("div",fe,[m(x,{onClick:n=>$(t),variant:"primary"},{default:u(()=>s[8]||(s[8]=[c("Done")])),_:2,__:[8]},1032,["onClick"]),m(x,{onClick:n=>T(t),variant:"secondary"},{default:u(()=>s[9]||(s[9]=[c("Cancel")])),_:2,__:[9]},1032,["onClick"])])])):v("",!0)])]))),128)),_.value?(i(),o("div",ye,[s[13]||(s[13]=a("h1",{class:"text-lg text-text-primary font-semibold"},"Add New Team",-1)),s[14]||(s[14]=a("br",null,null,-1)),m(q,{label:"Team Name",modelValue:p.value.name,"onUpdate:modelValue":s[1]||(s[1]=t=>p.value.name=t),placeholder:"Enter Team Name",size:"lg"},null,8,["modelValue"]),m(F,{label:"Description",class:"mt-4",modelValue:p.value.description,"onUpdate:modelValue":s[2]||(s[2]=t=>p.value.description=t),placeholder:"Enter Description",size:"lg"},null,8,["modelValue"]),a("div",ve,[m(x,{size:"md",variant:"primary",onClick:N},{default:u(()=>s[11]||(s[11]=[c(" Add Team ")])),_:1,__:[11]}),m(x,{size:"md",variant:"secondary",onClick:s[3]||(s[3]=t=>_.value=!1)},{default:u(()=>s[12]||(s[12]=[c("Cancel")])),_:1,__:[12]})])])):(i(),o("div",{key:0,class:"bg-bg-surface mt-2 cursor-pointer rounded-xl p-6 flex flex-col justify-center items-center",onClick:s[0]||(s[0]=t=>_.value=!0)},s[10]||(s[10]=[a("div",{class:"p-2.5 bg-accent w-8 h-8 rounded-full"},[a("img",{class:"w-3",src:B,alt:""})],-1),a("h3",{class:"font-medium text-text-primary capitalize text-sm mt-4"},"Add New Team",-1),a("p",{class:"text-[11px] text-text-secondary mt-1 text-start line-clamp-1"},"Create a custom resource type",-1)])))])],64))}});export{Ee as default};
