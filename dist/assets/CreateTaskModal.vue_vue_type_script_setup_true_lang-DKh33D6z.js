import{d as Z,U as ee,M as te,L as ae,a1 as le,$ as se,a0 as re,c as i,J as z,n as u,e as I,W as ie,w as C,o as n,h as r,i as D,k as o,l as c,m as p,_ as de,H as U,y as ne,C as oe,D as ue,F as ce,z as q,p as g,X as L,t as S,a2 as pe,B as $}from"./index-CAkNnYq1.js";const me={class:"px-6 grid grid-cols-1 sm:grid-cols-2 gap-4"},fe={key:0,class:"flex flex-col"},be={key:1,class:"flex gap-1 flex-col"},ve={key:0,class:"text-xs text-red-500"},De={key:2,class:"flex gap-1 flex-col"},ge={key:0,class:"text-xs text-red-500"},_e={class:"px-6 mt-2"},Ve={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},ke=Z({__name:"CreateTaskModal",props:{modelValue:{type:Boolean,default:!1},sheet_id:{},listId:{},selectedVariable:{},pin:{},size:{default:"lg"}},emits:["update:modelValue","created"],setup(A,{emit:O}){const{canCreateCard:N}=ee(),P=O,d=A,M=te(),{workspaceId:_,moduleId:F}=ae(),{mutate:K,isPending:V}=le({onSuccess:()=>{B(),M.invalidateQueries({queryKey:["sheet-list"]}),f.value=!1}}),{data:x}=se(_.value),{data:m}=re(_.value,F.value,d.sheet_id),f=i({get:()=>d.modelValue,set:e=>P("update:modelValue",e)}),h=i(()=>((m==null?void 0:m.value)??[]).filter(e=>{var a;return((a=e==null?void 0:e.type)==null?void 0:a.title)==="Select"})),Q=e=>e.map(a=>({_id:a,title:a})),w=i(()=>((x==null?void 0:x.value)??[]).map(e=>{var a;return{_id:e._id,title:((a=e==null?void 0:e.variables)==null?void 0:a["lane-title"])??String(e._id)}})),T=e=>e.slug,t=z({title:"",description:"",startDate:null,endDate:null,lane_id:null,variables:{}});u(h,e=>{for(const a of e){const s=T(a);s in t.variables||(t.variables[s]=null)}},{immediate:!0});const l=z({title:!1,description:!1,startDate:!1,endDate:!1,lane:!1}),R=i(()=>!!t.title.trim()&&(d.pin?!0:!!t.startDate&&!!t.endDate)&&!k.value&&!b.value&&!v.value&&!y.value);function W(e){t.startDate=e,l.startDate=!0}function j(e){t.endDate=e,l.endDate=!0}function H(e){t.lane_id=e,l.lane=!0}function J(){f.value=!1,B()}function B(){t.title="",t.description="",t.startDate=null,t.endDate=null,t.lane_id=null,t.variables={},l.title=!1,l.description=!1,l.startDate=!1,l.endDate=!1,l.lane=!1}const X=i(()=>m.value.find(e=>(e==null?void 0:e._id)==d.selectedVariable)),k=i(()=>l.title&&!t.title.trim()?"Title is required":""),b=i(()=>l.startDate?t.startDate?"":"Start date is required":""),v=i(()=>l.endDate?t.endDate?t.startDate&&t.endDate&&t.endDate<t.startDate?"End date cannot be before start date":"":"End date is required":""),y=i(()=>l.lane?t.lane_id?"":"Lane is required":""),E=new Date().toISOString().split("T")[0];function G(){var a;if(l.title=!0,l.description=!0,d.pin||(l.startDate=!0,l.endDate=!0),!R.value||V.value||!N.value)return;const e={sheet_list_id:d.listId,workspace_id:_.value,sheet_id:d.sheet_id,workspace_lane_id:t.lane_id,variables:{...t.variables,[`${(a=X.value)==null?void 0:a.slug}`]:d.listId,"card-title":t.title.trim(),"card-description":t.description.trim(),"start-date":t.startDate,"end-date":t.endDate},createdAt:new Date().toISOString()};K(e)}return u(()=>t.title,e=>{e!=null&&e.trim()&&l.title&&(l.title=!1)}),u(()=>t.lane_id,e=>{e&&l.lane&&(l.lane=!1)}),u(()=>t.startDate,e=>{e&&l.startDate&&(l.startDate=!1)}),u(()=>t.endDate,e=>{e&&l.endDate&&(l.endDate=!1)}),u(()=>t.description,e=>{e!=null&&e.trim()&&l.description&&(l.description=!1)}),(e,a)=>(n(),I(ie,{modelValue:f.value,"onUpdate:modelValue":a[4]||(a[4]=s=>f.value=s),modalClass:"!py-0",size:e.size},{default:C(()=>[a[8]||(a[8]=r("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[r("h2",{class:"text-xl font-semibold"},"Create Ticket"),r("p",{class:"text-sm text-text-secondary mt-1"},[D(" Provide the details below and click "),r("span",{class:"font-medium"},"Add Ticket"),D(". ")])],-1)),r("div",me,[o(de,{modelValue:t.title,"onUpdate:modelValue":a[0]||(a[0]=s=>t.title=s),label:"Ticket Title",placeholder:"e.g., Implement real-time notifications",error:!!k.value,message:k.value,onBlur:a[1]||(a[1]=s=>l.title=!0)},null,8,["modelValue","error","message"]),w.value.length>0?(n(),c("div",fe,[o(U,{size:"md",label:"Lane",options:w.value,placeholder:"Select lane",allowCustom:!1,"model-value":t.lane_id,"onUpdate:modelValue":H,error:!!y.value,message:y.value},null,8,["options","model-value","error","message"])])):p("",!0),(n(!0),c(ce,null,ne(h.value,s=>oe((n(),I(U,{size:"md",key:T(s),modelValue:t.variables[s.slug],"onUpdate:modelValue":Y=>t.variables[s.slug]=Y,options:Q(s.data),label:s.title,placeholder:"Select value",allowCustom:!0},null,8,["modelValue","onUpdate:modelValue","options","label"])),[[ue,(s==null?void 0:s._id)!=e.selectedVariable]])),128)),e.pin?p("",!0):(n(),c("div",be,[a[5]||(a[5]=r("label",{class:"text-sm"},"Start date",-1)),r("div",{class:q(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",b.value?"border-red-500":""])},[o(L,{placeholder:"Set start date",class:"w-full","model-value":t.startDate,"emit-as":"ymd","onUpdate:modelValue":W,"min-date":g(E)},null,8,["model-value","min-date"])],2),b.value?(n(),c("p",ve,S(b.value),1)):p("",!0)])),e.pin?p("",!0):(n(),c("div",De,[a[6]||(a[6]=r("label",{class:"text-sm"},"End date",-1)),r("div",{class:q(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",v.value?"border-red-500":""])},[o(L,{placeholder:"Set end date",class:"w-full","model-value":t.endDate,"emit-as":"ymd","onUpdate:modelValue":j,"min-date":t.startDate||g(E)},null,8,["model-value","min-date"])],2),v.value?(n(),c("p",ge,S(v.value),1)):p("",!0)]))]),r("div",_e,[o(pe,{label:"Description",placeholder:"What needs to be done, acceptance criteria, links…",modelValue:t.description,"onUpdate:modelValue":a[2]||(a[2]=s=>t.description=s),onBlur:a[3]||(a[3]=s=>l.description=!0)},null,8,["modelValue"])]),r("div",Ve,[o($,{variant:"secondary",onClick:J},{default:C(()=>a[7]||(a[7]=[D("Cancel")])),_:1,__:[7]}),o($,{variant:"primary",disabled:g(V),onClick:G},{default:C(()=>[D(S(g(V)?"Adding…":"Add Ticket"),1)]),_:1},8,["disabled"])])]),_:1,__:[8]},8,["modelValue","size"]))}});export{ke as _};
