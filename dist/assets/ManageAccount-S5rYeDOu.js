import{d as E,P as q,r as c,$ as P,c as R,u as S,h as n,b as l,m as f,i as A,g as v,w as j,e as C,B as U,t as _,F as M,v as O,o as i,S as $,a0 as z,a1 as J}from"./index-4VVrnSvV.js";import{_ as g}from"./BaseTextField.vue_vue_type_script_setup_true_lang-BOTvTtsA.js";import{a as F}from"./useCommon-Fwq2lbvO.js";import"./info-DjaLHeD_.js";const K={class:"bg-bg-body min-h-screen py-10 px-4 text-text-primary"},Q={class:"max-w-4xl mx-auto bg-bg-body border-border border shadow rounded-lg p-6"},Y={key:0},G={key:1},H={key:2},W={class:"relative h-44 w-full rounded-md bg-bg-surface mb-8 overflow-hidden"},X=["src"],Z={class:"flex items-center gap-4 mb-6 relative"},ee={class:"relative w-20 h-20"},ae={class:"w-20 aspect-square rounded-full bg-orange-500 flex items-center justify-center text-text-primary text-xl font-bold overflow-hidden"},te=["src"],le={key:1},oe={class:"text-lg font-medium"},se={class:"text-sm text-text-secondary"},ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ie={class:"mt-6"},re={class:"list-disc list-inside text-sm text-text-secondary"},ue={class:"mt-8 flex justify-end"},ve=E({__name:"ManageAccount",setup(de){const{data:p,isLoading:N,isError:I}=q({queryKey:["profile"],queryFn:$}),a=c({fullName:"",email:"",jobTitle:"",department:"",location:"",teams:[]}),b=c(""),y=c(""),x=c(""),h=c(""),k=c(null),V=c(null);P(()=>{if(!p.value)return;const o=p.value.data;a.value.fullName=o.u_full_name,a.value.email=o.u_email,a.value.jobTitle=o.u_job_title,a.value.department=o.u_department,a.value.location=o.u_location,a.value.teams=o.teams||[]});const L=R(()=>a.value.fullName.split(" ").map(o=>o[0]).join("").toUpperCase());async function T(o){var u,d,m,t;const e=(d=(u=o.target)==null?void 0:u.files)==null?void 0:d[0];if(!e)return;x.value=URL.createObjectURL(e);const r=new FormData;r.append("file",e);try{const s=await F(r);b.value=(m=s==null?void 0:s.data)==null?void 0:m.url,(t=s==null?void 0:s.data)!=null&&t.url&&w()}catch{alert("Upload failed")}}async function D(o){var u,d,m,t;const e=(d=(u=o.target)==null?void 0:u.files)==null?void 0:d[0];if(!e)return;h.value=URL.createObjectURL(e);const r=new FormData;r.append("file",e);try{const s=await F(r);y.value=(m=s==null?void 0:s.data)==null?void 0:m.url,(t=s==null?void 0:s.data)!=null&&t.url&&w()}catch{alert("Upload failed")}}const{mutate:B}=S({mutationFn:o=>z(o),onSuccess:()=>{J.push("/profile")},onError:()=>{alert("Failed to update profile.")}});function w(){const o={u_full_name:a.value.fullName,u_job_title:a.value.jobTitle,u_department:a.value.department,u_location:a.value.location,...b.value&&{u_profile_image:b.value},...y.value&&{u_cover_image:y.value}};B(o)}return(o,e)=>{var r,u,d,m;return i(),n("div",K,[l("div",Q,[e[10]||(e[10]=l("h1",{class:"text-2xl font-semibold mb-6"},"Manage Your Account",-1)),f(N)?(i(),n("div",Y,"Loading...")):f(I)?(i(),n("div",G,"Failed to load profile")):(i(),n("div",H,[l("div",W,[h.value||(u=(r=f(p))==null?void 0:r.data)!=null&&u.u_cover_image?(i(),n("img",{key:0,src:h.value||f(p).data.u_cover_image,class:"w-full h-full object-cover"},null,8,X)):A("",!0),l("input",{ref_key:"coverInput",ref:V,type:"file",accept:"image/*",class:"hidden",onChange:D},null,544),v(U,{variant:"secondary",size:"sm",class:"!absolute top-2 right-2",onClick:e[0]||(e[0]=()=>{var t;return(t=V.value)==null?void 0:t.click()})},{default:j(()=>e[6]||(e[6]=[C(" Change Cover ")])),_:1,__:[6]})]),l("div",Z,[l("div",ee,[l("div",ae,[x.value||(m=(d=f(p))==null?void 0:d.data)!=null&&m.u_profile_image?(i(),n("img",{key:0,src:x.value||f(p).data.u_profile_image,alt:"Profile",class:"w-full h-full object-cover"},null,8,te)):(i(),n("span",le,_(L.value),1))]),l("input",{ref_key:"avatarInput",ref:k,type:"file",accept:"image/*",class:"hidden",onChange:T},null,544),l("button",{class:"absolute aspect-square w-6 bottom-0 right-0 bg-bg-card border border-gray cursor-pointer rounded-full p-1 text-xs shadow",onClick:e[1]||(e[1]=()=>{var t;return(t=k.value)==null?void 0:t.click()})},e[7]||(e[7]=[l("i",{class:"fa-solid fa-pen"},null,-1)]))]),l("div",null,[l("p",oe,_(a.value.fullName),1),l("p",se,_(a.value.email),1)])]),l("div",ne,[v(g,{label:"Job Title",placeholder:"Frontend Dev",modelValue:a.value.jobTitle,"onUpdate:modelValue":e[2]||(e[2]=t=>a.value.jobTitle=t)},null,8,["modelValue"]),v(g,{label:"Department",placeholder:"web department",modelValue:a.value.department,"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.department=t)},null,8,["modelValue"]),v(g,{label:"Location",placeholder:"house #143 , B4",modelValue:a.value.location,"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.location=t)},null,8,["modelValue"]),v(g,{label:"Email address",modelValue:a.value.email,"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.email=t),disabled:""},null,8,["modelValue"])]),l("div",ie,[e[8]||(e[8]=l("label",{class:"block text-sm font-medium text-text-secondary mb-1"},"Teams",-1)),l("ul",re,[(i(!0),n(M,null,O(a.value.teams,t=>(i(),n("li",{key:t},_(t),1))),128))])]),l("div",ue,[v(U,{onClick:w,variant:"primary"},{default:j(()=>e[9]||(e[9]=[C(" Save Changes ")])),_:1,__:[9]})])]))])])}}});export{ve as default};
