import{d as A,J as E,aG as G,c as V,r as p,m as M,a as J,aa as W,ab as Y,Y as O,i as r,F as X,e as s,a6 as Z,y as ee,j as u,t as n,h as c,g as i,w as te,s as q,bc as se,n as I,U as ae,o as d,H as ie}from"./index-B_w4BlL9.js";import{_ as oe}from"./DropMenu.vue_vue_type_script_setup_true_lang-mMDvjKUv.js";import{_ as le}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-DMFxbu7w.js";const re={class:"flex justify-between gap-2 items-start mb-3"},ne={class:"flex gap-2 flex-wrap items-center"},de={key:0,class:"text-[10px] px-2 py-1 h-6 rounded bg-bg-surface/60 text-text-secondary font-medium uppercase"},ue={key:1,class:"text-[10px] px-2 py-1 h-6 rounded bg-accent/20 text-accent font-medium"},ce={class:"product-menu-icon transition-all w-6 py-1 px-2 h-6 flex justify-center items-center duration-100 ease-in-out bg-bg-surface/40 rounded-md"},me={class:"text-sm font-medium text-card-foreground leading-tight mb-2 capitalize"},pe={key:0,class:"flex justify-between items-center mt-3 pt-3 border-t border-border/50"},ge={class:"flex items-center gap-3 flex-1"},fe={class:"flex items-center gap-2"},ke={class:"flex items-center gap-1 text-xs text-text-secondary"},ye={key:0,class:"flex items-center gap-1 text-xs text-text-secondary"},ve=A({__name:"KanbanTicket",props:{ticket:{},selectedVar:{},footer:{type:Boolean}},emits:["select"],setup(K,{emit:B}){const{workspaceId:g,moduleId:_}=E(),{data:Q}=G(g.value),a=K,z={critical:"border-l-priority-critical",high:"border-l-priority-high",medium:"border-l-priority-medium",low:"border-l-priority-low"},N=V(()=>z[a.ticket.priority]??"border-l-gray-300"),o=p(!1),f=p(a.ticket["end-date"]??null),S=p(a.ticket["start-date"]??null);M(()=>{var e;return(e=a.ticket)==null?void 0:e["end-date"]},e=>{f.value=e??null}),M(()=>{var e;return(e=a.ticket)==null?void 0:e["start-date"]},e=>{S.value=e??null});const l=J(),k=W({onSuccess:()=>{l.invalidateQueries({queryKey:["people-lists"]}),l.invalidateQueries({queryKey:["get-sheets"]}),l.invalidateQueries({queryKey:["sheet-list"]}),l.invalidateQueries({queryKey:["roles"]})}}),{mutate:j,isPending:H}=Y(a.ticket._id,{onSuccess:()=>{l.invalidateQueries({queryKey:["sheet-list"]}),o.value=!1}});function L(){return[{label:"Delete",danger:!0,action:()=>{o.value=!0}}]}const P=()=>{j({})},U=e=>{const t={card_id:a.ticket._id,seat_id:e==null?void 0:e._id};k.mutate(t)},$=e=>{k.mutate({card_id:a.ticket._id,variables:{"end-date":e}})},{data:m}=O(g.value,_.value,""),y=V(()=>((m==null?void 0:m.value)??[]).filter(e=>e._id==a.selectedVar)),F=B;return(e,t)=>{var v,x,b,C,w,T,h,D;return d(),r(X,null,[s("div",{onClick:t[4]||(t[4]=()=>{F("select")}),class:ee(["product-ticket relative bg-bg-card rounded-lg p-4 shadow-sm cursor-grab border-t-4 hover:shadow-md transition-all duration-200 active:cursor-grabbing",N.value]),style:Z({borderColor:(x=(v=e.ticket)==null?void 0:v.lane)==null?void 0:x.variables["lane-color"]})},[s("div",re,[s("div",ne,[e.ticket["card-type"]&&((b=y.value[0])==null?void 0:b.slug)!="card-type"?(d(),r("span",de,n(e.ticket["card-type"]),1)):u("",!0),e.ticket["card-status"]&&((C=y.value[0])==null?void 0:C.slug)!="card-status"?(d(),r("span",ue,n(e.ticket["card-status"]),1)):u("",!0)]),s("div",ce,[c(oe,{onClick:t[0]||(t[0]=i(()=>{},["stop"])),items:L()},{trigger:te(()=>t[11]||(t[11]=[s("i",{class:"cursor-pointer text-sm fa-solid fa-ellipsis"},null,-1)])),_:1},8,["items"])])]),s("h3",me,n(e.ticket["card-title"]),1),t[1]||(q(-1,!0),(t[1]=s("p",{innerHTML:e.ticket["card-description"],class:"text-xs text-muted-foreground mb-3 text-text-secondary line-clamp-2"},null,8,["innerHTML"])).cacheIndex=1,q(1),t[1]),e.footer?u("",!0):(d(),r("div",pe,[s("div",ge,[s("div",{onClick:t[2]||(t[2]=i(()=>{},["stop"]))},[c(se,{users:I(Q),onAssign:U,assigneeId:e.ticket.assigned_to,seat:(w=e.ticket)==null?void 0:w.seat},null,8,["users","assigneeId","seat"])]),s("div",{onClick:t[3]||(t[3]=i(()=>{},["stop"])),class:"flex items-center gap-2 text-nowrap overflow-ellipsis text-xs text-text-secondary"},[c(ae,{placeholder:"end date","model-value":f.value,theme:"dark","emit-as":"ymd","onUpdate:modelValue":$},null,8,["model-value"])])]),s("div",fe,[s("div",ke,[t[12]||(t[12]=s("i",{class:"fa-regular fa-message text-[10px]"},null,-1)),s("span",null,n((T=e.ticket)==null?void 0:T.comments_count),1)]),(h=e.ticket)!=null&&h.attachments?(d(),r("div",ye,[t[13]||(t[13]=s("i",{class:"fa-regular fa-file text-[10px]"},null,-1)),s("span",null,n((D=e.ticket)==null?void 0:D.attachments.length),1)])):u("",!0)])]))],6),s("div",{class:"no-drag-zone",draggable:"false",onMousedown:t[8]||(t[8]=i(()=>{},["stop"])),onTouchstart:t[9]||(t[9]=i(()=>{},["stop"])),onPointerdown:t[10]||(t[10]=i(()=>{},["stop"]))},[c(le,{onClick:t[5]||(t[5]=i(()=>{},["stop"])),modelValue:o.value,"onUpdate:modelValue":t[6]||(t[6]=R=>o.value=R),title:"Delete Ticket",itemLabel:"Ticket",itemName:e.ticket.title,requireMatchText:e.ticket.title,confirmText:"Delete Ticket",cancelText:"Cancel",size:"md",loading:I(H),onConfirm:P,onCancel:t[7]||(t[7]=()=>{o.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"])],32)],64)}}}),we=ie(ve,[["__scopeId","data-v-c9136e41"]]);export{we as K};
