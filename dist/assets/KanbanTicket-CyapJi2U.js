import{d as G,W as J,M as Z,aT as O,c as I,r as c,n as z,N as X,ab as Y,ar as ee,a2 as te,j as i,o as l,F as se,f as s,ah as ae,z as ie,k as o,t as u,p as m,i as p,h as r,w as le,s as B,a4 as re,Z as oe,J as ne}from"./index-BCXm2D5k.js";import{_ as de}from"./DropMenu.vue_vue_type_script_setup_true_lang-DNIJ9Rx_.js";import{_ as ue}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-Ds0MNnWK.js";import"./index-CPHFkODT.js";const ce={class:"flex justify-between gap-2 items-start mb-3"},me={class:"flex gap-2 flex-wrap items-center"},pe={key:0,class:"text-[10px] px-2 py-1 h-6 rounded bg-bg-surface/60 text-text-secondary font-medium captalize"},fe={key:1,class:"text-[10px] px-2 py-1 h-6 rounded bg-accent/20 text-accent font-medium"},ke={key:0,class:"product-menu-icon transition-all w-6 py-1 px-2 h-6 flex justify-center items-center duration-100 ease-in-out bg-bg-surface/40 rounded-md"},ge={class:"text-sm font-medium text-card-foreground leading-tight mb-2 capitalize"},ye={key:0,class:"flex justify-between items-center mt-3 pt-3 border-t border-border/50"},ve={class:"flex items-center gap-3 flex-1"},xe={class:"flex items-center gap-2"},be={class:"flex items-center gap-1 text-xs text-text-secondary"},Ce={key:0,class:"flex items-center gap-1 text-xs text-text-secondary"},we=G({__name:"KanbanTicket",props:{ticket:{},selectedVar:{},footer:{type:Boolean}},emits:["select"],setup(K,{emit:N}){const{canDeleteCard:k,canAssignCard:Q}=J(),{workspaceId:g,moduleId:S}=Z(),{data:j}=O(g.value),a=K,P={critical:"border-l-priority-critical",high:"border-l-priority-high",medium:"border-l-priority-medium",low:"border-l-priority-low"},_=I(()=>P[a.ticket.priority]??"border-l-gray-300"),n=c(!1),y=c(a.ticket["end-date"]??null),H=c(a.ticket["start-date"]??null);z(()=>{var e;return(e=a.ticket)==null?void 0:e["end-date"]},e=>{y.value=e??null}),z(()=>{var e;return(e=a.ticket)==null?void 0:e["start-date"]},e=>{H.value=e??null});const d=X(),v=Y({onSuccess:()=>{d.invalidateQueries({queryKey:["people-lists"]}),d.invalidateQueries({queryKey:["get-sheets"]}),d.invalidateQueries({queryKey:["sheet-list"]}),d.invalidateQueries({queryKey:["roles"]})}}),{mutate:L,isPending:$}=ee(a.ticket._id,{onSuccess:()=>{d.invalidateQueries({queryKey:["sheet-list"]}),n.value=!1}});function A(){return[k.value?{label:"Delete",danger:!0,action:()=>{n.value=!0}}:null].filter(e=>e!==null)}const F=()=>{L({})},R=e=>{const t={card_id:a.ticket._id,seat_id:e==null?void 0:e._id};v.mutate(t)},U=e=>{v.mutate({card_id:a.ticket._id,variables:{"end-date":e}})},{data:f}=te(g,S,c("")),x=I(()=>((f==null?void 0:f.value)??[]).filter(e=>e._id==a.selectedVar)),W=N;return(e,t)=>{var b,C,w,T,h,D,V,M,q;return l(),i(se,null,[s("div",{onClick:t[4]||(t[4]=()=>{W("select")}),class:ie(["product-ticket relative bg-bg-card rounded-lg p-4 shadow-sm cursor-grab border-t-4 hover:shadow-md transition-all duration-200 active:cursor-grabbing",_.value]),style:ae({borderColor:(C=(b=e.ticket)==null?void 0:b.lane)==null?void 0:C.variables["lane-color"]})},[s("div",ce,[s("div",me,[e.ticket["card-type"]||e.ticket["card-type"]===null&&((w=x.value[0])==null?void 0:w.slug)!="card-type"?(l(),i("span",pe,u(e.ticket["card-type"]&&e.ticket["card-type"]!==""?e.ticket["card-type"]:"General"),1)):o("",!0),e.ticket["card-status"]&&((T=x.value[0])==null?void 0:T.slug)!="card-status"?(l(),i("span",fe,u(e.ticket["card-status"]),1)):o("",!0)]),m(k)?(l(),i("div",ke,[p(de,{onClick:t[0]||(t[0]=r(()=>{},["stop"])),items:A()},{trigger:le(()=>t[11]||(t[11]=[s("i",{class:"cursor-pointer text-sm fa-solid fa-ellipsis"},null,-1)])),_:1},8,["items"])])):o("",!0)]),s("h3",ge,u(e.ticket["card-title"]),1),t[1]||(B(-1,!0),(t[1]=s("p",{innerHTML:e.ticket["card-description"],class:"text-xs text-muted-foreground mb-3 text-text-secondary line-clamp-2 max-h-20"},null,8,["innerHTML"])).cacheIndex=1,B(1),t[1]),e.footer?o("",!0):(l(),i("div",ye,[s("div",ve,[m(Q)?(l(),i("div",{key:0,onClick:t[2]||(t[2]=r(()=>{},["stop"]))},[p(re,{users:m(j),onAssign:R,assigneeId:e.ticket.assigned_to,seat:(h=e.ticket)==null?void 0:h.seat},null,8,["users","assigneeId","seat"])])):o("",!0),s("div",{onClick:t[3]||(t[3]=r(()=>{},["stop"])),class:"flex items-center gap-2 text-nowrap overflow-ellipsis text-xs text-text-secondary"},[p(oe,{placeholder:"end date","model-value":y.value,theme:"dark","emit-as":"ymd","onUpdate:modelValue":U},null,8,["model-value"])])]),s("div",xe,[s("div",be,[t[12]||(t[12]=s("i",{class:"fa-regular fa-message text-[10px]"},null,-1)),s("span",null,u((D=e.ticket)==null?void 0:D.comments_count),1)]),(V=e.ticket)!=null&&V.attachments?(l(),i("div",Ce,[t[13]||(t[13]=s("i",{class:"fa-regular fa-file text-[10px]"},null,-1)),s("span",null,u((q=(M=e.ticket)==null?void 0:M.attachments)==null?void 0:q.length),1)])):o("",!0)])]))],6),s("div",{class:"no-drag-zone",draggable:"false",onMousedown:t[8]||(t[8]=r(()=>{},["stop"])),onTouchstart:t[9]||(t[9]=r(()=>{},["stop"])),onPointerdown:t[10]||(t[10]=r(()=>{},["stop"]))},[p(ue,{onClick:t[5]||(t[5]=r(()=>{},["stop"])),modelValue:n.value,"onUpdate:modelValue":t[6]||(t[6]=E=>n.value=E),title:"Delete Ticket",itemLabel:"Ticket",itemName:e.ticket.title,requireMatchText:e.ticket.title,confirmText:"Delete Ticket",cancelText:"Cancel",size:"md",loading:m($),onConfirm:F,onCancel:t[7]||(t[7]=()=>{n.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"])],32)],64)}}}),Me=ne(we,[["__scopeId","data-v-934febf5"]]);export{Me as default};
