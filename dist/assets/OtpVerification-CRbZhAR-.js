const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-3ojefXkT.js","assets/index-DONjRhdW.css"])))=>i.map(i=>d[i]);
import{d as oe,a as ae,r as d,x as se,c as T,b as F,y as ne,z as re,e as le,w as B,o as v,f as l,s as k,g,t as y,h as M,i as ie,j as x,k as A,A as ue,C as E,v as m,F as ce,B as de,D as me,p as pe}from"./index-3ojefXkT.js";import{_ as fe}from"./AuthLayout.vue_vue_type_script_setup_true_lang-Dj5hvoBs.js";import{v as ve,a as ge}from"./auth-CS1uX_Er.js";import"./favicon-BAFXWHLW.js";import"./Header-bD7I_ZKX.js";import"./dark-logo-Mcb_sJlF.js";const ye={class:"max-w-[496px] md:mx-auto w-full"},_e={class:"mb-12 space-y-2"},he={class:"font-bold"},we={class:"flex justify-center gap-2 sm:gap-4 pb-4"},ke=["value","onKeydown","onPaste","onInput"],xe={key:0,class:"text-red-500 text-sm text-center mt-2"},be={class:"text-sm font-medium text-text-secondary text-center"},Se=["aria-disabled"],Ie={key:1,class:"text-green-600 text-sm text-center mt-2"},Ce={key:2,class:"text-red-500 text-sm text-center mt-2"},u=5,L=45,Be=oe({name:"OtpVerify",__name:"OtpVerification",setup(Te){const N=ae(),R=d(Array.from({length:u},()=>null)),D=pe(),$=se(),_=d($.params.email||""),i=d(Array.from({length:u},()=>"")),s=d(""),h=d("");let p;function W(t,e){R.value[e]=t instanceof HTMLInputElement?t:null}function c(t){var e;(e=R.value[t])==null||e.focus()}const z=T(()=>i.value.every(t=>t.length===1)),{mutateAsync:j,isPending:b}=F({mutationFn:ve});async function K(){var t,e,o;if(s.value="",!z.value){s.value="Please enter the complete 5-digit code.";return}try{const a=i.value.join(""),n=await j({u_email:_.value,otp:a});localStorage.setItem("token",(t=n==null?void 0:n.data)==null?void 0:t.token),await N.bootstrap();const O=localStorage.getItem("post_auth_intent");if(O)try{const f=JSON.parse(O);localStorage.removeItem("post_auth_intent"),f.aiResponse&&(await me(async()=>{const{useWorkspaceStore:ee}=await import("./index-3ojefXkT.js").then(te=>te.dt);return{useWorkspaceStore:ee}},__vite__mapDeps([0,1]))).useWorkspaceStore().setWorkspace(f.aiResponse),D.push(f.path||"/dashboard");return}catch(f){console.error("Failed to parse post_auth_intent",f),localStorage.removeItem("post_auth_intent")}D.push("/create-profile")}catch(a){s.value=((o=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:o.message)||"Invalid code, please try again."}}function q(t,e){const{key:o}=e;/^[0-9]$/.test(o)?(i.value[t]=o,s.value&&(s.value=""),e.preventDefault(),t<u-1&&c(t+1)):o==="Backspace"?i.value[t]?(i.value[t]="",s.value&&(s.value="")):t>0&&c(t-1):o==="ArrowLeft"&&t>0?c(t-1):o==="ArrowRight"&&t<u-1&&c(t+1)}function P(t,e=0){const o=t.replace(/\D/g,"").slice(0,u-e);if(!o)return;for(let n=0;n<o.length;n++)i.value[e+n]=o[n];const a=Math.min(e+o.length,u-1);c(a),s.value&&(s.value="")}function G(t,e){var o;P(((o=e.clipboardData)==null?void 0:o.getData("text"))??"",t)}function H(t,e){const o=e.target,a=(o.value||"").replace(/\D/g,"");a.length<=1?(i.value[t]=a,a&&t<u-1&&c(t+1)):P(a,t),o.value=i.value[t]??"",s.value&&(s.value="")}function J(t){const e=t.target;setTimeout(()=>e.select(),0)}const r=d(L);let w;function S(){w&&(clearInterval(w),w=void 0)}function V(){S(),r.value=L,w=window.setInterval(()=>{r.value>0&&(r.value-=1),r.value===0&&S()},1e3)}const U=T(()=>{const t=Math.floor(r.value/60).toString().padStart(2,"0"),e=(r.value%60).toString().padStart(2,"0");return`${t}:${e}`}),{mutateAsync:Q,isPending:I,error:C,reset:X}=F({mutationFn:ge}),Y=T(()=>C!=null&&C.value?"1":"");async function Z(){var t,e;if(s.value="",X(),!_.value){s.value="Email not found. Please login again.";return}try{await Q({u_email:_.value}),h.value="A new code has been sent to your email.",p&&clearTimeout(p),p=window.setTimeout(()=>h.value="",4e3),V()}catch(o){s.value=((e=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to resend code."}}return ne(()=>{setTimeout(()=>c(0),0),V()}),re(()=>{S(),p&&clearTimeout(p)}),(t,e)=>(v(),le(fe,null,{form:B(()=>[l("div",ye,[l("div",_e,[e[0]||(k(-1,!0),(e[0]=l("h2",{class:"text-[32px] font-medium text-center text-text-primary"},[e[4]||(e[4]=g("Enter Verification Code"))])).cacheIndex=0,k(1),e[0]),e[1]||(k(-1,!0),(e[1]=l("p",{class:"text-base sm:text-nowrap font-medium text-text-secondary text-center"},[e[5]||(e[5]=g(" We sent a five-digit code to your email ")),l("span",he,"("+y(_.value)+")",1),e[6]||(e[6]=g(". "))])).cacheIndex=1,k(1),e[1])]),l("form",{onSubmit:e[3]||(e[3]=M(()=>{},["prevent"])),class:"space-y-4 w-full"},[l("div",we,[(v(),x(ce,null,ue(u,(o,a)=>l("input",{key:a,ref_for:!0,ref:n=>W(n,a),type:"text",inputmode:"numeric",pattern:"[0-9]*",maxlength:"1",autocomplete:"one-time-code",enterkeyhint:"done",class:E(["w-full aspect-square text-3xl sm:text-5xl p-1 md:p-2 font-bold text-center border rounded-lg focus:outline-none",["border-accent",s.value?"border-red-500":"",m(b)?"opacity-60 pointer-events-none":""]]),value:i.value[a],onKeydown:n=>q(a,n),onPaste:M(n=>G(a,n),["prevent"]),onInput:n=>H(a,n),onFocus:J},null,42,ke)),64))]),ie(de,{disabled:m(b),size:"lg",block:!0,onClick:K},{default:B(()=>[g(y(m(b)?"Verifying...":"Verify"),1)]),_:1},8,["disabled"]),s.value?(v(),x("p",xe,y(s.value),1)):A("",!0),l("p",be,[e[7]||(e[7]=g(" Didn't receive an email? Try checking your junk folder. ")),l("span",{class:E(["text-text-primary font-bold underline",r.value>0?"opacity-50 cursor-not-allowed":"cursor-pointer"]),role:"button","aria-disabled":r.value>0||m(I),onClick:e[2]||(e[2]=o=>r.value===0&&!m(I)&&Z())},y(r.value>0?`Resend in ${U.value}`:m(I)?"Resending...":"Resend code"),11,Se)]),h.value?(v(),x("p",Ie,y(h.value),1)):A("",!0),Y.value?(v(),x("p",Ce,"Failed to resend OTP. Please try again.")):A("",!0)],32)])]),_:1}))}});export{Be as default};
