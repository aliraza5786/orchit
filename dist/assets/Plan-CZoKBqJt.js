const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CreateTaskModal-Br9eeJ3t.js","assets/CreateTaskModal.vue_vue_type_script_setup_true_lang-9VFErIaQ.js","assets/index-DhgU3ice.js","assets/index-DtLPfuX4.css","assets/ConfirmDeleteModal-ChBgx1qL.js","assets/ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-CMPGAA_V.js","assets/SidePanel-CTDgY8u4.js","assets/SidePanel-DoroZ0j-.css","assets/KanbanBoard-C18gnh8i.js","assets/DropMenu.vue_vue_type_script_setup_true_lang-YV2LJPqC.js","assets/workspace-BaVqJjZ-.js","assets/KanbanBoard-CJVPdV8K.css"])))=>i.map(i=>d[i]);
import{J as be,K as Be,L as Y,n as v,r as B,m as j,M as ge,c as E,N as Se,d as ye,O as Je,i as k,e,g as he,y as Q,b as Z,T as Qe,w as A,t as I,P as We,o as m,Q as mt,R as ft,f as W,h as F,_ as Xe,B as ne,S as Fe,j as X,U as Ae,A as qe,V as vt,a as Ne,W as Ye,X as gt,Y as et,Z as bt,$ as tt,a0 as yt,F as ke,x as Pe,G as je,C as He,a1 as xt,a2 as _t,a3 as kt,a4 as St,a5 as Oe,a6 as Ue,p as ht,a7 as Ct}from"./index-DhgU3ice.js";import{K as Dt,D as wt}from"./KanbanSkeleton-BIDm-mJY.js";import{_ as Vt}from"./SearchBar.vue_vue_type_script_setup_true_lang-CL2S2mQx.js";import{_ as Tt}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-CMPGAA_V.js";import{u as $t}from"./workspace-BaVqJjZ-.js";const Lt="data:image/svg+xml,%3csvg%20width='60'%20height='46'%20viewBox='0%200%2060%2046'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20opacity='0.4'%3e%3cpath%20d='M59.7443%2034.8967L50.5682%2025.7206C50.4457%2025.5984%2050.2897%2025.5152%2050.1199%2025.4816C49.9501%2025.4479%2049.7742%2025.4653%2049.6143%2025.5315C49.4544%2025.5976%2049.3176%2025.7097%2049.2213%2025.8535C49.125%2025.9973%2049.0734%2026.1664%2049.073%2026.3394V30.517H25.9775V40.5114H49.0755V44.689C49.0759%2044.8621%2049.1275%2045.0312%2049.2238%2045.175C49.3201%2045.3187%2049.4569%2045.4308%2049.6168%2045.497C49.7767%2045.5632%2049.9527%2045.5805%2050.1224%2045.5468C50.2922%2045.5132%2050.4482%2045.43%2050.5708%2045.3078L59.7468%2036.1318C59.9095%2035.9672%2060.0005%2035.7451%2060.0001%2035.5137C59.9996%2035.2823%2059.9076%2035.0605%2059.7443%2034.8967Z'%20fill='%23C6DBA9'/%3e%3cpath%20d='M32.3149%2030.5293C30.664%2031.5967%2028.7394%2032.1633%2026.7734%2032.1609V40.5237H34.7295C39.2829%2038.5638%2042.9649%2035.0102%2045.0851%2030.5293H32.3149Z'%20fill='url(%23paint0_linear_250_16424)'/%3e%3cpath%20d='M46.2209%2020.2832C46.2317%2015.0884%2044.2448%2010.0884%2040.6714%206.3179C37.0981%202.54738%2032.2119%200.295026%2027.024%200.0269855C21.8362%20-0.241055%2016.7439%201.49574%2012.801%204.87791C8.85809%208.26009%206.36647%2013.0287%205.84178%2018.1969L2.46233%2017.8913C2.31055%2017.8782%202.15829%2017.9103%202.02467%2017.9835C1.89106%2018.0566%201.78205%2018.1677%201.71134%2018.3026C1.64063%2018.4376%201.61138%2018.5904%201.62726%2018.7419C1.64313%2018.8934%201.70343%2019.0368%201.80058%2019.1542L9.51927%2028.406C9.79205%2028.7344%2010.277%2028.7773%2010.378%2028.5045L19.6298%2020.7833C20.3876%2020.3413%2020.1173%2019.4825%2019.4328%2019.4194L15.8008%2019.091C16.0297%2017.1283%2016.8213%2015.2735%2018.0802%2013.7503C19.3391%2012.2271%2021.0115%2011.1004%2022.8961%2010.5059C24.7806%209.9114%2026.7969%209.8745%2028.7019%2010.3996C30.6069%2010.9248%2032.3195%2011.9896%2033.6332%2013.4657C34.947%2014.9419%2035.8059%2016.7664%2036.1065%2018.7195C36.4071%2020.6726%2036.1365%2022.6709%2035.3274%2024.4738C34.5183%2026.2766%2033.2051%2027.8071%2031.5462%2028.8807C29.8872%2029.9544%2027.9531%2030.5254%2025.977%2030.5251H25.9283V40.5094C31.2249%2040.4031%2036.7093%2038.2263%2040.4202%2034.4455C44.1311%2030.6648%2046.2134%2025.5808%2046.2209%2020.2832Z'%20fill='%23D7A39E'/%3e%3cpath%20d='M25.9773%2030.5293H0V40.5237H25.9773V30.5293Z'%20fill='url(%23paint1_linear_250_16424)'/%3e%3c/g%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_250_16424'%20x1='6.53714'%20y1='35.5252'%20x2='47.0198'%20y2='35.5252'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%236C798F'/%3e%3cstop%20offset='1'%20stop-color='%236C798F'%20stop-opacity='0.1'/%3e%3c/linearGradient%3e%3clinearGradient%20id='paint1_linear_250_16424'%20x1='0'%20y1='36'%20x2='26'%20y2='36'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23E8D4D3'%20stop-opacity='0'/%3e%3cstop%20offset='1'%20stop-color='%23E2A39F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",at="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='20'%20height='20'%20rx='3.33333'%20fill='%2329BF7F'/%3e%3cpath%20d='M6.43164%2014.3018L9.29004%2012.167L9.29102%2012.166C9.47176%2012.0328%209.69053%2011.9609%209.91504%2011.9609C10.0834%2011.9609%2010.2482%2012.0017%2010.3965%2012.0781L10.5391%2012.166L10.54%2012.167L13.373%2014.291V5.91699H6.43164V14.3018ZM14.4316%2014.3789C14.4277%2014.5672%2014.3725%2014.7506%2014.2725%2014.9102C14.1723%2015.0699%2014.0303%2015.1996%2013.8623%2015.2852C13.6944%2015.3706%2013.5064%2015.4094%2013.3184%2015.3965C13.1304%2015.3835%2012.9495%2015.3196%2012.7949%2015.2119L12.79%2015.208L9.91504%2013.0518L7.01465%2015.209C6.83427%2015.3432%206.61546%2015.4161%206.39062%2015.417H6.38965C6.2298%2015.4164%206.07171%2015.38%205.92773%2015.3105V15.3096C5.75087%2015.2261%205.60123%2015.0946%205.49609%2014.9297C5.3907%2014.7642%205.33364%2014.5721%205.33301%2014.376V5.87402C5.3338%205.7361%205.36234%205.59971%205.41602%205.47266C5.46971%205.3456%205.54812%205.23049%205.64648%205.13379C5.74485%205.0371%205.86131%204.96069%205.98926%204.90918C6.1165%204.85797%206.2525%204.83272%206.38965%204.83398V4.83301H13.3906C13.6661%204.83457%2013.9302%204.94494%2014.125%205.13965C14.3198%205.33446%2014.4301%205.59852%2014.4316%205.87402V14.3789Z'%20fill='white'%20stroke='white'%20stroke-width='0.333333'/%3e%3c/svg%3e",Mt=(i,r={})=>Be({queryKey:["sprint-list"],queryFn:({signal:S})=>Y({url:`sprints/${i}`,method:"GET",signal:S}),...r}),Bt=(i,r={})=>Be({queryKey:["sprint-cards",i],queryFn:({signal:S})=>Y({url:`sprints/${v(i)}/backlog`,method:"GET",signal:S}),...r}),Et=(i,r={})=>Be({queryKey:["sprint-kanban",i],queryFn:({signal:S})=>Y({url:`workspace/cards/sprintgrouped?sprint_id=${v(i)}&variable_id=68b6c96e0a95eef7d14e6981`,method:"GET",signal:S}),...r}),Pt=(i,r={})=>be({key:["sprint-complete"]},{mutationFn:S=>Y({url:`sprints/${v(i)}/complete`,method:"POST",data:S.payload}),...r}),Ot=(i,r={})=>Be({queryKey:["sprint-detail",i],queryFn:({signal:S})=>Y({url:`sprints/detail/${v(i)}?include_cards=true`,method:"GET",signal:S}),...r}),Ie=(i,r={})=>Be({queryKey:["backlog-list",i],queryFn:({signal:S})=>Y({url:`sprints/workspace/${v(i)}/cards?include_sprint_cards=false`,method:"GET",signal:S}),...r}),Ut=(i={})=>be({key:["add-sprint"]},{mutationFn:r=>Y({url:"/sprints",method:"POST",data:r.payload}),...i}),st=(i={})=>be({key:["move-card-to-sprint"]},{mutationFn:r=>Y({url:`/sprints/${r.id}/cards`,method:"POST",data:r.payload}),...i}),Ke=(i={})=>be({key:["add-sprint"]},{mutationFn:r=>Y({url:`/sprints/${r.id}`,method:"PUT",data:r.payload}),...i}),At=(i={})=>be({key:["start-sprint"]},{mutationFn:r=>Y({url:`/sprints/${r.id}/start`,method:"POST",data:r.payload}),...i}),qt=(i={})=>be({key:["delete-sprint"]},{mutationFn:r=>Y({url:`/sprints/${r}`,method:"DELETE"}),...i}),Ht=(i={})=>be({key:["remove-card-from-sprint"]},{mutationFn:r=>Y({url:`sprints/${v(r.sprintId)}/cards/remove `,method:"POST",data:{card_ids:[r.cardId]}}),...i}),lt="jira-like:";function ze(i="id"){return`${i}_${Math.random().toString(36).slice(2,9)}`}function Ze(i,r){try{localStorage.setItem(lt+i,JSON.stringify(r))}catch{}}function Ge(i,r){try{const S=localStorage.getItem(lt+i);return S?JSON.parse(S):r}catch{return r}}function nt(i){switch(i){case"Highest":return"rounded-md bg-red-50 px-2 py-0.5 text-xs text-red-700";case"High":return"rounded-md bg-orange-50 px-2 py-0.5 text-xs text-orange-700";case"Medium":return"rounded-md bg-amber-50 px-2 py-0.5 text-xs text-amber-700";case"Low":return"rounded-md bg-gray-100 px-2 py-0.5 text-xs text-gray-600"}}function rt(){const i=B(Ge("backlog",[])),r=B(Ge("sprints",[]));if(r.value.length===0)r.value.push({id:ze("sprint"),name:"Sprint 1",goal:"",start:"",end:"",started:!1,tickets:[]});else if(r.value.length>1){for(let n=1;n<r.value.length;n++)i.value.push(...r.value[n].tickets);r.value=[r.value[0]]}const S=B(r.value[0].id);j([i,r],()=>{Ze("backlog",i.value),Ze("sprints",r.value)},{deep:!0});const $=B([]),L=ge({}),y=E(()=>i.value.length>0&&$.value.length===i.value.length),b=n=>{var a;const l=r.value.find(u=>u.id===n);return!!l&&l.tickets.length>0&&(((a=L[n])==null?void 0:a.length)||0)===l.tickets.length};function T(n,l,a){const u=l.target.checked;if(n==="backlog")$.value=u?i.value.map(w=>w.id):[];else if(a){const w=r.value.find(x=>x.id===a);L[a]=u&&w?w.tickets.map(x=>x.id):[]}}function P(n,l,a,u){const w=a.target.checked,x=n==="backlog"?$.value:L[u]||(L[u]=[]);if(w&&!x.includes(l)&&x.push(l),!w){const G=x.indexOf(l);G>=0&&x.splice(G,1)}}function M(){return r.value.find(n=>n.id===S.value)||r.value[0]}function N(){const l=[...i.value,...r.value.flatMap(u=>u.tickets)].map(u=>Number(String(u.key).replace(/[^0-9]/g,""))).filter(u=>!Number.isNaN(u));return`PRJ-${l.length?Math.max(...l)+1:1}`}const{mutate:H}=st({onSuccess:()=>{Se.success("Cards moved to sprint successfully")},onError:n=>{Se.error("Failed to move cards: "+(n.message||"Unknown error"))}});function q(){var u,w;const n=M();if(!n||!$.value.length)return;const l=[],a=[];for(const x of i.value)($.value.includes(x.id)?a:l).push(x);i.value=l,n.tickets.push(...a),$.value=[],a.length>0&&H({id:n.id,payload:{card_ids:a.map(x=>x.id),priority:((w=(u=a[0])==null?void 0:u.priority)==null?void 0:w.toLowerCase())||"medium",story_points:a.reduce((x,G)=>x+(G.storyPoints||0),0)}})}function _(n){const l=r.value.find(x=>x.id===n);if(!l)return;const a=L[n]||[],u=[],w=[];for(const x of l.tickets)(a.includes(x.id)?w:u).push(x);l.tickets=u,i.value.push(...w),L[n]=[]}function U(n,l){if(n==="backlog")i.value=i.value.filter(a=>!$.value.includes(a.id)),$.value=[];else if(l){const a=L[l]||[],u=r.value.find(w=>w.id===l);if(!u)return;u.tickets=u.tickets.filter(w=>!a.includes(w.id)),L[l]=[]}}function D(n,l){const a={id:ze("T"),key:N(),createdAt:new Date().toISOString(),...l};if(n==="backlog")i.value.push(a);else{const u=M();u==null||u.tickets.push(a)}}function t(n){const l=M();l&&(l.name=n.name??l.name,l.goal=n.goal??l.goal,l.start=n.start??l.start,l.end=n.end??l.end)}function s(){const n=M();n&&(n.started=!n.started)}function C(n){return n.tickets.reduce((l,a)=>l+(a.storyPoints||0),0)}return{backlog:i,sprints:r,activeSprintId:S,selectedBacklogIds:$,selectedSprintIds:L,allBacklogChecked:y,allSprintChecked:b,toggleAll:T,toggleOne:P,getActiveSprint:M,createTicket:D,saveSprintMeta:t,toggleStartSprint:s,sprintPoints:C,moveSelectedToSprint:q,moveSelectedToBacklog:_,deleteSelected:U,priorityClass:nt}}const It={class:"space-y-3 flex flex-col overflow-y-auto"},Ft={key:0,class:"empty-state flex flex-col justify-center items-center h-full"},Nt={class:"flex items-center gap-2 text-text-secondary float-start"},Rt={class:"inline-block rounded-full px-2 py-0.5 text-xs"},jt={class:"truncate"},Kt={key:0,class:"float-end flex justify-center text-gray-500 items-center text-xs aspect-square max-w-6 min-h-6 bg-gray-500/10 rounded-full"},zt={key:1,class:"w-6 h-6 rounded-full"},Zt=["src"],Gt={key:2,class:"text-xs aspect-square max-w-6 flex justify-center items-center text-center min-h-6 bg-accent/30 text-accent border-accent border rounded-full"},Jt=["onDragstart"],Qt=ye({__name:"BacklogTable",props:{sorters:{}},emits:["ticket-dragged-to-sprint","open-ticket","ticket-moved-to-backlog"],setup(i,{emit:r}){const S=r,{workspaceId:$}=Je(),{data:L,isPending:y}=Ie($),b=B([]);j(L,D=>{D!=null&&D.cards&&(b.value=D.cards.map(t=>{var a,u,w,x;const s=((a=t.card)==null?void 0:a.variables)??{},C=((u=t.card)==null?void 0:u._id)??t.card_id,n=String(s["card-status"]??"").trim(),l=String(s.priority??"").trim();return{id:C,key:s["card-code"]||(C==null?void 0:C.slice(-6))||"PRJ-?",summary:s["card-title"]||"(untitled)",type:"Story",status:n,assignee:((w=t.card)==null?void 0:w.assigned_to)??"Unassigned",storyPoints:Number(t.story_points??0)||0,priority:P(l),createdAt:((x=t.card)==null?void 0:x.created_at)??new Date().toISOString(),description:s["card-description"]||""}}))},{immediate:!0});function T(D){const t=D.toLowerCase();switch(t.trim()){case"todo":return"bg-gray-500/10 text-gray-500";case"to do":return"bg-gray-500/10 text-gray-500";case"in progress":return"bg-gray-amber/10 text-amber-500";case"done":return"bg-green-500/10 text-green-500"}return t.includes("progress")?"In Progress":t.includes("done")||t.includes("complete")?"Done":"Todo"}function P(D){const t=String(D??"").toLowerCase();return t==="highest"||t==="blocker"||t==="critical"?"Highest":t==="high"||t==="major"?"High":t==="medium"||t==="normal"?"Medium":"Low"}const M=B(!1),N=B(null);function H(D,t,s){var n;N.value=t.id;const C=JSON.stringify({id:t.id,from:s,ticket:t});(n=D.dataTransfer)==null||n.setData("text/plain",C),D.dataTransfer&&(D.dataTransfer.effectAllowed="move")}function q(D){var t;M.value=!1,((t=D.dataTransfer)==null?void 0:t.dropEffect)!=="none"&&N.value&&(b.value=b.value.filter(s=>s.id!==N.value)),N.value=null}function _(D){var t;D.preventDefault(),M.value=!1;try{const s=(t=D.dataTransfer)==null?void 0:t.getData("text/plain");if(!s)return;const C=JSON.parse(s);if(C.from!=="sprint"||b.value.some(l=>l.id===C.id))return;b.value.push(C.ticket),S("ticket-moved-to-backlog",C.id,C.sprintId)}catch(s){console.error("Drop error:",s)}}const U=E(()=>[{key:"summary",label:"Summary",sortable:!1},{key:"status",label:"Status",width:120,sortable:!1},{key:"assignee",label:"",width:120,sortable:!1}]);return(D,t)=>(m(),k("section",It,[e("div",{class:Q(["rounded-lg border h-[300px] border-border flex flex-col",M.value?"ring-2 ring-blue-400":""]),onDragover:t[4]||(t[4]=he(()=>{},["prevent"])),onDragenter:t[5]||(t[5]=s=>M.value=!0),onDragleave:t[6]||(t[6]=s=>M.value=!1),onDrop:t[7]||(t[7]=s=>_(s))},[!v(y)&&b.value.length===0?(m(),k("div",Ft,t[8]||(t[8]=[e("img",{src:Lt,class:"mb-4",alt:"backlog-plan"},null,-1),e("h6",{class:"text-sm text-text-primary font-semibold mb-1"},"Get started in the backlog",-1),e("p",{class:"text-sm text-text-primary/90 mb-3"},"Plan and start a sprint to see issues here.",-1)]))):(m(),Z(Qe,{key:1,showHeader:!1,pagination:!1,class:"flex-grow h-full",rowDraggable:!0,onRowDragstart:t[1]||(t[1]=({row:s,$event:C})=>H(C,s,"backlog")),onRowDragend:t[2]||(t[2]=({$event:s})=>q(s)),columns:U.value,rows:b.value,"page-size":20,hover:!0,itemKey:s=>s.id,sorters:D.sorters,onRowClick:t[3]||(t[3]=({row:s})=>D.$emit("open-ticket",s))},{summary:A(({row:s})=>[e("div",Nt,[t[9]||(t[9]=e("img",{src:at,alt:""},null,-1)),e("span",Rt,I(s.key),1),e("span",jt,I(s.summary),1)])]),status:A(({row:s})=>[e("span",{class:Q([T(s.status),"px-2 py-1 rounded-md"])},I(s.status),3)]),assignee:A(({row:s})=>[s?s!=null&&s.assignee.u_profile_image?(m(),k("div",zt,[e("img",{src:s==null?void 0:s.assignee.u_profile_image,alt:""},null,8,Zt)])):(m(),k("span",Gt,I(v(We)(s==null?void 0:s.assignee.u_full_name)),1)):(m(),k("span",Kt,"UA"))]),drag:A(({row:s})=>[e("button",{class:"cursor-grab",title:"Drag to Sprint",draggable:"",onClick:t[0]||(t[0]=he(()=>{},["stop"])),onDragstart:C=>H(C,s,"backlog"),onDragend:q},"↕",40,Jt)]),_:1},8,["columns","rows","itemKey","sorters"]))],34)]))}}),Wt="data:image/svg+xml,%3csvg%20width='60'%20height='60'%20viewBox='0%200%2060%2060'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20opacity='0.4'%3e%3cpath%20d='M9.375%2030C11.6402%2030%2013.4766%2028.1637%2013.4766%2025.8984C13.4766%2023.6332%2011.6402%2021.7969%209.375%2021.7969C7.10977%2021.7969%205.27344%2023.6332%205.27344%2025.8984C5.27344%2028.1637%207.10977%2030%209.375%2030Z'%20fill='%23AE2A19'/%3e%3cpath%20d='M26.25%2024.375C28.5152%2024.375%2030.3516%2022.5387%2030.3516%2020.2734C30.3516%2018.0082%2028.5152%2016.1719%2026.25%2016.1719C23.9848%2016.1719%2022.1484%2018.0082%2022.1484%2020.2734C22.1484%2022.5387%2023.9848%2024.375%2026.25%2024.375Z'%20fill='%23BF63F3'/%3e%3cpath%20d='M15.3931%2035.8594H11.0159V33.0938C9.93587%2033.3387%208.81469%2033.3387%207.73465%2033.0938V35.8594H1.87528C1.55115%2035.8601%201.2345%2035.9568%200.965283%2036.1373C0.696064%2036.3178%200.486343%2036.574%200.362583%2036.8736C0.238824%2037.1731%200.206573%2037.5027%200.269899%2037.8205C0.333226%2038.1384%200.489292%2038.4304%200.718404%2038.6597L7.05872%2045L0.718404%2051.3403C0.489292%2051.5696%200.333226%2051.8616%200.269899%2052.1795C0.206573%2052.4973%200.238824%2052.8269%200.362583%2053.1264C0.486343%2053.426%200.696064%2053.6822%200.965283%2053.8627C1.2345%2054.0432%201.55115%2054.1399%201.87528%2054.1406H15.3931L21.7503%2045L15.3931%2035.8594Z'%20fill='%2382B536'/%3e%3cpath%20d='M34.4562%2035.8594H27.8937V27.4688C26.8137%2027.7138%2025.6925%2027.7138%2024.6125%2027.4688V35.8594H19.3896L25.7487%2045L19.3896%2054.1406H34.4562L40.8143%2045L34.4562%2035.8594Z'%20fill='%2382B536'/%3e%3cpath%20d='M43.8281%2019.6875H55.3125C55.7475%2019.6873%2056.1647%2019.5143%2056.4723%2019.2067C56.7799%2018.8991%2056.9529%2018.4819%2056.9531%2018.0469V9.375C56.9529%208.93996%2056.7799%208.5228%2056.4723%208.21518C56.1647%207.90755%2055.7475%207.73462%2055.3125%207.73438H43.8281V7.5C43.8281%207.06488%2043.6553%206.64758%2043.3476%206.3399C43.0399%206.03223%2042.6226%205.85938%2042.1875%205.85938C41.7524%205.85938%2041.3351%206.03223%2041.0274%206.3399C40.7197%206.64758%2040.5469%207.06488%2040.5469%207.5V32.5781H43.8281V19.6875Z'%20fill='%23FCA700'/%3e%3cpath%20d='M59.2843%2043.8403L51.7843%2036.3403C51.6322%2036.1878%2051.4514%2036.0668%2051.2524%2035.9842C51.0534%2035.9017%2050.8401%2035.8593%2050.6246%2035.8594H38.4521L44.8121%2045L38.4531%2054.1406H50.6246C50.8401%2054.1407%2051.0534%2054.0983%2051.2524%2054.0158C51.4514%2053.9332%2051.6322%2053.8122%2051.7843%2053.6597L59.2843%2046.1597C59.4368%2046.0075%2059.5577%2045.8267%2059.6402%2045.6277C59.7228%2045.4287%2059.7652%2045.2154%2059.7652%2045C59.7652%2044.7846%2059.7228%2044.5713%2059.6402%2044.3723C59.5577%2044.1733%2059.4368%2043.9925%2059.2843%2043.8403Z'%20fill='%2382B536'/%3e%3c/g%3e%3c/svg%3e",Xt={class:"rounded-lg flex flex-col"},Yt=["checked"],ea=["checked","onChange"],ta={class:"flex items-center gap-2 text-text-secondary float-start"},aa={class:"inline-block rounded-full px-2 py-0.5 text-xs"},sa={class:"truncate"},la={key:0,class:"float-end flex justify-center text-gray-500 items-center text-xs aspect-square max-w-6 min-h-6 bg-gray-500/10 rounded-full"},na={key:1,class:"w-6 h-6 rounded-full"},ra=["src"],oa={key:2,class:"text-xs aspect-square max-w-6 flex justify-center items-center text-center min-h-6 bg-accent/30 text-accent border-accent border rounded-full"},ia=["onDragstart"],da={key:1,class:"empty-state flex flex-col h-full justify-center items-center border-dashed border border-border"},ua=ye({__name:"SprintCard",props:{sprint:{},sprintId:{}},emits:["edit-sprint","toggle-start","open-ticket","move-selected-to-backlog","delete-selected-sprint","refresh"],setup(i,{emit:r}){const S=i;j(S,n=>{console.log("props changes",n)});const $=r,L=rt(),{selectedSprintIds:y,allSprintChecked:b,toggleAll:T,toggleOne:P}=L,M=B([]);j(()=>S.sprint.tickets,n=>{M.value=[...n||[]]},{immediate:!0,deep:!0});const N=B(!1),H=B(null),{mutate:q}=st({onSuccess:()=>{Se.success("Card moved to sprint successfully"),$("refresh")},onError:n=>{Se.error("Failed to move card: "+(n.message||"Unknown error"))}});function _(n,l,a,u){var x;H.value=l.id;const w=JSON.stringify({id:l.id,from:a,sprintId:u,ticket:l});(x=n.dataTransfer)==null||x.setData("text/plain",w),n.dataTransfer&&(n.dataTransfer.effectAllowed="move")}function U(n){var l;N.value=!1,((l=n.dataTransfer)==null?void 0:l.dropEffect)!=="none"&&H.value&&(M.value=M.value.filter(a=>a.id!==H.value)),H.value=null}function D(){N.value=!0}function t(){N.value=!1}function s(n){var l;n.preventDefault(),N.value=!1;try{const a=(l=n.dataTransfer)==null?void 0:l.getData("text/plain");if(!a)return;const u=JSON.parse(a);if(u.from!=="backlog"||M.value.some(x=>x.id===u.id))return;M.value.push(u.ticket),q({id:S.sprintId,payload:{card_ids:[u.ticket.id],priority:u.ticket.priority.toLowerCase(),story_points:u.ticket.storyPoints||0}})}catch(a){console.error("Drop error:",a)}}const C=[{key:"summary",label:"Summary",sortable:!0},{key:"status",label:"Status",width:120,sortable:!0},{key:"assignee",label:"Assignee",width:120,sortable:!0}];return(n,l)=>(m(),k("div",Xt,[e("div",{class:Q(["h-[300px]",N.value?"ring-2 ring-blue-400 rounded-lg":""]),onDragover:l[5]||(l[5]=he(()=>{},["prevent"])),onDragenter:D,onDragleave:t,onDrop:s},[M.value.length>0?(m(),Z(Qe,{key:0,showHeader:!1,pagination:!1,"row-draggable":!0,class:"h-full",onRowDragstart:l[2]||(l[2]=({row:a,$event:u})=>_(u,a,"sprint",n.sprint.id)),onRowDragend:l[3]||(l[3]=({$event:a})=>U(a)),columns:C,rows:M.value,"page-size":100,hover:!0,"item-key":a=>a.id,onRowClick:l[4]||(l[4]=({row:a})=>n.$emit("open-ticket",a))},{"select-header":A(()=>[e("input",{type:"checkbox",checked:v(b)(n.sprint.id),onChange:l[0]||(l[0]=a=>v(T)("sprint",a,n.sprint.id))},null,40,Yt)]),select:A(({row:a})=>[e("input",{type:"checkbox",checked:(v(y)[n.sprint.id]||[]).includes(a.id),onChange:u=>v(P)("sprint",a.id,u,n.sprint.id)},null,40,ea)]),summary:A(({row:a})=>[e("div",ta,[l[6]||(l[6]=e("img",{src:at,alt:""},null,-1)),e("span",aa,I(a.key),1),e("span",sa,I(a.summary),1)])]),status:A(({row:a})=>[e("span",{class:Q([v(mt)(a.status),"px-2 py-1 rounded-md"])},I(a.status),3)]),assignee:A(({row:a})=>{var u,w,x;return[a?(u=a==null?void 0:a.assignee)!=null&&u.u_profile_image?(m(),k("div",na,[e("img",{src:(w=a==null?void 0:a.assignee)==null?void 0:w.u_profile_image,alt:""},null,8,ra)])):(m(),k("span",oa,I(v(We)(((x=a==null?void 0:a.assignee)==null?void 0:x.u_full_name)??"")),1)):(m(),k("span",la,"UA"))]}),priority:A(({row:a})=>[e("span",{class:Q(v(nt)(a.priority))},I(a.priority),3)]),drag:A(({row:a})=>[e("button",{class:"cursor-grab",title:"Drag to Backlog",draggable:"",onClick:l[1]||(l[1]=he(()=>{},["stop"])),onDragstart:u=>_(u,a,"sprint",n.sprint.id),onDragend:U},"↕",40,ia)]),_:1},8,["rows","item-key"])):(m(),k("div",da,l[7]||(l[7]=[ft('<img src="'+Wt+'" class="mb-4" alt="backlog-plan"><h6 class="text-sm text-text-primary font-semibold mb-1 text-center">Plan your sprint</h6><p class="text-sm text-text-primary/90 mb-3 max-w-120 text-center">Drag work items from the <span class="font-bold"> Backlog </span> section or create new ones to plan the work for this sprint. Select <span class="font-bold">Start sprint</span> when you&#39;re ready.</p>',3)])))],34)]))}}),ca={class:"px-6 gap-4"},pa={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},ma=ye({__name:"SprintModal",props:{modelValue:{type:Boolean,default:!1},sprint:{},creatingSprint:{type:Boolean}},emits:["update:modelValue","save","close"],setup(i,{emit:r}){const S=r,$=i,L=E({get:()=>$.modelValue,set:q=>S("update:modelValue",q)}),y=ge({name:""}),b=ge({name:!1}),T=E(()=>b.name&&!String(y.name||"").trim()?"Name is required":""),P=E(()=>!!String(y.name||"").trim()&&!T.value);function M(){L.value=!1,S("close")}function N(){b.name=!0,P.value&&S("save",{name:String(y.name||"").trim()})}function H(){b.name=!1}return j(()=>$.sprint,q=>{if(!q){y.name="";return}y.name=q.name??(q==null?void 0:q.title)??"",H()},{immediate:!0}),(q,_)=>(m(),Z(Fe,{modelValue:L.value,"onUpdate:modelValue":_[2]||(_[2]=U=>L.value=U),modalClass:"!py-0",size:"md"},{default:A(()=>[_[5]||(_[5]=e("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[e("h2",{class:"text-xl font-semibold"},"Add Sprint"),e("p",{class:"text-sm text-text-secondary mt-1"},[W(" Add sprint name and then click "),e("span",{class:"font-medium"},"Save"),W(". ")])],-1)),e("div",ca,[F(Xe,{modelValue:y.name,"onUpdate:modelValue":_[0]||(_[0]=U=>y.name=U),label:"Name",placeholder:"Sprint 1",error:!!T.value,message:T.value,onBlur:_[1]||(_[1]=U=>b.name=!0)},null,8,["modelValue","error","message"]),_[3]||(_[3]=e("div",null,null,-1))]),e("div",pa,[F(ne,{variant:"secondary",onClick:M},{default:A(()=>_[4]||(_[4]=[W("Cancel")])),_:1,__:[4]}),F(ne,{variant:"primary",disabled:!P.value,onClick:N},{default:A(()=>[W(I(q.creatingSprint?"Saving...":"Save"),1)]),_:1},8,["disabled"])])]),_:1,__:[5]},8,["modelValue"]))}}),fa={class:"px-6 grid grid-cols-2 gap-4"},va={class:"flex gap-1 flex-col"},ga={key:0,class:"text-xs text-red-500"},ba={class:"flex gap-1 flex-col"},ya={key:0,class:"text-xs text-red-500"},xa={class:"flex flex-col col-span-2"},_a={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},ka=ye({__name:"StartSprintModal",props:{modelValue:{type:Boolean,default:!1},sprint:{},creatingSprint:{type:Boolean}},emits:["update:modelValue","save","close"],setup(i,{emit:r}){const S=r,$=i,L=E({get:()=>$.modelValue,set:t=>S("update:modelValue",t)}),y=ge({goal:"",start:"",end:""});j(()=>$.sprint,t=>{t&&(y.goal=t.goal??"",y.start=t.start??"",y.end=t.end??"",U())},{immediate:!0});const b=ge({start:!1,end:!1}),T=E(()=>!y.start&&b.start?"Start date is required":""),P=E(()=>{if(!y.end&&b.end)return"End date is required";if(y.start&&y.end){const t=D(y.start),s=D(y.end);if(Number.isFinite(t)&&Number.isFinite(s)&&s<t)return"End date cannot be before start date"}return""}),M=E(()=>!T.value&&!P.value);function N(t){y.start=t||"",b.start=!0}function H(t){y.end=t||"",b.end=!0}function q(){L.value=!1,S("close")}function _(){b.start=!0,b.end=!0,M.value&&S("save",{goal:y.goal??"",start:y.start||"",end:y.end||""})}function U(){b.start=!1,b.end=!1}function D(t){return t?new Date(`${t}T00:00:00`).getTime():NaN}return(t,s)=>(m(),Z(Fe,{modelValue:L.value,"onUpdate:modelValue":s[1]||(s[1]=C=>L.value=C),modalClass:"!py-0",size:"md"},{default:A(()=>[s[6]||(s[6]=e("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[e("h2",{class:"text-xl font-semibold"},"Start Sprint"),e("p",{class:"text-sm text-text-secondary mt-1"},[W(" Update sprint name, goal, and dates, then click "),e("span",{class:"font-medium"},"Start"),W(". ")])],-1)),e("div",fa,[e("div",va,[s[2]||(s[2]=e("label",{class:"text-sm"},"Start date",-1)),e("div",{class:Q(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",T.value?"border-red-500":""])},[F(Ae,{placeholder:"Set start date",class:"w-full","model-value":y.start,"emit-as":"ymd","onUpdate:modelValue":N},null,8,["model-value"])],2),T.value?(m(),k("p",ga,I(T.value),1)):X("",!0)]),e("div",ba,[s[3]||(s[3]=e("label",{class:"text-sm"},"End date",-1)),e("div",{class:Q(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",P.value?"border-red-500":""])},[F(Ae,{placeholder:"Set end date",class:"w-full","model-value":y.end,"emit-as":"ymd","onUpdate:modelValue":H},null,8,["model-value"])],2),P.value?(m(),k("p",ya,I(P.value),1)):X("",!0)]),e("div",xa,[s[4]||(s[4]=e("label",{class:"text-sm"},"Goal (optional)",-1)),qe(e("textarea",{"onUpdate:modelValue":s[0]||(s[0]=C=>y.goal=C),class:"w-full rounded-lg border border-border px-3 py-2 bg-bg-input",rows:"2",placeholder:"Ship onboarding flow"},null,512),[[vt,y.goal]])])]),e("div",_a,[F(ne,{variant:"secondary",onClick:q},{default:A(()=>s[5]||(s[5]=[W("Cancel")])),_:1,__:[5]}),F(ne,{variant:"primary",disabled:!M.value,onClick:_},{default:A(()=>[W(I(t.creatingSprint?"Starting...":"Start"),1)]),_:1},8,["disabled"])])]),_:1,__:[6]},8,["modelValue"]))}}),Sa={class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},ha={class:"text-sm text-text-secondary mt-1"},Ca={class:"flex items-center gap-2 mt-4 w-full"},Da={class:"flex items-center gap-2 flex-1"},wa={class:"px-6 min-h-[400px]"},Va={key:0},Ta={key:0,class:"flex items-center justify-center py-12"},$a={key:1,class:"text-center py-12 text-text-secondary"},La={key:2,class:"grid grid-cols-2 gap-3"},Ma=["onClick"],Ba={class:"flex items-center gap-3"},Ea={class:"w-10 h-10 rounded-lg bg-bg-input flex items-center justify-center group-hover:bg-primary/10 transition-colors"},Pa={class:"font-medium"},Oa={key:1},Ua={key:0,class:"flex items-center justify-center py-12"},Aa={key:1,class:"text-center py-12 text-text-secondary"},qa={key:2,class:"grid grid-cols-2 gap-3"},Ha=["onClick"],Ia={class:"flex items-center gap-3"},Fa={class:"w-10 h-10 rounded-lg bg-bg-input flex items-center justify-center group-hover:bg-primary/10 transition-colors"},Na={class:"font-medium"},Ra={key:2},ja={class:"grid grid-cols-2 gap-4"},Ka={key:0,class:"flex flex-col"},za={class:"flex gap-1 flex-col"},Za={key:0,class:"text-xs text-red-500"},Ga={class:"flex gap-1 flex-col"},Ja={key:0,class:"text-xs text-red-500"},Qa={class:"mt-4"},Wa={key:0,class:"text-xs text-red-500 mt-1 px-1"},Xa={class:"flex justify-between gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},Ya={key:1},es={class:"flex gap-2"},ts=ye({__name:"CreateBacklogTicketWithModuleSelection",props:{modelValue:{type:Boolean,default:!1},listId:{},selectedVariable:{}},emits:["update:modelValue","created"],setup(i,{emit:r}){const S=r,$=i,L=Ne(),{workspaceId:y}=Ye(),b=B(1),T=B(null),P=B(null),{data:M,isLoading:N}=gt(y.value),H=E(()=>{var c;return((c=M.value)==null?void 0:c.modules)||[]}),{data:q,isFetching:_,refetch:U}=et({workspace_module_id:T,workspace_id:y},{enabled:E(()=>!!T.value)});j(()=>T.value,()=>{U()});const D=E(()=>q.value||[]),{data:t}=bt(y.value),{data:s}=tt(y.value,T,{enabled:E(()=>!!T.value)}),{mutate:C,isPending:n}=yt({onSuccess:()=>{xe(),L.invalidateQueries({queryKey:["sheet-list"]}),L.invalidateQueries({queryKey:["backlog-list"]}),l.value=!1}}),l=E({get:()=>$.modelValue,set:c=>S("update:modelValue",c)}),a=E(()=>{switch(b.value){case 1:return"Select a module to create the ticket in";case 2:return"Select a sheet within the module";case 3:return"Provide the ticket details below and click Add Ticket";default:return""}}),u=E(()=>((s==null?void 0:s.value)??[]).filter(c=>{var o;return((o=c==null?void 0:c.type)==null?void 0:o.title)==="Select"})),w=c=>c.map(o=>({_id:o,title:o})),x=E(()=>((t==null?void 0:t.value)??[]).map(c=>{var o;return{_id:c._id,title:((o=c==null?void 0:c.variables)==null?void 0:o["lane-title"])??String(c._id)}})),G=c=>c.slug,d=ge({title:"",description:"",startDate:null,endDate:null,lane_id:null,variables:{}});j(u,c=>{for(const o of c){const f=G(o);f in d.variables||(d.variables[f]=null)}},{immediate:!0});const V=ge({title:!1,description:!1,startDate:!1,endDate:!1,lane:!1}),re=E(()=>!!d.title.trim()&&!!d.lane_id&&!!d.startDate&&!!d.endDate&&!h.value&&!O.value&&!le.value&&!ie.value&&!ae.value);function oe(c){d.startDate=c,V.startDate=!0}function Ce(c){d.endDate=c,V.endDate=!0}function ee(c){d.lane_id=c,V.lane=!0}function pe(c){T.value=c._id,b.value=2}function te(c){P.value=c._id,b.value=3}function K(){b.value>1&&b.value--}function De(){l.value=!1,xe()}function xe(){b.value=1,T.value=null,P.value=null,d.title="",d.description="",d.startDate=null,d.endDate=null,d.lane_id=null,d.variables={},V.title=!1,V.description=!1,V.startDate=!1,V.endDate=!1,V.lane=!1}const we=E(()=>{var c;return(c=s==null?void 0:s.value)==null?void 0:c.find(o=>(o==null?void 0:o._id)==$.selectedVariable)}),h=E(()=>V.title&&!d.title.trim()?"Title is required":""),O=E(()=>V.startDate?d.startDate?"":"Start date is required":""),le=E(()=>V.endDate?d.endDate?d.startDate&&d.endDate&&d.endDate<d.startDate?"End date cannot be before start date":"":"End date is required":""),ie=E(()=>V.lane?d.lane_id?"":"Lane is required":""),ae=E(()=>V.description&&!d.description.trim()?"Description is required":"");function _e(){var o;if(V.title=!0,V.lane=!0,V.description=!0,V.startDate=!0,V.endDate=!0,!re.value||n.value)return;const c={sheet_list_id:$.listId,workspace_id:y.value,sheet_id:P.value,workspace_lane_id:d.lane_id,variables:{...d.variables,[`${(o=we.value)==null?void 0:o.slug}`]:$.listId,"card-title":d.title.trim(),"card-description":d.description.trim(),"start-date":d.startDate,"end-date":d.endDate},createdAt:new Date().toISOString()};C(c)}return j(()=>d.title,c=>{c!=null&&c.trim()&&V.title&&(V.title=!1)}),j(()=>d.lane_id,c=>{c&&V.lane&&(V.lane=!1)}),j(()=>d.startDate,c=>{c&&V.startDate&&(V.startDate=!1)}),j(()=>d.endDate,c=>{c&&V.endDate&&(V.endDate=!1)}),j(()=>d.description,c=>{c!=null&&c.trim()&&V.description&&(V.description=!1)}),(c,o)=>(m(),Z(Fe,{modelValue:l.value,"onUpdate:modelValue":o[4]||(o[4]=f=>l.value=f),modalClass:"!py-0",size:"lg"},{default:A(()=>[e("div",Sa,[o[5]||(o[5]=e("h2",{class:"text-xl font-semibold"},"Create Backlog Ticket",-1)),e("p",ha,I(a.value),1),e("div",Ca,[(m(),k(ke,null,Pe(3,f=>e("div",{key:f,class:"flex items-center flex-1"},[e("div",Da,[e("div",{class:Q(["h-1 flex-1 rounded-full transition-colors",b.value>=f?"bg-primary":"bg-border"])},null,2)])])),64))])]),e("div",wa,[b.value===1?(m(),k("div",Va,[o[7]||(o[7]=e("h3",{class:"text-lg font-medium mb-4"},"Select Module",-1)),v(N)?(m(),k("div",Ta,o[6]||(o[6]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)]))):!H.value||H.value.length===0?(m(),k("div",$a," No modules available ")):(m(),k("div",La,[(m(!0),k(ke,null,Pe(H.value,f=>{var J,se,de,me,Ee;return m(),k("button",{key:f._id,onClick:Re=>pe(f),class:Q(["p-4 border rounded-lg hover:border-primary transition-all text-left group",T.value===f._id?"border-primary bg-primary/5":"border-border"])},[e("div",Ba,[e("div",Ea,[e("i",{class:Q([`${(se=(J=f==null?void 0:f.variables)==null?void 0:J["module-icon"])==null?void 0:se.prefix} ${(me=(de=f==null?void 0:f.variables)==null?void 0:de["module-icon"])==null?void 0:me.iconName}`,"text-lg"])},null,2)]),e("div",null,[e("p",Pa,I(((Ee=f.variables)==null?void 0:Ee["module-title"])||"Untitled"),1)])])],10,Ma)}),128))]))])):b.value===2?(m(),k("div",Oa,[o[9]||(o[9]=e("h3",{class:"text-lg font-medium mb-4"},"Select Sheet",-1)),v(_)?(m(),k("div",Ua,o[8]||(o[8]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)]))):!D.value||D.value.length===0?(m(),k("div",Aa," No sheets available for this module ")):(m(),k("div",qa,[(m(!0),k(ke,null,Pe(D.value,f=>{var J,se;return m(),k("button",{key:f._id,onClick:de=>te(f),class:Q(["p-4 border rounded-lg hover:border-primary transition-all text-left group",P.value===f._id?"border-primary bg-primary/5":"border-border"])},[e("div",Ia,[e("div",Fa,[e("i",{class:Q(`${(J=f==null?void 0:f.variables["sheet-icon"])==null?void 0:J.prefix} ${(se=f==null?void 0:f.variables["sheet-icon"])==null?void 0:se.iconName} text-lg`)},null,2)]),e("div",null,[e("p",Na,I((f==null?void 0:f.variables["sheet-title"])||"Untitled Sheet"),1)])])],10,Ha)}),128))]))])):b.value===3?(m(),k("div",Ra,[o[12]||(o[12]=e("h3",{class:"text-lg font-medium mb-4"},"Ticket Details",-1)),e("div",ja,[F(Xe,{modelValue:d.title,"onUpdate:modelValue":o[0]||(o[0]=f=>d.title=f),label:"Ticket Title",placeholder:"e.g., Implement real-time notifications",error:!!h.value,message:h.value,onBlur:o[1]||(o[1]=f=>V.title=!0)},null,8,["modelValue","error","message"]),x.value.length>0?(m(),k("div",Ka,[F(je,{size:"md",label:"Lane",options:x.value,placeholder:"Select lane",allowCustom:!1,"model-value":d.lane_id,"onUpdate:modelValue":ee,error:!!ie.value,message:ie.value},null,8,["options","model-value","error","message"])])):X("",!0),(m(!0),k(ke,null,Pe(u.value,f=>qe((m(),Z(je,{size:"md",key:G(f),modelValue:d.variables[f.slug],"onUpdate:modelValue":J=>d.variables[f.slug]=J,options:w(f.data),label:f.title,placeholder:"Select value",allowCustom:!0},null,8,["modelValue","onUpdate:modelValue","options","label"])),[[He,(f==null?void 0:f._id)!=c.selectedVariable]])),128)),e("div",za,[o[10]||(o[10]=e("label",{class:"text-sm"},"Start date",-1)),e("div",{class:Q(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",O.value?"border-red-500":""])},[F(Ae,{placeholder:"Set start date",class:"w-full","model-value":d.startDate,"emit-as":"ymd","onUpdate:modelValue":oe},null,8,["model-value"])],2),O.value?(m(),k("p",Za,I(O.value),1)):X("",!0)]),e("div",Ga,[o[11]||(o[11]=e("label",{class:"text-sm"},"End date",-1)),e("div",{class:Q(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",le.value?"border-red-500":""])},[F(Ae,{placeholder:"Set end date",class:"w-full","model-value":d.endDate,"emit-as":"ymd","onUpdate:modelValue":Ce},null,8,["model-value"])],2),le.value?(m(),k("p",Ja,I(le.value),1)):X("",!0)])]),e("div",Qa,[F(xt,{label:"Description",placeholder:"What needs to be done, acceptance criteria, links…",modelValue:d.description,"onUpdate:modelValue":o[2]||(o[2]=f=>d.description=f),onBlur:o[3]||(o[3]=f=>V.description=!0)},null,8,["modelValue"]),ae.value?(m(),k("p",Wa,I(ae.value),1)):X("",!0)])])):X("",!0)]),e("div",Xa,[b.value>1?(m(),Z(ne,{key:0,variant:"secondary",onClick:K},{default:A(()=>o[13]||(o[13]=[W("Back")])),_:1,__:[13]})):(m(),k("div",Ya)),e("div",es,[F(ne,{variant:"secondary",onClick:De},{default:A(()=>o[14]||(o[14]=[W("Cancel")])),_:1,__:[14]}),b.value===3?(m(),Z(ne,{key:0,variant:"primary",disabled:!re.value||v(n),onClick:_e},{default:A(()=>[W(I(v(n)?"Adding…":"Add Ticket"),1)]),_:1},8,["disabled"])):X("",!0)])])]),_:1},8,["modelValue"]))}}),as={class:"flex gap-2 flex-auto overflow-y-auto"},ss={class:"flex-auto bg-gradient-to-b from-bg-card/95 to-bg-card/90 backdrop-blur rounded-2xl shadow-[0_10px_40px_-10px_rgba(0,0,0,.5)] flex-grow h-full bg-bg-card border border-border overflow-x-auto flex"},ls={class:"flex overflow-x-auto gap-3 p-4"},ns={key:0,class:"mx-auto text-text-secondary/80 m-2 w-[90%] h-full justify-center flex items-center border border-dashed border-border"},rs=ye({__name:"ActiveSprint",props:{sptint_id:{}},setup(i){const r=i,S=Oe(()=>Ue(()=>import("./CreateTaskModal-Br9eeJ3t.js"),__vite__mapDeps([0,1,2,3]))),$=Oe(()=>Ue(()=>import("./ConfirmDeleteModal-ChBgx1qL.js"),__vite__mapDeps([4,5,2,3]))),L=Oe(()=>Ue(()=>import("./SidePanel-CTDgY8u4.js"),__vite__mapDeps([6,2,3,7]))),y=Oe(()=>Ue(()=>import("./KanbanBoard-C18gnh8i.js"),__vite__mapDeps([8,2,3,9,5,10,11]))),b=ht(),{workspaceId:T,moduleId:P}=Ye(),{data:M}=tt(T.value,P.value),N=Ne(),{mutate:H,isPending:q}=_t({onSuccess:()=>{N.invalidateQueries({queryKey:["sheet-list"]}),ee.value="",te.value=!1,Ce.value=!1,te.value=!1}}),_=h=>{H({workspace_id:T.value,module_id:P.value,variable_id:C.value,value:h})},{data:U}=et({workspace_id:T,workspace_module_id:P}),D=E(()=>{var h;return U.value?(h=U.value[0])==null?void 0:h._id:""}),t=B(D),s=E(()=>{var h;return M.value?(h=M.value[0])==null?void 0:h._id:""}),C=B(s),n=$t(),l=E(()=>r.sptint_id),{data:a,isPending:u}=Et(l),w=B(!1),x=B(),G=h=>{x.value=h},d=kt(),V=St();function re(h){h.type=="column"?d.mutate({payload:{workspace_id:T.value,workspace_module_id:P.value,variable_id:C.value,moved_value:h.meta.id,new_index:h.meta.newIndex}}):V.mutate({payload:{workspace_id:T.value,card_id:h.meta.moved._id,group_value:h.meta.fromColumnId,group_variable_id:C.value,new_index:h.meta.newIndex,sheet_id:t.value}})}const oe=h=>{};j(U,h=>{var O;(h==null?void 0:h.length)>0&&(t.value=(O=h[0])==null?void 0:O._id)});const Ce=B(!1),ee=B(""),pe=h=>{H({workspace_id:b.params.id,module_id:b.params.module_id,new_value:h.title,value:h.oldTitle,variable_id:C.value})},te=B(!1),K=B(),De=()=>{H({value:K.value.title,workspace_id:T.value,module_id:P.value,newValue:K.value.title,variable_id:C.value,is_trash:!0})},xe=h=>{te.value=!0,K.value=h},we=h=>{w.value=!0,K.value=h};return(h,O)=>{var le,ie,ae,_e,c;return m(),k("div",as,[e("div",ss,[qe(F(Dt,null,null,512),[[He,v(u)]]),qe(e("div",ls,[F(v(y),{onOnPlus:we,"onDelete:column":O[0]||(O[0]=o=>xe(o)),"onUpdate:column":O[1]||(O[1]=o=>pe(o)),onReorder:re,onAddColumn:_,"onSelect:ticket":G,board:v(a),onOnBoardUpdate:oe,variable_id:C.value,sheet_id:t.value},{"column-footer":A(o=>{var f,J,se,de,me;return[(J=(f=v(n))==null?void 0:f.transitions)!=null&&J.all_allowed&&!((me=(de=(se=v(n))==null?void 0:se.transitions)==null?void 0:de.all_allowed)!=null&&me.includes(o.column.title))&&v(n).transitions.currentColumn!=o.column.title?(m(),k("div",ns," Disbale ( you can't drop here )")):X("",!0)]}),_:1},8,["board","variable_id","sheet_id"])],512),[[He,!v(u)]])]),F(v($),{onClick:O[2]||(O[2]=he(()=>{},["stop"])),modelValue:te.value,"onUpdate:modelValue":O[3]||(O[3]=o=>te.value=o),title:"Delete List",itemLabel:"list",itemName:(le=K.value)==null?void 0:le.title,requireMatchText:(ie=K.value)==null?void 0:ie.title,confirmText:"Delete workspace",cancelText:"Cancel",size:"md",loading:v(q),onConfirm:De,onCancel:O[4]||(O[4]=()=>{te.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),w.value?(m(),Z(v(S),{selectedVariable:C.value,listId:(ae=K.value)==null?void 0:ae.title,sheet_id:t.value,key:"createTaskModalKey",modelValue:w.value,"onUpdate:modelValue":O[5]||(O[5]=o=>w.value=o),onSubmit:O[6]||(O[6]=()=>{})},null,8,["selectedVariable","listId","sheet_id","modelValue"])):X("",!0),(_e=x.value)!=null&&_e._id?(m(),Z(v(L),{key:1,details:x.value,onClose:O[7]||(O[7]=()=>{G({variables:{}})}),showPanel:!!((c=x.value)!=null&&c._id)},null,8,["details","showPanel"])):X("",!0)])}}}),os={class:"flex-auto flex-grow h-full bg-bg-card rounded-lg border border-border overflow-x-auto flex-col flex"},is={class:"header px-4 py-3 border-b border-border flex items-center justify-between gap-1"},ds={class:"flex gap-3 items-center"},us={key:1,class:"space-y-6 p-4 w-full flex-auto overflow-y-auto"},cs={class:"flex flex-col gap-6"},ps={class:"space-y-4 bg-bg-surface/30 p-4 rounded-md"},ms={class:"flex items-center justify-between"},fs={class:"text-sm font-semibold"},vs={key:0,class:"w-full h-full min-h-[250px] flex justify-center items-center"},gs={class:"space-y-4 bg-bg-surface/30 p-4 rounded-md"},bs={class:"flex items-center justify-between"},ys={class:"text-sm font-semibold"},xs={key:0,class:"w-full h-full min-h-[250px] flex justify-center items-center"},Ds=ye({__name:"Plan",setup(i){const r=B(!1),S=()=>{r.value=!1},{workspaceId:$}=Je(),L=B(!1),{moveSelectedToSprint:y,moveSelectedToBacklog:b,deleteSelected:T,saveSprintMeta:P,toggleStartSprint:M}=rt(),{data:N}=Ie($),{mutate:H,isPending:q}=qt({onSuccess:()=>{J.invalidateQueries({queryKey:["sprint-list"]}),U.value=!1}}),_=B(null),U=B(!1),D=()=>{var g;H((g=_.value)==null?void 0:g._id)},{mutate:t,isPending:s}=Ke({onSuccess:g=>{P({name:g.title}),C({id:d.value}),oe.value=!1}}),{mutate:C,isPending:n}=At({onSuccess:()=>{re()}}),l=g=>{console.log("helo",_.value,g),t({id:d.value,payload:{goal:g.goal,start_date:g.start,end_date:g.end}})},{data:a,refetch:u}=Mt($.value),{refetch:w,isPending:x}=Ie($),G=E(()=>{var g,p;return(p=(g=a==null?void 0:a.value)==null?void 0:g.sprints[0])==null?void 0:p._id}),d=B(G.value);j(()=>G.value,g=>{d.value=g});const{data:V,refetch:re}=Ot(G),oe=B(!1),Ce=()=>{oe.value=!0},{data:ee,isPending:pe,refetch:te}=Bt(d);j(()=>pe.value,g=>{console.log(g,pe.value,">>>> laoding state changes")});const K=E(()=>{var fe,ue;const g=(fe=ee==null?void 0:ee.value)==null?void 0:fe.backlog_items;if(!g)return null;const p=(((ue=ee==null?void 0:ee.value)==null?void 0:ue.backlog_items)||[]).map(R=>{var Ve,Te,$e,Le,Me;const ce=((Ve=R==null?void 0:R.card)==null?void 0:Ve.variables)||{},ve=((Te=R==null?void 0:R.card)==null?void 0:Te._id)||R.card_id;return{id:ve,key:ce["card-code"]||(ve==null?void 0:ve.slice(-6))||"PRJ-?",summary:ce["card-title"]||"(untitled)",type:"Story",status:De(String(ce["card-status"]||"").trim()),assignee:((Le=($e=R==null?void 0:R.card)==null?void 0:$e.assigned_to)==null?void 0:Le.name)||"Unassigned",storyPoints:Number(R.story_points||0),priority:xe(String(ce.priority||"").trim()),createdAt:((Me=R==null?void 0:R.card)==null?void 0:Me.created_at)||new Date().toISOString(),description:ce["card-description"]||""}});return{id:g._id,name:g.title||"Sprint 1",title:g.title,goal:"",start:"",end:"",started:!1,tickets:p}});function De(g){const p=g.toLowerCase();return p.includes("progress")?"In Progress":p.includes("done")||p.includes("complete")?"Done":"Todo"}function xe(g){const p=g.toLowerCase();return p==="highest"||p==="blocker"||p==="critical"?"Highest":p==="high"||p==="major"?"High":p==="medium"||p==="normal"?"Medium":"Low"}const{mutate:we}=Ht({onSuccess:()=>{Se.success("Card removed from sprint successfully"),h()},onError:g=>{Se.error("Failed to remove card from sprint"),console.error("Failed to remove card from sprint:",g)}});function h(){te(),u(),w(),re()}function O(g){console.log(">>> moving back to backlog"),d&&we({sprintId:d,cardId:g})}const le={createdAt:(g,p,fe)=>{const ue=new Date(g.createdAt).getTime(),R=new Date(p.createdAt).getTime();return fe==="asc"?ue-R:R-ue}},ie=B(!1),ae=B(null);function _e(){L.value=!0,ae.value=null}function c(g){ae.value=g,r.value=!0,ie.value=!0}const o=B(!1);function f(){o.value=!0}const J=Ne(),{mutate:se,isPending:de}=Ut({onSuccess:g=>{P({name:g.title}),J.invalidateQueries({queryKey:["sprint-list"]}),o.value=!1}}),{mutate:me,isPending:Ee}=Ke({onSuccess:g=>{P({name:g.title}),J.invalidateQueries({queryKey:["sprint-list"]}),o.value=!1}});function Re(g){var p;_.value?me({id:(p=_.value)==null?void 0:p._id,payload:{workspace_id:$.value,title:g.name}}):se({payload:{workspace_id:$.value,title:g.name}})}function ot(){_.value=null,console.log(">>> felo"),o.value=!0}function it(g){_.value=g,o.value=!0}function dt(g){_.value=g,U.value=!0}const{mutate:ut,isPending:ct}=Pt(d,{onSuccess:()=>{re()}}),pt=()=>{ut({})};return(g,p)=>{var fe,ue,R,ce,ve,Ve,Te,$e,Le,Me;return m(),k(ke,null,[e("div",os,[e("div",is,[F(wt,{prefix:"View By",modelValue:d.value,"onUpdate:modelValue":p[1]||(p[1]=z=>d.value=z),options:(fe=v(a))==null?void 0:fe.sprints,variant:"secondary",onEditOption:it,onDeleteOption:dt},{more:A(()=>[e("div",{onClick:p[0]||(p[0]=z=>ot()),class:"capitalize border-t border-border px-4 py-2 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-1 overflow-hidden overflow-ellipsis text-nowrap"},p[11]||(p[11]=[e("i",{class:"fa-solid fa-plus"},null,-1),W(" Add new ")]))]),_:1},8,["modelValue","options"]),e("div",ds,[F(Vt,{placeholder:"Search in Orchit AI space"}),((ue=v(V))==null?void 0:ue.status)=="active"?(m(),Z(ne,{key:0,size:"sm",onClick:pt},{default:A(()=>[W(I(v(ct)?"Ending...":"End"),1)]),_:1})):(m(),Z(ne,{key:1,size:"sm",onClick:Ce,disabled:!K.value||K.value.tickets.length==0},{default:A(()=>p[12]||(p[12]=[W("Start Sprint")])),_:1,__:[12]},8,["disabled"]))])]),((R=v(V))==null?void 0:R.status)=="active"?(m(),Z(rs,{key:0,sptint_id:d.value},null,8,["sptint_id"])):(m(),k("div",us,[e("div",cs,[e("section",ps,[e("div",ms,[e("h2",fs,"Sprint ("+I((ve=(ce=K.value)==null?void 0:ce.tickets)==null?void 0:ve.length)+" Taks)",1)]),v(pe)?(m(),k("div",vs,p[13]||(p[13]=[e("div",{role:"status","aria-label":"Loading",class:"h-10 w-10 rounded-full border-4 border-neutral-700 border-t-transparent animate-spin"},null,-1)]))):(m(),k(ke,{key:1},[K.value?(m(),Z(ua,{key:0,sprintId:d.value,sprint:K.value,onOpenTicket:c,onEditSprint:f,onToggleStart:v(M),onMoveSelectedToBacklog:v(b),onDeleteSelectedSprint:p[2]||(p[2]=z=>v(T)("sprint",z)),onRefresh:h},null,8,["sprintId","sprint","onToggleStart","onMoveSelectedToBacklog"])):X("",!0)],64))]),e("section",gs,[e("div",bs,[e("h2",ys,"Backlog ("+I((Te=(Ve=v(N))==null?void 0:Ve.cards)==null?void 0:Te.length)+" Tasks)",1),e("div",{class:"flex items-center gap-2"},[e("button",{class:"w-8 h-8 rounded-md border cursor-pointer aspect-square text-sm border-border hover:bg-bg-surface/80",onClick:_e},p[14]||(p[14]=[e("i",{class:"text-text-primary fa-regular fa-plus"},null,-1)]))])]),v(x)?(m(),k("div",xs,p[15]||(p[15]=[e("div",{role:"status","aria-label":"Loading",class:"h-10 w-10 rounded-full border-4 border-neutral-700 border-t-transparent animate-spin"},null,-1)]))):(m(),Z(Qt,{key:1,sorters:le,onMoveSelectedToSprint:v(y),onDeleteSelectedBacklog:p[3]||(p[3]=z=>v(T)("backlog")),onOpenTicket:c,onTicketMovedToBacklog:O},null,8,["onMoveSelectedToSprint"]))])])]))]),F(Tt,{onClick:p[4]||(p[4]=he(()=>{},["stop"])),modelValue:U.value,"onUpdate:modelValue":p[5]||(p[5]=z=>U.value=z),title:"Delete Sprint",itemLabel:"Sprint",itemName:($e=_.value)==null?void 0:$e.title,requireMatchText:(Le=_.value)==null?void 0:Le.title,confirmText:"Delete Ticket",cancelText:"Cancel",size:"md",loading:v(q),onConfirm:D,onCancel:p[6]||(p[6]=()=>{_.value=null,U.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),F(ma,{modelValue:o.value,"onUpdate:modelValue":p[7]||(p[7]=z=>o.value=z),onSave:Re,sprint:_.value,creatingSprint:_.value?v(Ee):v(de)},null,8,["modelValue","sprint","creatingSprint"]),F(ka,{sprint:_.value,modelValue:oe.value,"onUpdate:modelValue":p[8]||(p[8]=z=>oe.value=z),onSave:l,creatingSprint:v(n)||v(s)},null,8,["sprint","modelValue","creatingSprint"]),F(Ct,{modelValue:r.value,"onUpdate:modelValue":p[9]||(p[9]=z=>r.value=z),cardId:(Me=ae.value)==null?void 0:Me.id,onClose:S},null,8,["modelValue","cardId"]),F(ts,{modelValue:L.value,"onUpdate:modelValue":p[10]||(p[10]=z=>L.value=z)},null,8,["modelValue"])],64)}}});export{Ds as default};
