import{d as G,c as f,j as v,F as B,y as O,o as p,f as e,ad as ue,t as V,O as me,m as se,J as pe,N as ve,K as fe,n as q,al as ge,r as P,e as X,X as be,w as A,aA as _e,i as R,k as Z,I as oe,p as C,z as F,D as xe,am as ke,B as Y,g as ee,U as K,aB as le,ah as _,aC as he,aD as ye,u as we}from"./index-tfagm7Um.js";import{f as Ce}from"./FormatDate--XHqACrs.js";import{_ as Ie}from"./BaseEmailChip.vue_vue_type_script_setup_true_lang-HROMlwtq.js";import{u as $e,a as je,b as Pe}from"./usePeople-ZX_LuNxh.js";import{b as Se}from"./usePackages-B_r740Wy.js";import{f as Ve}from"./permissionUtils-fD2X1oS-.js";const ze=["aria-busy"],We=["onClick","aria-label"],Ue=["src"],Re={class:"flex justify-between gap-2.5 border-t border-border bg-bg-card p-3.5 text-sm"},Ee={class:"flex items-start gap-2.5"},Te=["src"],De={class:"min-w-0"},Le={class:"truncate text-sm font-medium text-text-primary w-20"},Ne={class:"truncate text-xs text-text-secondary"},qe={class:"truncate text-sm font-medium text-text-primary w-30 text-end"},Ae={key:1,class:"grid grid-cols-1 gap-5 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4"},Be={key:2,class:"col-span-full flex items-center justify-center py-10 text-sm text-text-secondary"},Me=G({__name:"ProjectGallery",props:{projects:{},loading:{type:Boolean,default:!1},skeletonCount:{default:8}},setup(M){const E=M,y=se(),z=f(()=>E.skeletonCount??8),w=r=>{var u;return((u=r==null?void 0:r.variables)==null?void 0:u.title)||(r==null?void 0:r.title)||"Untitled"};function g(r){if(!r)return"—";const u=new Date(r);return Number.isNaN(+u)?"—":new Intl.DateTimeFormat(void 0,{dateStyle:"medium",timeStyle:"short"}).format(u)}function t(r){let u=0;for(let m=0;m<((r==null?void 0:r.length)||0);m++)u=u*31+r.charCodeAt(m)|0;const n=Math.abs(u)%360;return`linear-gradient(135deg, hsl(${n} 55% 55%), hsl(${n} 60% 48%))`}function b(r){return t(w(r))}function W(r){var n;const u=(n=r==null?void 0:r.LatestTask)==null?void 0:n.job_id;u?localStorage.setItem("jobId",u):localStorage.removeItem("jobId"),y.push(`/workspace/peak/${r._id}/${u??""}`)}return(r,u)=>{var n;return!r.loading&&((n=r.projects)!=null&&n.length)?(p(),v("section",{key:0,class:"grid grid-cols-1 gap-5 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4","aria-busy":r.loading?"true":"false","aria-live":"polite"},[(p(!0),v(B,null,O(r.projects,(m,k)=>{var I;return p(),v("article",{key:m._id??k,class:"group relative overflow-hidden rounded-xl cursor-pointer border border-border/70 bg-bg-card shadow-sm outline-none transition-all duration-200 hover:shadow-md focus-within:ring-2 focus-within:ring-orange-300"},[e("button",{type:"button",class:"absolute inset-0 z-10",onClick:D=>W(m),"aria-label":`Open project ${w(m)}`},null,8,We),e("div",{class:"flex h-39 items-center justify-center",style:ue({background:b(m)})},[e("img",{src:m.logo,class:"aspect-square h-10 w-10 rounded-md object-cover",alt:"",loading:"lazy",decoding:"async"},null,8,Ue)],4),e("div",Re,[e("div",Ee,[e("img",{src:m.logo,class:"h-6 w-6 rounded-md object-cover",alt:"",loading:"lazy",decoding:"async"},null,8,Te),e("div",De,[e("h3",Le,V(w(m)),1),e("p",Ne,V(g(m.created_at)),1)])]),e("div",null,[e("h3",qe,V((I=m.owner)==null?void 0:I.name),1),u[0]||(u[0]=e("p",{class:"truncate text-xs text-text-secondary text-end"},"Workspace Owner",-1))])])])}),128))],8,ze)):r.loading?(p(),v("section",Ae,[(p(!0),v(B,null,O(z.value,m=>(p(),v("div",{key:"sk-"+m,class:"overflow-hidden rounded-xl border border-border/70 bg-bg-card shadow-sm",role:"status","aria-label":"Loading project"},u[1]||(u[1]=[me('<div class="h-39 bg-[linear-gradient(90deg,theme(colors.slate.200/20),theme(colors.slate.200/40),theme(colors.slate.200/20))] bg-[length:200%_100%] animate-[shimmer_1.1s_ease_infinite]" data-v-3a990292></div><div class="flex items-start gap-2.5 border-t border-border p-3.5 text-sm" data-v-3a990292><div class="h-6 w-6 rounded-md bg-surface" data-v-3a990292></div><div class="flex w-full flex-col gap-2" data-v-3a990292><div class="h-3 w-32 rounded bg-surface" data-v-3a990292></div><div class="h-2.5 w-20 rounded bg-surface" data-v-3a990292></div></div></div>',2)])))),128))])):(p(),v("div",Be," No projects yet "))}}}),Ke=pe(Me,[["__scopeId","data-v-3a990292"]]),Oe={class:"px-6 flex flex-col gap-4"},Qe={key:0,class:"w-full mt-2"},Fe=["onClick"],Ge={class:"text-sm font-medium text-text-primary"},He={key:0,class:"py-2 border-t border-border bg-bg-input"},Je=["value"],Xe={class:"text-xs font-medium text-text-primary"},Ze={class:"text-[11px] text-text-secondary leading-tight"},Ye={class:"flex justify-end gap-2 p-6 mt-6 sticky bottom-0 bg-bg-body border-t border-border"},es=G({__name:"InviteUsersWithPermissions",props:{modelValue:{type:Boolean,default:!1},defaultWorkspaceId:{}},emits:["update:modelValue","invited"],setup(M,{emit:E}){const y=E,z=M,w=f({get:()=>z.modelValue,set:s=>y("update:modelValue",s)}),g=ve(),t=fe({workspace_id:null,role_id:null,emails:[],additional_seats:1,workspace_access_role_id:null});q(()=>z.defaultWorkspaceId,s=>{s&&(t.workspace_id=s,t.role_id=null)},{immediate:!0});const b=f(()=>t.workspace_id??void 0),{data:W,isLoading:r}=$e(b,{enabled:f(()=>!!t.workspace_id)}),u=f(()=>(W.value||[]).map(s=>({_id:s._id,title:s.title})));q(W,s=>{console.log(s,"workspace roles.......")});const{data:n}=ge(b,{enabled:f(()=>!!t.workspace_id)}),m=f(()=>{var s;return((s=n.value)==null?void 0:s.company_id)??null}),{data:k,refetch:I,isLoading:D}=je({company_id:m,workspace_id:b},{enabled:f(()=>!!m.value&&!!b.value)});q(b,()=>{b.value&&m.value&&I()});const T=f(()=>(k.value||[]).map(s=>({_id:s._id,title:s.title})));q(T,s=>{s&&s.length>0&&t.role_id});const x=f(()=>!k.value||!t.workspace_access_role_id?null:k.value.find(s=>s._id===t.workspace_access_role_id)),L=P({}),U=P([]),{mutate:l}=Se();function o(s){L.value[s]=!L.value[s]}q(x,s=>{if(!s){U.value=[];return}const i=[];s.permission_categories.forEach(d=>{d.permissions.forEach(a=>{a.enabled&&i.push(a._id)})}),U.value=i},{immediate:!0});function c(s){t.workspace_access_role_id=s}function $(){var d;if(!((d=x.value)!=null&&d._id))return;const s=[];x.value.permission_categories.forEach(a=>{a.permissions.forEach(h=>s.push(h))});const i=Ve(s,U.value);l({roleId:x.value._id,payload:{title:x.value.title,description:x.value.description,is_admin:x.value.is_admin,is_editor:x.value.is_editor,is_viewer:x.value.is_viewer,permission_ids:i.permission_ids,module_permissions:i.module_permissions,workspace_id:t.workspace_id}},{onSuccess:()=>{K.success("Permissions updated successfully"),g.invalidateQueries({queryKey:["workspace-roles"]})},onError:a=>{console.error("Failed to update permissions",a),K.error("Failed to update permissions")}})}const S=f(()=>t.workspace_access_role_id?"":"Role is required"),j=f(()=>{const s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.emails.filter(i=>!s.test(i))}),H=f(()=>j.value.length?`Invalid: ${j.value.join(", ")}`:""),N=f(()=>!!t.workspace_id&&!!t.role_id&&!!t.workspace_access_role_id&&t.emails.length>0&&j.value.length===0);f(()=>{var s;return((s=k.value)==null?void 0:s.find(i=>i._id===t.workspace_access_role_id))||null});function re(s){}function ie(){}const{mutate:ne,isPending:J}=Pe();function de(){if(!N.value||J.value)return;const i=t.emails.map(d=>({name:ce(d),email:d}))[0];ne({id:t.role_id,payload:{name:i.name,email:i.email,workspace_id:t.workspace_id,workspace_access_role_id:t.workspace_access_role_id,role_id:t.role_id,additional_seats:1}},{onSuccess:d=>{var a,h;(a=d==null?void 0:d.failedInvites)!=null&&a.length?K.error(((h=d.failedInvites[0])==null?void 0:h.error)??"Some invites failed"):K.success("Invitations sent"),g.invalidateQueries({queryKey:["all-users"]}),g.invalidateQueries({queryKey:["people-lists"]}),g.invalidateQueries({queryKey:["workspaceRoles"]}),g.invalidateQueries({queryKey:["workspaces"]}),g.invalidateQueries({queryKey:["people"]}),g.invalidateQueries({queryKey:["dashboard-teams"]}),y("invited",d),ae(),w.value=!1},onError:d=>{var h,Q;const a=((Q=(h=d==null?void 0:d.response)==null?void 0:h.data)==null?void 0:Q.message)||(d==null?void 0:d.message)||"Failed to send invitations.";K.error(a)}})}function te(){ae(),w.value=!1}function ae(){t.role_id=null,t.emails=[]}function ce(s){const d=(s.split("@")[0]||"").split("+")[0].split(/[^a-zA-Z]+/).filter(Boolean);return d.length?d.map(a=>a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()).join(" "):s}return(s,i)=>(p(),X(be,{modelValue:w.value,"onUpdate:modelValue":i[3]||(i[3]=d=>w.value=d),size:"md",modalClass:"!py-0"},{default:A(()=>{var d;return[e("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[i[5]||(i[5]=e("h2",{class:"text-xl font-semibold"},"Invite Users",-1)),i[6]||(i[6]=e("p",{class:"text-sm text-text-secondary mt-1"}," Add emails, workspace role and pick role based permission. ",-1)),e("button",{onClick:te,class:"absolute top-4 cursor-pointer right-4 text-text-secondary hover:text-text-primary text-xl z-10"},i[4]||(i[4]=[e("img",{"data-v-4ef80912":"",src:_e,alt:""},null,-1)]))]),e("div",Oe,[R(Ie,{class:"w-full",label:"User emails",modelValue:t.emails,"onUpdate:modelValue":i[0]||(i[0]=a=>t.emails=a),error:!!H.value,message:H.value||"Press Enter after each email",showName:"",onInvalid:re,onAdd:ie},null,8,["modelValue","error","message"]),R(oe,{size:"md",label:"Team Role",options:u.value,placeholder:"Choose team role","model-value":t.role_id,loading:C(r),"onUpdate:modelValue":i[1]||(i[1]=a=>t.role_id=a)},null,8,["options","model-value","loading"]),R(oe,{size:"md",label:"Workspace Role",options:T.value,placeholder:"Choose workspace role","model-value":t.workspace_access_role_id,"onUpdate:modelValue":c,disabled:!t.workspace_id,message:S.value,error:!!S.value,loading:C(D)||!m.value},null,8,["options","model-value","disabled","message","error","loading"]),x.value&&!x.value.is_admin?(p(),v("div",Qe,[i[7]||(i[7]=e("h2",{class:"text-base font-medium mb-1 flex items-center text-text-primary"}," Permissions ",-1)),(p(!0),v(B,null,O((d=x.value)==null?void 0:d.permission_categories,a=>(p(),v("div",{key:a==null?void 0:a.category,class:"border border-border mb-2 rounded-lg overflow-hidden bg-bg-surface/30"},[e("button",{onClick:h=>o(a==null?void 0:a.category),class:"w-full px-3 py-2 flex justify-between items-center hover:bg-bg-surface transition"},[e("span",Ge,V(a==null?void 0:a.category_title),1),e("i",{class:F(["fa-solid fa-chevron-down text-xs text-text-secondary transition-transform",L.value[a==null?void 0:a.category]?"rotate-180":""])},null,2)],8,Fe),L.value[a==null?void 0:a.category]?(p(),v("div",He,[(p(!0),v(B,null,O(a==null?void 0:a.permissions,h=>(p(),v("div",{key:h._id,class:"flex items-start gap-2 hover:bg-bg-body py-2 px-3"},[xe(e("input",{type:"checkbox","onUpdate:modelValue":i[2]||(i[2]=Q=>U.value=Q),value:h._id,onChange:$,class:"h-4 w-4 mt-0.5 rounded border-border accent-accent cursor-pointer flex-shrink-0"},null,40,Je),[[ke,U.value]]),e("div",null,[e("p",Xe,V(h.title),1),e("p",Ze,V(h.description),1)])]))),128))])):Z("",!0)]))),128))])):Z("",!0)]),e("div",Ye,[R(Y,{variant:"secondary",onClick:te},{default:A(()=>i[8]||(i[8]=[ee("Cancel")])),_:1,__:[8]}),R(Y,{variant:"primary",disabled:!N.value||C(J),onClick:de},{default:A(()=>[ee(V(C(J)?"Inviting…":"Send Invites"),1)]),_:1},8,["disabled"])])]}),_:1},8,["modelValue"]))}}),ss={class:"flex -space-x-2"},ts=G({__name:"WorkspaceListTable",setup(M){const E=se(),y=new Map,z=l=>(y.has(l)||y.set(l,Ce(l)),y.get(l)),w=l=>{var $;const o=l.row,c=($=o==null?void 0:o.LatestTask)==null?void 0:$.job_id;c?localStorage.setItem("jobId",c):localStorage.removeItem("jobId"),E.push(`/workspace/peak/${o==null?void 0:o._id}/${c||""}`)},g=P(!1),t=P(void 0),b=l=>{t.value=l,g.value=!0},k=[{key:"variables",label:"Project",render:({row:l,value:o})=>_("div",{class:"flex items-center gap-2"},[l.logo?_("img",{src:l.logo,alt:(o==null?void 0:o.title)||"Project",class:"h-8 w-8 bg-bg-card rounded-full object-cover",loading:"lazy",decoding:"async"}):_("div",{class:"h-8 w-8 rounded-full bg-bg-card"}),_("span",{class:"cursor-pointer hover:underline",onClick:c=>{c.stopPropagation(),w({row:l})}},(o==null?void 0:o.title)||"Untitled")])},{key:"variables",label:"Project type",render:({value:l})=>_("span",{class:"capitalize"},(l==null?void 0:l["workspace-type"])||"-")},{key:"People",label:"People",render:({row:l,value:o})=>_("div",{class:"flex items-center -space-x-3"},[_(ye,{avatars:o||[],image:!0,maxVisible:3}),_("button",{class:l.has_permission_to_manage_user?"flex justify-center items-center rounded-full border border-border text-xs bg-bg-dropdown cursor-pointer hover:bg-bg-dropdown-menu-hover transition  h-8 w-8 cursor-pointer":"hidden",onClick:c=>{c.stopPropagation(),b(l._id)},title:"Invite Users"},[_("i",{class:"fa-solid fa-plus text-gray-500 text-xs"})])])},{key:"created_at",label:"Start Date",render:({value:l})=>_("span",z(l))},{key:"admin",label:"Workspace Owner",render:({row:l})=>{const o=l==null?void 0:l.owner;if(!o)return _("span","-");const c=S=>S.split(" ").map(j=>j[0]).join("").toUpperCase(),$=S=>{let j=0;for(let N=0;N<S.length;N++)j=S.charCodeAt(N)+((j<<5)-j);return`hsl(${Math.abs(j)%360}, 60%, 50%)`};return _("div",{class:"flex items-center gap-2"},[o.profile_img?_("img",{src:o.profile_img,alt:o.name,class:"h-6 w-6 rounded-full object-cover",loading:"lazy",decoding:"async"}):_("div",{class:"h-8 w-8 border-primary border-2 shadow-md flex items-center justify-center rounded-full text-white text-xs font-medium",style:{backgroundColor:$(o.name)}},c(o.name)),_("span",o.name)])}}],I=P(1),D=P(10),{data:T,isPending:x}=le(I,D),L=f(()=>{var l;return((l=T.value)==null?void 0:l.workspaces)??[]}),U=P(0);return q(T,()=>{var l,o,c,$;(o=(l=T.value)==null?void 0:l.pagination)!=null&&o.totalCount&&(U.value=($=(c=T.value)==null?void 0:c.pagination)==null?void 0:$.totalCount)}),(l,o)=>(p(),v(B,null,[R(he,{columns:k,rows:L.value,loading:C(x),total:U.value,page:I.value,"onUpdate:page":o[0]||(o[0]=c=>I.value=c),pageSize:D.value,"onUpdate:pageSize":o[1]||(o[1]=c=>D.value=c),pageSizes:[10,20,50,100]},{status:A(({row:c})=>[e("span",{class:F(["px-3 py-1 rounded-full text-xs font-medium",{"bg-blue-100 text-blue-600":c.status==="In progress","bg-red-100 text-red-600":c.status==="Live","bg-green-100 text-green-600":c.status==="Done"}])},V(c.status),3)]),team:A(({row:c})=>[e("div",ss,[(p(!0),v(B,null,O(c.Roles,($,S)=>(p(),v("span",{key:S,class:"w-6 h-6 flex items-center justify-center rounded-full bg-gray-200 text-xs"},V($),1))),128))])]),_:1},8,["rows","loading","total","page","pageSize"]),R(es,{modelValue:g.value,"onUpdate:modelValue":o[2]||(o[2]=c=>g.value=c),defaultWorkspaceId:t.value},null,8,["modelValue","defaultWorkspaceId"])],64))}}),as={class:"w-full bg-bg-body text-text-primary"},os={class:"mx-auto w-full max-w-[1440px] px-5 py-10 md:px-15 md:py-20"},ls={class:"flex flex-wrap items-center justify-between gap-5"},rs={class:"flex items-center gap-3"},is={class:"mt-21 mb-8 flex items-center justify-between"},ns={class:"flex items-center gap-3"},ds={key:0,class:"flex items-center justify-center py-10 text-sm text-text-secondary"},gs=G({__name:"Home",setup(M){const E=se(),y=we(),z=P(1),w=P(10),{data:g,isPending:t}=le(z,w),b=P("list"),W=u=>{b.value=u},r=f(()=>g.value.length===0);return(u,n)=>{var m;return p(),v("div",as,[e("div",os,[e("div",ls,[n[4]||(n[4]=e("div",{class:"flex flex-col gap-1.5 max-md:gap-1"},[e("h1",{class:"text-2xl font-medium"},"Welcome to Orchit AI!"),e("p",{class:"text-sm text-text-secondary"},"Create, organize, and collaborate seamlessly.")],-1)),e("div",rs,[e("div",{to:"/create-workspace",onClick:n[0]||(n[0]=()=>{var k,I;((k=C(y).limits.features[1])==null?void 0:k.usage.current)>=((I=C(y).limits.features[1])==null?void 0:I.limits.limit)?C(y).setLimitExccedModal(!0):C(E).push("/create-workspace")})},[R(Y,{variant:"primary"},{default:A(()=>n[3]||(n[3]=[ee("Create a workspace")])),_:1,__:[3]})])])]),e("div",is,[n[7]||(n[7]=e("h2",{class:"text-xl font-medium"},"All Workspaces",-1)),e("div",ns,[e("button",{class:F(["aspect-square w-8 cursor-pointer rounded-md p-1",b.value==="list"?"text-accent bg-accent-text":" hover:bg-border/50 backdrop-blur-2xl  transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),onClick:n[1]||(n[1]=k=>W("list")),title:"List view"},n[5]||(n[5]=[e("i",{class:"fa-solid fa-align-left"},null,-1)]),2),e("button",{class:F(["aspect-square w-8 cursor-pointer rounded-md p-1",b.value==="gallery"?"text-accent bg-accent-text":"hover:bg-border/50 backdrop-blur-2xl  transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),onClick:n[2]||(n[2]=k=>W("gallery")),title:"Gallery view"},n[6]||(n[6]=[e("i",{class:"fa-solid fa-grid-2"},null,-1)]),2)])]),!C(t)&&r.value?(p(),v("div",ds," No Workspace ")):b.value==="list"?(p(),X(ts,{key:1})):b.value==="gallery"?(p(),X(Ke,{key:2,projects:(m=C(g))==null?void 0:m.workspaces,loading:C(t)},null,8,["projects","loading"])):Z("",!0)])])}}});export{gs as default};
