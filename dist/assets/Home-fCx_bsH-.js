import{d as Q,c as v,j as p,F as A,y as M,f as s,a8 as de,t as V,L as ce,m as Y,o as m,I as ue,b as me,R as pe,n as D,ap as ve,r as $,e as H,V as fe,w as N,aq as be,i as R,k as Z,H as ae,z as O,C as ge,a9 as _e,B as J,g as X,p as I,S as L,ar as oe,as as xe,at as g,au as ke,u as he}from"./index-CjFOheYc.js";import{f as ye}from"./FormatDate--XHqACrs.js";import{_ as we}from"./BaseEmailChip.vue_vue_type_script_setup_true_lang-BBhKmPsf.js";import{u as Ce,a as Ie,b as $e}from"./usePeople-DCrwFIz6.js";import{b as je}from"./usePackages-CxukpSz6.js";const Pe=["aria-busy"],Se=["onClick","aria-label"],Ve=["src"],ze={class:"flex justify-between gap-2.5 border-t border-border bg-bg-card p-3.5 text-sm"},We={class:"flex items-start gap-2.5"},Ue=["src"],Re={class:"min-w-0"},Te={class:"truncate text-sm font-medium text-text-primary w-20"},Ee={class:"truncate text-xs text-text-secondary"},De={class:"truncate text-sm font-medium text-text-primary"},Ne={key:1,class:"grid grid-cols-1 gap-5 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4"},Ae={key:2,class:"col-span-full flex items-center justify-center py-10 text-sm text-text-secondary"},Be=Q({__name:"ProjectGallery",props:{projects:{},loading:{type:Boolean,default:!1},skeletonCount:{default:8}},setup(B){const T=B,h=Y(),z=v(()=>T.skeletonCount??8),y=i=>{var c;return((c=i==null?void 0:i.variables)==null?void 0:c.title)||(i==null?void 0:i.title)||"Untitled"};function x(i){if(!i)return"—";const c=new Date(i);return Number.isNaN(+c)?"—":new Intl.DateTimeFormat(void 0,{dateStyle:"medium",timeStyle:"short"}).format(c)}function a(i){let c=0;for(let u=0;u<((i==null?void 0:i.length)||0);u++)c=c*31+i.charCodeAt(u)|0;const n=Math.abs(c)%360;return`linear-gradient(135deg, hsl(${n} 55% 55%), hsl(${n} 60% 48%))`}function f(i){return a(y(i))}function W(i){var n;const c=(n=i==null?void 0:i.LatestTask)==null?void 0:n.job_id;c?localStorage.setItem("jobId",c):localStorage.removeItem("jobId"),h.push(`/workspace/peak/${i._id}/${c??""}`)}return(i,c)=>{var n;return!i.loading&&((n=i.projects)!=null&&n.length)?(m(),p("section",{key:0,class:"grid grid-cols-1 gap-5 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4","aria-busy":i.loading?"true":"false","aria-live":"polite"},[(m(!0),p(A,null,M(i.projects,(u,C)=>{var w;return m(),p("article",{key:u._id??C,class:"group relative overflow-hidden rounded-xl cursor-pointer border border-border/70 bg-bg-card shadow-sm outline-none transition-all duration-200 hover:shadow-md focus-within:ring-2 focus-within:ring-orange-300"},[s("button",{type:"button",class:"absolute inset-0 z-10",onClick:b=>W(u),"aria-label":`Open project ${y(u)}`},null,8,Se),s("div",{class:"flex h-39 items-center justify-center",style:de({background:f(u)})},[s("img",{src:u.logo,class:"aspect-square h-10 w-10 rounded-md object-cover",alt:"",loading:"lazy",decoding:"async"},null,8,Ve)],4),s("div",ze,[s("div",We,[s("img",{src:u.logo,class:"h-6 w-6 rounded-md object-cover",alt:"",loading:"lazy",decoding:"async"},null,8,Ue),s("div",Re,[s("h3",Te,V(y(u)),1),s("p",Ee,V(x(u.created_at)),1)])]),s("div",null,[s("h3",De,V((w=u.owner)==null?void 0:w.name),1),c[0]||(c[0]=s("p",{class:"truncate text-xs text-text-secondary"},"Workspace Owner",-1))])])])}),128))],8,Pe)):i.loading?(m(),p("section",Ne,[(m(!0),p(A,null,M(z.value,u=>(m(),p("div",{key:"sk-"+u,class:"overflow-hidden rounded-xl border border-border/70 bg-bg-card shadow-sm",role:"status","aria-label":"Loading project"},c[1]||(c[1]=[ce('<div class="h-39 bg-[linear-gradient(90deg,theme(colors.slate.200/20),theme(colors.slate.200/40),theme(colors.slate.200/20))] bg-[length:200%_100%] animate-[shimmer_1.1s_ease_infinite]" data-v-518c688c></div><div class="flex items-start gap-2.5 border-t border-border p-3.5 text-sm" data-v-518c688c><div class="h-6 w-6 rounded-md bg-surface" data-v-518c688c></div><div class="flex w-full flex-col gap-2" data-v-518c688c><div class="h-3 w-32 rounded bg-surface" data-v-518c688c></div><div class="h-2.5 w-20 rounded bg-surface" data-v-518c688c></div></div></div>',2)])))),128))])):(m(),p("div",Ae," No projects yet "))}}}),qe=ue(Be,[["__scopeId","data-v-518c688c"]]),Le={class:"px-6 flex flex-col gap-4"},Me={key:0,class:"w-full mt-2"},Fe=["onClick"],Oe={class:"text-sm font-medium text-text-primary"},Qe={key:0,class:"px-3 py-2 space-y-2 border-t border-border bg-bg-card"},Ke=["value"],Ge={class:"text-xs font-medium text-text-primary"},He={class:"text-[11px] text-text-secondary leading-tight"},Ze={class:"flex justify-end gap-2 p-6 mt-6 sticky bottom-0 bg-bg-body border-t border-border"},Je=Q({__name:"InviteUsersWithPermissions",props:{modelValue:{type:Boolean,default:!1},defaultWorkspaceId:{}},emits:["update:modelValue","invited"],setup(B,{emit:T}){const h=T,z=B,y=v({get:()=>z.modelValue,set:t=>h("update:modelValue",t)}),x=me(),a=pe({workspace_id:null,role_id:null,emails:[],additional_seats:1,workspace_access_role_id:null});D(()=>z.defaultWorkspaceId,t=>{t&&(a.workspace_id=t,a.role_id=null)},{immediate:!0});const f=v(()=>a.workspace_id??void 0),{data:W}=Ce(f,{enabled:v(()=>!!a.workspace_id)}),i=v(()=>(W.value||[]).map(t=>({_id:t._id,title:t.title})));D(W,t=>{console.log(t,"workspace roles.......")});const{data:c}=ve(f,{enabled:v(()=>!!a.workspace_id)}),n=v(()=>{var t;return((t=c.value)==null?void 0:t.company_id)??null}),{data:u,refetch:C}=Ie({company_id:n,workspace_id:f},{enabled:v(()=>!!n.value&&!!f.value)});D(f,()=>{f.value&&C()});const w=v(()=>(u.value||[]).map(t=>({_id:t._id,title:t.title})));D(w,t=>{t&&t.length>0&&a.role_id});const b=v(()=>!u.value||!a.workspace_access_role_id?null:u.value.find(t=>t._id===a.workspace_access_role_id)),j=$({}),E=$([]),{mutate:K}=je();function F(t){j.value[t]=!j.value[t]}D(b,t=>{if(!t){E.value=[];return}const e=[];t.permission_categories.forEach(_=>{_.permissions.forEach(l=>{l.enabled&&e.push(l._id)})}),E.value=e},{immediate:!0});function r(t){a.workspace_access_role_id=t}function o(){var t;(t=b.value)!=null&&t._id&&K({roleId:b.value._id,payload:{title:b.value.title,description:b.value.description,is_admin:b.value.is_admin,is_editor:b.value.is_editor,is_viewer:b.value.is_viewer,permission_ids:E.value}},{onSuccess:()=>{L.success("Permissions updated successfully"),x.invalidateQueries({queryKey:["workspace-roles"]})},onError:e=>{console.error("Failed to update permissions",e),L.error("Failed to update permissions")}})}const d=v(()=>a.workspace_access_role_id?"":"Role is required"),k=v(()=>{const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return a.emails.filter(e=>!t.test(e))}),P=v(()=>k.value.length?`Invalid: ${k.value.join(", ")}`:""),S=v(()=>!!a.workspace_id&&!!a.role_id&&!!a.workspace_access_role_id&&a.emails.length>0&&k.value.length===0);v(()=>{var t;return((t=u.value)==null?void 0:t.find(e=>e._id===a.workspace_access_role_id))||null});function ee(t){}function q(){}const{mutate:le,isPending:G}=$e();function re(){if(!S.value||G.value)return;const t=a.emails.map(e=>({name:ie(e),email:e}));le({id:a.role_id,payload:{users:t,workspace_id:a.workspace_id,workspace_access_role_id:a.workspace_access_role_id,role_id:a.role_id,additional_seats:1}},{onSuccess:e=>{var _,l;(_=e==null?void 0:e.failedInvites)!=null&&_.length?L.error(((l=e.failedInvites[0])==null?void 0:l.error)??"Some invites failed"):L.success("Invitations sent"),x.invalidateQueries({queryKey:["all-users"]}),x.invalidateQueries({queryKey:["people-lists"]}),x.invalidateQueries({queryKey:["workspaceRoles"]}),h("invited",e),se(),y.value=!1},onError:e=>{var l,U;const _=((U=(l=e==null?void 0:e.response)==null?void 0:l.data)==null?void 0:U.message)||(e==null?void 0:e.message)||"Failed to send invitations.";L.error(_)}})}function te(){se(),y.value=!1}function se(){a.role_id=null,a.emails=[]}function ie(t){const _=(t.split("@")[0]||"").split("+")[0].split(/[^a-zA-Z]+/).filter(Boolean);return _.length?_.map(l=>l.charAt(0).toUpperCase()+l.slice(1).toLowerCase()).join(" "):t}return(t,e)=>(m(),H(fe,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=_=>y.value=_),size:"md",modalClass:"!py-0"},{default:N(()=>{var _;return[s("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[e[5]||(e[5]=s("h2",{class:"text-xl font-semibold"},"Invite Users",-1)),e[6]||(e[6]=s("p",{class:"text-sm text-text-secondary mt-1"}," Add emails, workspace role and pick role based permission. ",-1)),s("button",{onClick:te,class:"absolute top-4 cursor-pointer right-4 text-text-secondary hover:text-text-primary text-xl z-10"},e[4]||(e[4]=[s("img",{"data-v-4ef80912":"",src:be,alt:""},null,-1)]))]),s("div",Le,[R(we,{class:"w-full",label:"User emails",modelValue:a.emails,"onUpdate:modelValue":e[0]||(e[0]=l=>a.emails=l),error:!!P.value,message:P.value||"Press Enter after each email",showName:"",onInvalid:ee,onAdd:q},null,8,["modelValue","error","message"]),R(ae,{size:"md",label:"Team Role",options:i.value,placeholder:"Choose team role","model-value":a.role_id,"onUpdate:modelValue":e[1]||(e[1]=l=>a.role_id=l)},null,8,["options","model-value"]),R(ae,{size:"md",label:"Workspace Role",options:w.value,placeholder:"Choose workspace role","model-value":a.workspace_access_role_id,"onUpdate:modelValue":r,disabled:!a.workspace_id,message:d.value,error:!!d.value},null,8,["options","model-value","disabled","message","error"]),b.value&&!b.value.is_admin?(m(),p("div",Me,[e[7]||(e[7]=s("h2",{class:"text-base font-medium mb-1 flex items-center text-text-primary"}," Permissions ",-1)),(m(!0),p(A,null,M((_=b.value)==null?void 0:_.permission_categories,l=>(m(),p("div",{key:l==null?void 0:l.category,class:"border border-border mb-2 rounded-lg overflow-hidden bg-bg-surface/30"},[s("button",{onClick:U=>F(l==null?void 0:l.category),class:"w-full px-3 py-2 flex justify-between items-center hover:bg-bg-surface transition"},[s("span",Oe,V(l==null?void 0:l.category_title),1),s("i",{class:O(["fa-solid fa-chevron-down text-xs text-text-secondary transition-transform",j.value[l==null?void 0:l.category]?"rotate-180":""])},null,2)],8,Fe),j.value[l==null?void 0:l.category]?(m(),p("div",Qe,[(m(!0),p(A,null,M(l==null?void 0:l.permissions,U=>(m(),p("div",{key:U._id,class:"flex items-start gap-2"},[ge(s("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=ne=>E.value=ne),value:U._id,onChange:o,class:"h-4 w-4 mt-0.5 rounded border-border accent-accent cursor-pointer flex-shrink-0"},null,40,Ke),[[_e,E.value]]),s("div",null,[s("p",Ge,V(U.title),1),s("p",He,V(U.description),1)])]))),128))])):Z("",!0)]))),128))])):Z("",!0)]),s("div",Ze,[R(J,{variant:"secondary",onClick:te},{default:N(()=>e[8]||(e[8]=[X("Cancel")])),_:1,__:[8]}),R(J,{variant:"primary",disabled:!S.value||I(G),onClick:re},{default:N(()=>[X(V(I(G)?"Inviting…":"Send Invites"),1)]),_:1},8,["disabled"])])]}),_:1},8,["modelValue"]))}}),Xe={class:"flex -space-x-2"},Ye=Q({__name:"WorkspaceListTable",setup(B){const T=Y(),h=new Map,z=r=>(h.has(r)||h.set(r,ye(r)),h.get(r)),y=r=>{var k;const o=r.row,d=(k=o==null?void 0:o.LatestTask)==null?void 0:k.job_id;d?localStorage.setItem("jobId",d):localStorage.removeItem("jobId"),T.push(`/workspace/peak/${o==null?void 0:o._id}/${d||""}`)},x=$(!1),a=$(void 0),f=r=>{a.value=r,x.value=!0},C=[{key:"variables",label:"Project",render:({row:r,value:o})=>g("div",{class:"flex items-center gap-2"},[r.logo?g("img",{src:r.logo,alt:(o==null?void 0:o.title)||"Project",class:"h-8 w-8 bg-bg-card rounded-full object-cover",loading:"lazy",decoding:"async"}):g("div",{class:"h-8 w-8 rounded-full bg-bg-card"}),g("span",{class:"cursor-pointer hover:underline",onClick:d=>{d.stopPropagation(),y({row:r})}},(o==null?void 0:o.title)||"Untitled")])},{key:"variables",label:"Project type",render:({value:r})=>g("span",{class:"capitalize"},(r==null?void 0:r["workspace-type"])||"-")},{key:"People",label:"People",render:({row:r,value:o})=>g("div",{class:"flex items-center -space-x-3"},[g(ke,{avatars:o||[],image:!0,maxVisible:3}),g("button",{class:"h-8 w-8 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors border border-dashed border-gray-300 cursor-pointer",onClick:d=>{d.stopPropagation(),f(r._id)},title:"Invite Users"},[g("i",{class:"fa-solid fa-plus text-gray-500 text-xs"})])])},{key:"created_at",label:"Start Date",render:({value:r})=>g("span",z(r))},{key:"admin",label:"Workspace Owner",render:({row:r})=>{const o=r==null?void 0:r.owner;if(!o)return g("span","-");const d=P=>P.split(" ").map(S=>S[0]).join("").toUpperCase(),k=P=>{let S=0;for(let q=0;q<P.length;q++)S=P.charCodeAt(q)+((S<<5)-S);return`hsl(${Math.abs(S)%360}, 60%, 50%)`};return g("div",{class:"flex items-center gap-2"},[o.profile_img?g("img",{src:o.profile_img,alt:o.name,class:"h-6 w-6 rounded-full object-cover",loading:"lazy",decoding:"async"}):g("div",{class:"h-8 w-8 border-primary border-2 shadow-md flex items-center justify-center rounded-full text-white text-xs font-medium",style:{backgroundColor:k(o.name)}},d(o.name)),g("span",o.name)])}}],w=$(1),b=$(10),{data:j,isPending:E}=oe(w,b),K=v(()=>{var r;return((r=j.value)==null?void 0:r.workspaces)??[]}),F=$(0);return D(j,()=>{var r,o,d,k;(o=(r=j.value)==null?void 0:r.pagination)!=null&&o.totalCount&&(F.value=(k=(d=j.value)==null?void 0:d.pagination)==null?void 0:k.totalCount)}),(r,o)=>(m(),p(A,null,[R(xe,{columns:C,rows:K.value,loading:I(E),total:F.value,page:w.value,"onUpdate:page":o[0]||(o[0]=d=>w.value=d),pageSize:b.value,"onUpdate:pageSize":o[1]||(o[1]=d=>b.value=d),pageSizes:[10,20,50,100]},{status:N(({row:d})=>[s("span",{class:O(["px-3 py-1 rounded-full text-xs font-medium",{"bg-blue-100 text-blue-600":d.status==="In progress","bg-red-100 text-red-600":d.status==="Live","bg-green-100 text-green-600":d.status==="Done"}])},V(d.status),3)]),team:N(({row:d})=>[s("div",Xe,[(m(!0),p(A,null,M(d.Roles,(k,P)=>(m(),p("span",{key:P,class:"w-6 h-6 flex items-center justify-center rounded-full bg-gray-200 text-xs"},V(k),1))),128))])]),_:1},8,["rows","loading","total","page","pageSize"]),R(Je,{modelValue:x.value,"onUpdate:modelValue":o[2]||(o[2]=d=>x.value=d),defaultWorkspaceId:a.value},null,8,["modelValue","defaultWorkspaceId"])],64))}}),et={class:"w-full bg-bg-body text-text-primary"},tt={class:"mx-auto w-full max-w-[1440px] px-5 py-10 md:px-15 md:py-20"},st={class:"flex flex-wrap items-center justify-between gap-5"},at={class:"flex items-center gap-3"},ot={class:"mt-21 mb-8 flex items-center justify-between"},lt={class:"flex items-center gap-3"},rt={key:0,class:"flex items-center justify-center py-10 text-sm text-text-secondary"},mt=Q({__name:"Home",setup(B){const T=Y(),h=he(),z=$(1),y=$(10),{data:x,isPending:a}=oe(z,y),f=$("list"),W=c=>{f.value=c},i=v(()=>x.value.length===0);return(c,n)=>{var u;return m(),p("div",et,[s("div",tt,[s("div",st,[n[4]||(n[4]=s("div",{class:"flex flex-col gap-1.5 max-md:gap-1"},[s("h1",{class:"text-2xl font-medium"},"Welcome to Orchit AI!"),s("p",{class:"text-sm text-text-secondary"},"Create, organize, and collaborate seamlessly.")],-1)),s("div",at,[s("div",{to:"/create-workspace",onClick:n[0]||(n[0]=()=>{var C,w;((C=I(h).limits.features[1])==null?void 0:C.usage.current)>=((w=I(h).limits.features[1])==null?void 0:w.limits.limit)?I(h).setLimitExccedModal(!0):I(T).push("/create-workspace")})},[R(J,{variant:"primary"},{default:N(()=>n[3]||(n[3]=[X("Create a workspace")])),_:1,__:[3]})])])]),s("div",ot,[n[7]||(n[7]=s("h2",{class:"text-xl font-medium"},"All Workspaces",-1)),s("div",lt,[s("button",{class:O(["aspect-square w-8 cursor-pointer rounded-md p-1",f.value==="list"?"text-accent bg-accent-text":" hover:bg-border/50 backdrop-blur-2xl  transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),onClick:n[1]||(n[1]=C=>W("list")),title:"List view"},n[5]||(n[5]=[s("i",{class:"fa-solid fa-align-left"},null,-1)]),2),s("button",{class:O(["aspect-square w-8 cursor-pointer rounded-md p-1",f.value==="gallery"?"text-accent bg-accent-text":"hover:bg-border/50 backdrop-blur-2xl  transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),onClick:n[2]||(n[2]=C=>W("gallery")),title:"Gallery view"},n[6]||(n[6]=[s("i",{class:"fa-solid fa-grid-2"},null,-1)]),2)])]),!I(a)&&i.value?(m(),p("div",rt," No Workspace ")):f.value==="list"?(m(),H(Ye,{key:1})):f.value==="gallery"?(m(),H(qe,{key:2,projects:(u=I(x))==null?void 0:u.workspaces,loading:I(a)},null,8,["projects","loading"])):Z("",!0)])])}}});export{mt as default};
