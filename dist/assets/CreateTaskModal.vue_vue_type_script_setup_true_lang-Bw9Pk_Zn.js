import{d as Y,U as Z,L as ee,K as te,a1 as ae,$ as le,a0 as se,c as i,S as T,n as u,e as E,W as re,w as y,o as n,h as r,i as D,k as o,l as c,m as p,_ as ie,H as z,y as de,C as ne,D as oe,F as ue,z as U,X as I,t as C,a2 as ce,B as q,p as L}from"./index-DPxgKwPD.js";const pe={class:"px-6 grid grid-cols-2 gap-4"},me={key:0,class:"flex flex-col"},fe={key:1,class:"flex gap-1 flex-col"},be={key:0,class:"text-xs text-red-500"},ve={key:2,class:"flex gap-1 flex-col"},De={key:0,class:"text-xs text-red-500"},ge={class:"px-6 mt-2"},_e={class:"flex justify-end gap-2 p-6 mt-8 sticky bottom-0 bg-bg-body border-t border-border"},xe=Y({__name:"CreateTaskModal",props:{modelValue:{type:Boolean,default:!1},sheet_id:{},listId:{},selectedVariable:{},pin:{},size:{default:"lg"}},emits:["update:modelValue","created"],setup($,{emit:A}){const{canCreateCard:N}=Z(),O=A,d=$,P=ee(),{workspaceId:g,moduleId:K}=te(),{mutate:F,isPending:_}=ae({onSuccess:()=>{B(),P.invalidateQueries({queryKey:["sheet-list"]}),f.value=!1}}),{data:V}=le(g.value),{data:m}=se(g.value,K.value,d.sheet_id),f=i({get:()=>d.modelValue,set:e=>O("update:modelValue",e)}),h=i(()=>((m==null?void 0:m.value)??[]).filter(e=>{var a;return((a=e==null?void 0:e.type)==null?void 0:a.title)==="Select"})),M=e=>e.map(a=>({_id:a,title:a})),S=i(()=>((V==null?void 0:V.value)??[]).map(e=>{var a;return{_id:e._id,title:((a=e==null?void 0:e.variables)==null?void 0:a["lane-title"])??String(e._id)}})),w=e=>e.slug,t=T({title:"",description:"",startDate:null,endDate:null,lane_id:null,variables:{}});u(h,e=>{for(const a of e){const s=w(a);s in t.variables||(t.variables[s]=null)}},{immediate:!0});const l=T({title:!1,description:!1,startDate:!1,endDate:!1,lane:!1}),Q=i(()=>!!t.title.trim()&&(d.pin?!0:!!t.startDate&&!!t.endDate)&&!x.value&&!b.value&&!v.value&&!k.value);function R(e){t.startDate=e,l.startDate=!0}function W(e){t.endDate=e,l.endDate=!0}function j(e){t.lane_id=e,l.lane=!0}function H(){f.value=!1,B()}function B(){t.title="",t.description="",t.startDate=null,t.endDate=null,t.lane_id=null,t.variables={},l.title=!1,l.description=!1,l.startDate=!1,l.endDate=!1,l.lane=!1}const X=i(()=>m.value.find(e=>(e==null?void 0:e._id)==d.selectedVariable)),x=i(()=>l.title&&!t.title.trim()?"Title is required":""),b=i(()=>l.startDate?t.startDate?"":"Start date is required":""),v=i(()=>l.endDate?t.endDate?t.startDate&&t.endDate&&t.endDate<t.startDate?"End date cannot be before start date":"":"End date is required":""),k=i(()=>l.lane?t.lane_id?"":"Lane is required":"");function G(){var a;if(l.title=!0,l.description=!0,d.pin||(l.startDate=!0,l.endDate=!0),!Q.value||_.value||!N.value)return;const e={sheet_list_id:d.listId,workspace_id:g.value,sheet_id:d.sheet_id,workspace_lane_id:t.lane_id,variables:{...t.variables,[`${(a=X.value)==null?void 0:a.slug}`]:d.listId,"card-title":t.title.trim(),"card-description":t.description.trim(),"start-date":t.startDate,"end-date":t.endDate},createdAt:new Date().toISOString()};F(e)}return u(()=>t.title,e=>{e!=null&&e.trim()&&l.title&&(l.title=!1)}),u(()=>t.lane_id,e=>{e&&l.lane&&(l.lane=!1)}),u(()=>t.startDate,e=>{e&&l.startDate&&(l.startDate=!1)}),u(()=>t.endDate,e=>{e&&l.endDate&&(l.endDate=!1)}),u(()=>t.description,e=>{e!=null&&e.trim()&&l.description&&(l.description=!1)}),(e,a)=>(n(),E(re,{modelValue:f.value,"onUpdate:modelValue":a[4]||(a[4]=s=>f.value=s),modalClass:"!py-0",size:e.size},{default:y(()=>[a[8]||(a[8]=r("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[r("h2",{class:"text-xl font-semibold"},"Create Ticket"),r("p",{class:"text-sm text-text-secondary mt-1"},[D(" Provide the details below and click "),r("span",{class:"font-medium"},"Add Ticket"),D(". ")])],-1)),r("div",pe,[o(ie,{modelValue:t.title,"onUpdate:modelValue":a[0]||(a[0]=s=>t.title=s),label:"Ticket Title",placeholder:"e.g., Implement real-time notifications",error:!!x.value,message:x.value,onBlur:a[1]||(a[1]=s=>l.title=!0)},null,8,["modelValue","error","message"]),S.value.length>0?(n(),c("div",me,[o(z,{size:"md",label:"Lane",options:S.value,placeholder:"Select lane",allowCustom:!1,"model-value":t.lane_id,"onUpdate:modelValue":j,error:!!k.value,message:k.value},null,8,["options","model-value","error","message"])])):p("",!0),(n(!0),c(ue,null,de(h.value,s=>ne((n(),E(z,{size:"md",key:w(s),modelValue:t.variables[s.slug],"onUpdate:modelValue":J=>t.variables[s.slug]=J,options:M(s.data),label:s.title,placeholder:"Select value",allowCustom:!0},null,8,["modelValue","onUpdate:modelValue","options","label"])),[[oe,(s==null?void 0:s._id)!=e.selectedVariable]])),128)),e.pin?p("",!0):(n(),c("div",fe,[a[5]||(a[5]=r("label",{class:"text-sm"},"Start date",-1)),r("div",{class:U(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",b.value?"border-red-500":""])},[o(I,{placeholder:"Set start date",class:"w-full","model-value":t.startDate,"emit-as":"ymd","onUpdate:modelValue":R},null,8,["model-value"])],2),b.value?(n(),c("p",be,C(b.value),1)):p("",!0)])),e.pin?p("",!0):(n(),c("div",ve,[a[6]||(a[6]=r("label",{class:"text-sm"},"End date",-1)),r("div",{class:U(["border flex items-center border-border h-10 px-2 bg-bg-input rounded-lg",v.value?"border-red-500":""])},[o(I,{placeholder:"Set end date",class:"w-full","model-value":t.endDate,"emit-as":"ymd","onUpdate:modelValue":W},null,8,["model-value"])],2),v.value?(n(),c("p",De,C(v.value),1)):p("",!0)]))]),r("div",ge,[o(ce,{label:"Description",placeholder:"What needs to be done, acceptance criteria, links…",modelValue:t.description,"onUpdate:modelValue":a[2]||(a[2]=s=>t.description=s),onBlur:a[3]||(a[3]=s=>l.description=!0)},null,8,["modelValue"])]),r("div",_e,[o(q,{variant:"secondary",onClick:H},{default:y(()=>a[7]||(a[7]=[D("Cancel")])),_:1,__:[7]}),o(q,{variant:"primary",disabled:L(_),onClick:G},{default:y(()=>[D(C(L(_)?"Adding…":"Add Ticket"),1)]),_:1},8,["disabled"])])]),_:1,__:[8]},8,["modelValue","size"]))}});export{xe as _};
