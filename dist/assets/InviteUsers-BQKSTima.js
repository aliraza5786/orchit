import{d as P,c as l,a as $,ah as j,M as q,m as W,bd as M,b as O,o as Q,w as c,e as o,h as d,G as D,B as k,f as x,n as V,t as F,S as G,N as p}from"./index-LtrL70BY.js";import{_ as K}from"./BaseEmailChip.vue_vue_type_script_setup_true_lang-CAv4Ftzm.js";import{b as L}from"./auth-BKHNSFIv.js";const R={class:"px-6 flex flex-col gap-4"},T={class:"flex justify-end gap-2 p-6 mt-6 sticky bottom-0 bg-bg-body border-t border-border"},X=P({__name:"InviteUsers",props:{modelValue:{type:Boolean,default:!1},defaultWorkspaceId:{}},emits:["update:modelValue","invited"],setup(I,{emit:C}){const v=C,f=I,n=l({get:()=>f.modelValue,set:e=>v("update:modelValue",e)}),h=$(),{data:r}=j(1,100),s=q({workspace_id:null,role_id:"viewer",emails:[]});W(()=>f.defaultWorkspaceId,e=>{e&&!s.workspace_id?s.workspace_id=e:s.workspace_id=B.value[0]._id},{immediate:!0});const B=l(()=>{var e;return(((e=r==null?void 0:r.value)==null?void 0:e.workspaces)??[]).map(a=>{var t;return{_id:a._id??a.id,title:((t=a==null?void 0:a.variables)==null?void 0:t.title)??a.title??String(a._id??a.id)}})}),_=l(()=>s.role_id?"":"Role is required"),m=l(()=>{const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return s.emails.filter(a=>!e.test(a))}),b=l(()=>m.value.length?`Invalid: ${m.value.join(", ")}`:""),g=l(()=>!!s.workspace_id&&!!s.role_id&&s.emails.length>0&&m.value.length===0);function E(e){}function w(){}const{mutate:S,isPending:u}=L(),{data:U}=M();function A(){!g.value||u.value||S({payload:{company_id:U.value._id,role:s.role_id,emails:s.emails.map(e=>({email:e,name:z(e)}))}},{onSuccess:e=>{var a,t;(a=e==null?void 0:e.failedInvites)!=null&&a.length?p.error(((t=e.failedInvites[0])==null?void 0:t.error)??"Some invites failed"):p.success("Invitations sent"),h.invalidateQueries({queryKey:["all-users"]}),v("invited",e),y(),n.value=!1},onError:e=>{var t,i;const a=((i=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:i.message)||(e==null?void 0:e.message)||"Failed to send invitations.";p.error(a)}})}function N(){y(),n.value=!1}function y(){s.role_id=null,s.emails=[]}function z(e){const t=(e.split("@")[0]||"").split("+")[0].split(/[^a-zA-Z]+/).filter(Boolean);return t.length?t.map(i=>i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()).join(" "):e}return(e,a)=>(Q(),O(G,{modelValue:n.value,"onUpdate:modelValue":a[2]||(a[2]=t=>n.value=t),size:"md",modalClass:"!py-0"},{default:c(()=>[a[4]||(a[4]=o("div",{class:"sticky top-0 z-10 flex flex-col items-start pt-6 px-6 border-b border-border bg-bg-body pb-4 mb-4"},[o("h2",{class:"text-xl font-semibold"},"Invite Users"),o("p",{class:"text-sm text-text-secondary mt-1"}," Add emails, and pick a permission.")],-1)),o("div",R,[d(K,{class:"w-full",label:"User emails",modelValue:s.emails,"onUpdate:modelValue":a[0]||(a[0]=t=>s.emails=t),error:!!b.value,message:b.value||"Press Enter after each email",showName:"",onInvalid:E,onAdd:w},null,8,["modelValue","error","message"]),d(D,{size:"md",label:"Permission",options:[{title:"Viewer",_id:"viewer"},{title:"Editor",_id:"editor"},{title:"Admin",_id:"admin"}],placeholder:"Choose role","model-value":s.role_id,"onUpdate:modelValue":a[1]||(a[1]=t=>s.role_id=t),disabled:!s.workspace_id,message:_.value,error:!!_.value},null,8,["model-value","disabled","message","error"])]),o("div",T,[d(k,{variant:"secondary",onClick:N},{default:c(()=>a[3]||(a[3]=[x("Cancel")])),_:1,__:[3]}),d(k,{variant:"primary",disabled:!g.value||V(u),onClick:A},{default:c(()=>[x(F(V(u)?"Invitingâ€¦":"Send Invites"),1)]),_:1},8,["disabled"])])]),_:1,__:[4]},8,["modelValue"]))}});export{X as default};
