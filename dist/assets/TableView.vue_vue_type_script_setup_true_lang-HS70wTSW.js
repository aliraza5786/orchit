import{d as H,K as V,n as N,r as k,c as E,j as d,f as r,F as c,y as p,k as C,h as J,g as P,o as l,ah as _,t as S,D as Q,L as Y,P as Z,e as ee,b2 as se,al as ne,ac as re}from"./index-BCXm2D5k.js";const te={class:"px-4"},oe={class:"kanban-table space-y-4 h-[85vh] mt-4 overflow-y-auto overflow-x-auto"},le={class:"w-full table-fixed border-collapse rounded-[6px] shadow-sm bg-bg-body/20 text-sm border border-border/60"},de={class:"bg-bg-surface border-b border-border sticky top-[-1px] z-10"},ae={class:"text-text-secondary"},ue=["onMousedown"],ie={class:"w-10 p-2 text-center relative"},be={class:"relative inline-block"},ce={key:0,class:"column-menu absolute w-[200px] -right-1 bg-bg-dropdown border border-border rounded shadow z-50"},me=["checked","onChange"],ve={class:"bg-bg-surface/20"},pe=["colspan"],fe=["onClick"],ge=["colspan"],ye=["onMouseenter"],we=["colspan"],he=["onUpdate:modelValue","onBlur"],xe=["colspan"],Ce=H({__name:"TableView",props:{columns:{},rows:{},isPending:{type:Boolean},canCreate:{type:Boolean,default:!0},canCreateVariable:{type:Boolean,default:!0}},emits:["update:rows","create","toggleVisibility","addVar"],setup(T,{emit:A}){const b=T,m=A,a=V(b.rows||[]);N(()=>b.rows,s=>{s&&a.splice(0,a.length,...s)});const o=V({id:null,field:""}),v=k(null),$=k(null),z=E(()=>a.some(s=>o.id===s.id&&!s[o.field])),F=(s,e)=>{o.id=s.id,o.field=e,ne(()=>{var n;return(n=$.value)==null?void 0:n.focus()})},I=()=>{o.id=null,o.field=""},W=s=>{var e;if(!((e=s[o.field])!=null&&e.trim())){const n=a.findIndex(u=>u.id===s.id);n!==-1&&a.splice(n,1)}I(),m("update:rows",a.slice()),m("create",s)},M=s=>{var n;const e={id:Date.now()};b.columns.forEach(u=>e[u.key]=""),a.splice(s,0,e),F(e,((n=b.columns[0])==null?void 0:n.key)||""),v.value=null,m("update:rows",a.slice())};function X(s,e){if(!(!s||!e))return e.includes(".")?e.split(".").reduce((n,u)=>n==null?n:n[u],s):s[e]}function U(s,e){return e!=null&&e.accessor?e.accessor(s):X(s,e.key)}const j=s=>{var n;const e=U(s.row,s.column);return(n=s.column)!=null&&n.render?s.column.render({row:s==null?void 0:s.row,column:s==null?void 0:s.column,value:e,index:s==null?void 0:s.index}):re("span",String(e??""))},i=V({});N(()=>b.columns,s=>{s.forEach((e,n)=>{n==0?i[e.key]=250:i[e.key]||(i[e.key]=150)})},{immediate:!0});let h=null,B=0,L=0;const K=(s,e)=>{h=e,B=s.clientX,L=i[e],document.addEventListener("mousemove",R),document.addEventListener("mouseup",D)},R=s=>{if(!h)return;const e=s.clientX-B,n=Math.max(80,L+e);i[h]=n},D=()=>{h=null,document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",D)};document.addEventListener("click",s=>{s.target.closest(".column-menu")||(y.value=!1)});const f=k(b.columns.filter(s=>s.visible??!0).map(s=>s.key)),g=E(()=>b.columns.filter(s=>f.value.includes(s.key))),y=k(!1);document.addEventListener("click",s=>{s.target.closest(".column-menu")||(y.value=!1)});const O=s=>{const e=f.value.indexOf(s);e===-1?(m("toggleVisibility",s,!0),f.value.push(s)):(m("toggleVisibility",s,!1),f.value.splice(e,1))},q=E(()=>1+g.value.length+1);return(s,e)=>(l(),d("div",te,[r("div",oe,[r("table",le,[r("thead",de,[r("tr",ae,[e[8]||(e[8]=r("th",{class:"w-2 p-0"},null,-1)),(l(!0),d(c,null,p(g.value,n=>(l(),d("th",{key:n==null?void 0:n.key,class:"relative font-bold p-2 uppercase text-left text-[11px] tracking-wide border-r border-border/40 select-none whitespace-nowrap min-w-[200px]",style:_({width:i[n.key]?i[n.key]+"px":"100%"})},[r("span",null,S(n==null?void 0:n.label),1),r("div",{class:"absolute right-0 top-0 h-full w-2 cursor-col-resize z-30 hover:bg-accent/20 active:bg-accent/40 transition",onMousedown:u=>K(u,n.key)},null,40,ue)],4))),128)),r("th",ie,[r("div",be,[r("button",{onClick:e[0]||(e[0]=J(n=>y.value=!y.value,["stop"])),class:"p-1 rounded hover:bg-bg-surface/50 cursor-pointer"},e[6]||(e[6]=[r("i",{class:"fa-regular fa-columns-3"},null,-1)])),y.value?(l(),d("div",ce,[(l(!0),d(c,null,p(b.columns,n=>(l(),d("div",{key:"toggle-"+n.key,class:"flex items-center space-x-2 px-3 py-1.5 capitalize font-medium cursor-pointer hover:bg-bg-dropdown-menu-hover text-[12px] text-text-primary gap-2"},[r("input",{type:"checkbox",checked:f.value.includes(n.key),onChange:u=>O(n.key),class:"h-4 w-4 mt-0.5 rounded border-border accent-accent cursor-pointer flex-shrink-0"},null,40,me),r("span",null,S(n.label),1)]))),128)),s.canCreateVariable?(l(),d("div",{key:0,onClick:e[1]||(e[1]=n=>m("addVar")),class:"sticky bottom-0 bg-bg-dropdown shadow-md mt-2 shadow-border capitalize border-t border-border px-4 py-2 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-1 overflow-hidden overflow-ellipsis text-nowrap"},e[7]||(e[7]=[r("i",{class:"fa-solid fa-plus"},null,-1),P(" Add new ")]))):C("",!0)])):C("",!0)])])])]),r("tbody",ve,[s.isPending?(l(),d(c,{key:0},p(5,n=>r("tr",{key:"sk-"+n,class:"border-b border-border animate-pulse"},[e[10]||(e[10]=r("td",null,[r("div",{class:"w-4 h-4 bg-bg-surface rounded"})],-1)),(l(!0),d(c,null,p(s.columns,(u,x)=>(l(),d("td",{key:u.key,class:"border-r border-border h-8",style:_({width:i[u.key]+"px"}),colspan:x===g.value.length-1?2:1},e[9]||(e[9]=[r("div",{class:"w-full h-4 bg-bg-surface rounded"},null,-1)]),12,pe))),128))])),64)):(l(!0),d(c,{key:1},p(a,(n,u)=>{var x;return l(),d(c,{key:n==null?void 0:n.id},[v.value===u&&!z.value?(l(),d("tr",{key:0,class:"relative bg-bg-surface/20 transition-all cursor-pointer border border-accent",onMouseleave:e[2]||(e[2]=t=>v.value=null)},[r("td",{class:"!p-0 w-8",onClick:t=>M(u)},e[11]||(e[11]=[r("span",{class:"absolute left-[-6px] top-[-14px] bg-bg-surface border border-border w-6 h-6 text-sm rounded-md flex justify-center items-center shadow-sm hover:bg-bg-surface/70"},"+",-1)]),8,fe),r("td",{class:"!p-0",colspan:(x=s.columns)==null?void 0:x.length},null,8,ge)],32)):C("",!0),r("tr",{onMouseenter:t=>v.value=u,class:"border-b border-border hover:bg-bg-surface/40 transition-colors"},[e[12]||(e[12]=r("td",null,null,-1)),(l(!0),d(c,null,p(g.value,(t,G)=>(l(),d("td",{key:t==null?void 0:t.key,class:"border-r border-border overflow-visible relative h-8",style:_({width:i[t.key]+"px"}),colspan:G===g.value.length-1?2:1},[(o==null?void 0:o.id)===(n==null?void 0:n.id)&&(o==null?void 0:o.field)===(t==null?void 0:t.key)?Q((l(),d("input",{key:0,"onUpdate:modelValue":w=>n[t==null?void 0:t.key]=w,onBlur:w=>W(n),class:"min-w-[200px] w-full p-1 border border-accent/60 rounded-sm focus:outline-none focus:ring-1 focus:ring-accent bg-bg-body text-[12px] h-8",ref_for:!0,ref:w=>w&&(o==null?void 0:o.id)===(n==null?void 0:n.id)&&(o==null?void 0:o.field)===(t==null?void 0:t.key)&&($.value=w)},null,40,he)),[[Z,n[t==null?void 0:t.key]]]):Y(s.$slots,t.key,{key:2,row:n,column:t,index:`r-${n._id}`},()=>[(l(),ee(se(j),{row:n,column:t,index:n._id},null,8,["row","column","index"]))])],12,we))),128))],40,ye)],64)}),128)),!z.value&&s.canCreate?(l(),d("tr",{key:2,onClick:e[3]||(e[3]=n=>M(a==null?void 0:a.length)),class:"sticky bottom-0 bg-bg-surface border-t border-border cursor-pointer transition hover:bg-bg-body",onMouseenter:e[4]||(e[4]=n=>v.value=a==null?void 0:a.length),onMouseleave:e[5]||(e[5]=n=>v.value=null)},[r("td",{colspan:q.value,class:"text-text-secondary h-8 px-3"},e[13]||(e[13]=[r("span",{class:"inline-flex w-5 h-5 border border-border-input rounded-full justify-center items-center text-secondary hover:bg-bg-surface/50 transition pb-0.5"},"+",-1),P(" Add New Row ")]),8,xe)],32)):C("",!0)])])])]))}});export{Ce as _};
