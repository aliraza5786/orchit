import{d as Qe,Y as We,bh as Ge,r as v,m as k,q as le,S as Xe,M as ne,c as f,be as Ye,bi as Je,bj as Ze,bk as et,bl as tt,bm as st,a as at,a7 as ot,ad as it,b as lt,w as g,A as O,C as nt,e as s,h as m,a5 as P,i as l,a6 as de,g as re,U as W,t as r,bf as dt,av as rt,j as C,G as ce,bn as ct,F as D,X as ue,y as ut,n as B,x as L,B as G,f as F,ab as ve,o as i,H as vt}from"./index-Dp_Ec3Oc.js";const mt={class:"flex flex-col max-w-[380px] min-w-[380px] h-full overflow-y-auto bg-gradient-to-b from-bg-card/95 to-bg-card/90 backdrop-blur rounded-2xl shadow-[0_10px_40px_-10px_rgba(0,0,0,.5)] border border-orchit-white/5 overflow-hidden",role:"complementary","aria-label":"Details panel"},pt={class:"sticky top-0 z-10 bg-transparent border-b border-orchit-white/5 px-6 py-4 flex items-center justify-between"},ht={class:"py-5 px-6 flex flex-col gap-5 flex-grow"},xt={class:"capitalize"},ft=["onKeydown"],gt=["innerHTML"],_t={key:1,class:"opacity-60"},bt={key:"tab-details",class:"space-y-6"},yt={class:"grid grid-cols-2 gap-4 text-sm"},wt={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-4"},kt={class:"mt-1 font-medium"},Ct={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-4"},Dt={class:"mt-1 font-medium"},St={class:"rounded-2xl border border-orchit-white/10 bg-orchit-white/5 p-4 grid grid-cols-1 sm:grid-cols-2 gap-4"},Vt={class:"space-y-2"},Et={class:"space-y-2"},Ut={class:"space-y-2"},It={class:"h-8 px-3 flex items-center gap-2 rounded-lg bg-bg-input border border-orchit-white/10"},Tt={class:"space-y-2"},Pt={key:0,class:"text-xs text-red-400 mt-1"},Bt={key:0,class:"space-y-2 sm:col-span-1"},Lt={class:"text-xs uppercase tracking-wider text-text-secondary"},Mt={key:1},jt={class:"relative border-l border-orchit-white/10 pl-5 space-y-4 ml-1"},zt={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-3 hover:bg-orchit-white/7 transition"},At={class:"font-semibold"},Ot={class:"font-semibold"},Ft={key:"tab-comments",class:"space-y-4"},$t={class:"flex items-center gap-3 mb-2"},qt={class:"h-8 w-8 rounded-full bg-accent/15 text-accent flex items-center justify-center text-xs font-semibold"},Ht={class:"flex-1"},Kt={class:"text-sm font-medium"},Nt={class:"text-xs text-text-secondary"},Rt={key:0,class:"flex items-center gap-2"},Qt=["onClick"],Wt=["onClick"],Gt={class:"flex items-center gap-2 justify-end"},Xt={key:0,class:"mt-3 grid grid-cols-2 gap-2"},Yt=["href"],Jt={class:"text-xs truncate"},Zt={class:"rounded-xl border border-orchit-white/10 bg-orchit-white/5 overflow-hidden"},es={class:"flex items-center justify-between p-2 border-t border-orchit-white/10"},ts={key:"tab-attachments",class:"space-y-3"},ss={class:"text-xs text-text-secondary"},as={class:"grid sm:grid-cols-2 gap-4"},os={class:"p-3"},is={key:0,class:"rounded-lg overflow-hidden"},ls=["src"],ns={key:1,class:"rounded-lg overflow-hidden"},ds=["src"],rs={key:2,class:"h-40 rounded-lg bg-black/5 grid place-items-center"},cs={class:"mt-3"},us={class:"font-medium truncate"},vs={class:"text-xs text-text-secondary capitalize"},ms={class:"p-3 pt-0"},ps=["href"],hs=Qe({__name:"SidePanel",props:{pin:{type:Boolean,default:!1},showPanel:{type:Boolean,default:!0},details:{type:Object,default:()=>({})}},emits:["close","update:details","comment:post","priority:change"],setup(_,{emit:me}){var ae,oe;const{workspaceId:pe}=We(),n=_,he=me,{data:x}=Ge(n.details._id),U=v("details"),xe=[{label:"Details",value:"details"},{label:"Comments",value:"comments"},{label:"History",value:"history"},{label:"Attachment",value:"attachment"}],M=v(!1),b=v(n.details["card-title"]??"");k(()=>n.details["card-title"],t=>{b.value=t});const $=v(null);function fe(){M.value=!0,ve(()=>{var t,e;(t=$.value)==null||t.focus(),(e=$.value)==null||e.select()})}function X(){b.value.trim()||(b.value=n.details["card-title"]??""),y.mutate({card_id:n.details._id,variables:{"card-title":b.value.trim()}}),M.value=!1}const S=v(n.details["card-description"]);k(()=>n.details,()=>{S.value=n.details["card-description"]});const j=v(!1),q=v(null);function ge(t){var u,a;const e=(u=t==null?void 0:t.querySelector)==null?void 0:u.call(t,".ProseMirror");if(!e)return;e.focus();const o=(a=window.getSelection)==null?void 0:a.call(window),d=document.createRange();d.selectNodeContents(e),d.collapse(!1),o==null||o.removeAllRanges(),o==null||o.addRange(d)}async function _e(){j.value=!0,await ve(),ge(q.value||void 0)}function Y(t){y.mutate({card_id:n.details._id,attachments:t??[],variables:{"card-description":S.value}}),j.value=!1}function J(t){var o;if(!j.value)return;const e=t.target;(o=q.value)!=null&&o.contains(e)||Y()}le(()=>document.addEventListener("mousedown",J)),Xe(()=>document.removeEventListener("mousedown",J));const Z=ne({posted_on:((ae=n.details)==null?void 0:ae.posted_on)??((oe=n.details)==null?void 0:oe.created_at)??new Date().toISOString()}),be=f({get:()=>new Date(Z.posted_on).toISOString().slice(0,10),set:t=>{Z.posted_on=new Date(t+"T00:00:00").toISOString()}}),{data:H}=Ye(pe.value),K=v(n.details.workspace_lane_id??"");k(()=>n.details.workspace_lane_id,t=>{K.value=t});const ye=f(()=>((H==null?void 0:H.value)??[]).map(t=>{var e;return{_id:t._id,title:((e=t==null?void 0:t.variables)==null?void 0:e["lane-title"])??String(t._id)}}));function we(t){K.value=t,y.mutate({card_id:n.details._id,workspace_lane_id:t})}const p=v({startDate:n.details["start-date"],endDate:n.details["end-date"]}),ke=f(()=>n.details["start-date"]),Ce=f(()=>n.details["end-date"]);k(ke,t=>{p.value={...p.value,startDate:t}}),k(Ce,t=>{p.value={...p.value,endDate:t}});const N=f(()=>p!=null&&p.value.startDate&&p.value.endDate&&p.value.endDate<p.value.startDate?"End date cannot be before start date":""),De=t=>y.mutate({card_id:n.details._id,variables:{"start-date":t}}),Se=t=>y.mutate({card_id:n.details._id,variables:{"end-date":t}}),Ve=f(()=>n.details.assigned_to),Ee=t=>{var e;y.mutate({card_id:n.details._id,assigned_to:(e=t==null?void 0:t.user_info)==null?void 0:e._id})},c=v([]),Ue=f(()=>{var t;return(t=n.details)==null?void 0:t._id}),{data:ee}=Je(Ue);k(()=>ee.value,()=>{var t;c.value=(t=ee.value)==null?void 0:t.comments});const{mutate:Ie,isPending:Te}=Ze({onSuccess:t=>{I.value="",T.value=[],c.value=[...c.value,t]}}),I=v(""),Pe=t=>(t??"").split(" ").map(e=>e[0]).filter(Boolean).slice(0,2).join("").toUpperCase(),Be=t=>t?new Date(t).toLocaleString():"",{data:Le}=et(),Me=t=>{var e;return((e=t==null?void 0:t.created_by)==null?void 0:e._id)===Le.value},z=v(null),V=v(""),{mutate:je,isPending:te}=tt(),{mutate:ze}=st();function Ae(t){z.value=t._id,V.value=t.comment_text??""}function R(){z.value=null,V.value="",M.value=!1}function Oe(t){const e=V.value.trim();if(!e)return;const o=c.value.findIndex(u=>u._id===t._id),d=o>-1?{...c.value[o]}:null;o>-1&&(c.value[o]={...c.value[o],comment_text:e}),je({id:t._id,payload:{comment_text:e}},{onError:()=>{o>-1&&d&&(c.value[o]=d)},onSuccess:u=>{o>-1&&(c.value[o]=u??c.value[o]),R()}})}function Fe(t){const e=c.value.findIndex(d=>d._id===t._id),o=e>-1?c.value[e]:null;e>-1&&c.value.splice(e,1),ze({id:t._id},{onError:()=>{o&&c.value.splice(e,0,o)}})}const $e=f(()=>{var t;return(((t=n.details)==null?void 0:t.attachments)??[]).map(e=>{var o;return{_id:e._id??e.id??((o=crypto.randomUUID)==null?void 0:o.call(crypto))??Math.random(),name:e.name??e.filename??"file",url:e.url,kind:(e.type??e.kind??"").toLowerCase().includes("image")?"image":(e.type??e.kind??"").toLowerCase().includes("video")?"video":"file"}})}),Q=at(),y=ot({onSuccess:()=>{Q.invalidateQueries({queryKey:["get-sheets"]}),Q.invalidateQueries({queryKey:["sheet-list"]}),Q.invalidateQueries({queryKey:["roles"]})}}),T=v([]),{mutate:qe}=it({onSuccess:t=>{T.value=[t]}});function He(t){const e=t.target.files;Array.from(e).forEach(o=>{const d=new FormData;d.append("file",o),qe(d)})}function Ke(){const t=I.value.trim();!t&&!T.value.length||Ie({id:n.details._id,payload:{comment_text:t,attachments:T.value.map(e=>({name:e.data.name,url:e.data.url}))}})}const A=ne({}),se=()=>{var t;(t=x==null?void 0:x.value)!=null&&t.variables&&(x.value.variables??[]).forEach(o=>{var u,a;if(!o||o.type!=="Select")return;const d=Array.isArray(o.data)&&o.data.length?((u=o.data[0])==null?void 0:u.value)??((a=o.data[0])==null?void 0:a._id)??o.data[0]:void 0;A[o.slug]=o.value??A[o.slug]??d??null})};le(se),k(()=>x.value,se,{deep:!0});function Ne(t,e){var d,u;A[e]=t,((u=(((d=x.value)==null?void 0:d.variables)??[]).find(a=>a.slug===e))==null?void 0:u.value)!==t&&y.mutate({card_id:n.details._id,variables:{[e]:t}})}return(t,e)=>(i(),lt(P,{name:"panel",appear:""},{default:g(()=>[O(s("div",mt,[s("div",pt,[e[7]||(e[7]=s("h5",{class:"text-[18px] font-semibold tracking-tight"},"Details",-1)),s("button",{class:"p-2 rounded-xl hover:bg-orchit-white/5 active:scale-[.98] cursor-pointer transition",onClick:e[0]||(e[0]=()=>he("close")),"aria-label":"Close details"},e[6]||(e[6]=[s("i",{class:"fa-solid fa-xmark text-xl"},null,-1)]))]),s("div",ht,[s("div",xt,[m(P,{name:"fade-scale",mode:"out-in"},{default:g(()=>[M.value?O((i(),l("input",{key:"title-edit",ref_key:"titleInput",ref:$,"onUpdate:modelValue":e[1]||(e[1]=o=>b.value=o),onBlur:X,onKeydown:[de(re(X,["prevent"]),["enter"]),de(re(R,["prevent"]),["esc"])],class:"w-full text-2xl font-semibold rounded-xl px-3 py-2 bg-orchit-white/5 border border-orchit-white/10 focus:outline-none focus:ring-2 focus:ring-accent/40 transition",type:"text","aria-label":"Edit title"},null,40,ft)),[[W,b.value]]):(i(),l("h1",{key:"title-view",class:"text-2xl font-semibold tracking-tight cursor-text rounded-lg px-2 py-1 hover:bg-orchit-white/5 transition",onClick:fe,"aria-label":"Card title"},r(b.value||"Untitled"),1))]),_:1})]),s("div",null,[e[8]||(e[8]=s("h3",{class:"mb-2 text-base font-semibold tracking-wide px-1"},"Description",-1)),m(P,{name:"fade-scale",mode:"out-in"},{default:g(()=>[j.value?(i(),l("div",{key:"desc-edit",ref_key:"descEditorWrap",ref:q,class:"rounded-xl overflow-hidden border border-orchit-white/10 shadow-sm"},[m(dt,{modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=o=>S.value=o),onFocusOut:Y},null,8,["modelValue"])],512)):(i(),l("div",{key:"desc-view",class:"text-[15px] leading-6 text-text-secondary whitespace-pre-wrap cursor-text rounded-xl px-4 py-3 border border-orchit-white/10 bg-orchit-white/5 hover:border-orchit-white/20 transition",onClick:_e},[S.value?(i(),l("div",{key:0,innerHTML:S.value},null,8,gt)):(i(),l("span",_t,"Click to add a description…"))]))]),_:1})]),m(rt,{modelValue:U.value,"onUpdate:modelValue":e[3]||(e[3]=o=>U.value=o),options:xe,size:"md"},null,8,["modelValue"]),m(P,{name:"section",mode:"out-in"},{default:g(()=>{var o,d,u;return[U.value==="details"?(i(),l("section",bt,[s("div",yt,[s("div",wt,[e[9]||(e[9]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"Posted On",-1)),s("div",kt,r(be.value),1)]),s("div",Ct,[e[10]||(e[10]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"ID",-1)),s("div",Dt,r(_.details["card-code"]),1)])]),s("div",St,[s("div",Vt,[e[11]||(e[11]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"Lane",-1)),m(ce,{size:"sm",options:ye.value,placeholder:"Select lane",allowCustom:!1,"model-value":K.value,"onUpdate:modelValue":we},null,8,["options","model-value"])]),s("div",Et,[e[12]||(e[12]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"Assign",-1)),m(ct,{onAssign:Ee,assigneeId:Ve.value,seat:_.details.seat},null,8,["assigneeId","seat"])]),_.pin?C("",!0):(i(),l(D,{key:0},[s("div",Ut,[e[14]||(e[14]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"Start Date",-1)),s("div",It,[e[13]||(e[13]=s("i",{class:"fa-regular fa-calendar"},null,-1)),m(ue,{placeholder:"Set start date",class:"w-full","model-value":p.value.startDate,"emit-as":"ymd","onUpdate:modelValue":De},null,8,["model-value"])])]),s("div",Tt,[e[16]||(e[16]=s("div",{class:"text-xs uppercase tracking-wider text-text-secondary"},"Target End",-1)),s("div",{class:ut(["h-8 px-3 flex items-center gap-2 rounded-lg bg-bg-input border transition-colors",N.value?"border-red-500":"border-orchit-white/10"])},[e[15]||(e[15]=s("i",{class:"fa-regular fa-calendar"},null,-1)),m(ue,{placeholder:"Set end date",class:"w-full","model-value":p.value.endDate,"emit-as":"ymd","onUpdate:modelValue":Se},null,8,["model-value"])],2),N.value?(i(),l("p",Pt,r(N.value),1)):C("",!0)])],64)),(o=B(x))!=null&&o.variables?(i(!0),l(D,{key:1},L((d=B(x))==null?void 0:d.variables,(a,E)=>(i(),l(D,{key:a.slug||`var-${E}`},[(a==null?void 0:a.type)==="Select"?(i(),l("div",Bt,[s("div",Lt,r(a.title),1),m(ce,{size:"sm",options:a==null?void 0:a.data.map(w=>({_id:w,title:w})),placeholder:"Select option",allowCustom:!1,"model-value":A[a.slug],"onUpdate:modelValue":w=>Ne(w,a.slug)},null,8,["options","model-value","onUpdate:modelValue"])])):C("",!0)],64))),128)):C("",!0)])])):U.value==="history"?(i(),l("section",Mt,[s("div",null,[e[19]||(e[19]=s("h3",{class:"text-sm font-semibold tracking-wide mb-3"},"History",-1)),s("ol",jt,[(i(!0),l(D,null,L(_.details.history,(a,E)=>(i(),l("li",{key:E,class:"group"},[e[18]||(e[18]=s("span",{class:"absolute -left-[5px] top-0 w-2 h-2 rounded-full bg-accent/70 ring-4 ring-accent/10"},null,-1)),s("div",zt,[s("span",At,r(a.user.u_full_name),1),e[17]||(e[17]=s("span",{class:"text-text-secondary"}," changed ",-1)),s("span",Ot,r(a.field_name),1)])]))),128))])])])):U.value==="comments"?(i(),l("section",Ft,[(i(!0),l(D,null,L(c.value??[],a=>{var E,w,ie;return i(),l("div",{key:a._id,class:"rounded-xl border border-orchit-white/10 bg-orchit-white/5 p-4 hover:bg-orchit-white/7 transition"},[s("div",$t,[s("div",qt,r(Pe((E=a.created_by)==null?void 0:E.u_full_name)),1),s("div",Ht,[s("div",Kt,r((w=a.created_by)==null?void 0:w.u_full_name),1),s("div",Nt,r(Be(a.created_at)),1)]),Me(a)?(i(),l("div",Rt,[z.value!==a._id?(i(),l("button",{key:0,class:"text-xs text-accent hover:underline",onClick:h=>Ae(a)},"Edit",8,Qt)):C("",!0),s("button",{class:"text-xs text-red-400 hover:underline",onClick:h=>Fe(a)},"Delete",8,Wt)])):C("",!0)]),m(P,{name:"fade",mode:"out-in"},{default:g(()=>[z.value!==a._id?(i(),l("p",{key:`c-view-${a._id}`,class:"text-[15px] leading-6"},r(a.comment_text),1)):(i(),l("div",{key:`c-edit-${a._id}`,class:"space-y-2"},[O(s("textarea",{"onUpdate:modelValue":e[4]||(e[4]=h=>V.value=h),rows:"3",class:"w-full p-3 rounded-lg bg-bg-input/80 border border-orchit-white/10 focus:ring-2 focus:ring-accent/40 outline-none"},null,512),[[W,V.value]]),s("div",Gt,[m(G,{variant:"secondary",size:"sm",onClick:R},{default:g(()=>e[20]||(e[20]=[F("Cancel")])),_:1,__:[20]}),m(G,{class:"btn",size:"sm",onClick:h=>Oe(a),disabled:!V.value.trim()||B(te)},{default:g(()=>[F(r(B(te)?"Saving…":"Save"),1)]),_:2},1032,["onClick","disabled"])])]))]),_:2},1024),(ie=a==null?void 0:a.attachments)!=null&&ie.length?(i(),l("div",Xt,[(i(!0),l(D,null,L(a.attachments,(h,Re)=>(i(),l("a",{key:Re,href:h.url,target:"_blank",class:"group flex items-center gap-2 rounded-lg border border-orchit-white/10 bg-orchit-white/5 px-2 py-1 hover:bg-orchit-white/10 transition"},[e[21]||(e[21]=s("i",{class:"fa-regular fa-file text-text-secondary group-hover:text-text-primary transition"},null,-1)),s("span",Jt,r(h==null?void 0:h.name),1)],8,Yt))),128))])):C("",!0)])}),128)),s("div",Zt,[O(s("textarea",{"onUpdate:modelValue":e[5]||(e[5]=a=>I.value=a),rows:"3",class:"w-full p-3 bg-transparent outline-none text-sm",placeholder:"Write a comment"},null,512),[[W,I.value]]),s("div",es,[s("input",{type:"file",multiple:"",onChange:He,class:"text-xs text-text-secondary file:mr-3 file:px-3 file:py-1.5 file:rounded-md file:border file:border-orchit-white/10 file:bg-orchit-white/10 hover:file:bg-orchit-white/15 file:text-text-primary transition"},null,32),m(G,{variant:"primary",size:"sm",onClick:Ke,disabled:!I.value.trim()&&!T.value.length},{default:g(()=>[F(r(B(Te)?"Posting…":"Post"),1)]),_:1},8,["disabled"])])])])):(i(),l("section",ts,[s("div",ss," Files attached to this "+r(((u=_.details)==null?void 0:u.type)??"item")+". ",1),s("div",as,[(i(!0),l(D,null,L($e.value,a=>(i(),l("div",{key:a._id,class:"rounded-2xl overflow-hidden border border-orchit-white/10 bg-orchit-white/5 hover:bg-orchit-white/8 transition group"},[s("div",os,[a.kind==="image"?(i(),l("div",is,[s("img",{src:a.url,class:"w-full h-40 object-cover group-hover:scale-[1.02] transition"},null,8,ls)])):a.kind==="video"?(i(),l("div",ns,[s("video",{src:a.url,controls:"",class:"w-full h-40 object-cover"},null,8,ds)])):(i(),l("div",rs,e[22]||(e[22]=[s("i",{class:"fa-regular fa-file text-3xl text-text-secondary"},null,-1)]))),s("div",cs,[s("div",us,r(a.name),1),s("div",vs,r(a.kind),1)])]),s("div",ms,[s("a",{href:a.url,target:"_blank",rel:"noopener",class:"w-full inline-flex items-center justify-center gap-2 h-9 rounded-lg bg-accent text-orchit-white text-sm hover:opacity-90 transition"},e[23]||(e[23]=[s("i",{class:"fa-regular fa-arrow-up-right-from-square"},null,-1),F(" View ")]),8,ps)])]))),128))])]))]}),_:1})])],512),[[nt,_.showPanel]])]),_:1}))}}),fs=vt(hs,[["__scopeId","data-v-24d1369f"]]);export{fs as default};
