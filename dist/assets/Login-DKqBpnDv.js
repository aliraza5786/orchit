import{d as D,u as O,a as T,r as y,c as u,b as I,e as W,w as n,o as P,f as l,s as d,g as a,h as q,i,j as G,k as H,_ as B,t as E,B as V,l as j,m as J,n as K,p as Q}from"./index-C37bc_Pk.js";import{_ as X}from"./Header-CUUqVTQh.js";import{_ as Y}from"./AuthLayout.vue_vue_type_script_setup_true_lang-BIh2C3Td.js";import{l as Z,s as ee}from"./auth-N4bU6DSF.js";import"./dark-logo-Mcb_sJlF.js";import"./favicon-BAFXWHLW.js";const te={class:"max-w-[500px] md:mx-auto w-full text-text-primary bg-bg-body"},se={key:0,class:"text-red-500 text-sm text-center mt-2"},oe={class:"text-center mt-4"},de=D({name:"LoginPage",__name:"Login",setup(ae){const b=O(),h=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,L=T(),p=y(""),g=y(""),r=y(""),m={email:!1,password:!1},x=u(()=>m.email?p.value.trim()?h.test(p.value)?"":"Invalid email":"Email is required":""),N=u(()=>!!x.value),w=u(()=>m.password?g.value?g.value.length<6?"Password must be at least 6 characters":"":"Password is required":""),A=u(()=>!!w.value),C=u(()=>!x.value&&!w.value),f=Q(),{mutateAsync:F,isPending:_}=I({mutationFn:Z}),{mutateAsync:$}=I({mutationFn:ee}),z=u(()=>_.value),M=u(()=>_.value?"Signing In...":"Sign in");function k(){r.value&&(r.value="")}async function R(){var s,e;try{const t=await J(),o=await K.get("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${t.access_token}`}}),v=await $({u_email:o.data.email,u_social_id:o.data.sub,u_social_type:"google",u_full_name:o.data.name});S(v)}catch(t){(t==null?void 0:t.message)!=="Popup closed"&&(r.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"Google Login failed. Please try again.")}}async function S(s){var t,o,v;localStorage.setItem("token",(t=s==null?void 0:s.data)==null?void 0:t.token),await L.bootstrap();const e=localStorage.getItem("post_auth_intent");if(e)try{const c=JSON.parse(e);localStorage.removeItem("post_auth_intent"),c.aiResponse&&b.setWorkspace(c.aiResponse),f.push(c.path||"/dashboard");return}catch(c){console.error("Failed to parse post_auth_intent",c),localStorage.removeItem("post_auth_intent")}if(console.log((o=s==null?void 0:s.data)==null?void 0:o.isNewUser,"new user"),(v=s==null?void 0:s.data)!=null&&v.isNewUser){f.push("/create-profile");return}b.pricing?f.push("/dashboard?stripePayment=true"):f.push("/dashboard")}async function U(){var s,e;if(r.value="",m.email=!0,m.password=!0,!C.value){r.value="Please fill all fields correctly.";return}try{const t=await F({u_email:p.value,u_password:g.value});S(t)}catch(t){r.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"Login failed. Please try again."}}return(s,e)=>{const t=j("router-link");return P(),W(Y,null,{form:n(()=>[l("div",te,[e[0]||(d(-1,!0),(e[0]=l("h2",{class:"text-[32px] font-medium mb-12 text-center text-text-primary"},[e[7]||(e[7]=a(" Sign in to Orchit AI "))])).cacheIndex=0,d(1),e[0]),l("form",{onSubmit:q(U,["prevent"]),class:"space-y-4 w-full"},[i(B,{modelValue:p.value,"onUpdate:modelValue":[e[1]||(e[1]=o=>p.value=o),k],label:"Email",placeholder:"Email address",size:"lg",error:N.value,message:x.value,onBlur:e[2]||(e[2]=o=>m.email=!0)},null,8,["modelValue","error","message"]),i(B,{modelValue:g.value,"onUpdate:modelValue":[e[3]||(e[3]=o=>g.value=o),k],label:"Password",placeholder:"Enter your password",size:"lg",type:"password",error:A.value,message:w.value,onBlur:e[4]||(e[4]=o=>m.password=!0)},null,8,["modelValue","error","message"]),i(V,{disabled:z.value,size:"lg",block:!0,type:"submit"},{default:n(()=>[a(E(M.value),1)]),_:1},8,["disabled"]),e[11]||(e[11]=l("span",{class:"block text-center text-[12px]"},"OR",-1)),i(V,{size:"lg",block:!0,appearance:"outlined",variant:"ghost",type:"button",onClick:R},{icon:n(()=>e[8]||(e[8]=[l("img",{src:X,class:"w-5 h-5 mr-4"},null,-1)])),default:n(()=>[e[9]||(e[9]=a(" Continue with google "))]),_:1,__:[9]}),r.value?(P(),G("p",se,E(r.value),1)):H("",!0),l("div",oe,[i(t,{to:"/forgot-password",class:"text-sm text-accent hover:underline"},{default:n(()=>e[10]||(e[10]=[a(" Forgot password? ")])),_:1,__:[10]})])],32),e[5]||(d(-1,!0),(e[5]=l("p",{class:"text-sm font-medium text-text-secondary text-center mt-6"},[e[14]||(e[14]=a(" By signing in, you agree to the ")),i(t,{to:"/privacy-policy",class:"text-text-primary font-bold hover:underline"},{default:n(()=>e[12]||(e[12]=[a(" Privacy Policy ")])),_:1,__:[12]}),e[15]||(e[15]=a(" and ")),i(t,{to:"/terms-of-services",class:"text-text-primary font-bold hover:underline"},{default:n(()=>e[13]||(e[13]=[a(" Terms of Service ")])),_:1,__:[13]})])).cacheIndex=5,d(1),e[5]),e[6]||(d(-1,!0),(e[6]=l("p",{class:"text-sm font-medium text-text-secondary text-center mt-8"},[e[17]||(e[17]=a(" Donâ€™t have an account? ")),i(t,{to:"/register",class:"text-text-primary font-bold underline"},{default:n(()=>e[16]||(e[16]=[a("Sign up")])),_:1,__:[16]})])).cacheIndex=6,d(1),e[6])])]),_:1})}}});export{de as default};
