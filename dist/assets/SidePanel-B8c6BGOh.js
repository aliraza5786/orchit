const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Bau3eFG3.js","assets/index-BMLa60ps.css","assets/BaseSelectField-C6lXk60C.js","assets/AssigmentDropdown-CRxnC0yB.js"])))=>i.map(i=>d[i]);
import{d as ft,r as b,W as ht,Q as bt,S as gt,by as xt,x as S,C as Ce,aw as yt,O as De,c as P,a1 as wt,bz as kt,bA as Ct,bB as Dt,bC as St,bD as Et,ab as It,aO as Vt,f as Tt,ap as W,w as E,o as r,y as G,J as Qt,g as a,m as d,i as n,F as q,h as x,G as D,E as O,n as I,t as v,ae as K,ai as Se,l as Ee,T as ue,k as J,al as Ie,V as Ve,H as M,N as At}from"./index-Bau3eFG3.js";import{u as Ut}from"./sidePanelStore-BqzaOVcm.js";const Lt={key:0,class:"flex flex-col gap-5 p-6 animate-pulse"},Pt={key:1},qt={class:"sticky top-0 z-10 border-b border-border px-4 sm:px-6 py-[9px] flex items-center justify-between bg-bg-card"},Ot={class:"flex items-center gap-2"},Kt=["aria-label"],Mt={class:"py-5 px-4 sm:px-6 flex flex-col gap-5 flex-grow"},zt={key:0,class:"space-y-2 sm:col-span-1"},Bt={class:"text-xs uppercase tracking-wider text-text-secondary"},jt={class:"capitalize"},Ft=["disabled","title","onKeydown"],Rt=["title"],$t=["disabled"],Ht=["innerHTML"],Nt={key:1,class:"opacity-60"},Wt={key:"tab-details",class:"space-y-6"},Yt={class:"grid grid-cols-2 gap-4 text-sm"},Gt={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-4"},Jt={class:"mt-1 font-medium"},Xt={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-4"},Zt={class:"mt-1 font-medium"},es={class:"rounded-2xl border border-orchit-white/10 bg-orchit-white/5 p-4 grid grid-cols-1 gap-4"},ts={class:"space-y-2"},ss={class:"space-y-2"},as={class:"space-y-2"},is={class:"h-8 px-3 flex items-center gap-2 rounded-lg bg-bg-input border border-orchit-white/10"},os={class:"space-y-2"},ls={key:0,class:"text-xs text-red-400 mt-1"},ns={key:0,class:"space-y-2 sm:col-span-1"},rs={class:"text-xs uppercase tracking-wider text-text-secondary"},ds={key:1},us={class:"relative border-l border-orchit-white/10 pl-5 space-y-4 ml-1"},cs={class:"rounded-xl bg-orchit-white/5 border border-orchit-white/10 p-3 hover:bg-orchit-white/7 transition"},ps={class:"font-semibold"},ms={class:"font-semibold"},vs={key:"tab-comments",class:"space-y-4"},_s={class:"flex items-center gap-3 mb-2"},fs={class:"h-8 w-8 rounded-full bg-accent/15 text-accent flex items-center justify-center text-xs font-semibold"},hs={class:"flex-1"},bs={class:"text-sm font-medium"},gs={class:"text-xs text-text-secondary"},xs={key:0,class:"flex items-center gap-2"},ys=["disabled","onClick"],ws=["disabled","onClick"],ks={class:"flex items-center gap-2 justify-end"},Cs={key:0,class:"mt-3 grid grid-cols-2 gap-2"},Ds=["href"],Ss={class:"text-xs truncate"},Es={class:"rounded-xl border border-orchit-white/10 bg-orchit-white/5 overflow-hidden"},Is=["disabled"],Vs={class:"flex items-center w-full justify-between p-2 border-t border-orchit-white/10"},Ts={key:"tab-attachments",class:"space-y-3"},Qs={class:"text-xs text-text-secondary"},As={class:"grid sm:grid-cols-2 gap-4"},Us={class:"p-3"},Ls={key:0,class:"rounded-lg overflow-hidden"},Ps=["src"],qs={key:1,class:"rounded-lg overflow-hidden"},Os=["src"],Ks={key:2,class:"h-40 rounded-lg bg-black/5 grid place-items-center"},Ms={class:"mt-3"},zs={class:"font-medium truncate"},Bs={class:"text-xs text-text-secondary capitalize"},js={class:"p-3 pt-0"},Fs=["href"],Rs=ft({__name:"SidePanel",props:{pin:{type:Boolean,default:!1},showPanel:{type:Boolean,default:!0},details:{type:Object,default:()=>({})}},emits:["close","closeSidePanel","update:details","comment:post","priority:change","ticketUpdated"],setup(z,{emit:Te}){var ye,we,ke;const g=Ut(),Qe=K({loader:()=>M(()=>import("./index-Bau3eFG3.js").then(t=>t.dr),__vite__mapDeps([0,1])),loadingComponent:{template:'<div class="h-20 w-full animate-pulse bg-neutral-700/30 rounded-lg"></div>'},delay:200}),X=K(()=>M(()=>import("./BaseSelectField-C6lXk60C.js"),__vite__mapDeps([2,0,1]))),ce=K(()=>M(()=>import("./index-Bau3eFG3.js").then(t=>t.ds),__vite__mapDeps([0,1]))),Ae=K(()=>M(()=>import("./AssigmentDropdown-CRxnC0yB.js"),__vite__mapDeps([3,0,1]))),Z=K(()=>M(()=>import("./index-Bau3eFG3.js").then(t=>t.dq),__vite__mapDeps([0,1]))),Ue=K(()=>M(()=>import("./index-Bau3eFG3.js").then(t=>t.du),__vite__mapDeps([0,1]))),B=b(!1),{canCreateComment:ee,canEditComment:Y,canViewComment:pe,canDeleteComment:Le,canEditCard:y,canViewAttachment:Pe,canAssignCard:qe}=ht(),{workspaceId:Oe}=bt(),c=gt(),_=z,te=Te,se=b(_.details._id),{data:l,isPending:me,isFetching:Ke,refetch:Me}=xt(se,{initialData:()=>c.getQueryData(["product-card",se.value]),staleTime:5*60*1e3,gcTime:10*60*1e3,refetchOnWindowFocus:!1});console.log("card variables",l.value),S(_,()=>{se.value=_.details._id}),S(()=>l.value,t=>{console.log("card variables",l.value),t&&(g.selectedCard=t,g.selectedCardTitle=t["card-title"],g.selectedCardId=t._id)},{immediate:!0});const j=b("details"),ze=[{label:"Details",value:"details"},{label:"Comments",value:"comments",disabled:pe},{label:"History",value:"history"},{label:"Attachment",value:"attachment"}],A=b(!1),V=b(l.value?l.value["card-title"]:""),ve=b(null);function Be(){var t;y.value&&(g.saveTitle(V.value),g.saveLocalId((t=l.value)==null?void 0:t._id),g.saveCardDetails(l.value),A.value=!0,Ie(()=>{var e;return(e=ve.value)==null?void 0:e.focus()}))}S(()=>g.selectedCardTitle,t=>{!A.value&&t!==void 0&&(V.value=t)},{immediate:!0});function je(){const t=V.value.trim();if(!t||t===g.selectedCardTitle){A.value=!1;return}Q.mutate({card_id:g.selectedCardId,variables:{"card-title":t}}),A.value=!1}const U=b(l!=null&&l.value?l==null?void 0:l.value["card-description"]:"");S(()=>{var t;return(t=g.selectedCard)==null?void 0:t["card-description"]},t=>{var e;t&&((e=g.selectedCard)==null?void 0:e._id)===g.selectedCardId&&(g.selectedCard["card-description"]=t,g.selectedCard={...g.selectedCard})});const F=b(!1),ae=b(null);function Fe(t){var u,p;const e=(u=t==null?void 0:t.querySelector)==null?void 0:u.call(t,".ProseMirror");if(!e)return;e.focus();const s=(p=window.getSelection)==null?void 0:p.call(window),o=document.createRange();o.selectNodeContents(e),o.collapse(!1),s==null||s.removeAllRanges(),s==null||s.addRange(o)}async function Re(){y.value&&(F.value=!0,await Ie(),Fe(ae.value||void 0))}function _e(){var s,o;const t=(s=U.value)==null?void 0:s.trim(),e=((o=l.value)==null?void 0:o["card-description"])??"";if(!t||t===e){F.value=!1;return}Q.mutate({card_id:_.details._id,variables:{"card-description":t}},{onSuccess:()=>{te("ticketUpdated",{cardId:_.details._id,updates:{"card-description":t}})}}),F.value=!1}function fe(t){var s;if(!F.value)return;const e=t.target;(s=ae.value)!=null&&s.contains(e)||_e()}Ce(()=>document.addEventListener("mousedown",fe)),yt(()=>document.removeEventListener("mousedown",fe));const ie=De({posted_on:((ye=_.details)==null?void 0:ye.posted_on)??((we=_.details)==null?void 0:we.created_at)??""}),$e=P({get:()=>ie.posted_on?new Date(ie.posted_on).toISOString().slice(0,10):"",set:t=>{ie.posted_on=t?new Date(t+"T00:00:00").toISOString():""}}),{data:oe}=wt(Oe.value),le=b(l!=null&&l.value?l.value.workspace_lane_id:"Main");S([()=>l.value,()=>Ke.value],()=>{l!=null&&l.value&&(V.value=l==null?void 0:l.value["card-title"],U.value=l.value["card-description"],le.value=l.value.workspace_lane_id||"Main")});const He={_id:"Main",title:"Main"},Ne=P(()=>{const t=((oe==null?void 0:oe.value)??[]).map(e=>{var s;return{_id:e._id,title:((s=e==null?void 0:e.variables)==null?void 0:s["lane-title"])??String(e._id)}});return[He,...t]});function We(t){le.value=t,t!=="Main"&&Q.mutate({card_id:_.details._id,workspace_lane_id:t})}const k=b({startDate:null,endDate:null});S(()=>l.value,t=>{k.value.startDate=(t==null?void 0:t["start-date"])??null,k.value.endDate=(t==null?void 0:t["end-date"])??null},{immediate:!0,deep:!0});const ne=P(()=>k!=null&&k.value.startDate&&k.value.endDate&&k.value.endDate<k.value.startDate?"End date cannot be before start date":""),Ye=t=>{k.value.startDate=t??null,Q.mutate({card_id:_.details._id,variables:{"start-date":t}})},Ge=t=>{k.value.endDate=t??null,Q.mutate({card_id:_.details._id,variables:{"end-date":t}})},Je=P(()=>l==null?void 0:l.value.assigned_to),Xe=t=>{Q.mutate({card_id:_.details._id,seat_id:t==null?void 0:t._id,optimisticUser:t})},Ze=P(()=>{var t;return(t=_.details)==null?void 0:t._id}),{data:re}=kt(Ze),h=b((ke=re.value)==null?void 0:ke.comments);S(()=>re.value,()=>{var t;h.value=(t=re.value)==null?void 0:t.comments});const{mutate:et,isPending:tt}=Ct({onMutate:async t=>{const e=_.details._id;await c.cancelQueries({queryKey:["product-comments",e]}),await c.cancelQueries({queryKey:["sheet-list"]});const s=c.getQueryData(["product-comments",e]),o=c.getQueryData(["sheet-list"]),u={_id:Date.now().toString(),comment_text:t.payload.comment_text,commented_by:{u_full_name:"You",_id:he.value},attachments:t.payload.attachments||[],created_at:new Date().toISOString()};return c.setQueryData(["product-comments",e],p=>({...p,comments:[...(p==null?void 0:p.comments)||[],u]})),{previousComments:s,previousLists:o}},onError:(t,e,s)=>{s!=null&&s.previousComments&&c.setQueryData(["product-comments",_.details._id],s.previousComments),s!=null&&s.previousLists&&c.setQueriesData({queryKey:["sheet-list"]},s.previousLists),console.log(t,e)},onSettled:()=>{c.invalidateQueries({queryKey:["product-comments",_.details._id]}),c.invalidateQueries({queryKey:["sheet-list"]}),c.invalidateQueries({queryKey:["product-card"]})}}),R=b(""),st=t=>(t??"").split(" ").map(e=>e[0]).filter(Boolean).slice(0,2).join("").toUpperCase(),at=t=>t?new Date(t).toLocaleString():"",{data:he}=Dt(),it=t=>{var e;return((e=t==null?void 0:t.created_by)==null?void 0:e._id)===he.value},$=b(null),T=b(""),{mutate:ot,isPending:be}=St({onSuccess:t=>{const e=h.value.findIndex(s=>s._id===t._id);e>-1&&(h.value[e]={...h.value[e],comment_text:t.comment_text}),$.value=null,T.value="",c.invalidateQueries({queryKey:["product-card"]})}}),{mutate:lt}=Et();function nt(t){$.value=t._id,T.value=t.comment_text??""}function de(){$.value=null,T.value="",A.value=!1}function rt(t){const e=T.value.trim();if(!e)return;const s=h.value.findIndex(u=>u._id===t._id),o=s>-1?{...h.value[s]}:null;s>-1&&(h.value[s]={...h.value[s],comment_text:e}),ot({id:t._id,payload:{comment_text:e}},{onError:()=>{s>-1&&o&&(h.value[s]=o)},onSuccess:u=>{s>-1&&(h.value[s]=u??h.value[s]),de(),c.invalidateQueries({queryKey:["product-card"]})}})}function dt(t){const e=h.value.findIndex(o=>o._id===t._id),s=e>-1?h.value[e]:null;e>-1&&h.value.splice(e,1),lt({id:t._id},{onError:()=>{s&&h.value.splice(e,0,s)}})}const ut=P(()=>{var t;return(t=l.value)==null?void 0:t.attachments.map(e=>{var s;return{_id:e._id??e.id??((s=crypto.randomUUID)==null?void 0:s.call(crypto))??Math.random(),name:e.name??e.filename??"file",url:e.url,kind:(e.type??e.kind??"").toLowerCase().includes("image")?"image":(e.type??e.kind??"").toLowerCase().includes("video")?"video":"file"}})}),Q=It({onMutate:async t=>{const{card_id:e,variables:s}=t;await c.cancelQueries({queryKey:["product-card",e]}),await c.cancelQueries({queryKey:["sheet-list"]});const o=c.getQueryData(["product-card",e]),u=c.getQueryData(["sheet-list"]),p=f=>{if(!f||f._id!==e)return f;const i={...f,variables:Array.isArray(f.variables)?[...f.variables]:[]};return s&&(Object.assign(i,s),Object.entries(s).forEach(([w,m])=>{const L=i.variables.findIndex(C=>C.slug===w);L!==-1?i.variables[L]={...i.variables[L],value:m}:i.variables.push({slug:w,value:m,type:"Text"}),w==="card-description"&&(i["card-description"]=m,i.description=m)})),t.workspace_lane_id&&(i.workspace_lane_id=t.workspace_lane_id),t.optimisticUser&&(i.seat=t.optimisticUser,i.assigned_to=t.optimisticUser),i};return c.setQueryData(["product-card",e],p),c.setQueriesData({queryKey:["sheet-list"]},f=>Array.isArray(f)?f.map(i=>{var w;return{...i,cards:(w=i.cards)==null?void 0:w.map(m=>m._id===e?p(m):m)}}):f),{previousCard:o,previousLists:u}},onSuccess:(t,e)=>{const s=e.card_id;Me(),t&&(c.setQueryData(["product-card",s],t),c.setQueriesData({queryKey:["sheet-list"]},o=>Array.isArray(o)?o.map(u=>{var p;return{...u,cards:(p=u.cards)==null?void 0:p.map(f=>f._id===s?{...f,...t}:f)}}):o),c.invalidateQueries({queryKey:["product-card",s]}))},onError:(t,e,s)=>{if(!s)return;const o=e.card_id;c.setQueryData(["product-card",o],s.previousCard),c.setQueriesData({queryKey:["sheet-list"]},s.previousLists)},onSettled:(t,e,s)=>{const o=s.card_id;c.invalidateQueries({queryKey:["product-card",o]}),c.invalidateQueries({queryKey:["sheet-list"]})}}),H=b([]),{mutate:ct}=Vt({onSuccess:t=>{H.value=[t],c.invalidateQueries({queryKey:["product-card"]})}});function pt(t){const e=t.target.files;Array.from(e).forEach(s=>{const o=new FormData;o.append("file",s),ct(o)})}function mt(){const t=R.value.trim();if(!t&&!H.value.length)return;const e=_.details._id;c.setQueriesData({queryKey:["sheet-list"]},s=>Array.isArray(s)?s.map(o=>({...o,cards:o.cards.map(u=>u._id===e?{...u,comment_count:(u.comment_count||0)+1}:u)})):s),et({id:e,payload:{comment_text:t,attachments:H.value.map(s=>({name:s.data.name,url:s.data.url}))}}),R.value="",H.value=[]}const N=De({}),ge=()=>{var t;(t=l==null?void 0:l.value)!=null&&t.variables&&(l.value.variables??[]).forEach(s=>{var u,p;if(!s||s.type!=="Select")return;const o=Array.isArray(s.data)&&s.data.length?((u=s.data[0])==null?void 0:u.value)??((p=s.data[0])==null?void 0:p._id)??s.data[0]:void 0;N[s.slug]=s.value??N[s.slug]??o??null})};Ce(ge),S(()=>l.value,ge,{deep:!0});function xe(t,e){var o,u;N[e]=t,((u=(((o=l.value)==null?void 0:o.variables)??[]).find(p=>p.slug===e))==null?void 0:u.value)!==t&&Q.mutate({card_id:_.details._id,variables:{[e]:t}})}function vt(t){return t==="comments"&&!pe.value?(Ve.error("You do not have permission to view comments"),!1):t==="attachment"&&!Pe.value?(Ve.error("You do not have permission to view attachments"),!1):!0}return(t,e)=>(r(),Tt(W,{name:"panel",appear:""},{default:E(()=>{var s;return[G(a("div",{class:q(["flex flex-col h-full overflow-y-auto bg-gradient-to-b from-bg-card/95 to-bg-card/90 backdrop-blur rounded-[6px] shadow-[0_10px_40px_-10px_rgba(0,0,0,.5)] border border-orchit-white/5 overflow-hidden transition-all duration-300 ease-in-out",B.value?"min-w-full max-w-full":"min-w-full max-w-[380px] sm:min-w-[380px]"]),role:"complementary","aria-label":"Details panel"},[n(me)&&!n(l)?(r(),d("div",Lt,e[9]||(e[9]=[a("div",{class:"h-8 bg-orchit-white/10 rounded-xl w-3/4"},null,-1),a("div",{class:"space-y-2"},[a("div",{class:"h-4 bg-orchit-white/10 rounded w-full"}),a("div",{class:"h-4 bg-orchit-white/10 rounded w-5/6"})],-1),a("div",{class:"grid grid-cols-2 gap-4"},[a("div",{class:"h-20 bg-orchit-white/10 rounded-xl"}),a("div",{class:"h-20 bg-orchit-white/10 rounded-xl"})],-1)]))):(r(),d("div",Pt,[a("div",qt,[e[11]||(e[11]=a("h5",{class:"text-[18px] font-semibold tracking-tight"},"Details",-1)),a("div",Ot,[a("button",{class:"p-2 rounded-xl hover:bg-orchit-white/5 active:scale-[.98] cursor-pointer transition",onClick:e[0]||(e[0]=o=>B.value=!B.value),"aria-label":B.value?"Collapse details":"Expand details"},[a("i",{class:q(["fa-solid",B.value?"fa-compress":"fa-expand","text-lg"])},null,2)],8,Kt),a("button",{class:"p-2 rounded-xl hover:bg-orchit-white/5 active:scale-[.98] cursor-pointer transition",onClick:e[1]||(e[1]=()=>{te("close"),te("closeSidePanel")}),"aria-label":"Close details"},e[10]||(e[10]=[a("i",{class:"fa-solid fa-xmark text-lg"},null,-1)]))])]),a("div",Mt,[(r(!0),d(D,null,O((s=n(l))==null?void 0:s.variables,(o,u)=>(r(),d(D,{key:o.slug||`var-${u}`},[(o==null?void 0:o.type)==="Select"&&o.slug=="card-type"?(r(),d("div",zt,[a("div",Bt,v(o.title),1),x(n(X),{disabled:!n(y),size:"sm",options:o==null?void 0:o.data.map(p=>({_id:p,title:p})),placeholder:"Select option",allowCustom:!1,"model-value":N[o.slug],"onUpdate:modelValue":p=>xe(p,o.slug)},null,8,["disabled","options","model-value","onUpdate:modelValue"])])):I("",!0)],64))),128)),a("div",jt,[x(W,{name:"fade-scale",mode:"out-in"},{default:E(()=>[A.value?G((r(),d("input",{disabled:!n(y),title:n(y)?"":"You do not have permission to edit this card",key:"title-edit",ref_key:"titleInput",ref:ve,"onUpdate:modelValue":e[2]||(e[2]=o=>V.value=o),onKeydown:[Se(Ee(je,["prevent"]),["enter"]),Se(Ee(de,["prevent"]),["esc"])],class:"w-full text-2xl font-semibold rounded-xl px-3 py-2 bg-orchit-white/5 border border-orchit-white/10 focus:outline-none focus:ring-2 focus:ring-accent/40 transition",type:"text","aria-label":"Edit title"},null,40,Ft)),[[ue,V.value]]):(r(),d("h1",{key:"title-view",class:q([n(y)?"cursor-text":"cursor-not-allowed","text-[20px] leading-[28px] font-semibold tracking-tight rounded-lg px-2 py-1 hover:bg-orchit-white/5 transition"]),onClick:e[3]||(e[3]=o=>Be()),"aria-label":"Card title",title:n(y)?"":"You do not have permission to edit this card"},v(V.value||"Untitled"),11,Rt))]),_:1})]),a("div",null,[e[12]||(e[12]=a("h3",{class:"mb-2 text-base font-semibold tracking-wide px-1"}," Description ",-1)),x(W,{name:"fade-scale",mode:"out-in"},{default:E(()=>[F.value?(r(),d("div",{key:"desc-edit",ref_key:"descEditorWrap",ref:ae,class:"rounded-xl overflow-hidden border border-orchit-white/10 shadow-sm"},[x(n(Qe),{modelValue:U.value,"onUpdate:modelValue":e[4]||(e[4]=o=>U.value=o),onFocusOut:_e},null,8,["modelValue"])],512)):(r(),d("div",{key:"desc-view",class:q(["text-[15px] leading-6 text-text-secondary whitespace-pre-wrap rounded-xl px-4 py-3 border border-orchit-white/10 bg-orchit-white/5 hover:border-orchit-white/20 transition",n(y)?"cursor-text":"cursor-not-allowed"]),disabled:!n(y),onClick:Re},[U.value?(r(),d("div",{key:0,innerHTML:U.value},null,8,Ht)):(r(),d("span",Nt,"Click to add a description…"))],10,$t))]),_:1})]),x(n(Ue),{modelValue:j.value,"onUpdate:modelValue":e[5]||(e[5]=o=>j.value=o),options:ze,size:"md",beforeChange:vt},null,8,["modelValue"]),x(W,{name:"section",mode:"out-in"},{default:E(()=>{var o,u,p,f;return[j.value==="details"?(r(),d("section",Wt,[a("div",Yt,[a("div",Gt,[e[13]||(e[13]=a("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," Posted On ",-1)),a("div",Jt,v($e.value),1)]),a("div",Xt,[e[14]||(e[14]=a("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," ID ",-1)),a("div",Zt,v(z.details["card-code"]),1)])]),a("div",es,[a("div",ts,[e[15]||(e[15]=a("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," Tab ",-1)),x(n(X),{disabled:!n(y),size:"sm",options:Ne.value,placeholder:"Select tab",allowCustom:!1,"model-value":le.value,"onUpdate:modelValue":We},null,8,["disabled","options","model-value"])]),a("div",ss,[e[16]||(e[16]=a("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," Assign ",-1)),x(n(Ae),{disabled:!n(qe),onAssign:e[6]||(e[6]=i=>Xe(i)),assigneeId:Je.value,seat:n(l).seat},null,8,["disabled","assigneeId","seat"])]),z.pin?I("",!0):(r(),d(D,{key:0},[a("div",as,[e[18]||(e[18]=a("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," Start Date ",-1)),a("div",is,[e[17]||(e[17]=a("i",{class:"fa-regular fa-calendar"},null,-1)),x(n(ce),{disabled:!n(y),placeholder:"Set start date",class:"w-full","model-value":k.value.startDate,"emit-as":"ymd","onUpdate:modelValue":Ye},null,8,["disabled","model-value"])])]),a("div",os,[e[20]||(e[20]=a("div",{class:"text-xs uppercase tracking-wider text-text-secondary"}," Target End ",-1)),a("div",{class:q(["h-8 px-3 flex items-center gap-2 rounded-lg bg-bg-input border transition-colors",ne.value?"border-red-500":"border-orchit-white/10"])},[e[19]||(e[19]=a("i",{class:"fa-regular fa-calendar"},null,-1)),x(n(ce),{disabled:!n(y),placeholder:"Set end date",class:"w-full","model-value":k.value.endDate,"emit-as":"ymd","onUpdate:modelValue":Ge},null,8,["disabled","model-value"])],2),ne.value?(r(),d("p",ls,v(ne.value),1)):I("",!0)])],64)),n(me)?(r(),d(D,{key:1},[e[21]||(e[21]=a("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),e[22]||(e[22]=a("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),e[23]||(e[23]=a("div",{class:"bg-bg-surface/40 w-full animate-pulse h-8 p-1"},null,-1)),e[24]||(e[24]=a("div",{class:"bg-bg-surface/40 w-full animate-pulse h-6 p-1"},null,-1))],64)):(o=n(l))!=null&&o.variables?(r(!0),d(D,{key:2},O((u=n(l))==null?void 0:u.variables,(i,w)=>(r(),d(D,{key:i.slug||`var-${w}`},[i.type==="Select"&&i.slug!=="card-type"&&i.slug!=="ok"&&i.slug!=="process"?(r(),d("div",ns,[a("div",rs,v(i.title),1),x(n(X),{disabled:!n(y),size:"sm",options:i==null?void 0:i.data.filter(m=>m!=="ok"&&m!=="process").map(m=>({_id:m,title:m})),placeholder:"Select option",allowCustom:!1,"model-value":N[i.slug],"onUpdate:modelValue":m=>xe(m,i.slug)},null,8,["disabled","options","model-value","onUpdate:modelValue"])])):I("",!0)],64))),128)):I("",!0)])])):j.value==="history"?(r(),d("section",ds,[a("div",null,[e[27]||(e[27]=a("h3",{class:"text-sm font-semibold tracking-wide mb-3"}," History ",-1)),a("ol",us,[(r(!0),d(D,null,O((p=n(l))==null?void 0:p.history,(i,w)=>(r(),d("li",{key:w,class:"group"},[e[26]||(e[26]=a("span",{class:"absolute -left-[5px] top-0 w-2 h-2 rounded-full bg-accent/70 ring-4 ring-accent/10"},null,-1)),a("div",cs,[a("span",ps,v(i.user.u_full_name),1),e[25]||(e[25]=a("span",{class:"text-text-secondary"}," changed ",-1)),a("span",ms,v(i.field_name),1)])]))),128))])])])):j.value==="comments"?(r(),d("section",vs,[(r(!0),d(D,null,O(h.value??[],i=>{var w,m,L;return r(),d("div",{key:i._id,class:"rounded-xl border border-orchit-white/10 bg-orchit-white/5 p-4 hover:bg-orchit-white/7 transition"},[a("div",_s,[a("div",fs,v(st((w=i.commented_by)==null?void 0:w.u_full_name)),1),a("div",hs,[a("div",bs,v((m=i.commented_by)==null?void 0:m.u_full_name),1),a("div",gs,v(at(i.created_at)),1)]),it(i)?(r(),d("div",xs,[$.value!==i._id?(r(),d("button",{key:0,disabled:!n(Y),class:"text-xs text-accent hover:underline",onClick:C=>nt(i)}," Edit ",8,ys)):I("",!0),a("button",{disabled:!n(Le),class:"text-xs text-red-400 hover:underline",onClick:C=>dt(i)}," Delete ",8,ws)])):I("",!0)]),x(W,{name:"fade",mode:"out-in"},{default:E(()=>[$.value!==i._id?(r(),d("p",{key:`c-view-${i._id}`,class:"text-[15px] leading-6"},v(i.comment_text),1)):(r(),d("div",{key:`c-edit-${i._id}`,class:"space-y-2"},[G(a("textarea",{"onUpdate:modelValue":e[7]||(e[7]=C=>T.value=C),rows:"3",class:"w-full p-3 rounded-lg bg-bg-input/80 border border-orchit-white/10 focus:ring-2 focus:ring-accent/40 outline-none"},null,512),[[ue,T.value]]),a("div",ks,[x(n(Z),{variant:"secondary",size:"sm",onClick:de},{default:E(()=>e[28]||(e[28]=[J("Cancel")])),_:1,__:[28]}),x(n(Z),{class:"btn",size:"sm",onClick:C=>rt(i),disabled:!T.value.trim()||n(be)||!n(Y)},{default:E(()=>[J(v(n(be)?"Saving…":"Save"),1)]),_:2},1032,["onClick","disabled"])])]))]),_:2},1024),(L=i==null?void 0:i.attachments)!=null&&L.length?(r(),d("div",Cs,[(r(!0),d(D,null,O(i.attachments,(C,_t)=>(r(),d("a",{key:_t,href:C.url,target:"_blank",class:"group flex items-center gap-2 rounded-lg border border-orchit-white/10 bg-orchit-white/5 px-2 py-1 hover:bg-orchit-white/10 transition"},[e[29]||(e[29]=a("i",{class:"fa-regular fa-file text-text-secondary group-hover:text-text-primary transition"},null,-1)),a("span",Ss,v(C==null?void 0:C.name),1)],8,Ds))),128))])):I("",!0)])}),128)),a("div",Es,[G(a("textarea",{disabled:!n(ee)||!n(Y),"onUpdate:modelValue":e[8]||(e[8]=i=>R.value=i),rows:"3",class:q([n(ee)||n(Y)?"cursor-text":"cursor-not-allowed","w-full p-3 bg-transparent outline-none text-sm"]),placeholder:"Write a comment"},null,10,Is),[[ue,R.value]]),a("div",Vs,[a("input",{type:"file",multiple:"",onChange:pt,class:"max-w-full text-ellipsis text-xs text-text-secondary file:mr-3 col-span-2 file:px-3 file:py-1.5 file:rounded-md file:border file:border-orchit-white/10 file:bg-orchit-white/10 hover:file:bg-orchit-white/15 file:text-text-primary transition inline w-fit"},null,32),x(n(Z),{variant:"primary",class:"min-w-[70px]",size:"sm",onClick:mt,disabled:!R.value.trim()&&!H.value.length||!n(ee)},{default:E(()=>[J(v(n(tt)?"Posting…":"Post"),1)]),_:1},8,["disabled"])])])])):(r(),d("section",Ts,[a("div",Qs," Files attached to this "+v(((f=z.details)==null?void 0:f.type)??"item")+". ",1),a("div",As,[(r(!0),d(D,null,O(ut.value,i=>(r(),d("div",{key:i._id,class:"rounded-2xl overflow-hidden border border-orchit-white/10 bg-orchit-white/5 hover:bg-orchit-white/8 transition group"},[a("div",Us,[i.kind==="image"?(r(),d("div",Ls,[a("img",{src:i.url,class:"w-full h-40 object-cover group-hover:scale-[1.02] transition"},null,8,Ps)])):i.kind==="video"?(r(),d("div",qs,[a("video",{src:i.url,controls:"",class:"w-full h-40 object-cover"},null,8,Os)])):(r(),d("div",Ks,e[30]||(e[30]=[a("i",{class:"fa-regular fa-file text-3xl text-text-secondary"},null,-1)]))),a("div",Ms,[a("div",zs,v(i.name),1),a("div",Bs,v(i.kind),1)])]),a("div",js,[a("a",{href:i.url,target:"_blank",rel:"noopener",class:"w-full inline-flex items-center justify-center gap-2 h-9 rounded-lg bg-accent text-orchit-white text-sm hover:opacity-90 transition"},e[31]||(e[31]=[a("i",{class:"fa-regular fa-arrow-up-right-from-square"},null,-1),J(" View ")]),8,Fs)])]))),128))])]))]}),_:1})])]))],2),[[Qt,z.showPanel]])]}),_:1}))}}),Ns=At(Rs,[["__scopeId","data-v-8f95e431"]]);export{Ns as default};
