const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Dropdown-CyEDc0bn.js","assets/index-SgxqeUdj.js","assets/index-h61U0LjG.css","assets/index-T8e2brB_.js","assets/Dropdown-P9l2osTz.css","assets/SearchBar-CwxftVDD.js","assets/SearchBar.vue_vue_type_script_setup_true_lang-C6l6nhEq.js","assets/KanbanSkeleton-BPUpbkKN.js","assets/KanbanSkeleton-BjQaxKe3.css","assets/BaseTextField-Dou9YXcG.js","assets/KanbanTicket-ul82jM-k.js","assets/DropMenu.vue_vue_type_script_setup_true_lang-B5WRiZal.js","assets/ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-DFW6OdV1.js","assets/KanbanTicket-dlS9DisH.css","assets/TableView-CUhsXzqf.js","assets/TableView.vue_vue_type_script_setup_true_lang-CDw6UrdH.js","assets/TableSearchCell-DCbNcxNv.js","assets/TableAssigneeCell-5PpAeJEj.js","assets/CalendarView-Cr7F1H91.js","assets/CalendarView-DsU6_g0u.css","assets/GanttChartView-DpeOfr6N.js","assets/TimelineView-COu4CI8k.js","assets/TimelineView-BsFP6voT.css","assets/CreateTaskModal-COeWxYvP.js","assets/CreateTaskModal.vue_vue_type_script_setup_true_lang-52xw9kug.js","assets/CreateSheetModal-C1Pqv3U8.js","assets/IconPicker-DgVFyfJ3.js","assets/IconPicker-CIMr_3tu.css","assets/AudioRecorder.vue_vue_type_script_setup_true_lang-B5c2g88j.js","assets/CreateSheetModal--7RYCgy-.css","assets/CreateVariableModal-Gqd-XZNk.js","assets/ConfirmDeleteModal-BmpFw3td.js","assets/SidePanel-BBQIZ0f4.js","assets/sidePanelStore-z_z_edWh.js","assets/SidePanel-Dd1w9Imr.css","assets/KanbanBoard-DSkGExj-.js","assets/vuedraggable.umd-4OkpUW01.js","assets/_commonjsHelpers-_d1bhYXs.js","assets/KanbanBoard-Dffh696C.css"])))=>i.map(i=>d[i]);
import{d as ka,W as wa,r as c,N as Ca,O as Sa,c as A,a2 as Ta,p as F,a0 as Va,a6 as Ea,u as Da,as as Aa,a7 as La,a8 as Ia,a9 as Na,a1 as Pa,ac as T,ad as qa,Q as Oa,ae as y,ab as Ma,a3 as Ra,aa as za,V as Ua,af as Ba,ag as Wa,j as L,f as i,i as C,e as M,k,w as Y,q as d,A as R,F as ze,E as Ue,G as ut,h as ce,ai as ct,ah as vt,t as Be,P as ja,v as Fa,aj as We,ak as Ka,C as x,o as _,g as we,T as pt,U as ft,am as $a,al as je,K as Ha}from"./index-SgxqeUdj.js";import{F as bt}from"./fuse-Ch1WBRTM.js";import{l as Qa}from"./lodash-CQYOKM_D.js";import{k as ve}from"./MindElixir-Ch35iPok.js";import{u as Ga}from"./sidePanelStore-z_z_edWh.js";import"./_commonjsHelpers-_d1bhYXs.js";const Ya={class:"flex-auto bg-gradient-to-b from-bg-card/95 to-bg-card/90 backdrop-blur rounded-[6px] shadow-[0_10px_40px_-10px_rgba(0,0,0,.5)] flex-grow h-full bg-bg-card border border-border overflow-x-auto flex-col flex scrollbar-visible"},Ja={class:"overflow-x-auto shrink-0 sticky top-0 z-20 bg-bg-card"},Xa={class:"header px-4 py-3 border-b border-border flex items-center justify-between gap-1 min-w-max h-full"},Za={class:"flex gap-3 items-center"},el={class:"flex items-center gap-3 bg-bg-surface/50 h-[32px] px-2 rounded-md"},tl={class:"flex overflow-x-auto gap-3 p-4 scrollbar-visible h-full"},al={key:0,class:"mx-auto text-text-secondary/80 m-2 w-[90%] h-full justify-center flex items-center border border-dashed border-border"},ll={key:0,class:"bg-bg-body rounded-lg p-4"},rl={class:"flex items-center mt-3 gap-3"},ol=["disabled"],il={class:"relative w-full h-full flex overflow-hidden"},nl={key:0,class:"format-sidebar h-full py-4 px-4 w-[320px] border-l bg-bg-card overflow-x-hidden overflow-y-auto flex flex-col"},sl={class:"flex items-center justify-between pb-3 mb-4 border-b"},dl={class:"format-content space-y-6"},ul={class:"format-group mb-3"},cl={class:"flex items-center gap-2"},vl=["value"],pl={class:"format-group mb-3"},fl={class:"flex items-center gap-2"},bl=["value"],ml={class:"grid grid-cols-1 gap-3"},_l=["value"],gl={class:"mt-6 pt-4"},yl=["disabled"],xl={key:0,class:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},hl={key:0,class:"fixed inset-0 bg-black/30 flex items-center justify-center"},kl={class:"bg-white p-6 rounded-xl w-80"},wl={class:"flex justify-end gap-2 mt-4"},Cl=["disabled"],Sl={class:"flex items-center mt-3 gap-3"},Tl=ka({__name:"Product",setup(Vl){const Fe=y(()=>x(()=>import("./Dropdown-CyEDc0bn.js"),__vite__mapDeps([0,1,2,3,4]))),mt=y(()=>x(()=>import("./SearchBar-CwxftVDD.js"),__vite__mapDeps([5,6,1,2]))),_t=y(()=>x(()=>import("./KanbanSkeleton-BPUpbkKN.js"),__vite__mapDeps([7,1,2,8]))),pe=y(()=>x(()=>import("./BaseTextField-Dou9YXcG.js"),__vite__mapDeps([9,1,2]))),Ke=y(()=>x(()=>import("./index-SgxqeUdj.js").then(t=>t.dq),__vite__mapDeps([1,2]))),gt=y(()=>x(()=>import("./KanbanTicket-ul82jM-k.js"),__vite__mapDeps([10,1,2,11,3,12,13]))),yt=y(()=>x(()=>import("./TableView-CUhsXzqf.js"),__vite__mapDeps([14,15,1,2]))),xt=y(()=>x(()=>import("./index-SgxqeUdj.js").then(t=>t.ds),__vite__mapDeps([1,2]))),$e=y(()=>x(()=>import("./TableSearchCell-DCbNcxNv.js"),__vite__mapDeps([16,1,2]))),ht=y(()=>x(()=>import("./TableAssigneeCell-5PpAeJEj.js"),__vite__mapDeps([17,1,2]))),kt=y(()=>x(()=>import("./CalendarView-Cr7F1H91.js"),__vite__mapDeps([18,1,2,19]))),wt=y(()=>x(()=>import("./GanttChartView-DpeOfr6N.js"),__vite__mapDeps([20,1,2]))),Ct=y(()=>x(()=>import("./TimelineView-COu4CI8k.js"),__vite__mapDeps([21,1,2,22]))),St=y(()=>x(()=>import("./CreateTaskModal-COeWxYvP.js"),__vite__mapDeps([23,24,1,2]))),Tt=y(()=>x(()=>import("./CreateSheetModal-C1Pqv3U8.js"),__vite__mapDeps([25,1,2,26,27,28,29]))),Vt=y(()=>x(()=>import("./CreateVariableModal-Gqd-XZNk.js"),__vite__mapDeps([30,1,2]))),Ce=y(()=>x(()=>import("./ConfirmDeleteModal-BmpFw3td.js"),__vite__mapDeps([31,12,1,2]))),Et=y(()=>x(()=>import("./SidePanel-BBQIZ0f4.js"),__vite__mapDeps([32,1,2,33,34]))),Dt=y(()=>x(()=>import("./KanbanBoard-DSkGExj-.js"),__vite__mapDeps([35,36,37,1,2,11,3,38]))),{canEditSheet:At,canDeleteSheet:Lt,canCreateVariable:fe,canCreateSheet:It,canCreateCard:Nt,canEditCard:be,canDeleteCard:Pt,canAssignCard:qt}=wa(),J=c(!1),X=c(null),Z=c(!1),ee=c(null),Se=c(!1),f=c("kanban"),te=c(null),K=c(null),ae=c(!1),He=Fa(),{workspaceId:V,moduleId:P}=Ca(),D=Sa(),me=c(!1),w=c(),z=c(null),$=c(!1),_e=c(!1),U=c(""),Te=c(null),Qe=Ga();function Ot(t){U.value="",_e.value=!0,Te.value=t}function Mt(){Te.value&&Te.value(U.value),_e.value=!1}function Rt(){_e.value=!1}const Ve=c(null),zt=t=>{Ve.value=t},Ut=A(()=>{var t;return(t=q.value)==null?void 0:t.find(e=>e._id===S.value)}),Ge=c(!1),Ye=c(!1);F(Ge,t=>{t&&(Ye.value=!1)}),F(Ye,t=>{t&&(Ge.value=!1)});const Je=async()=>{if(ee.value)try{Se.value=!0,await pt({url:`workspace/card/${ee.value}`,method:"DELETE"}),Wt(ee.value),Z.value=!1,X.value=null,ft.success("Ticket deleted successfully"),await le(),await xe()}catch(t){ft.error($a(t))}finally{Se.value=!1}},Bt=async()=>{await Je()},Wt=t=>{var e,a;(a=(e=m.value)==null?void 0:e.sheets)==null||a.forEach(l=>{var r;(r=l.sheet_lists)==null||r.forEach(v=>{v.cards=v.cards.filter(u=>u._id!==t)})})},{data:ge,refetch:le,isPending:Xe}=Va({workspace_id:V,workspace_module_id:P}),Ee=A(()=>{var t;return ge.value?(t=ge.value[0])==null?void 0:t._id:""}),E=c(Ee.value),{data:q,isPending:jt}=Ta(V,P,E),{mutate:De,isPending:Ae}=Ea({onSuccess:()=>{D.invalidateQueries({queryKey:["sheet-list"]}),H.value="",Q.value=!1,oe.value=!1,Q.value=!1}}),Ze=A(()=>{var t;return((t=Ut.value)==null?void 0:t.title)==="Process"&&Ve.value?{variable_slug:"card-type",type_value:Ve.value.title}:{}}),et=t=>{const e={workspace_id:V.value,module_id:P.value,variable_id:S.value,value:t,...Ze.value};De(e)};F(Ee,()=>{E.value=Ee.value});const Le=A(()=>{var t;return q!=null&&q.value?(t=q==null?void 0:q.value[0])==null?void 0:t._id:""}),S=c(Le.value);F(Le,()=>{S.value=Le.value});const ye=Da(),{data:m,isPending:Ie,refetch:xe}=Aa(P,E,A(()=>[...ye.selectedLaneIds]),S,Ze),O=t=>{t._id||(t._id=t.id),w.value=t,Qe.selectTaskCard(t)};window.selectCardHandler=O;const Ft=()=>{w.value=null,Qe.clearSelectedCard()},re=c(!1),Kt=()=>{W.value={},re.value=!re.value},$t=La(),Ht=Ia();function Qt(t){t.type==="column"?$t.mutate({payload:{workspace_id:V.value,workspace_module_id:P.value,variable_id:S.value,moved_value:t.meta.id,new_index:t.meta.newIndex}},{onSuccess:()=>{le(),xe()}}):Ht.mutate({payload:{workspace_id:V.value,card_id:t.meta.moved._id,group_value:t.meta.fromColumnId,group_variable_id:S.value,new_index:t.meta.newIndex,sheet_id:E.value}},{onSuccess:()=>{le(),xe()}})}const Gt=t=>{},Yt=A(()=>(ge.value||[]).map(t=>({_id:t._id,title:t==null?void 0:t.variables["sheet-title"],description:t==null?void 0:t.variables["sheet-description"],icon:t.icon,status:t==null?void 0:t.generation_status})));F(ge,t=>{var e;(t==null?void 0:t.length)>0&&(E.value=(e=t[0])==null?void 0:e._id)});const oe=c(!1),H=c("");function Ne(){oe.value=!oe.value}function he(){const t=H.value.trim();t&&et(t)}const Jt=t=>{De({workspace_id:He.params.id,module_id:He.params.module_id,new_value:t.title,value:t.oldTitle,variable_id:S.value})},Q=c(!1),B=c(),Xt=()=>{De({value:B.value.title,workspace_id:V.value,module_id:P.value,newValue:B.value.title,variable_id:S.value,is_trash:!0})},Zt=t=>{Q.value=!0,B.value=t},ea=t=>{me.value=!0,B.value=t},W=c();function ta(t){J.value=!0,W.value=t}const{mutate:tt,isPending:aa}=Na({onSuccess:()=>{le(),J.value=!1}});function la(){var t;tt({sheet_id:(t=W.value)==null?void 0:t._id,workspace_module_id:P.value,is_trash:!0})}function ra(t){re.value=!0,W.value=t}const ie=c(""),oa=c("");F(ie,Qa.debounce(t=>{oa.value=t},200));const at=A(()=>{const e=(m.value||[]).flatMap(a=>(a.cards||[]).map(l=>{const r=Array.isArray(l.variables)?l.variables.find(v=>v.slug==="card-description"):null;return{...l,columnId:a.title,"card-description":l["card-description"]||(r==null?void 0:r.value)||""}}));return new bt(e,{keys:["card-title","card-description"],threshold:.3})}),ne=A(()=>{var t;if(f.value==="kanban"){if(!ie.value)return m.value;console.log("fuse data",at.value);const e=at.value.search(ie.value).map(a=>a.item);return m.value.map(a=>({...a,cards:e.filter(l=>l.columnId===a.title)}))}else{const e=(t=ie.value)==null?void 0:t.trim();if(!e){let l=[];return(m.value??[]).forEach(r=>{l=[...l,...r==null?void 0:r.cards]}),l}return new bt(sa.value,{keys:["card-title","card-description"],threshold:.3}).search(e).map(l=>l.item)}}),{data:Pe}=Pa(V),lt=A(()=>((Pe==null?void 0:Pe.value)??[]).map(t=>{var e;return{_id:t._id,title:((e=t==null?void 0:t.variables)==null?void 0:e["lane-title"])??String(t._id)}})),ia=A(()=>{var t;return[{key:"card-title",label:"Title",render:({row:e,value:a})=>T("div",{class:"flex items-center gap-1 w-full ps-2"},[T("a",{onClick:()=>w.value=e,class:"text-[12px] underline text-blue-500 shrink-0 overflow-ellipsis cursor-pointer"},e["card-code"]),T("div",{class:"flex-1 min-w-0"},[T("input",{onFocusout:l=>{var r;ot(e==null?void 0:e._id,"card-title",(r=l==null?void 0:l.target)==null?void 0:r.value)},class:"text-[12px] w-full overflow-ellipsis capitalize p-1 w-full p-1 focus:border border-accent/60 rounded-sm focus:outline-none focus:ring-1 focus:ring-accent bg-transparent focus:bg-bg-body text-[12px] h-8",defaultValue:a,disabled:!be.value})])])},{key:"end-date",label:"Due Date",render:({row:e,value:a})=>{const l=c(a);return T(xt,{class:" capitalize flex items-center gap-2 text-[12px]",placeholder:"Set start date",tableInputClass:!0,modelValue:l.value,disabled:!be.value,"onUpdate:modelValue":r=>va(e==null?void 0:e._id,r),emptyText:"Date"})}},{key:"lane",label:"Lane",render:({row:e})=>{var a;return T($e,{options:lt.value??[],placeholder:"Select lane",modelValue:((a=e.lane)==null?void 0:a._id)||null,disabled:!be.value,"onUpdate:modelValue":l=>pa(e==null?void 0:e._id,l),displayField:"title",emptyText:"Lane"})}},{key:"created_by",label:"Owner",render:({value:e})=>T("div",{class:"capitalize flex items-center gap-2  px-3"},[T("div",{class:" rounded-full  "},[e!=null&&e.u_profile_image?T("img",{class:"w-6 h-6 rounded-full",src:e==null?void 0:e.u_profile_image}):T("div",{class:"w-5 h-5 rounded-full flex justify-center items-center text-[11px] ",style:`background:${e!=null&&e.u_full_name?qa({name:e.u_full_name,email:e.u_email}):""}`},Oa(e==null?void 0:e.u_full_name))]),T("span",{class:"text-[12px]"},e?e==null?void 0:e.u_full_name:"")])},{key:"seat",label:"Assignee",render:({row:e,value:a})=>T(ht,{class:"capitalize flex items-center gap-2 ",onAssign:l=>na(e==null?void 0:e._id,l),assigneeId:a,seat:a,name:!0,disabled:!qt.value,emptyText:"Assignee"})},...((t=q.value)==null?void 0:t.filter(e=>{var a;return((a=e==null?void 0:e.type)==null?void 0:a.title)==="Select"}).map(e=>({key:e==null?void 0:e.slug,label:e==null?void 0:e.slug,render:({row:a,value:l})=>{var v;let r=l;if(Array.isArray(a==null?void 0:a.variables)){const u=a.variables.find(p=>p.slug===e.slug);u&&(r=u.value)}else r=((v=a==null?void 0:a.variables)==null?void 0:v[e.slug])??(a==null?void 0:a[e.slug])??l;return T("div",{class:"capitalize flex items-center gap-2"},[T($e,{options:da(e.data??[]),modelValue:r,disabled:!be.value,emptyText:e.slug,"onUpdate:modelValue":u=>{ot(a==null?void 0:a._id,e.slug,u)},columnName:e.slug})])},visible:e==null?void 0:e.is_visible})))??[]]}),na=(t,e)=>{qe(t,a=>{a.seat=e}),se.mutate({card_id:t,seat_id:e==null?void 0:e._id})},sa=A(()=>{let t=[];return(m.value??[]).forEach(e=>{t=[...t,...e==null?void 0:e.cards]}),t}),da=t=>t.map(e=>({_id:e.value??e,title:e.value??e})),ua=(t,e)=>{if(!m.value)return!1;let a=!1;const l=m.value.map(r=>{const v=(r.cards||[]).map(u=>{if(u._id!==t)return u;a=!0;const p={...u,...e};if(Array.isArray(u.variables)){const s=[...u.variables];Object.entries(e).forEach(([o,g])=>{const n=s.findIndex(b=>b.slug===o);n!==-1?s[n]={...s[n],value:g}:s.push({slug:o,value:g,type:"Text"})}),p.variables=s}else p.variables={...u.variables||{},...e};return p});return{...r,cards:v}});return m.value=l,a},se=Ma({onMutate:async t=>{const{card_id:e,variables:a}=t;await D.cancelQueries({queryKey:["product-card",e]}),await D.cancelQueries({queryKey:["sheet-list"]});const l=D.getQueryData(["product-card",e]),r=D.getQueryData(["sheet-list"]),v=u=>{if(!u)return u;const p={...u,variables:Array.isArray(u.variables)?[...u.variables]:{...u.variables||{}}};return a&&(Object.assign(p,a),Array.isArray(p.variables)?Object.entries(a).forEach(([s,o])=>{const g=p.variables.findIndex(n=>n.slug===s);g!==-1?p.variables[g]={...p.variables[g],value:o}:p.variables.push({slug:s,value:o,type:"Text"})}):Object.assign(p.variables,a)),t.optimisticUser&&(p.seat=t.optimisticUser),t.workspace_lane_id&&(p.workspace_lane_id=t.workspace_lane_id),p};return a&&m.value&&ua(e,a),w.value&&w.value._id===e&&(w.value=v(w.value)),D.setQueryData(["product-card",e],v),D.setQueriesData({queryKey:["sheet-list"]},u=>Array.isArray(u)?u.map(p=>{var s;return{...p,cards:(s=p.cards)==null?void 0:s.map(o=>o._id===e?v(o):o)}}):u),We(m),{previousCard:l,previousLists:r}},onError:(t,e,a)=>{a!=null&&a.previousCard&&D.setQueryData(["product-card",e.card_id],a.previousCard),a!=null&&a.previousLists&&D.setQueryData(["sheet-list"],a.previousLists),w.value&&w.value._id===e.card_id&&(a!=null&&a.previousCard)&&(w.value=a.previousCard),console.log(t)}}),qe=(t,e)=>{if(m.value)for(const a of m.value){if(!a.cards)continue;const l=a.cards.findIndex(r=>r._id===t);if(l!==-1){const r=a.cards[l];e(r),We(m);break}}},{mutate:rt}=Ra({onSuccess:()=>{D.invalidateQueries({queryKey:["sheet-list"]})}});function ot(t,e,a){const l=typeof a=="string"?a.trim():a;qe(t,r=>{var v;if(r[e]=l,Array.isArray(r.variables)){const u=r.variables.findIndex(p=>p.slug===e);u!==-1?r.variables[u].value=l:r.variables.push({slug:e,value:l,type:"Text"})}((v=w.value)==null?void 0:v._id)===t&&(w.value[e]=l)}),se.mutate({card_id:t,variables:{[e]:l}})}function ca(t){if(t["card-title"]){const e={sheet_list_id:"To Do",workspace_id:V.value,sheet_id:E.value,variables:{"card-title":t["card-title"].trim()},createdAt:new Date().toISOString()};rt(e)}}const va=(t,e)=>{const a=m.value.findIndex(l=>l.cards.some(r=>r._id===t));if(a!==-1){const l=m.value[a].cards.findIndex(r=>r._id===t);l!==-1&&(m.value[a].cards[l]["end-date"]=e)}se.mutate({card_id:t,variables:{"start-date":e}})};function pa(t,e){qe(t,a=>{const l=lt.value.find(r=>r._id===e);l&&(a.lane=l)}),We(m),se.mutate({card_id:t,workspace_lane_id:e})}const{mutate:fa}=za(),ba=(t,e)=>{fa({payload:{sheet_id:E.value,workspace_id:V.value,variable_slug:t,is_visible:e}})},j=A(()=>{var t,e;return(e=(t=z.value)==null?void 0:t.nodeObj)!=null&&e.style?z.value.nodeObj.style:Re(I)});function N(t,e,a){return t!==void 0?t:e!==void 0?e:a}function Oe(t,e){var u;if(!((u=z.value)!=null&&u.nodeObj))return;const a=z.value.nodeObj;a.style||(a.style={});const l=e.target,r=l.type==="number"?Number(l.value):l.value;switch(t){case"bg_color":a.style.background=r;break;case"color":a.style.color=r;break;case"font_size":a.style.fontSize=`${r}px`;break;case"font_weight":a.style.fontWeight=r;break;case"font_style":a.style.fontStyle=r;break;case"font_family":a.style.fontFamily=r;break;case"border_color":a.style.borderColor=r;break;case"border_width":a.style.borderWidth=`${r}px`;break;case"border_radius":a.style.borderRadius=`${r}px`;break;case"padding":a.style.padding=`${r}px`;break}const v=document.getElementById(a.id);v&&st(a,v)}const I={bg_color:"#ffffff",color:"#000000",font_size:14,font_weight:"normal",font_style:"normal",font_family:"Inter",border_color:"#cccccc",border_width:0,border_radius:0,padding:0},G=c(!1);async function it(){var e;const t=(e=z.value)==null?void 0:e.nodeObj;if(!(!t||G.value)){G.value=!0;try{const a=Ka(t);a._originalStyle||(a._originalStyle={});const l=a.style||{},r=a._originalStyle,v={bg_color:N(l.background,r.bg_color,I.bg_color),color:N(l.color,r.color,I.color),font_size:N(l.fontSize?parseInt(l.fontSize):void 0,r.font_size,I.font_size),font_weight:N(l.fontWeight,r.font_weight,I.font_weight),font_style:N(l.fontStyle,r.font_style,I.font_style),font_family:N(l.fontFamily,r.font_family,I.font_family),border_color:N(l.borderColor,r.border_color,I.border_color),border_width:N(l.borderWidth?parseInt(l.borderWidth):void 0,r.border_width,I.border_width),border_radius:N(l.borderRadius?parseInt(l.borderRadius):void 0,r.border_radius,I.border_radius),padding:N(l.padding?parseInt(l.padding):void 0,r.padding,I.padding),hyperLink:U.value||a.hyperLink||""};a._originalStyle={...v};const u=a.unique_name==="sheet"?{sheet_id:a.id,workspace_id:V.value,workspace_module_id:P.value,style:v}:{card_id:a.id,seat_id:a.seat_id,style:v};a.unique_name==="sheet"?await tt(u):await se.mutateAsync(u)}finally{G.value=!1}}}const ma=c([]),{isDark:Me}=Ua();function _a(t){const e={id:"root",topic:localStorage.getItem("currentName")??"",isRoot:!0,children:[],style:{},_originalStyle:{},unique_name:"root"};if(!Array.isArray(t))return e;const a={};return t.forEach(l=>{var p,s;const r=((p=l.variables)==null?void 0:p["sheet-title"])||"Untitled",v=((s=l.style)==null?void 0:s.hyperLink)||"";a[r]||(a[r]={id:l._id,topic:r,variables:l==null?void 0:l.variables,children:[],style:l==null?void 0:l.style,_originalStyle:(l==null?void 0:l.style)||{},unique_name:"sheet",hyperLink:v||""},e.children.push(a[r]));const u={id:l==null?void 0:l._id,topic:l.title,children:[],style:Re(l==null?void 0:l.style),_originalStyle:l.style||{},unique_name:"List",hyperLink:v||""};(l.cards||[]).forEach((o,g)=>{var h;const n=((h=o.style)==null?void 0:h.hyperLink)||"",b={id:o._id||`card-${g}`,seat_id:o.seat_id,topic:o["card-title"],style:Re(o.style),_originalStyle:o.style||{},children:[],unique_name:"card",hyperLink:n||""};u.children.push(b),ma.value=b}),a[r].children.push(u)}),e}const{mutateAsync:ga}=Ba({onSuccess:()=>{D.invalidateQueries({queryKey:["sheets"]}),D.invalidateQueries({queryKey:["sheet-list"]}),close()}}),ya=async t=>{try{await pt({url:"workspace/cards/group-card-order",method:"PATCH",data:t}),le(),xe(),console.log("Card reordered successfully")}catch(e){console.error("Failed to reorder card:",e)}};function nt(){var a;const t=(a=te.value)==null?void 0:a.querySelector(".mind-elixir-toolbar.rb");if(!t||t.querySelector(".open-sidebar-btn"))return;const e=document.createElement("button");e.className="open-sidebar-btn me-toolbar-btn ms-2",e.title="Open Formatting Sidebar",e.innerHTML='<i class="fa-solid fa-sidebar"></i>',e.addEventListener("click",()=>{$.value=!$.value}),t.appendChild(e)}let de=null;function xa(){var e,a;de&&(de.disconnect(),de=null);const t=(a=(e=te.value)==null?void 0:e.querySelector(".mind-elixir-toolbar.rb"))==null?void 0:a.parentElement;t&&(de=new MutationObserver(()=>{nt()}),de.observe(t,{childList:!0,subtree:!0}),nt())}Wa(()=>{f.value!=="mindmap"||!te.value||!m.value||je(()=>{var u,p;const t=_a(m.value);K.value&&((p=(u=K.value).destroy)==null||p.call(u),K.value=null);const e=new Set,a=new Set,l=new Set,r=new ve({el:te.value,theme:Me.value?ve.DARK_THEME:ve.THEME,draggable:!0,contextMenu:!0,toolBar:!0,keypress:!0,locale:"en",overflowHidden:!1,contextMenuOption:{Update:!0,extend:[{name:"Update Node",onclick:()=>{var o;$.value&&($.value=!1);const s=(o=z.value)==null?void 0:o.nodeObj;s&&O(s)}},{name:"Add Hyperlink",onclick:()=>{Ot(async()=>{await it()})}}]}});K.value=r,r.init({nodeData:t}),je(()=>{setTimeout(()=>{r.toCenter()},300)}),je(()=>{xa()}),r.bus.addListener("selectNode",s=>{s&&(z.value={nodeObj:s})}),r.bus.addListener("renderNode",s=>{!(s!=null&&s.nodeObj)||!(s!=null&&s.element)||st(s.nodeObj,s.element)});const v=s=>{let o=s;for(;o;){if(o.unique_name==="sheet")return o;o=o.parent}return null};r.bus.addListener("operation",async s=>{if(s){if(s.name==="moveNode"||s.name==="moveNodeBefore"||s.name==="moveNodeAfter"){const o=s.obj,g=s.target;if(!o||o.unique_name!=="card"||!g)return;const n=o._originalParent||o.parent;if(!n||n.unique_name!=="List")return;const b=g.unique_name==="List"?g:g.parent;if(!b||b.unique_name!=="List")return;const h=v(b);if(!h)return;const ue=b.children.findIndex(ke=>ke.id===o.id);if(ue===-1)return;o._originalParent=b,await ya({workspace_id:V.value,card_id:o.id,group_value:b.topic,group_variable_id:S.value,new_index:ue,sheet_id:h.id});return}if(s.name==="removeNode"){const o=s.obj;if(!o||!o.id||o.unique_name!=="card")return;ee.value=o.id,await Je();return}if(s.name==="addChild"||s.name==="insertSibling"){const o=s.obj;if(!o||!o.id)return;e.add(o.id);return}if(s.name==="beginEdit"){const o=s.obj;console.log("editing node",o);return}if(s.name==="finishEdit"){const o=s.obj;if(!o||!o.id)return;const g=e.has(o.id),n=a.has(o.id);if(!g&&!n||n)return;if(g){e.delete(o.id),a.add(o.id);const b=o.parent;if(!b||!("unique_name"in b)){a.delete(o.id);return}if(b.unique_name==="root"&&!l.has(o.id)){l.add(o.id);try{await ga({variables:{"sheet-title":o.topic??"New Sheet","sheet-description":"This is custom description"},is_ai_generated:!1,workspace_id:V.value,workspace_module_id:P.value})}catch(h){console.error("Error creating workspace sheet:",h),a.delete(o.id),l.delete(o.id)}return}if(b.unique_name==="List"){try{const h=ha({topic:o.topic??"New Card",id:o.id},b);h.variables&&(h.variables["card-description"]="This is a default description"),await rt(h)}catch(h){console.error("Error creating card:",h),a.delete(o.id)}return}if(b.unique_name==="sheet"){try{console.log("Creating new list under sheet...")}catch(h){console.error("Error creating list:",h),a.delete(o.id)}return}}}}})})}),F(Me,()=>{K.value&&K.value.changeTheme(Me.value?ve.DARK_THEME:ve.THEME)},{immediate:!0});function st(t,e){if(!t||!e||!t.style)return;const a=e.querySelector(".topic"),l=e.querySelector(".node")??e,r=t.style;r.background&&(l.style.background=r.background),r.color&&a&&(a.style.color=r.color),a&&(r.fontSize&&(a.style.fontSize=r.fontSize),r.fontFamily&&(a.style.fontFamily=r.fontFamily),r.fontWeight&&(a.style.fontWeight=r.fontWeight),r.fontStyle&&(a.style.fontStyle=r.fontStyle)),r.borderColor&&(l.style.borderColor=r.borderColor),r.borderWidth&&(l.style.borderWidth=r.borderWidth),r.borderRadius&&(l.style.borderRadius=r.borderRadius),r.padding&&(l.style.padding=r.padding)}function Re(t={}){return{background:t.bg_color,color:t.color,fontSize:t.font_size!=null?`${t.font_size}px`:void 0,fontWeight:t.font_weight,fontStyle:t.font_style,fontFamily:t.font_family,borderColor:t.border_color,borderWidth:t.border_width!=null?`${t.border_width}px`:void 0,borderRadius:t.border_radius!=null?`${t.border_radius}px`:void 0,padding:t.padding!=null?`${t.padding}px`:void 0,hyperLink:t.hyperLink||void 0}}function ha(t,e){const a=new Date,l=a.toISOString().split("T")[0],r=new Date(a.getTime()+3*24*60*60*1e3).toISOString().split("T")[0];return{sheet_list_id:(e==null?void 0:e.topic)||"In Progress",workspace_id:V.value,sheet_id:E.value,workspace_lane_id:(t==null?void 0:t.workspace_lane_id)||null,variables:{"card-status":(e==null?void 0:e.topic)||"In Progress","card-type":"General",priority:"medium",process:null,"card-title":t.topic||"New Card","card-description":"","start-date":l,"end-date":r},createdAt:new Date().toISOString()}}return(t,e)=>{var a,l,r,v,u,p,s,o,g;return _(),L(ze,null,[i("div",Ya,[i("div",Ja,[i("div",Xa,[C(d(Fe),{onEditOption:ra,modelValue:E.value,"onUpdate:modelValue":e[1]||(e[1]=n=>E.value=n),canEdit:d(At),canDelete:d(Lt),onDeleteOption:ta,options:Yt.value,variant:"secondary",customClasses:"fixed w-auto"},{more:Y(()=>[d(It)?(_(),L("div",{key:0,onClick:e[0]||(e[0]=n=>Kt()),class:"capitalize border-t border-border px-4 py-2 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-1 overflow-hidden overflow-ellipsis text-nowrap"},e[37]||(e[37]=[i("i",{class:"fa-solid fa-plus"},null,-1),we(" Add new ")]))):k("",!0)]),_:1},8,["modelValue","canEdit","canDelete","options"]),i("div",Za,[(f.value=="kanban",_(),M(d(Fe),{key:0,actions:!1,modelValue:S.value,"onUpdate:modelValue":e[3]||(e[3]=n=>S.value=n),options:d(q),variant:"secondary",customClasses:"fixed w-auto",onNestedSelect:zt},{more:Y(()=>[d(fe)?(_(),L("div",{key:0,onClick:e[2]||(e[2]=()=>{ae.value=!0}),class:"sticky bottom-0 bg-bg-dropdown shadow-md shadow-border capitalize border-t border-border px-4 py-2 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-1 overflow-hidden overflow-ellipsis text-nowrap"},e[38]||(e[38]=[i("i",{class:"fa-solid fa-plus"},null,-1),we(" Add new ")]))):k("",!0)]),_:1},8,["modelValue","options"])),C(d(mt),{onOnChange:e[4]||(e[4]=n=>{ie.value=n}),placeholder:"Search in Orchit AI space"}),i("div",el,[i("button",{class:R(["aspect-square cursor-pointer rounded-sm p-0 px-0.5",f.value==="kanban"?"text-accent bg-accent-text":" hover:bg-border/50 backdrop-blur-2xl  transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),title:"Kanban view",onClick:e[5]||(e[5]=n=>f.value="kanban")},e[39]||(e[39]=[i("i",{class:"fa-solid fa-chart-kanban"},null,-1)]),2),i("button",{onClick:e[6]||(e[6]=n=>f.value="table"),class:R(["aspect-square cursor-pointer rounded-sm p-0 px-0.5",f.value==="table"?"text-accent bg-accent-text":"hover:bg-border/50 backdrop-blur-2xl transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),title:"List view"},e[40]||(e[40]=[i("i",{class:"fa-solid fa-align-left"},null,-1)]),2),i("button",{onClick:e[7]||(e[7]=n=>f.value="mindmap"),class:R(["aspect-square cursor-pointer rounded-sm p-0 px-0.5",f.value==="mindmap"?"text-accent bg-accent-text":"hover:bg-border/50 backdrop-blur-2xl transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),title:"MindMap view"},e[41]||(e[41]=[i("i",{class:"fa-solid fa-chart-diagram"},null,-1)]),2),i("button",{onClick:e[8]||(e[8]=n=>f.value="calendar"),class:R(["aspect-square cursor-pointer rounded-sm p-0 px-0.5",f.value==="calendar"?"text-accent bg-accent-text":"hover:bg-border/50 backdrop-blur-2xl transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),title:"Calendar view"},e[42]||(e[42]=[i("i",{class:"fa-regular fa-calendar"},null,-1)]),2),i("button",{onClick:e[9]||(e[9]=n=>f.value="gantt"),class:R(["aspect-square cursor-pointer rounded-sm p-0 px-0.5",f.value==="gantt"?"text-accent bg-accent-text":"hover:bg-border/50 backdrop-blur-2xl transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),title:"Gantt Chart view"},e[43]||(e[43]=[i("i",{class:"fa-solid fa-chart-gantt"},null,-1)]),2),i("button",{onClick:e[10]||(e[10]=n=>f.value="timeline"),class:R(["aspect-square cursor-pointer rounded-sm p-0 px-0.5",f.value==="timeline"?"text-accent bg-accent-text":"hover:bg-border/50 backdrop-blur-2xl transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),title:"Timeline view"},e[44]||(e[44]=[i("i",{class:"fa-solid fa-timeline"},null,-1)]),2)])])])]),f.value=="kanban"?(_(),L(ze,{key:0},[Ue(C(d(_t),null,null,512),[[ut,d(Ie)||d(Xe)]]),Ue(i("div",tl,[C(d(Dt),{onOnPlus:ea,board:ne.value,"onDelete:column":e[11]||(e[11]=n=>Zt(n)),"onUpdate:column":e[12]||(e[12]=n=>Jt(n)),onReorder:Qt,onAddColumn:et,"onSelect:ticket":O,onOnBoardUpdate:Gt,variable_id:S.value,sheet_id:E.value},{"column-footer":Y(n=>{var b,h,ue,ke,dt;return[(h=(b=d(ye))==null?void 0:b.transitions)!=null&&h.all_allowed&&!((dt=(ke=(ue=d(ye))==null?void 0:ue.transitions)==null?void 0:ke.all_allowed)!=null&&dt.includes(n.column.title))&&d(ye).transitions.currentColumn!=n.column.title?(_(),L("div",al," Disbale ( you can't drop here ) ")):k("",!0)]}),ticket:Y(({ticket:n})=>[C(d(gt),{selectedVar:S.value,onSelect:()=>{O(n)},ticket:n},null,8,["selectedVar","onSelect","ticket"])]),_:1},8,["board","variable_id","sheet_id"]),i("div",{class:"min-w-[270px] sm:min-w-[328px]",onClick:e[14]||(e[14]=ce(()=>{},["stop"]))},[oe.value?(_(),L("div",ll,[C(d(pe),{autofocus:!0,modelValue:H.value,"onUpdate:modelValue":e[13]||(e[13]=n=>H.value=n),placeholder:"Add New list",onKeyup:ct(he,["enter"])},null,8,["modelValue"]),e[45]||(e[45]=i("p",{class:"text-xs mt-1.5"},"You can add details while editing",-1)),i("div",rl,[C(d(Ke),{onClick:he,varaint:"primary",class:"px-3 py-1 bg-accent cursor-pointer text-white rounded"},{default:Y(()=>[we(Be(d(Ae)?"Adding...":"Add list"),1)]),_:1}),i("i",{class:"fa-solid fa-close",onClick:Ne})])])):(_(),L("button",{key:1,disabled:!d(fe),class:R(["text-sm text-text-primary py-2.5 font-medium flex items-center justify-center w-full gap-2 bg-bg-body rounded-lg",d(fe)?"cursor-pointer":"cursor-not-allowed"]),onClick:ce(Ne,["stop"])}," + Add List ",10,ol))])],512),[[ut,!d(Ie)&&!d(Xe)]])],64)):k("",!0),f.value=="table"?(_(),M(d(yt),{key:1,onToggleVisibility:ba,onAddVar:e[15]||(e[15]=()=>{ae.value=!0}),isPending:d(Ie)||d(jt),columns:ia.value,rows:ne.value,canCreate:d(Nt),canCreateVariable:d(fe),canDelete:d(Pt),onDelete:e[16]||(e[16]=n=>{X.value=n,ee.value=n._id,Z.value=!0}),onCreate:ca},null,8,["isPending","columns","rows","canCreate","canCreateVariable","canDelete"])):k("",!0),f.value==="mindmap"?(_(),L(ze,{key:2},[i("div",il,[i("div",{ref_key:"mindMapRef",ref:te,class:"flex-1 h-full overflow-hidden rounded-md relative",style:{height:"600px",width:"100%"}},null,512),$.value?(_(),L("div",nl,[i("div",sl,[e[47]||(e[47]=i("h3",{class:"text-sm font-semibold text-secondary"},"Format Node",-1)),i("button",{onClick:e[17]||(e[17]=n=>$.value=!1),class:"text-gray-400 hover:text-gray-700"},e[46]||(e[46]=[i("i",{class:"fa-solid fa-times"},null,-1)]))]),i("div",dl,[i("div",null,[e[50]||(e[50]=i("h4",{class:"text-xs font-semibold text-secondary uppercase mb-3"}," Colors ",-1)),i("div",ul,[e[48]||(e[48]=i("label",{class:"block text-xs text-secondary mb-1"},"Background",-1)),i("div",cl,[i("div",{class:"h-10 w-10 rounded-md border cursor-pointer relative",style:vt({backgroundColor:j.value.background})},[i("input",{type:"color",value:j.value.background,class:"absolute inset-0 opacity-0 cursor-pointer",onInput:e[18]||(e[18]=n=>Oe("bg_color",n)),style:{"pointer-events":"all"}},null,40,vl)],4),C(d(pe),{modelValue:j.value.background,placeholder:"#3b82f6",class:"flex-1",readonly:""},null,8,["modelValue"])])]),i("div",pl,[e[49]||(e[49]=i("label",{class:"block text-xs text-secondary mb-1"},"Text",-1)),i("div",fl,[i("div",{class:"h-10 w-10 rounded-md border cursor-pointer relative",style:vt({backgroundColor:j.value.color})},[i("input",{type:"color",value:j.value.color,class:"absolute inset-0 opacity-0 cursor-pointer",onInput:e[19]||(e[19]=n=>Oe("color",n)),style:{"pointer-events":"all"}},null,40,bl)],4),C(d(pe),{modelValue:j.value.color,placeholder:"#3b82f6",class:"flex-1",readonly:""},null,8,["modelValue"])])])]),i("div",null,[i("div",ml,[i("div",null,[e[52]||(e[52]=i("label",{class:"block text-xs text-secondary mb-1"},"Weight",-1)),i("select",{class:"w-full h-8 border rounded px-2 text-sm",value:j.value.fontWeight,onChange:e[20]||(e[20]=n=>Oe("font_weight",n))},e[51]||(e[51]=[i("option",{value:"lighter"},"Light",-1),i("option",{value:"normal"},"Normal",-1),i("option",{value:"bold"},"Bold",-1),i("option",{value:"bolder"},"Extra Bold",-1)]),40,_l)])])])]),i("div",gl,[i("button",{class:"w-full cursor-pointer bg-gradient-to-tr from-accent to-accent-hover text-white flex items-center justify-center gap-2 px-4 py-2 rounded-md text-sm font-medium hover:shadow-md disabled:opacity-60",disabled:G.value,onClick:it},[G.value?(_(),L("span",xl)):k("",!0),i("span",null,Be(G.value?"Updating...":"Update"),1)],8,yl)])])):k("",!0)]),_e.value?(_(),L("div",hl,[i("div",kl,[e[53]||(e[53]=i("h3",{class:"text-lg font-semibold mb-4"},"Insert Web Link",-1)),Ue(i("input",{"onUpdate:modelValue":e[21]||(e[21]=n=>U.value=n),type:"text",placeholder:"Enter or paste a URL",class:"w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[ja,U.value]]),i("div",wl,[i("button",{onClick:Rt,class:"px-4 py-2 rounded-md bg-gray-200 hover:bg-gray-300"}," Cancel "),i("button",{disabled:!U.value,onClick:Mt,class:R(["px-4 py-2 rounded-md text-white",U.value?"bg-blue-500 hover:bg-blue-600":"bg-blue-300 cursor-not-allowed"])}," Insert ",10,Cl)])])])):k("",!0),oe.value?(_(),L("div",{key:1,class:"absolute top-40 left-70 bg-bg-body rounded-lg p-4 shadow-lg z-100 min-w-[328px] border",onClick:e[23]||(e[23]=ce(()=>{},["stop"]))},[C(d(pe),{autofocus:!0,modelValue:H.value,"onUpdate:modelValue":e[22]||(e[22]=n=>H.value=n),placeholder:"Add New list",onKeyup:ct(he,["enter"])},null,8,["modelValue"]),e[54]||(e[54]=i("p",{class:"text-xs mt-1.5"},"You can add details while editing",-1)),i("div",Sl,[C(d(Ke),{onClick:he,varaint:"primary",class:"px-3 py-1 bg-accent cursor-pointer text-white rounded"},{default:Y(()=>[we(Be(d(Ae)?"Adding...":"Add list"),1)]),_:1}),i("i",{class:"fa-solid fa-close cursor-pointer",onClick:Ne})])])):k("",!0)],64)):k("",!0),f.value==="calendar"?(_(),M(d(kt),{key:3,data:ne.value,"onSelect:ticket":O},null,8,["data"])):k("",!0),f.value==="gantt"?(_(),M(d(wt),{key:4,data:ne.value,"onSelect:ticket":O},null,8,["data"])):k("",!0),f.value==="timeline"?(_(),M(d(Ct),{key:5,data:ne.value,"onSelect:ticket":O},null,8,["data"])):k("",!0)]),C(d(Ce),{onClick:e[24]||(e[24]=ce(()=>{},["stop"])),modelValue:Q.value,"onUpdate:modelValue":e[25]||(e[25]=n=>Q.value=n),title:"Delete List",itemLabel:"list",itemName:(a=B.value)==null?void 0:a.title,requireMatchText:(l=B.value)==null?void 0:l.title,confirmText:"Delete List",cancelText:"Cancel",size:"md",loading:d(Ae),onConfirm:Xt,onCancel:e[26]||(e[26]=()=>{Q.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),me.value?(_(),M(d(St),{selectedVariable:S.value,listId:(r=B.value)==null?void 0:r.title,sheet_id:E.value,key:"createTaskModalKey",modelValue:me.value,"onUpdate:modelValue":e[27]||(e[27]=n=>me.value=n),onSubmit:e[28]||(e[28]=()=>{})},null,8,["selectedVariable","listId","sheet_id","modelValue"])):k("",!0),(v=w.value)!=null&&v._id?(_(),M(d(Et),{key:1,details:w.value,onClose:e[29]||(e[29]=()=>{O({variables:{}})}),onCloseSidePanel:Ft,showPanel:!!((u=w.value)!=null&&u._id)},null,8,["details","showPanel"])):k("",!0),C(d(Tt),{size:"md",sheet:W.value,modelValue:re.value,"onUpdate:modelValue":e[30]||(e[30]=n=>re.value=n)},null,8,["sheet","modelValue"]),ae.value?(_(),M(d(Vt),{key:2,modelValue:ae.value,"onUpdate:modelValue":e[31]||(e[31]=n=>ae.value=n),sheetID:E.value},null,8,["modelValue","sheetID"])):k("",!0),C(d(Ce),{onClick:e[32]||(e[32]=ce(()=>{},["stop"])),modelValue:J.value,"onUpdate:modelValue":e[33]||(e[33]=n=>J.value=n),title:"Delete Sheet",itemLabel:"Sheet",itemName:(p=W.value)==null?void 0:p.title,requireMatchText:(s=W.value)==null?void 0:s.title,confirmText:"Delete Sheet",cancelText:"Cancel",size:"md",loading:d(aa),onConfirm:la,onCancel:e[34]||(e[34]=()=>{J.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),C(d(Ce),{modelValue:Z.value,"onUpdate:modelValue":e[35]||(e[35]=n=>Z.value=n),title:"Delete Ticket",itemLabel:"Ticket",itemName:(o=X.value)==null?void 0:o.title,requireMatchText:(g=X.value)==null?void 0:g.title,confirmText:"Delete Ticket",cancelText:"Cancel",size:"md",loading:Se.value,onConfirm:Bt,onCancel:e[36]||(e[36]=()=>{Z.value=!1,X.value=null})},null,8,["modelValue","itemName","requireMatchText","loading"]),e[55]||(e[55]=i("div",null,null,-1))],64)}}}),Pl=Ha(Tl,[["__scopeId","data-v-aa346af3"]]);export{Pl as default};
