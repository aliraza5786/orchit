const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CreateTaskModal-Bp7hpigC.js","assets/CreateTaskModal.vue_vue_type_script_setup_true_lang-CN0kvOWE.js","assets/index-CT_3ZLGv.js","assets/index-BP-tUf8i.css","assets/CreateSheetModal-CcS7UZjJ.js","assets/IconPicker-Dl6V-Qml.js","assets/IconPicker-CIMr_3tu.css","assets/AudioRecorder.vue_vue_type_script_setup_true_lang-8MFvlaT6.js","assets/CreateSheetModal--7RYCgy-.css","assets/CreateVariableModal-DoRtLGRM.js","assets/ConfirmDeleteModal-DAOQDODa.js","assets/ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-GWqcpFzg.js","assets/SidePanel-BPdHZA13.js","assets/SidePanel-U7OOMI6M.css","assets/KanbanBoard-NBPLrL5g.js","assets/vuedraggable.umd-BuQpOzqt.js","assets/_commonjsHelpers-_d1bhYXs.js","assets/DropMenu.vue_vue_type_script_setup_true_lang-BXb1xPxI.js","assets/KanbanBoard-Dffh696C.css"])))=>i.map(i=>d[i]);
import{d as ca,W as va,r as d,M as pa,N as fa,c as T,a2 as ba,n as O,a0 as ma,a6 as ga,u as ya,ar as _a,a7 as xa,a8 as ka,a9 as ha,a1 as wa,ac as k,Z as Ca,ad as Sa,Q as Ta,ab as Da,a3 as Va,aa as Ea,V as Aa,ae as La,af as Na,j as _,f as n,i as C,e as I,k as y,w as G,p as u,z as q,F as ce,D as Ue,E as ot,h as ve,ah as nt,_ as rt,B as it,ag as De,t as pe,y as st,P as Fa,q as Ia,ai as dt,aj as qa,o as c,g as Ve,ak as Y,A as J,T as ut,U as ct,bn as Ma,al as vt,J as Pa}from"./index-CT_3ZLGv.js";import{D as pt}from"./Dropdown-Bq5sD82s.js";import{_ as za}from"./SearchBar.vue_vue_type_script_setup_true_lang-CfHjCEjs.js";import{K as Ba}from"./KanbanSkeleton-qwRKVfs7.js";import{K as $a}from"./KanbanTicket-CA1yD0vS.js";import{F as ft}from"./fuse-Ch1WBRTM.js";import{l as Oa}from"./lodash-CQYOKM_D.js";import{_ as bt,a as Ra,b as Ua,C as Wa,c as Ka,d as ja,k as fe}from"./TimelineView-C8AHE3fR.js";import"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-GWqcpFzg.js";import"./DropMenu.vue_vue_type_script_setup_true_lang-BXb1xPxI.js";import"./_commonjsHelpers-_d1bhYXs.js";const Ha={class:"flex-auto bg-gradient-to-b from-bg-card/95 to-bg-card/90 backdrop-blur rounded-[6px] shadow-[0_10px_40px_-10px_rgba(0,0,0,.5)] flex-grow h-full bg-bg-card border border-border overflow-x-auto flex-col flex scrollbar-visible"},Qa={class:"overflow-x-auto shrink-0 sticky top-0 z-20 bg-bg-card"},Ga={class:"header px-4 py-3 border-b border-border flex items-center justify-between gap-1 min-w-max h-full"},Ya={class:"flex gap-3 items-center"},Ja={class:"flex items-center gap-3 bg-bg-surface/50 h-[32px] px-2 rounded-md"},Za={class:"flex overflow-x-auto gap-3 p-4 scrollbar-visible h-full"},Xa={key:0,class:"mx-auto text-text-secondary/80 m-2 w-[90%] h-full justify-center flex items-center border border-dashed border-border"},el={key:0,class:"bg-bg-body rounded-lg p-4"},tl={class:"flex items-center mt-3 gap-3"},al=["disabled"],ll={class:"relative w-full h-full flex overflow-hidden"},ol={key:0,class:"format-sidebar h-full py-4 px-4 w-[320px] border-l bg-bg-card overflow-x-hidden overflow-y-auto flex flex-col"},nl={class:"flex items-center justify-between pb-3 mb-4 border-b"},rl={class:"format-content space-y-6"},il={class:"format-group relative mb-3"},sl={class:"text-xs text-secondary"},dl={key:0,class:"absolute z-50 mt-2 p-3 bg-bg-card rounded-lg shadow-lg border w-[240px]"},ul={class:"grid grid-cols-10 gap-1 mb-3"},cl=["onClick"],vl={class:"flex items-center gap-2"},pl=["value"],fl=["value"],bl={class:"format-group relative mb-3"},ml={class:"text-xs text-secondary"},gl={key:0,class:"absolute z-50 mt-2 p-3 bg-bg-card rounded-lg shadow-lg border w-[240px]"},yl={class:"grid grid-cols-10 gap-1 mb-3"},_l=["onClick"],xl={class:"flex items-center gap-2"},kl=["value"],hl=["value"],wl={class:"grid grid-cols-1 gap-3"},Cl=["value"],Sl={class:"mt-6 pt-4"},Tl=["disabled"],Dl={key:0,class:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},Vl={key:0,class:"fixed inset-0 bg-black/30 flex items-center justify-center"},El={class:"bg-white p-6 rounded-xl w-80"},Al={class:"flex justify-end gap-2 mt-4"},Ll=["disabled"],Nl={class:"flex items-center mt-3 gap-3"},Fl=ca({__name:"Product",setup(Il){const{canEditSheet:mt,canDeleteSheet:gt,canCreateVariable:be,canCreateSheet:yt,canCreateCard:_t,canEditCard:me,canAssignCard:xt}=va(),Z=d(!1),ge=d(null),ye=d(!1),_e=d(null),Ee=d(!1),p=d("kanban"),X=d(null),R=d(null),ee=d(!1),We=Ia(),{workspaceId:h,moduleId:A}=pa(),M=fa(),xe=d(!1),te=d(),P=d(null),U=d(!1),ke=d(!1),z=d(""),Ae=d(null);function kt(t){z.value="",ke.value=!0,Ae.value=t}function ht(){Ae.value&&Ae.value(z.value),ke.value=!1}function wt(){ke.value=!1}const Le=d(null),Ct=t=>{Le.value=t},St=T(()=>{var t;return(t=L.value)==null?void 0:t.find(e=>e._id===x.value)}),W=d(!1),Ke=["#FFFFFF","#F2F2F2","#D9D9D9","#BFBFBF","#A6A6A6","#808080","#404040","#000000","#FFE066","#FF9AA2","#8EE4AF","#00EAD3","#90DBF4","#4D96FF","#6C63FF","#C77DFF","#F7A1C4","#FFC300","#FF5733","#2ECC71","#00B894","#17A2B8","#0984E3","#3F51B5","#9C27B0","#E84393","#FF8C00","#E74C3C","#1E8449","#006D6F","#004C6D","#0057A8","#1A237E","#4A148C","#7D3C98"],K=d(!1);O(W,t=>{t&&(K.value=!1)}),O(K,t=>{t&&(W.value=!1)});const je=async()=>{if(_e.value)try{Ee.value=!0,await ut({url:`workspace/card/${_e.value}`,method:"DELETE"}),Dt(_e.value),ye.value=!1,ge.value=null,ct.success("Ticket deleted successfully"),await ae(),await Ce()}catch(t){ct.error(Ma(t))}finally{Ee.value=!1}},Tt=async()=>{await je()},Dt=t=>{var e,a;(a=(e=m.value)==null?void 0:e.sheets)==null||a.forEach(l=>{var o;(o=l.sheet_lists)==null||o.forEach(v=>{v.cards=v.cards.filter(f=>f._id!==t)})})},Vt=Y(()=>J(()=>import("./CreateTaskModal-Bp7hpigC.js"),__vite__mapDeps([0,1,2,3]))),Et=Y(()=>J(()=>import("./CreateSheetModal-CcS7UZjJ.js"),__vite__mapDeps([4,2,3,5,6,7,8]))),At=Y(()=>J(()=>import("./CreateVariableModal-DoRtLGRM.js"),__vite__mapDeps([9,2,3]))),Ne=Y(()=>J(()=>import("./ConfirmDeleteModal-DAOQDODa.js"),__vite__mapDeps([10,11,2,3]))),Lt=Y(()=>J(()=>import("./SidePanel-BPdHZA13.js"),__vite__mapDeps([12,2,3,13]))),Nt=Y(()=>J(()=>import("./KanbanBoard-NBPLrL5g.js"),__vite__mapDeps([14,15,16,2,3,17,11,18]))),{data:he,refetch:ae,isPending:He}=ma({workspace_id:h,workspace_module_id:A}),Fe=T(()=>{var t;return he.value?(t=he.value[0])==null?void 0:t._id:""}),w=d(Fe.value),{data:L,isPending:Ft}=ba(h.value,A.value,w),{mutate:Ie,isPending:qe}=ga({onSuccess:()=>{M.invalidateQueries({queryKey:["sheet-list"]}),j.value="",H.value=!1,oe.value=!1,H.value=!1}}),Qe=T(()=>{var t;return((t=St.value)==null?void 0:t.title)==="Process"&&Le.value?{variable_slug:"card-type",type_value:Le.value.title}:{}}),Ge=t=>{const e={workspace_id:h.value,module_id:A.value,variable_id:x.value,value:t,...Qe.value};Ie(e)};O(Fe,()=>{w.value=Fe.value});const Me=T(()=>{var t;return L!=null&&L.value?(t=L==null?void 0:L.value[0])==null?void 0:t._id:""}),x=d(Me.value);O(Me,()=>{x.value=Me.value});const we=ya(),{data:m,isPending:Pe,refetch:Ce}=_a(A,w,T(()=>[...we.selectedLaneIds]),x,Qe),F=t=>{t._id||(t._id=t.id),te.value=t};window.selectCardHandler=F;const le=d(!1),It=()=>{$.value={},le.value=!le.value},qt=xa(),Mt=ka();function Pt(t){t.type==="column"?qt.mutate({payload:{workspace_id:h.value,workspace_module_id:A.value,variable_id:x.value,moved_value:t.meta.id,new_index:t.meta.newIndex}},{onSuccess:()=>{ae(),Ce()}}):Mt.mutate({payload:{workspace_id:h.value,card_id:t.meta.moved._id,group_value:t.meta.fromColumnId,group_variable_id:x.value,new_index:t.meta.newIndex,sheet_id:w.value}},{onSuccess:()=>{ae(),Ce()}})}const zt=t=>{},Bt=T(()=>(he.value||[]).map(t=>({_id:t._id,title:t==null?void 0:t.variables["sheet-title"],description:t==null?void 0:t.variables["sheet-description"],icon:t.icon,status:t==null?void 0:t.generation_status})));O(he,t=>{var e;(t==null?void 0:t.length)>0&&(w.value=(e=t[0])==null?void 0:e._id)});const oe=d(!1),j=d("");function ze(){oe.value=!oe.value}function Se(){const t=j.value.trim();t&&Ge(t)}const $t=t=>{Ie({workspace_id:We.params.id,module_id:We.params.module_id,new_value:t.title,value:t.oldTitle,variable_id:x.value})},H=d(!1),B=d(),Ot=()=>{Ie({value:B.value.title,workspace_id:h.value,module_id:A.value,newValue:B.value.title,variable_id:x.value,is_trash:!0})},Rt=t=>{H.value=!0,B.value=t},Ut=t=>{xe.value=!0,B.value=t},$=d();function Wt(t){Z.value=!0,$.value=t}const{mutate:Ye,isPending:Kt}=ha({onSuccess:()=>{ae(),Z.value=!1}});function jt(){var t;Ye({sheet_id:(t=$.value)==null?void 0:t._id,workspace_module_id:A.value,is_trash:!0})}function Ht(t){le.value=!0,$.value=t}const ne=d(""),Qt=d("");O(ne,Oa.debounce(t=>{Qt.value=t},200));const Gt=T(()=>{const t=m.value.flatMap(e=>e.cards.map(a=>({...a,columnId:e.title})));return new ft(t,{keys:["card-title","card-description"],threshold:.3})}),re=T(()=>{var t;if(p.value==="kanban"){if(!ne.value)return m.value;const e=Gt.value.search(ne.value).map(a=>a.item);return m.value.map(a=>({...a,cards:e.filter(l=>l.columnId===a.title)}))}else{const e=(t=ne.value)==null?void 0:t.trim();if(!e){let l=[];return(m.value??[]).forEach(o=>{l=[...l,...o==null?void 0:o.cards]}),l}return new ft(Zt.value,{keys:["card-title","card-description"],threshold:.3}).search(e).map(l=>l.item)}}),{data:Be}=wa(h),Je=T(()=>((Be==null?void 0:Be.value)??[]).map(t=>{var e;return{_id:t._id,title:((e=t==null?void 0:t.variables)==null?void 0:e["lane-title"])??String(t._id)}})),Yt=T(()=>{var t;return[{key:"card-title",label:"Title",render:({row:e,value:a})=>k("div",{class:"flex items-center gap-1 w-full"},[k("a",{onClick:()=>te.value=e,class:"text-[12px] underline text-blue-500 shrink-0 overflow-ellipsis cursor-pointer"},e["card-code"]),k("div",{class:"flex-1 min-w-0"},[k("input",{onFocusout:l=>{var o;Xe(e==null?void 0:e._id,"card-title",(o=l==null?void 0:l.target)==null?void 0:o.value)},class:"text-[12px] w-full overflow-ellipsis capitalize p-1 w-full p-1 focus:border border-accent/60 rounded-sm focus:outline-none focus:ring-1 focus:ring-accent bg-transparent focus:bg-bg-body text-[12px] h-8",defaultValue:a,disabled:!me.value})])])},{key:"end-date",label:"Due Date",render:({row:e,value:a})=>{const l=d(a);return k(Ca,{class:" capitalize flex items-center gap-2 text-[12px]",placeholder:"Set start date",tableInputClass:!0,modelValue:l.value,disabled:!me.value,"onUpdate:modelValue":o=>ta(e==null?void 0:e._id,o),emptyText:"Date"})}},{key:"lane",label:"Lane",render:({row:e})=>{var a;return k(bt,{options:Je.value??[],placeholder:"Select lane",modelValue:((a=e.lane)==null?void 0:a._id)||null,disabled:!me.value,"onUpdate:modelValue":l=>aa(e==null?void 0:e._id,l),displayField:"title",emptyText:"Lane"})}},{key:"created_by",label:"Owner",render:({value:e})=>k("div",{class:"capitalize flex items-center gap-2  px-3"},[k("div",{class:" rounded-full  "},[e!=null&&e.u_profile_image?k("img",{class:"w-6 h-6 rounded-full",src:e==null?void 0:e.u_profile_image}):k("div",{class:"w-5 h-5 rounded-full flex justify-center items-center text-[11px] ",style:`background:${e!=null&&e.u_full_name?Sa({name:e.u_full_name,email:e.u_email}):""}`},Ta(e==null?void 0:e.u_full_name))]),k("span",{class:"text-[12px]"},e?e==null?void 0:e.u_full_name:"")])},{key:"seat",label:"Assignee",render:({row:e,value:a})=>k(Ra,{class:"capitalize flex items-center gap-2 ",onAssign:l=>Jt(e==null?void 0:e._id,l),assigneeId:a,seat:a,name:!0,disabled:!xt.value,emptyText:"Assignee"})},...((t=L.value)==null?void 0:t.filter(e=>{var a;return((a=e==null?void 0:e.type)==null?void 0:a.title)==="Select"}).map(e=>({key:e==null?void 0:e.slug,label:e==null?void 0:e.slug,render:({row:a,value:l})=>{var v;let o=l;if(Array.isArray(a==null?void 0:a.variables)){const f=a.variables.find(E=>E.slug===e.slug);f&&(o=f.value)}else o=((v=a==null?void 0:a.variables)==null?void 0:v[e.slug])??(a==null?void 0:a[e.slug])??l;return k("div",{class:"capitalize flex items-center gap-2"},[k(bt,{options:Xt(e.data??[]),modelValue:o,disabled:!me.value,emptyText:e.slug,"onUpdate:modelValue":f=>{Xe(a==null?void 0:a._id,e.slug,f)},columnName:e.slug})])},visible:e==null?void 0:e.is_visible})))??[]]}),Jt=(t,e)=>{$e(t,a=>{a.seat=e}),ie.mutate({card_id:t,seat_id:e==null?void 0:e._id})},Zt=T(()=>{let t=[];return(m.value??[]).forEach(e=>{t=[...t,...e==null?void 0:e.cards]}),t}),Xt=t=>t.map(e=>({_id:e.value??e,title:e.value??e})),ie=Da({onSuccess:()=>{M.invalidateQueries({queryKey:["get-sheets"]}),M.invalidateQueries({queryKey:["sheet-list"]}),M.invalidateQueries({queryKey:["roles"]})}}),$e=(t,e)=>{if(!m.value)return;const a=m.value.findIndex(l=>l.cards.some(o=>o._id===t));if(a!==-1){const l=m.value[a].cards.findIndex(o=>o._id===t);if(l!==-1){const o={...m.value[a].cards[l]};e(o),m.value[a].cards[l]=o,dt(m)}}},{mutate:Ze}=Va({onSuccess:()=>{M.invalidateQueries({queryKey:["sheet-list"]})}});function Xe(t,e,a){$e(t,l=>{if(e==="card-title"&&(l[e]=a),Array.isArray(l.variables)){const o=l.variables.find(v=>v.slug===e);o?o.value=a:l.variables.push({slug:e,value:a,type:"Select"})}else l.variables&&typeof l.variables=="object"?l.variables[e]=a:l[e]=a}),ie.mutate({card_id:t,variables:{[e]:a.trim()}})}function ea(t){if(t["card-title"]){const e={sheet_list_id:"To Do",workspace_id:h.value,sheet_id:w.value,variables:{"card-title":t["card-title"].trim()},createdAt:new Date().toISOString()};Ze(e)}}const ta=(t,e)=>{const a=m.value.findIndex(l=>l.cards.some(o=>o._id===t));if(a!==-1){const l=m.value[a].cards.findIndex(o=>o._id===t);l!==-1&&(m.value[a].cards[l]["end-date"]=e)}ie.mutate({card_id:t,variables:{"start-date":e}})};function aa(t,e){$e(t,a=>{const l=Je.value.find(o=>o._id===e);l&&(a.lane=l)}),dt(m),ie.mutate({card_id:t,workspace_lane_id:e})}const{mutate:la}=Ea(),oa=(t,e)=>{la({payload:{sheet_id:w.value,workspace_id:h.value,variable_slug:t,is_visible:e}})},N=T(()=>{var t,e;return(e=(t=P.value)==null?void 0:t.nodeObj)!=null&&e.style?P.value.nodeObj.style:Re(D)});function V(t,e,a){return t!==void 0?t:e!==void 0?e:a}function se(t,e){var f;if(!((f=P.value)!=null&&f.nodeObj))return;const a=P.value.nodeObj;a.style||(a.style={});const l=e.target,o=l.type==="number"?Number(l.value):l.value;switch(t){case"bg_color":a.style.background=o;break;case"color":a.style.color=o;break;case"font_size":a.style.fontSize=`${o}px`;break;case"font_weight":a.style.fontWeight=o;break;case"font_style":a.style.fontStyle=o;break;case"font_family":a.style.fontFamily=o;break;case"border_color":a.style.borderColor=o;break;case"border_width":a.style.borderWidth=`${o}px`;break;case"border_radius":a.style.borderRadius=`${o}px`;break;case"padding":a.style.padding=`${o}px`;break}const v=document.getElementById(a.id);v&&at(a,v)}const D={bg_color:"#ffffff",color:"#000000",font_size:14,font_weight:"normal",font_style:"normal",font_family:"Inter",border_color:"#cccccc",border_width:0,border_radius:0,padding:0},Q=d(!1);async function et(){var e;const t=(e=P.value)==null?void 0:e.nodeObj;if(!(!t||Q.value)){Q.value=!0;try{const a=qa(t);a._originalStyle||(a._originalStyle={});const l=a.style||{},o=a._originalStyle,v={bg_color:V(l.background,o.bg_color,D.bg_color),color:V(l.color,o.color,D.color),font_size:V(l.fontSize?parseInt(l.fontSize):void 0,o.font_size,D.font_size),font_weight:V(l.fontWeight,o.font_weight,D.font_weight),font_style:V(l.fontStyle,o.font_style,D.font_style),font_family:V(l.fontFamily,o.font_family,D.font_family),border_color:V(l.borderColor,o.border_color,D.border_color),border_width:V(l.borderWidth?parseInt(l.borderWidth):void 0,o.border_width,D.border_width),border_radius:V(l.borderRadius?parseInt(l.borderRadius):void 0,o.border_radius,D.border_radius),padding:V(l.padding?parseInt(l.padding):void 0,o.padding,D.padding),hyperLink:z.value||a.hyperLink||""};a._originalStyle={...v};const f=a.unique_name==="sheet"?{sheet_id:a.id,workspace_id:h.value,workspace_module_id:A.value,style:v}:{card_id:a.id,seat_id:a.seat_id,style:v};a.unique_name==="sheet"?await Ye(f):await ie.mutateAsync(f)}finally{Q.value=!1}}}const na=d([]),{isDark:Oe}=Aa();function ra(t){const e={id:"root",topic:localStorage.getItem("currentName")??"",isRoot:!0,children:[],style:{},_originalStyle:{},unique_name:"root"};if(!Array.isArray(t))return e;const a={};return t.forEach(l=>{var E,s;const o=((E=l.variables)==null?void 0:E["sheet-title"])||"Untitled",v=((s=l.style)==null?void 0:s.hyperLink)||"";a[o]||(a[o]={id:l._id,topic:o,variables:l==null?void 0:l.variables,children:[],style:l==null?void 0:l.style,_originalStyle:(l==null?void 0:l.style)||{},unique_name:"sheet",hyperLink:v||""},e.children.push(a[o]));const f={id:l==null?void 0:l._id,topic:l.title,children:[],style:Re(l==null?void 0:l.style),_originalStyle:l.style||{},unique_name:"List",hyperLink:v||""};(l.cards||[]).forEach((i,S)=>{var g;const r=((g=i.style)==null?void 0:g.hyperLink)||"",b={id:i._id||`card-${S}`,seat_id:i.seat_id,topic:i["card-title"],style:Re(i.style),_originalStyle:i.style||{},children:[],unique_name:"card",hyperLink:r||""};f.children.push(b),na.value=b}),a[o].children.push(f)}),e}const{mutateAsync:ia}=La({onSuccess:()=>{M.invalidateQueries({queryKey:["sheets"]}),M.invalidateQueries({queryKey:["sheet-list"]}),close()}}),sa=async t=>{try{await ut({url:"workspace/cards/group-card-order",method:"PATCH",data:t}),ae(),Ce(),console.log("Card reordered successfully")}catch(e){console.error("Failed to reorder card:",e)}};function tt(){var a;const t=(a=X.value)==null?void 0:a.querySelector(".mind-elixir-toolbar.rb");if(!t||t.querySelector(".open-sidebar-btn"))return;const e=document.createElement("button");e.className="open-sidebar-btn me-toolbar-btn ms-2",e.title="Open Formatting Sidebar",e.innerHTML='<i class="fa-solid fa-sidebar"></i>',e.addEventListener("click",()=>{U.value=!U.value}),t.appendChild(e)}let de=null;function da(){var e,a;de&&(de.disconnect(),de=null);const t=(a=(e=X.value)==null?void 0:e.querySelector(".mind-elixir-toolbar.rb"))==null?void 0:a.parentElement;t&&(de=new MutationObserver(()=>{tt()}),de.observe(t,{childList:!0,subtree:!0}),tt())}Na(()=>{p.value!=="mindmap"||!X.value||!m.value||vt(()=>{var f,E;const t=ra(m.value);R.value&&((E=(f=R.value).destroy)==null||E.call(f),R.value=null);const e=new Set,a=new Set,l=new Set,o=new fe({el:X.value,theme:Oe.value?fe.DARK_THEME:fe.THEME,draggable:!0,contextMenu:!0,toolBar:!0,keypress:!0,locale:"en",overflowHidden:!1,contextMenuOption:{Update:!0,extend:[{name:"Update Node",onclick:()=>{var i;U.value&&(U.value=!1);const s=(i=P.value)==null?void 0:i.nodeObj;s&&F(s)}},{name:"Add Hyperlink",onclick:()=>{kt(async()=>{await et()})}}]}});R.value=o,o.init({nodeData:t}),setTimeout(()=>{o.toCenter()},100),vt(()=>{da()}),o.bus.addListener("selectNode",s=>{s&&(P.value={nodeObj:s})}),o.bus.addListener("renderNode",s=>{!(s!=null&&s.nodeObj)||!(s!=null&&s.element)||at(s.nodeObj,s.element)});const v=s=>{let i=s;for(;i;){if(i.unique_name==="sheet")return i;i=i.parent}return null};o.bus.addListener("operation",async s=>{if(s){if(s.name==="moveNode"||s.name==="moveNodeBefore"||s.name==="moveNodeAfter"){const i=s.obj,S=s.target;if(!i||i.unique_name!=="card"||!S)return;const r=i._originalParent||i.parent;if(!r||r.unique_name!=="List")return;const b=S.unique_name==="List"?S:S.parent;if(!b||b.unique_name!=="List")return;const g=v(b);if(!g)return;const ue=b.children.findIndex(Te=>Te.id===i.id);if(ue===-1)return;i._originalParent=b,await sa({workspace_id:h.value,card_id:i.id,group_value:b.topic,group_variable_id:x.value,new_index:ue,sheet_id:g.id});return}if(s.name==="removeNode"){const i=s.obj;if(!i||!i.id||i.unique_name!=="card")return;_e.value=i.id,await je();return}if(s.name==="addChild"||s.name==="insertSibling"){const i=s.obj;if(!i||!i.id)return;e.add(i.id);return}if(s.name==="beginEdit"){const i=s.obj;console.log("editing node",i);return}if(s.name==="finishEdit"){const i=s.obj;if(!i||!i.id)return;const S=e.has(i.id),r=a.has(i.id);if(!S&&!r||r)return;if(S){e.delete(i.id),a.add(i.id);const b=i.parent;if(!b||!("unique_name"in b)){a.delete(i.id);return}if(b.unique_name==="root"&&!l.has(i.id)){l.add(i.id);try{await ia({variables:{"sheet-title":i.topic??"New Sheet","sheet-description":"This is custom description"},is_ai_generated:!1,workspace_id:h.value,workspace_module_id:A.value})}catch(g){console.error("Error creating workspace sheet:",g),a.delete(i.id),l.delete(i.id)}return}if(b.unique_name==="List"){try{const g=ua({topic:i.topic??"New Card",id:i.id},b);g.variables&&(g.variables["card-description"]="This is a default description"),await Ze(g)}catch(g){console.error("Error creating card:",g),a.delete(i.id)}return}if(b.unique_name==="sheet"){try{console.log("Creating new list under sheet...")}catch(g){console.error("Error creating list:",g),a.delete(i.id)}return}}}}})})}),O(Oe,()=>{R.value&&R.value.changeTheme(Oe.value?fe.DARK_THEME:fe.THEME)},{immediate:!0});function at(t,e){if(!t||!e||!t.style)return;const a=e.querySelector(".topic"),l=e.querySelector(".node")??e,o=t.style;o.background&&(l.style.background=o.background),o.color&&a&&(a.style.color=o.color),a&&(o.fontSize&&(a.style.fontSize=o.fontSize),o.fontFamily&&(a.style.fontFamily=o.fontFamily),o.fontWeight&&(a.style.fontWeight=o.fontWeight),o.fontStyle&&(a.style.fontStyle=o.fontStyle)),o.borderColor&&(l.style.borderColor=o.borderColor),o.borderWidth&&(l.style.borderWidth=o.borderWidth),o.borderRadius&&(l.style.borderRadius=o.borderRadius),o.padding&&(l.style.padding=o.padding)}function Re(t={}){return{background:t.bg_color,color:t.color,fontSize:t.font_size!=null?`${t.font_size}px`:void 0,fontWeight:t.font_weight,fontStyle:t.font_style,fontFamily:t.font_family,borderColor:t.border_color,borderWidth:t.border_width!=null?`${t.border_width}px`:void 0,borderRadius:t.border_radius!=null?`${t.border_radius}px`:void 0,padding:t.padding!=null?`${t.padding}px`:void 0,hyperLink:t.hyperLink||void 0}}function ua(t,e){const a=new Date,l=a.toISOString().split("T")[0],o=new Date(a.getTime()+3*24*60*60*1e3).toISOString().split("T")[0];return{sheet_list_id:(e==null?void 0:e.topic)||"In Progress",workspace_id:h.value,sheet_id:w.value,workspace_lane_id:(t==null?void 0:t.workspace_lane_id)||null,variables:{"card-status":(e==null?void 0:e.topic)||"In Progress","card-type":"General",priority:"medium",process:null,"card-title":t.topic||"New Card","card-description":"","start-date":l,"end-date":o},createdAt:new Date().toISOString()}}return(t,e)=>{var a,l,o,v,f,E,s,i,S;return c(),_(ce,null,[n("div",Ha,[n("div",Qa,[n("div",Ga,[C(pt,{onEditOption:Ht,modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=r=>w.value=r),canEdit:u(mt),canDelete:u(gt),onDeleteOption:Wt,options:Bt.value,variant:"secondary",customClasses:"fixed w-auto"},{more:G(()=>[u(yt)?(c(),_("div",{key:0,onClick:e[0]||(e[0]=r=>It()),class:"capitalize border-t border-border px-4 py-2 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-1 overflow-hidden overflow-ellipsis text-nowrap"},e[38]||(e[38]=[n("i",{class:"fa-solid fa-plus"},null,-1),Ve(" Add new ")]))):y("",!0)]),_:1},8,["modelValue","canEdit","canDelete","options"]),n("div",Ya,[(p.value=="kanban",c(),I(pt,{key:0,actions:!1,modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=r=>x.value=r),options:u(L),variant:"secondary",customClasses:"fixed w-auto",onNestedSelect:Ct},{more:G(()=>[u(be)?(c(),_("div",{key:0,onClick:e[2]||(e[2]=()=>{ee.value=!0}),class:"sticky bottom-0 bg-bg-dropdown shadow-md shadow-border capitalize border-t border-border px-4 py-2 hover:bg-bg-dropdown-menu-hover cursor-pointer flex items-center gap-1 overflow-hidden overflow-ellipsis text-nowrap"},e[39]||(e[39]=[n("i",{class:"fa-solid fa-plus"},null,-1),Ve(" Add new ")]))):y("",!0)]),_:1},8,["modelValue","options"])),C(za,{onOnChange:e[4]||(e[4]=r=>{ne.value=r}),placeholder:"Search in Orchit AI space"}),n("div",Ja,[n("button",{class:q(["aspect-square cursor-pointer rounded-sm p-0 px-0.5",p.value==="kanban"?"text-accent bg-accent-text":" hover:bg-border/50 backdrop-blur-2xl  transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),title:"List view",onClick:e[5]||(e[5]=r=>p.value="kanban")},e[40]||(e[40]=[n("i",{class:"fa-solid fa-chart-kanban"},null,-1)]),2),n("button",{onClick:e[6]||(e[6]=r=>p.value="table"),class:q(["aspect-square cursor-pointer rounded-sm p-0 px-0.5",p.value==="table"?"text-accent bg-accent-text":"hover:bg-border/50 backdrop-blur-2xl transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),title:"Gallery view"},e[41]||(e[41]=[n("i",{class:"fa-solid fa-align-left"},null,-1)]),2),n("button",{onClick:e[7]||(e[7]=r=>p.value="mindmap"),class:q(["aspect-square cursor-pointer rounded-sm p-0 px-0.5",p.value==="mindmap"?"text-accent bg-accent-text":"hover:bg-border/50 backdrop-blur-2xl transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),title:"MindMap view"},e[42]||(e[42]=[n("i",{class:"fa-solid fa-chart-diagram"},null,-1)]),2),n("button",{onClick:e[8]||(e[8]=r=>p.value="calendar"),class:q(["aspect-square cursor-pointer rounded-sm p-0 px-0.5",p.value==="calendar"?"text-accent bg-accent-text":"hover:bg-border/50 backdrop-blur-2xl transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),title:"Calendar view"},e[43]||(e[43]=[n("i",{class:"fa-regular fa-calendar"},null,-1)]),2),n("button",{onClick:e[9]||(e[9]=r=>p.value="gantt"),class:q(["aspect-square cursor-pointer rounded-sm p-0 px-0.5",p.value==="gantt"?"text-accent bg-accent-text":"hover:bg-border/50 backdrop-blur-2xl transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),title:"Gantt Chart view"},e[44]||(e[44]=[n("i",{class:"fa-solid fa-chart-gantt"},null,-1)]),2),n("button",{onClick:e[10]||(e[10]=r=>p.value="timeline"),class:q(["aspect-square cursor-pointer rounded-sm p-0 px-0.5",p.value==="timeline"?"text-accent bg-accent-text":"hover:bg-border/50 backdrop-blur-2xl transition-all duration-75 hover:outline-border hover:outline hover:text-accent"]),title:"Timeline view"},e[45]||(e[45]=[n("i",{class:"fa-solid fa-timeline"},null,-1)]),2)])])])]),p.value=="kanban"?(c(),_(ce,{key:0},[Ue(C(Ba,null,null,512),[[ot,u(Pe)||u(He)]]),Ue(n("div",Za,[C(u(Nt),{onOnPlus:Ut,board:re.value,"onDelete:column":e[11]||(e[11]=r=>Rt(r)),"onUpdate:column":e[12]||(e[12]=r=>$t(r)),onReorder:Pt,onAddColumn:Ge,"onSelect:ticket":F,onOnBoardUpdate:zt,variable_id:x.value,sheet_id:w.value},{"column-footer":G(r=>{var b,g,ue,Te,lt;return[(g=(b=u(we))==null?void 0:b.transitions)!=null&&g.all_allowed&&!((lt=(Te=(ue=u(we))==null?void 0:ue.transitions)==null?void 0:Te.all_allowed)!=null&&lt.includes(r.column.title))&&u(we).transitions.currentColumn!=r.column.title?(c(),_("div",Xa," Disbale ( you can't drop here ) ")):y("",!0)]}),ticket:G(({ticket:r})=>[C($a,{selectedVar:x.value,onSelect:()=>{F(r)},ticket:r},null,8,["selectedVar","onSelect","ticket"])]),_:1},8,["board","variable_id","sheet_id"]),n("div",{class:"min-w-[270px] sm:min-w-[328px]",onClick:e[14]||(e[14]=ve(()=>{},["stop"]))},[oe.value?(c(),_("div",el,[C(rt,{autofocus:!0,modelValue:j.value,"onUpdate:modelValue":e[13]||(e[13]=r=>j.value=r),placeholder:"Add New list",onKeyup:nt(Se,["enter"])},null,8,["modelValue"]),e[46]||(e[46]=n("p",{class:"text-xs mt-1.5"},"You can add details while editing",-1)),n("div",tl,[C(it,{onClick:Se,varaint:"primary",class:"px-3 py-1 bg-accent cursor-pointer text-white rounded"},{default:G(()=>[Ve(pe(u(qe)?"Adding...":"Add list"),1)]),_:1}),n("i",{class:"fa-solid fa-close",onClick:ze})])])):(c(),_("button",{key:1,disabled:!u(be),class:q(["text-sm text-text-primary py-2.5 font-medium flex items-center justify-center w-full gap-2 bg-bg-body rounded-lg",u(be)?"cursor-pointer":"cursor-not-allowed"]),onClick:ve(ze,["stop"])}," + Add List ",10,al))])],512),[[ot,!u(Pe)&&!u(He)]])],64)):y("",!0),p.value=="table"?(c(),I(Ua,{key:1,onToggleVisibility:oa,onAddVar:e[15]||(e[15]=()=>{ee.value=!0}),isPending:u(Pe)||u(Ft),columns:Yt.value,rows:re.value,canCreate:u(_t),canCreateVariable:u(be),onCreate:ea},null,8,["isPending","columns","rows","canCreate","canCreateVariable"])):y("",!0),p.value==="mindmap"?(c(),_(ce,{key:2},[n("div",ll,[n("div",{ref_key:"mindMapRef",ref:X,class:"flex-1 h-full overflow-hidden rounded-md relative"},null,512),U.value?(c(),_("div",ol,[n("div",nl,[e[48]||(e[48]=n("h3",{class:"text-sm font-semibold text-secondary"},"Format Node",-1)),n("button",{onClick:e[16]||(e[16]=r=>U.value=!1),class:"text-gray-400 hover:text-gray-700"},e[47]||(e[47]=[n("i",{class:"fa-solid fa-times"},null,-1)]))]),n("div",rl,[n("div",null,[e[51]||(e[51]=n("h4",{class:"text-xs font-semibold text-secondary uppercase mb-3"}," Colors ",-1)),n("div",il,[e[49]||(e[49]=n("label",{class:"block text-xs text-secondary mb-1"},"Background",-1)),n("div",{class:"flex items-center gap-2 cursor-pointer",onClick:e[17]||(e[17]=r=>W.value=!W.value)},[n("div",{class:"w-full h-7 rounded border",style:De({background:N.value.background})},null,4),n("span",sl,pe(N.value.background),1)]),W.value?(c(),_("div",dl,[n("div",ul,[(c(),_(ce,null,st(Ke,r=>n("button",{key:r,class:"w-5 h-5 rounded border",style:De({background:r}),onClick:b=>{se("bg_color",{target:{value:r}}),W.value=!1}},null,12,cl)),64))]),n("div",vl,[n("input",{type:"color",value:N.value.background,class:"w-8 h-8 cursor-pointer",onInput:e[18]||(e[18]=r=>se("bg_color",r))},null,40,pl),n("input",{type:"text",class:"flex-1 text-xs border rounded px-2 py-1",value:N.value.background,readonly:""},null,8,fl)])])):y("",!0)]),n("div",bl,[e[50]||(e[50]=n("label",{class:"block text-xs text-secondary mb-1"},"Text",-1)),n("div",{class:"flex items-center gap-2 cursor-pointer",onClick:e[19]||(e[19]=r=>K.value=!K.value)},[n("div",{class:"w-full h-7 rounded border",style:De({background:N.value.color})},null,4),n("span",ml,pe(N.value.color),1)]),K.value?(c(),_("div",gl,[n("div",yl,[(c(),_(ce,null,st(Ke,r=>n("button",{key:r,class:"w-5 h-5 rounded border",style:De({background:r}),onClick:b=>{se("color",{target:{value:r}}),K.value=!1}},null,12,_l)),64))]),n("div",xl,[n("input",{type:"color",value:N.value.color,class:"w-8 h-8 cursor-pointer",onInput:e[20]||(e[20]=r=>se("color",r))},null,40,kl),n("input",{type:"text",class:"flex-1 text-xs border rounded px-2 py-1",value:N.value.color,readonly:""},null,8,hl)])])):y("",!0)])]),n("div",null,[n("div",wl,[n("div",null,[e[53]||(e[53]=n("label",{class:"block text-xs text-secondary mb-1"},"Weight",-1)),n("select",{class:"w-full h-8 border rounded px-2 text-sm",value:N.value.fontWeight,onChange:e[21]||(e[21]=r=>se("font_weight",r))},e[52]||(e[52]=[n("option",{value:"lighter"},"Light",-1),n("option",{value:"normal"},"Normal",-1),n("option",{value:"bold"},"Bold",-1),n("option",{value:"bolder"},"Extra Bold",-1)]),40,Cl)])])])]),n("div",Sl,[n("button",{class:"w-full cursor-pointer bg-gradient-to-tr from-accent to-accent-hover text-white flex items-center justify-center gap-2 px-4 py-2 rounded-md text-sm font-medium hover:shadow-md disabled:opacity-60",disabled:Q.value,onClick:et},[Q.value?(c(),_("span",Dl)):y("",!0),n("span",null,pe(Q.value?"Updating...":"Update"),1)],8,Tl)])])):y("",!0)]),ke.value?(c(),_("div",Vl,[n("div",El,[e[54]||(e[54]=n("h3",{class:"text-lg font-semibold mb-4"},"Insert Web Link",-1)),Ue(n("input",{"onUpdate:modelValue":e[22]||(e[22]=r=>z.value=r),type:"text",placeholder:"Enter or paste a URL",class:"w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[Fa,z.value]]),n("div",Al,[n("button",{onClick:wt,class:"px-4 py-2 rounded-md bg-gray-200 hover:bg-gray-300"}," Cancel "),n("button",{disabled:!z.value,onClick:ht,class:q(["px-4 py-2 rounded-md text-white",z.value?"bg-blue-500 hover:bg-blue-600":"bg-blue-300 cursor-not-allowed"])}," Insert ",10,Ll)])])])):y("",!0),oe.value?(c(),_("div",{key:1,class:"absolute top-40 left-70 bg-bg-body rounded-lg p-4 shadow-lg z-100 min-w-[328px] border",onClick:e[24]||(e[24]=ve(()=>{},["stop"]))},[C(rt,{autofocus:!0,modelValue:j.value,"onUpdate:modelValue":e[23]||(e[23]=r=>j.value=r),placeholder:"Add New list",onKeyup:nt(Se,["enter"])},null,8,["modelValue"]),e[55]||(e[55]=n("p",{class:"text-xs mt-1.5"},"You can add details while editing",-1)),n("div",Nl,[C(it,{onClick:Se,varaint:"primary",class:"px-3 py-1 bg-accent cursor-pointer text-white rounded"},{default:G(()=>[Ve(pe(u(qe)?"Adding...":"Add list"),1)]),_:1}),n("i",{class:"fa-solid fa-close cursor-pointer",onClick:ze})])])):y("",!0)],64)):y("",!0),p.value==="calendar"?(c(),I(Wa,{key:3,data:re.value,"onSelect:ticket":F},null,8,["data"])):y("",!0),p.value==="gantt"?(c(),I(Ka,{key:4,data:re.value,"onSelect:ticket":F},null,8,["data"])):y("",!0),p.value==="timeline"?(c(),I(ja,{key:5,data:re.value,"onSelect:ticket":F},null,8,["data"])):y("",!0)]),C(u(Ne),{onClick:e[25]||(e[25]=ve(()=>{},["stop"])),modelValue:H.value,"onUpdate:modelValue":e[26]||(e[26]=r=>H.value=r),title:"Delete List",itemLabel:"list",itemName:(a=B.value)==null?void 0:a.title,requireMatchText:(l=B.value)==null?void 0:l.title,confirmText:"Delete List",cancelText:"Cancel",size:"md",loading:u(qe),onConfirm:Ot,onCancel:e[27]||(e[27]=()=>{H.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),xe.value?(c(),I(u(Vt),{selectedVariable:x.value,listId:(o=B.value)==null?void 0:o.title,sheet_id:w.value,key:"createTaskModalKey",modelValue:xe.value,"onUpdate:modelValue":e[28]||(e[28]=r=>xe.value=r),onSubmit:e[29]||(e[29]=()=>{})},null,8,["selectedVariable","listId","sheet_id","modelValue"])):y("",!0),(v=te.value)!=null&&v._id?(c(),I(u(Lt),{key:1,details:te.value,onClose:e[30]||(e[30]=()=>{F({variables:{}})}),showPanel:!!((f=te.value)!=null&&f._id)},null,8,["details","showPanel"])):y("",!0),C(u(Et),{size:"md",sheet:$.value,modelValue:le.value,"onUpdate:modelValue":e[31]||(e[31]=r=>le.value=r)},null,8,["sheet","modelValue"]),ee.value?(c(),I(u(At),{key:2,modelValue:ee.value,"onUpdate:modelValue":e[32]||(e[32]=r=>ee.value=r),sheetID:w.value},null,8,["modelValue","sheetID"])):y("",!0),C(u(Ne),{onClick:e[33]||(e[33]=ve(()=>{},["stop"])),modelValue:Z.value,"onUpdate:modelValue":e[34]||(e[34]=r=>Z.value=r),title:"Delete Sheet",itemLabel:"Sheet",itemName:(E=$.value)==null?void 0:E.title,requireMatchText:(s=$.value)==null?void 0:s.title,confirmText:"Delete Sheet",cancelText:"Cancel",size:"md",loading:u(Kt),onConfirm:jt,onCancel:e[35]||(e[35]=()=>{Z.value=!1})},null,8,["modelValue","itemName","requireMatchText","loading"]),C(u(Ne),{modelValue:ye.value,"onUpdate:modelValue":e[36]||(e[36]=r=>ye.value=r),title:"Delete Ticket",itemLabel:"Ticket",itemName:(i=ge.value)==null?void 0:i.title,requireMatchText:(S=ge.value)==null?void 0:S.title,confirmText:"Delete Ticket",cancelText:"Cancel",size:"md",loading:Ee.value,onConfirm:Tt,onCancel:e[37]||(e[37]=()=>{ye.value=!1,ge.value=null})},null,8,["modelValue","itemName","requireMatchText","loading"]),e[56]||(e[56]=n("div",null,null,-1))],64)}}}),jl=Pa(Fl,[["__scopeId","data-v-ad4e1605"]]);export{jl as default};
